//From origin\page\backend\customerservice\customer\customer.js
define("originpagebackendcustomerservicecustomercustomerjs",["avalon","util","moment","json","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,o){function s(e,a,i){var o=JSON.stringify(e);v.pageData=[],t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:i})}function r(e){var t;e.flag&&(t=e.data,v.merchantData=t,console.log(t))}var l=i+"-add-Question-dialog",d=i+"-add-Question-form",c=i+"-schedule",u=i+"-active-select",m=i+"-active-form",p=i+"-active-dialog",f=i+"-active-uploader",g=n.getAppData("user"),v=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:"#/study/coursemanage"},{text:"test"}],a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(o.params.id),a.createData={},a.options1=[],a.options2=[],a.stepData={},a.merchantData={},a.$addQuestionDialogOpts={dialogId:l,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(d);t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(l),o=e.getVm(d);if(o.validate()){a=o.getFormData();var s=e.getVm(c).selectedValue;a.merchantId=v.merchantId,a.problemType=s,a.problemStatus=1,a=JSON.stringify(a),console.log(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(c);a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var o=e.getVm(l),s=e.getVm(d);o.title="添加问题",s.title="",s.description="",o.open()},a.$addQuestionFormOpts={formId:d,field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:c,options:[],selectedIndex:1},a.createActive=function(){var i=e.getVm(p),o=e.getVm(m),s=e.getVm(u);a.options2.length?s.setOptions(a.options2):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,a.options2=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),s.setOptions(a.options2))}}),i.title="营销活动申请",o.activityTitle="",o.description="",i.open()},a.$activeUploaderOpts={uploaderId:f,uploadifyOpts:{uploader:n.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:g.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=JSON.parse(e),e.flag){var t=e.data;v.createData.$model.attachmentName=t.attachmentName,v.createData.$model.originalFileName=t.originalFileName,v.createData.$model.fileSize=t.fileSize}}},a.$createActiveDialogOpts={dialogId:p,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(m);t.reset(),t.activityTitle="",t.description=""},submit:function(){var a,i=e.getVm(p),o=e.getVm(m),s=e.getVm(u);if(o.validate()){a=o.getFormData(),v.createData.$model.merchantId=v.merchantId,v.createData.$model.activityTitle=a.activityTitle,v.createData.$model.description=a.description,v.createData.$model.activityType=s.selectedValue,v.createData.$model.attachmentId=0;var r=JSON.stringify(v.createData.$model);console.log(r),t.c2s({url:n.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:r,success:function(e){console.log(r),1==e.flag&&i.close()}})}}},a.$createActiveFormOpts={formId:m,field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},a.$activeOpts={selectId:u,options:[],selectedIndex:1}});e.scan(a[0]),s({merchantId:v.merchantId},"synMerchant/getMerchantInfoByOrder.do",r)},$remove:function(){}}),i});

//From origin\page\backend\customerservice\customerservice.js
define("originpagebackendcustomerservicecustomerservicejs",["avalon","util","originwidgetpaginationpaginationjs","originwidgetformselectjs"],function(avalon,util){var win=this,erp=win.erp,pageMod={},tempWidgetIdStore=[];return _.extend(pageMod,{$init:function(pageEl,pageName){function updateList(e,t,a){var n=JSON.stringify(e);pageVm.pageData=[],util.c2s({url:erp.BASE_PATH+t,type:"post",contentType:"application/json",data:n,success:a})}function merchantCallBack(responseData){responseData=eval(responseData);var data,paginationVm=avalon.getVm(getTypeId("paginationId"));responseData.flag&&(data=responseData.data,paginationVm.total=data.totalSize,pageVm.pageDataMerchant=data.rows)}function backlogCallBack(e){var t,a=avalon.getVm(getTypeId("paginationId"));e.flag&&(t=e.data,a.total=t.totalSize,pageVm.pageDataBacklog=t.rows)}function backlogCallBackValue(e){var t;e.flag&&(t=e.data,pageVm.dotolen=t.rows.length)}var getTypeId=function(e){var t=pageName+e;return tempWidgetIdStore.push(t),t},pageVm=avalon.define(pageName,function(e){e.pageUserId=erp.getAppData("user").id,e.pageStatus=1,e.pageDataMerchant={},e.pageDataBacklog={},e.options1=[],e.dotolen=0,e.distributionFd={},e.backlog={userId:e.pageUserId,inputItemTypes:["01","02","03","04"],merchantName:"",pageNumber:1,pageSize:10,businessTypes:["1","9","10","11","3","7","12","13"]},e.requestData={merchantStatus:"200",userId:"",pageSize:10,pageNumber:1,merchantName:"",merchantStatusType:0},e.localHref=function(e){util.jumpPage(e)},e.permission={end_attachment_mag:util.hasPermission("end_attachment_mag"),end_email_temp:util.hasPermission("end_email_temp"),end_complaint_mag:util.hasPermission("end_complaint_mag"),end_merchant_mag:util.hasPermission("end_merchant_mag"),end_custom_service_todolist:util.hasPermission("end_custom_service_todolist")},e.changePageStatus=function(t){var a=avalon.getVm(getTypeId("paginationId"));a.currentPage=1,e.pageStatus=t,1==t?(pageVm.requestData.merchantName="",pageVm.requestData.pageNumber=1,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)):2==t&&(pageVm.backlog.merchantName="",pageVm.backlog.pageNumber=1,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack))},e.distributionFd={},e.distribution=function(){var t=avalon.getVm(getTypeId("distributionDialogId")),a=avalon.getVm(getTypeId("fdId")),n={remark:"end_custom_service"};n=JSON.stringify(n),e.distributionFd.$model.userId=this.$vmodel.$model.el.listAssistantUsers.length?this.$vmodel.$model.el.listAssistantUsers[0].id:"",e.distributionFd.$model.merchantId=this.$vmodel.$model.el.merchantId,e.options1.length?(a.setOptions(e.options1),t.title="分配负责人",t.open()):util.c2s({url:erp.BASE_PATH+"user/getAllUsersByResourceCode.do",type:"post",contentType:"application/json",data:n,success:function(n){var i;n.flag&&(i=n.data,e.options1=_.map(i,function(e){return{text:e.userName,value:e.id}}),a.setOptions(e.options1),t.title="分配负责人",t.open())}})},e.$scheduleOpts={selectId:getTypeId("fdId"),options:[],selectedIndex:1},e.$distributionDialogOpts={dialogId:getTypeId("distributionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){},submit:function(){var e,t=avalon.getVm(getTypeId("distributionDialogId")),a=avalon.getVm(getTypeId("fdId"));pageVm.distributionFd.$model.newUserId=a.selectedValue,e=JSON.stringify(pageVm.distributionFd.$model),util.c2s({url:erp.BASE_PATH+"fesOnlineProcess/saveSysAssistantMerchant.do",type:"post",contentType:"application/json",data:e,success:function(e){1==e.flag&&(t.close(),updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack))}})}},e.changeStatus=function(t){var a=avalon.getVm(getTypeId("paginationId"));a.currentPage=1,e.requestData.pageNumber=1,e.requestData.merchantStatus=t,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},e.search=function(){updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},e.showProgressTip=function(){var e=this.$vmodel.$model,t=e.el.stepText,a=pageName+"-progress-tip",n=$(this),i=$("#"+a),o=n.offset();i.length||(i=$('<div id="'+a+'" class="grid-tip"></div>'),i.html('<span class="text-content"></span><span class="icon-arrow"></span>'),i.hide().appendTo("body")),$(".text-content",i).text(t),i.css({top:o.top-i.height()-20,left:o.left-i.width()/2-11}).show()},e.hideProgressTip=function(){$("#"+pageName+"-progress-tip").hide()},e.backlogSearch=function(){var e=avalon.getVm(getTypeId("paginationId"));e.currentPage=1,pageVm.backlog.pageNumber=1,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack)},e.doToStatus=function(e){var t=avalon.getVm(getTypeId("paginationId"));t.currentPage=1,pageVm.backlog.pageNumber=1,pageVm.backlog.inputItemTypes=e,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack)},e.$paginationOpts={paginationId:getTypeId("paginationId"),total:0,onJump:function(){var e=avalon.getVm(getTypeId("paginationId"));0==pageVm.pageStatus||1==pageVm.pageStatus?(pageVm.requestData.pageNumber=e.currentPage,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)):2==pageVm.pageStatus&&(pageVm.backlog.pageNumber=e.currentPage,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack))}}});avalon.scan(pageEl[0]),updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBackValue),updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},$remove:function(){_.each(tempWidgetIdStore,function(e){var t=avalon.getVm(e);t&&$(t.widgetElement).remove()}),tempWidgetIdStore.length=0}}),pageMod});

//From origin\page\backend\customerservice\linewaiting\linewaiting.js
define("originpagebackendcustomerservicelinewaitinglinewaitingjs",["avalon","util","moment","json","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={},o=[];return _.extend(i,{$init:function(a,i,s){function r(e,a,i){var o=JSON.stringify(e);t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:i})}function l(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.userMerchantList=t.userMerchantList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in t){var o=t.hasOwnProperty(i);o&&"object"!=typeof t[i]&&(a[i]=t[i])}for(var i in n){var o=n.hasOwnProperty(i);o&&(a[i]=n[i])}a.imgUrl=a.attachment_name?m.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:m.path+"portal/origin/asset/image/merchant-default-logo.jpg",m.merchantData=a;var s=u.id;if(a.userMerchantList)for(var r=0;r<a.userMerchantList.length;r++){if(s==a.userMerchantList[r].userId)return void(m.promise=!0);m.promise=!1}}}function d(e){var t;if(e.flag){for(var t=e.data,a=[],n=0;n<t.length;n++)if("营销活动创建"==t[n].fesStep.stepName){for(var i=t[n].fesMarketingActivitys,o=0;o<i.length;o++)i[o].fesStep={stepName:"营销活动创建"};a=i}else a.push(t[n]);m.stepData=a}}var c=function(e){var t=i+e;return o.push(t),t},u=n.getAppData("user"),m=e.define(i,function(a){function i(e,t){var a=[];if(e instanceof Array)for(var n=0;n<e.length;n++){var i={};for(var o in e[n]){var s=e[n].hasOwnProperty(o);if(s)for(var r=0;r<t.length;r++)o==t[r]&&(i[t[r]]=e[n][o])}a.push(i)}else{var i={};for(var o in e){var s=e[n].hasOwnProperty(o);if(s)for(var r=0;r<t.length;r++)o==t[r]&&(i[t[r]]=e[n][o])}a.push(i)}return a}a.navCrumbs=[{text:"我的主页",href:"#/backend/customerservice"},{text:"待办事项"}],a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(s.params.id),a.pageStatus=1,a.path=n.BASE_PATH,a.merchantData={productList:[],filePath:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",online_time:"",format_name:"",attachment_name:"",attachment_path:""},a.stepData=[],a.changePageStatus=function(e){a.pageStatus=e,2==e&&a.cardFn()},a.responseCardData=[{card_count:0,card_price:0,card_type:"",merchant_type:"",is_sold_card:!1,merchant_name:"",merchant_id:0,cardtype_id:0,description:"",card_name:""}],a.cardFn=function(){t.c2s({url:n.BASE_PATH+"synMembershipCard/listSynMembershipCards.do",type:"post",data:{pageNumber:1,pageSize:1e4,merchantId:m.merchantId},success:function(e){if(e.flag){var t=e.data.rows,a=["card_count","card_price","card_type","merchant_type","is_sold_card","merchant_name","cardtype_id","description","card_name"];m.responseCardData=i(t,a)}}})},a.options1=[],a.$addQuestionDialogOpts={dialogId:c("addQuestionDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addQuestionForm"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(c("addQuestionDialog")),o=e.getVm(c("addQuestionForm"));if(o.validate()){a=o.getFormData();var s=e.getVm(c("addQuestionSelect")).selectedValue;a.merchantId=m.merchantId,a.problemType=s,a.problemStatus=1,a=JSON.stringify(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(c("addQuestionSelect"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var o=e.getVm(c("addQuestionDialog")),s=e.getVm(c("addQuestionForm"));o.title="添加问题",s.title="",s.description="",o.open()},a.$addQuestionFormOpts={formId:c("addQuestionForm"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:c("addQuestionSelect"),options:[],selectedIndex:1},a.accessSwitch=1,a.step9AccessId=0,a.acessRequestData={},a.accessSwitchFn=function(e){a.accessSwitch=e},a.step9Access=function(i){var o,s=(e.getVm(c("addAccessForm")),e.getVm(c("addAccessDialog")));if("add"==i){a.step9AccessId=0;var r=JSON.stringify([{documentType:"2"},{documentType:"3"}]);o="sysQuestion/listMutiSysQuestions.do"}else if("edit"==i){a.step9AccessId=1;var r=JSON.stringify({merchantId:m.merchantId});o="sysDocument/getSysDocumentByMerchantId.do"}t.c2s({url:n.BASE_PATH+o,type:"post",contentType:"application/json",data:r,success:function(e){function t(e){for(var t=[],a=0;a<e.length;a++){var n={};n.optionContent=e[a].optionContent,n.isSelected=e[a].isSelected,n.isOpenTextarea=e[a].isOpenTextarea,n.tip=e[a].tip,n.isOpenTextarea=e[a].isOpenTextarea,n.comment=e[a].comment?e[a].comment:"",t.push(n)}return t}function n(e){for(var a=[],n=0;n<e.length;n++){var i={};i.questionId=e[n].id,i.questionType=e[n].question_type,i.title=e[n].title,i.tip=e[n].tip,i.comment=e[n].comment?e[n].comment:"",e[n].sysQuestionOptionList&&(i.sysDocumentDtlOptionList=t(e[n].sysQuestionOptionList)),a.push(i)}return a}if(1==e.flag)if("add"==i){var o=e.data,r={};r.data1=n(o[2]),r.data2=n(o[3]),a.acessRequestData=r,s.title="回访单",s.open()}else if("edit"==i){var o=e.data,r={};r.data1=o[0].sysDocumentDtlList,r.data2=o[1].sysDocumentDtlList,a.acessRequestData=r,s.title="回访单",s.open()}}})},a.radioBox=function(e){for(var t=e.sysDocumentDtlOptionList,a=0;a<t.length;a++)t[a].isSelected="0",t[a].comment="";this.$vmodel.$model.el.isSelected="1",$(this).closest("li").find("textarea").removeClass("valid-error-field"),$(this).closest("li").find(".ff-value-tip").hide()},a.checkBox=function(){var e=this.$vmodel.$model.el;e.isSelected="1"==e.isSelected?"0":"1"},a.$addAccessDialogOpts={dialogId:c("addAccessDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="close">关&nbsp;闭</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},width:660,readonly:!1,onOpen:function(){},onClose:function(){var t=e.getVm(c("addAccessForm"));t.reset()},submit:function(){var a,i=e.getVm(c("addAccessDialog")),o=e.getVm(c("addAccessForm")),s=[],l={},u={};o.testVal()&&(a="sysDocument/saveDocumentAndUpdateStatusAfterStep10.do",l.documentType=2,l.merchantId=m.merchantId,u.documentType=3,u.merchantId=m.merchantId,l.sysDocumentDtlList=m.acessRequestData.data1.$model,u.sysDocumentDtlList=m.acessRequestData.data2.$model,s.push(l),s.push(u),s=JSON.stringify(s),t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:s,success:function(e){1==e.flag&&(i.close(),r({merchantId:m.merchantId},"fesOnlineProcess/listFesOnlineProcesssAfterOnline.do",d))}}))}},a.$addAccessFormOpts={formId:c("addAccessForm"),testVal:function(){for(var t=!0,a=e.getVm(c("addAccessForm")),n=a.widgetElement,i=$(".questions",$(n)),o=0;o<i.length;o++){var s=$(i[o]);if(!_.str.trim(s.val())){s.blur(function(){var e=_.str.trim($(this).val());if(e)$(this).removeClass("valid-error-field"),$(this).next(".ff-value-tip").hide();else{$(this).addClass("valid-error-field");var t=$(this).next(".ff-value-tip");t?t.addClass("valid-error").html("内容不能为空！").show():$(this).parent().append("<div class='ff-value-tip valid-error'>内容不能为空</div>")}}),s.addClass("valid-error-field");var r=s.next(".ff-value-tip");r?r.addClass("valid-error").html("内容不能为空！").show():s.parent().append("<div class='ff-value-tip valid-error'>内容不能为空</div>"),t=!1}}return t},questions:""},a.$step9AttachUploaderOpts={uploaderId:c("lineAttachUploaderId"),uploadifyOpts:{uploader:n.BASE_PATH+"sysDocument/uploadRecordAndSaveSysDocumentAfterOnline.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:u.sessionId,inputSysDocuments:JSON.stringify([{merchantId:m.merchantId,documentType:2},{merchantId:m.merchantId,documentType:3}])}},width:110,height:30},onSuccessResponseData:function(e){e=JSON.parse(e),e.flag&&r({merchantId:m.merchantId},"fesOnlineProcess/listFesOnlineProcesssAfterOnline.do",d)}},a.disposeOpen=function(){t.confirm({content:"你确认已经回访了吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"sysDocument/closeToDoListsAfterViste.do",type:"post",data:{merchantId:m.merchantId},success:function(e){e.flag&&r({merchantId:m.merchantId},"fesOnlineProcess/listFesOnlineProcesssAfterOnline.do",d)}})}})},a.activeReqData={activityId:"",status:"",reason:""},a.activeSelect=function(a,i){if("2"==a){var o="您确定活动申请已经创建了吗？";t.confirm({content:o,onSubmit:function(){t.c2s({url:n.BASE_PATH+"activity/updateActivityStatus.do",type:"post",data:{activityId:i,status:a},success:function(e){e.flag&&r({merchantId:m.merchantId},"fesOnlineProcess/listFesOnlineProcesssAfterOnline.do",d)}})}})}else if("3"==a){m.activeReqData.activityId=i,m.activeReqData.status=a;var s=e.getVm(c("activeDialogId"));s.title="关闭申请",s.open()}},a.$activeDisposeOpts={dialogId:c("activeDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){var t=e.getVm(c("activeform"));t.reason=""},submit:function(){var a=e.getVm(c("activeDialogId")),i=e.getVm(c("activeform"));if(i.validate()){var o=m.activeReqData.$model;t.c2s({url:n.BASE_PATH+"activity/updateActivityStatus.do",type:"post",data:{activityId:o.activityId,status:o.status,reason:o.reason},success:function(e){1==e.flag&&(a.close(),i.reason="",r({merchantId:m.merchantId},"fesOnlineProcess/listFesOnlineProcesssAfterOnline.do",d))}})}}},a.$activeformOpts={formId:c("activeform"),field:[{selector:".reason",name:"reason",rule:["noempty",function(e,t){return e.length>250?"内容不能超过250个字！":t[0]!==!0?"内容不能为空":!0}]}]}});e.scan(a[0]),r({merchantId:m.merchantId},"synMerchant/getMerchantInfoByOrder.do",l),r({merchantId:m.merchantId},"fesOnlineProcess/listFesOnlineProcesssAfterOnline.do",d)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),i});

//From origin\page\backend\customerservice\waiting\waiting.js
define("originpagebackendcustomerservicewaitingwaitingjs",["avalon","util","moment","json","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i,o){function r(e,a,i){var s=JSON.stringify(e);t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:s,success:i})}function l(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?m.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:m.path+"portal/origin/asset/image/merchant-default-logo.jpg",m.merchantData=a,m.navCrumbs[1].text=a.merchant_name}}function d(t){var a,n=e.getVm(c("step63Uploder"));if(t.flag){n&&$(n.widgetElement).remove(),a=t.data;for(var i=[],s=0;s<a.length;s++)"micro_message"==a[s].stepNum&&i.push(a[s]),"final_program"==a[s].stepNum&&i.push(a[s]),"entity_cards"==a[s].stepNum&&i.push(a[s]),"background_set"==a[s].stepNum&&i.push(a[s]),"train"==a[s].stepNum&&i.push(a[s]);m.pageData=i}}var c=function(e){var t=i+e;return s.push(t),t},u=n.getAppData("user"),m=e.define(i,function(a){function i(e){for(var t=0;t<a.pageData.length;t++)if(a.pageData[t].stepNum==e)return a.pageData[t].id}a.navCrumbs=[{text:"后端客服",href:"#/backend/customerservice"},{text:"test"}],a.path=n.BASE_PATH,a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(o.params.id),a.pageData={};var s=function(){a.merchantData={productList:[],filePath:"",merchant_id:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",format_name:"",attachment_name:"",attachment_path:""}};s();var l=function(){a.options1=[],a.$addQuestionDialogOpts={dialogId:c("addQuestionDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addQuestionForm"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(c("addQuestionDialog")),s=e.getVm(c("addQuestionForm"));if(s.validate()){a=s.getFormData();var o=e.getVm(c("addQuestionSelect")).selectedValue;a.merchantId=m.merchantId,a.problemType=o,a.problemStatus=1,a=JSON.stringify(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(c("addQuestionSelect"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var s=e.getVm(c("addQuestionDialog")),o=e.getVm(c("addQuestionForm"));s.title="添加问题",o.title="",o.description="",s.open()},a.$addQuestionFormOpts={formId:c("addQuestionForm"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:c("addQuestionSelect"),options:[],selectedIndex:1}};l(),a.removeAttach=function(e,a){t.confirm({content:"你确定要删除文档吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/deleteAttachment/"+e+"/"+a+".do",type:"get",success:function(e){e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}})}})};var p=function(){a.removeWeixin=function(e,a){var i={id:a,processId:e,merchantId:m.merchantId},s=JSON.stringify(i);t.confirm({content:"确定要删除选中的微信申请吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"applySetting/deleteRemark.do",type:"post",contentType:"application/json",data:s,success:function(e){e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}})}})},a.addWeixin=function(){var t=e.getVm(c("addWeixinDialog"));t.weixinId=this.$vmodel.$model.el.id,t.title="备注",t.open()},a.$addWeixinDialogOpts={dialogId:c("addWeixinDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addWeixinForm"));t.reset()},submit:function(){var a=e.getVm(c("addWeixinForm")),i=e.getVm(c("addWeixinDialog"));if(a.validate()){a.description.length>250&&t.confirm({content:"内容不能超过250个字！"});var s=a.getFormData();s.processId=i.weixinId,s.merchantId=m.merchantId;var o=JSON.stringify(s);t.c2s({url:n.BASE_PATH+"applySetting/addRemark.do",type:"post",contentType:"application/json",data:o,success:function(e){1==e.flag&&(i.close(),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d))}})}}},a.$addWeixinFormOpts={formId:c("addWeixinForm"),field:[{selector:".description",name:"remark",rule:["noempty",function(e,t){return e.length>250?"内容不能超过250个字！":t[0]!==!0?"内容不能为空":!0}]}],description:""}};p(),a.addAfter=function(){var t=e.getVm(c("addAfterDialog"));t.id=this.$vmodel.$model.el.id,t.title="更新状态",t.open()},a.removeAfter=function(e,a){var i={id:a,processId:e,merchantId:m.merchantId},s=JSON.stringify(i);t.confirm({content:"确定要删除选中的后台设置吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/deleteBackGroundContent.do",type:"post",contentType:"application/json",data:s,success:function(e){e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}})}})},a.$addSetDialogOpts={dialogId:c("addAfterDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addAfterFormlog"));t.reset()},submit:function(){var a=e.getVm(c("addAfterFormlog")),i=e.getVm(c("addAfterDialog"));if(a.validate()){a.description.length>250&&t.confirm({content:"内容不能超过250个字！"});var s=a.getFormData();s.id=i.id,s.merchantId=m.merchantId,s.onlineProcessStatus="03";var o=JSON.stringify(s);t.c2s({url:n.BASE_PATH+"fesOnlineProcess/saveBackGroundContent.do",type:"post",contentType:"application/json",data:o,success:function(e){1==e.flag&&(i.close(),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d))}})}}},a.$addSetFormOpts={formId:c("addAfterFormlog"),field:[{selector:".set-description",name:"remark",rule:["noempty",function(e,t){return e.length>250?"内容不能超过250个字！":t[0]!==!0?"内容不能为空":!0}]}],description:""},a.$step63UploaderOpts={uploaderId:c("step63Uploder"),uploadifyOpts:{uploader:n.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:u.sessionId,processId:i("entity_cards"),typeId:12}},width:120,height:30,progressData:"speed"},onSuccessResponseData:function(e){e=JSON.parse(e),e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}};var f=function(){a.carRequestData={processId:0,merchantId:a.merchantId,fesOpenCardApplicationDtls:[{cardName:"",cardAmount:"",validityTerm:1,isContainFour:"0",isContainSeven:"0"}]},a.openCard=function(t){var n=e.getVm(c("cardDialog"));n.title="开卡申请",a.carRequestData.processId=t,n.open()},a.changeRedio4=function(e){this.$vmodel.$model.el.isContainFour=e},a.changeRedio7=function(e){this.$vmodel.$model.el.isContainSeven=e},a.$addCardDialogOpts={dialogId:c("cardDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button ms-if="save" type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},save:1,width:530,onClose:function(){var t=e.getVm(c("cardForm"));t.reset(),t.cardName="",t.cardAmount="",t.validityTerm=""},submit:function(){var a,i=e.getVm(c("cardDialog")),s=e.getVm(c("cardForm"));if(s.validate()){for(var o=m.carRequestData.$model.fesOpenCardApplicationDtls,l=0;l<o.length;l++)o[l].cardAmount=Number(o[l].cardAmount),o[l].validityTerm=Number(o[l].validityTerm);a=JSON.stringify(m.carRequestData.$model),t.c2s({url:n.BASE_PATH+"applySetting/saveOpenCardApply.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&(i.close(),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d))}})}}},a.$addCardFormOpts={formId:c("cardForm"),field:[{selector:".cardName",rule:["noempty",function(e,t){return t[0]!==!0?"卡类型名称不能为空":!0}]},{selector:".cardAmount",rule:["noempty",function(e,t){if(t[0]!==!0)return"开卡数量不能为空";var a=/^[0-9]\d*$/;return a.test(e)?!0:"开卡数量必须为数字"}]}],cardName:"",cardAmount:"",validityTerm:""},a.readCard=function(i){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/getFesOpenCardApplicationsAndDtls.do",type:"post",contentType:"application/json",data:JSON.stringify({processId:i}),success:function(t){if(1==t.flag){m.carRequestData=t.data[0];var n=e.getVm(c("cardDialog"));n.save=0,a.openCard()}}})},a.addCarList=function(){var e={cardName:"",cardAmount:"",validityTerm:1,isContainFour:0,isContainSeven:"0"};a.carRequestData.fesOpenCardApplicationDtls.push(e)},a.removeCarList=function(){a.carRequestData.fesOpenCardApplicationDtls.pop()}};f();var g=function(){a.step9AccessId=0,a.acessRequestData=[],a.step9Access=function(i,s,o){var r,l=(e.getVm(c("addAccessForm")),e.getVm(c("addAccessDialog")));if("add"==i){a.step9AccessId=0;var d=JSON.stringify({documentType:"1"});r="sysQuestion/listSysQuestions.do"}else if("edit"==i){a.step9AccessId=s;var d=JSON.stringify({id:s});r="sysDocument/querySysDocumentById.do"}t.c2s({url:n.BASE_PATH+r,type:"post",contentType:"application/json",data:d,success:function(t){function n(e){for(var t=[],a=0;a<e.length;a++){var n={};n.optionContent=e[a].optionContent,n.isSelected=e[a].isSelected,n.isOpenTextarea=e[a].isOpenTextarea,n.tip=e[a].tip,n.isOpenTextarea=e[a].isOpenTextarea,n.comment=e[a].comment?e[a].comment:"",t.push(n)}return t}function s(e){for(var t=[],a=0;a<e.length;a++){var i={};i.questionId=e[a].id,i.questionType=e[a].question_type,i.title=e[a].title,i.tip=e[a].tip,i.comment=e[a].comment?e[a].comment:"",e[a].sysQuestionOptionList&&(i.sysDocumentDtlOptionList=n(e[a].sysQuestionOptionList)),t.push(i)}return t}function r(){var t=e.getVm(c("addAccessDialog")),a=e.getVm(c("addAccessForm"));t.readonly=!0;{var n=a.widgetElement;$("input",$(n)).attr("disabled","disabled"),$("textarea",$(n)).attr("disabled","disabled")}}if(1==t.flag)if("add"==i){var d=t.data;d=s(d),a.acessRequestData=d,l.title="回访单",l.open()}else if("edit"==i){var d=t.data.sysDocumentDtlList;a.acessRequestData=d,l.title="回访单","04"==o&&r(),l.open()}}})},a.radioBox=function(e){for(var t=e.sysDocumentDtlOptionList,a=0;a<t.length;a++)t[a].isSelected="0",t[a].comment="";this.$vmodel.$model.el.isSelected="1",$(this).closest("li").find("textarea").removeClass("valid-error-field"),$(this).closest("li").find(".ff-value-tip").hide();this.name,this.$vmodel.$model.el.optionContent},a.checkBox=function(){var e=this.$vmodel.$model.el;e.isSelected="1"==e.isSelected?"0":"1"},a.$addAccessDialogOpts={dialogId:c("addAccessDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="close">关&nbsp;闭</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},width:600,readonly:!1,onOpen:function(){},onClose:function(){var t=e.getVm(c("addAccessDialog")),a=e.getVm(c("addAccessForm"));a.reset(),t.readonly=!1},submit:function(){var a,i=e.getVm(c("addAccessDialog")),s=e.getVm(c("addAccessForm")),o={};s.testVal()&&(m.step9AccessId?(o.id=m.step9AccessId,a="sysDocument/saveDocumentAndUpdateStatusForStep9.do"):a="sysDocument/saveDocumentAndUpdateStatusForStep9.do",o.documentType=1,o.merchantId=m.merchantId,o.sysDocumentDtlList=m.acessRequestData.$model,o=JSON.stringify(o),t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:function(e){1==e.flag&&(i.close(),i.readonly=!1,r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d))}}))}},a.$addAccessFormOpts={formId:c("addAccessForm"),testVal:function(){for(var t=!0,a=e.getVm(c("addAccessForm")),n=a.widgetElement,i=$(".questions",$(n)),s=0;s<i.length;s++){var o=$(i[s]);if(!_.str.trim(o.val())){o.blur(function(){var e=_.str.trim($(this).val());if(e)$(this).removeClass("valid-error-field"),$(this).next(".ff-value-tip").hide();else{$(this).addClass("valid-error-field");var t=$(this).next(".ff-value-tip");t?t.addClass("valid-error").html("内容不能为空！").show():$(this).parent().append("<div class='ff-value-tip valid-error'>内容不能为空</div>")}}),o.addClass("valid-error-field");var r=o.next(".ff-value-tip");r?r.addClass("valid-error").html("内容不能为空！").show():o.parent().append("<div class='ff-value-tip valid-error'>内容不能为空</div>"),t=!1}}return t},questions:""}};g(),a.$step9AttachUploaderOpts={uploaderId:c("attachUploaderId"),uploadifyOpts:{uploader:n.BASE_PATH+"sysDocument/uploadRecordAndSaveSysDocumentForStep9.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:u.sessionId,inputSysDocument:JSON.stringify({merchantId:m.merchantId,documentType:1})}},width:110,height:30},onSuccessResponseData:function(e){e=JSON.parse(e),e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}},a.stepEnd=function(e,i,s,o){var r={id:e,onlineProcessStatus:i},l=JSON.stringify(r);t.confirm({content:s,onSubmit:function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/updateFesOnlineProcessStatus.do",type:"post",contentType:"application/json",data:l,success:function(e){if(e.flag)for(var t=0;t<a.pageData.length;t++)a.pageData[t].stepNum==o&&(a.pageData[t].onlineProcessStatus=i,a.pageData[t].listAttachmentAndOperateLog.push(e.data))}})}})}});e.scan(a[0]),r({merchantId:m.merchantId},"synMerchant/getMerchantInfoByOrder.do",l),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",d)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\backend\distribution\distribution.js
define("originpagebackenddistributiondistributionjs",["avalon","util","originwidgetpaginationpaginationjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i){function o(e,a,i){var s=JSON.stringify(e);d.pageData=[],t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:s,success:i})}function r(t){var a,n=e.getVm(l("paginationId"));t.flag&&(a=t.data,n.total=a.totalSize,d.pageData=a.rows,d.backlog.merchantName="")}var l=function(e){var t=i+e;return s.push(t),t},d=e.define(i,function(t){t.pageUserId=n.getAppData("user").id,t.logItemStatus="01",t.pageData={},t.backlog={userId:t.pageUserId,inputItemTypes:["01"],merchantName:"",pageNumber:1,pageSize:10,businessTypes:["8"]},t.changeStatus=function(e){t.backlog.inputItemTypes=e,o(d.backlog.$model,"myHomePage/getComplexSysToDoLists.do",r)},t.$paginationOpts={paginationId:l("paginationId"),total:0,onJump:function(){var t=e.getVm(l("paginationId"));d.backlog.pageNumber=t.currentPage,o(d.backlog.$model,"myHomePage/getComplexSysToDoLists.do",r)}}});e.scan(a[0]),o(d.backlog.$model,"myHomePage/getComplexSysToDoLists.do",r)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\backend\distribution\waiting\waiting.js
define("originpagebackenddistributionwaitingwaitingjs",["avalon","util","moment","json","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,s){function o(e,a,i){var s=JSON.stringify(e);t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:s,success:i})}function r(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?u.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:u.path+"portal/origin/asset/image/merchant-default-logo.jpg",u.merchantData=a,u.navCrumbs[1].text=a.merchant_name}}function l(e){var t;if(e.flag){t=e.data;for(var a=[],n=0;n<t.length;n++)"equipment_distribution"==t[n].stepNum&&a.push(t[n]);u.pageData=a}}var d=function(e){return n.arr||(n.arr=[]),n.arr.push(i+e),i+e},c=n.getAppData("user"),u=e.define(i,function(a){a.navCrumbs=[{text:"设备配送",href:"#/backend/distribution"},{text:"test"}],a.path=n.BASE_PATH,a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(s.params.id),a.pageData={},a.imgUrl="";var i=function(){a.merchantData={productList:[],filePath:"",merchant_id:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",format_name:"",attachment_name:"",attachment_path:"",imgUrl:""}};i();var o=function(){a.options1=[],a.$addQuestionDialogOpts={dialogId:d("addQuestionDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(d("addQuestionForm"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(d("addQuestionDialog")),s=e.getVm(d("addQuestionForm"));if(s.validate()){a=s.getFormData();var o=e.getVm(d("addQuestionSelect")).selectedValue;a.merchantId=u.merchantId,a.problemType=o,a.problemStatus=1,a=JSON.stringify(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(d("addQuestionSelect"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var s=e.getVm(d("addQuestionDialog")),o=e.getVm(d("addQuestionForm"));s.title="添加问题",o.title="",o.description="",s.open()},a.$addQuestionFormOpts={formId:d("addQuestionForm"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:d("addQuestionSelect"),options:[],selectedIndex:1}};o(),a.stepEnd=function(e,i,s,o){var r={id:e,onlineProcessStatus:i},l=JSON.stringify(r);t.confirm({content:s,onSubmit:function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/updateFesOnlineProcessStatus.do",type:"post",contentType:"application/json",data:l,success:function(e){if(e.flag)for(var t=0;t<a.pageData.length;t++)a.pageData[t].stepNum==o&&(a.pageData[t].onlineProcessStatus=i,a.pageData[t].listAttachmentAndOperateLog.push(e.data))}})}})};var r=function(){function i(e,t){for(var a=[],n=0,i=t[e].length;i>n;n++){var s={};s.text=t[e][n].dictionary_value,s.value=t[e][n].dictionary_key,a.push(s)}return a}a.step8DistriRequestData={processId:198,logisticsCompany:"",logisticsNum:"",contactId:1,fesStowageDtls:[{category:"",amount:1,unitType:""}]};var s={};a.step8Index=-1,a.addCardModel=function(){var t=++a.step8Index,n='<div class="step8-model tep{replace}" ms-controller="model{replace}"><div class="ff-value"><div class="ff-value-box"><span class="schedule card-type" ms-widget="select,$,$selectTypeOpts{replace}"></span><input class="input-text card-number amount2" name="amount2" ms-duplex="amount"><span class="schedule card-unit" ms-widget="select,$,$selectUnitOpts{replace}"></span><span class="card-remove" ms-click="removeCarModel({replace})">-</span></div><div class="ff-value-tip"></div></div></div>';n=n.replace(/{replace}/g,t),$(".step8-dom-parent").eq(0).append(n),s[t]=e.define("model"+t,function(e){e.amount=1,e["$selectTypeOpts"+t]={selectId:d("selectTypeId"+t),options:u.selectType,selectedIndex:0},e["$selectUnitOpts"+t]={selectId:d("selectUnitId"+t),options:u.selectUnit,selectedIndex:0}}),e.scan($(".step8-dom-parent").eq(0)[0],[a])},a.removeCarModel=function(t){var a=e.getVm(d("selectTypeId"+t)),n=e.getVm(d("selectUnitId"+t));$(a.widgetElement).remove(),$(n.widgetElement).remove(),$(".tep"+t)[0].remove(),delete s[t]},a.step8Distri=function(s){var o=e.getVm(d("step8DistriDialog"));o.processId=s;var r=["00000045","00000083"];r=JSON.stringify(r),t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByTypeList.do",type:"post",contentType:"application/json",data:r,success:function(t){var n;if(t.flag){n=t.data;for(var s in n)"00000045"==s?(a.selectType=i(s,n),e.getVm(d("selectTypeId")).setOptions(a.selectType)):"00000083"==s&&(a.selectUnit=i(s,n),e.getVm(d("selectUnitId")).setOptions(a.selectUnit))}}});var l=JSON.stringify({merchantId:a.merchantId});t.c2s({url:n.BASE_PATH+"contact/queryContact.do",type:"post",contentType:"application/json",data:l,success:function(t){if(t.flag){for(var a=t.data,n=[],i=0;i<a.length;i++){var s={};s.value=a[i].id,s.text=a[i].name,n.push(s)}e.getVm(d("selectMessId")).setOptions(n),o.title="确认设备配送",o.open()}}})},a.$addDistriDialogOpts={dialogId:d("step8DistriDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},width:500,onClose:function(){var t=e.getVm(d("step8DistriForm"));t.reset(),t.logisticsNum="",t.logisticsCompany=""},submit:function(){var i=e.getVm(d("step8DistriDialog")),o=e.getVm(d("step8DistriForm")),r=e.getVm(d("selectTypeId")),l=e.getVm(d("selectUnitId")),c=e.getVm(d("selectMessId"));if(o.validate()){u.step8DistriRequestData.$model.processId=i.processId,u.step8DistriRequestData.$model.contactId=c.selectedValue,u.step8DistriRequestData.$model.fesStowageDtls[0].category=r.selectedValue,u.step8DistriRequestData.$model.fesStowageDtls[0].unitType=l.selectedValue;for(var m in s){var p={};console.log(e.getVm(d("selectTypeId"+m))),p.category=e.getVm(d("selectTypeId"+m)).selectedValue,p.unitType=e.getVm(d("selectUnitId"+m)).selectedValue,p.amount=parseInt(s[m].amount),u.step8DistriRequestData.$model.fesStowageDtls.push(p)}var f=JSON.stringify(u.step8DistriRequestData.$model);t.c2s({url:n.BASE_PATH+"applySetting/saveFesStowage.do",type:"post",contentType:"application/json",data:f,success:function(e){if(console.log(f),1==e.flag){i.close();for(var t=0;t<a.pageData.length;t++)"equipment_distribution"==a.pageData[t].stepNum&&(a.pageData[t].onlineProcessStatus="04",a.pageData[t].listAttachmentAndOperateLog.push(e.data))}}})}}},a.$addDistriFormOpts={formId:d("step8DistriForm"),field:[{selector:".logisticsNum",rule:["noempty",function(e,t){return t[0]!==!0?"快点单号不能为空":!0}]},{selector:".logisticsCompany",rule:["noempty",function(e,t){return t[0]!==!0?"物流公司不能为空":!0}]},{selector:".amount",rule:["noempty",function(e,t){return t[0]!==!0?"设备个数不能为空":!0}]}],logisticsNum:"",logisticsCompany:"",amount:""},a.$selectTypeOpts={selectId:d("selectTypeId"),options:[],selectedIndex:0},a.$selectUnitOpts={selectId:d("selectUnitId"),options:[],selectedIndex:0},a.$selectMessOpts={selectId:d("selectMessId"),options:[{text:"X展架",value:7}],selectedIndex:0}};r()});e.scan(a[0]),o({merchantId:u.merchantId},"synMerchant/getMerchantInfoByOrder.do",r),o({merchantId:u.merchantId,userId:c.id,resourceRemark:"end_delivery_service"},"fesOnlineProcess/listFesOnlineProcesss.do",l)},$remove:function(){for(var t=0;t<n.arr.length;t++){var a=e.getVm(n.arr[t]);a&&$(a.widgetElement).remove()}n.arr.length=0}}),i});

//From origin\page\backend\home\home.js
define("originpagebackendhomehomejs",["avalon","util","json","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetgridgridjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i){{var o=function(e){var t=i+e;return s.push(t),t};e.define(i,function(a){a.pageUserId=n.getAppData("user").id,a.pageStatus=1,a.localHref=function(e){t.jumpPage(e)},a.permission={},a.changePageStatus=function(t){a.pageStatus=t,1==t&&e.getVm(o("-tabs1-grid")).load()},a.$gridTab1Opts={gridId:o("-tabs1-grid"),disableCheckAll:!1,disableCheckbox:!1,getTemplate:function(e){var t=e.split("MS_OPTION_TBAR"),a=t[1].split("MS_OPTION_MAIN")[0],n='<div class="ui-grid-bbar fn-clear"><div class="grid-action fn-left"><button type="button" class="check-all-btn main-btn" ms-click="scCheckAll">全选</button>&nbsp;<button type="button" class="batch-remove-btn main-btn">批量指派</button></div><div class="pagination fn-right" ms-widget="pagination,$,$paginationOpts"></div></div>';return'<div class="ui-grid-search"><input type="text" class="input-text" placeholder="需求标题"><button type="button" class="query-btn main-btn" ms-click="search">搜索</button></div>MS_OPTION_TBAR'+a+n},columns:[{dataIndex:"course_name",text:"全部",html:!0,hideable:!1,renderer:function(){},headerWidget:{type:"select",widgetConfig:{selectId:"test1",options:[]}}},{dataIndex:"time_limit",text:"需求标题"},{dataIndex:"time_limit",text:"全部类型",html:!0,hideable:!1,headerWidget:{type:"select",widgetConfig:{selectId:"test2",options:[]}}},{dataIndex:"operation",text:"来源"},{dataIndex:"operation",text:"操作"}],onLoad:function(e,a){t.c2s({url:n.BASE_PATH+"course/getCourseInfo.do",data:e,success:function(e){var t;e.flag&&(t=e.data,a.call(this,t))}})}}})}e.scan(a[0]),e.getVm(o("-tabs1-grid")).load(),function(){alert(1)}()},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\backend\monthlycheck\monthlycheck.js
define("originpagebackendmonthlycheckmonthlycheckjs",["avalon","util","json","moment","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetgridgridjs"],function(e,t,a,n){var i=this,s=i.erp,o={},r=[];return _.extend(o,{$init:function(i,o){var l=function(e){var t=o+e;return r.push(t),t},d=e.define(o,function(i){i.permission={},i.pageUserId=s.getAppData("user").id,i.$yearSelectOpts={selectId:l("-year"),options:[{value:"2014",text:"2014年"},{value:"2015",text:"2015年"}]},i.$monthSelectOpts={selectId:l("-month"),options:[{value:"01",text:"1月月报"},{value:"02",text:"2月月报"},{value:"03",text:"3月月报"},{value:"04",text:"4月月报"},{value:"05",text:"5月月报"},{value:"06",text:"6月月报"},{value:"07",text:"7月月报"},{value:"08",text:"8月月报"},{value:"09",text:"9月月报"},{value:"10",text:"10月月报"},{value:"11",text:"11月月报"},{value:"12",text:"12月月报"}]},i.$fdSelectOpts={selectId:l("-fd"),options:[{value:0,text:"全部前端"}]},i.$checkSelectOpts={selectId:l("-check"),options:[{value:"",text:"全部商户"},{value:"1",text:"明天要讲解月报"}],selectedIndex:1},i.$statusSelectOpts={selectId:l("-status"),options:[{value:"",text:"全部状态"}]},i.keyword="",i.search=function(){e.getVm(l("-grid")).load()},t.c2s({url:s.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000101",success:function(t){var a,n=e.getVm(l("-status"));if(t.flag){a=t.data;var i=_.map(a,function(e){return{text:e.dictionary_value,value:e.dictionary_key}});i.unshift({value:"",text:"全部状态"}),n.setOptions(i)}}}),t.c2s({url:s.BASE_PATH+"user/getAllUsersByResourceCode.do",contentType:"application/json",type:"post",data:a.stringify({remark:"fes_my_main_page"}),success:function(t){var a,n=e.getVm(l("-fd"));if(t.flag){a=t.data;var i=_.map(a,function(e){return{text:e.userName,value:e.id}});i.unshift({value:0,text:"全部前端"}),n.setOptions(i)}}}),i.keyword="",i.$gridOpts={gridId:l("-grid"),disableCheckAll:!0,disableCheckbox:!0,getTemplate:function(e){var t=e.split("MS_OPTION_TBAR");return'<div class="ui-grid-tbar fn-clear"><div class="fn-left">共<span class="num">{{gridTotalSize}}</span>个商户</div></div>MS_OPTION_TBAR'+t[1]},columns:[{dataIndex:"merchant_name",text:"商户",html:!0,renderer:function(){return'<div style="text-align: left">{{$outer.el.merchant_name}}</div>'}},{dataIndex:"front_user_name",text:"前端"},{dataIndex:"open_number",text:"开台数",html:!0,renderer:function(){return'<span ms-visible="$outer.el.open_number == 0">未填写</span><span class="end" ms-visible="$outer.el.open_number == 1">已填写</span>'}},{dataIndex:"job_overview",text:"工作概述",html:!0,renderer:function(){return'<span ms-visible="$outer.el.job_overview == 0">未填写</span><span class="end" ms-visible="$outer.el.job_overview == 1">已填写</span>'}},{dataIndex:"effect_and_suggestion",text:"效果及建议",html:!0,renderer:function(){return'<span ms-visible="$outer.el.effect_and_suggestion == 0">未填写</span><span class="end" ms-visible="$outer.el.effect_and_suggestion == 1">已填写</span>'}},{dataIndex:"membership_development",text:"会员发展",html:!0,renderer:function(){return'<span ms-visible="$outer.el.membership_development == 0">未填写</span><span class="end" ms-visible="$outer.el.membership_development == 1">已填写</span>'}},{dataIndex:"member_consumption",text:"会员消费",html:!0,renderer:function(){return'<span ms-visible="$outer.el.member_consumption == 0">未填写</span><span class="end" ms-visible="$outer.el.member_consumption == 1">已填写</span>'}},{dataIndex:"membership_value",text:"会员储值",html:!0,renderer:function(){return'<span ms-visible="$outer.el.membership_value == 0">未填写</span><span class="end" ms-visible="$outer.el.membership_value == 1">已填写</span>'}},{dataIndex:"affiliate_marketing",text:"会员营销",html:!0,renderer:function(){return'<span ms-visible="$outer.el.affiliate_marketing == 0">未填写</span><span class="end" ms-visible="$outer.el.affiliate_marketing == 1">已填写</span>'}},{dataIndex:"population_quality",text:"群体质量",html:!0,renderer:function(){return'<span ms-visible="$outer.el.population_quality == 0">未填写</span><span class="end" ms-visible="$outer.el.population_quality == 1">已填写</span>'}},{dataIndex:"monthly_check_state",text:"状态",html:!0,renderer:function(){return'<span class="warn" ms-visible="$outer.el.monthly_check_state == 0">未完成</span><span class="through" ms-visible="$outer.el.monthly_check_state == 1">已完成</span>'}}],onLoad:function(i,o){i=_.extend(i,{reportTime:n(e.getVm(l("-year")).selectedValue+"-"+e.getVm(l("-month")).selectedValue)/1,merchantName:_.str.trim(d.keyword),frontUserId:e.getVm(l("-fd")).selectedValue,monthlyCheckState:e.getVm(l("-status")).selectedValue,isCheck:e.getVm(l("-check")).selectedValue}),t.c2s({url:s.BASE_PATH+"besMonthlyCheck/queryBesMonthlyCheckList.do",contentType:"application/json",data:a.stringify(i),success:function(e){var t;e.flag&&(t=e.data,o.call(this,t))}})}}});e.scan(i[0]);var c=new Date,u=c.getFullYear(),m=c.getMonth();0==m&&(m=12,u-=1),e.getVm(l("-year")).selectValue(u),e.getVm(l("-month")).selectValue(m),e.getVm(l("-grid")).load()},$remove:function(){_.each(r,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),r.length=0}}),o});

//From origin\page\databank\list\addedit\addedit.js
define("originpagedatabanklistaddeditaddeditjs",["avalon","util","json","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetuploaderuploaderjs"],function(e,t,a){var n=this,i=n.erp,s={},o=[];return _.extend(s,{$init:function(n,s,r){function l(e,n,s){var o=a.stringify(e);t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:s})}function d(t){var a;if(t.flag){a=t.data,u.requestData={title:a.title,description:a.description,applyCrowdType:a.apply_crowd_type,sysAttachment:{originalFileName:a.sysAttachment.originalFileName,attachmentName:a.sysAttachment.attachmentName,attachmentSize:a.sysAttachment.attachmentSize,attachmentSuffix:a.sysAttachment.attachmentSuffix}},u.fileName=a.sysAttachment.originalFileName;for(var n=a.apply_crowd_type,i=u.personType.$model,s=0;s<n.length;s++)for(var o=0;o<i.length;o++)n[s]==i[o].value&&(u.personType[o].isSelect="1");for(var r=a.data_type,l=u.$dataTypeOpts.options,d=e.getVm(c("dataTypeOpts")),m=0;m<l.length;m++)l[m].value==r&&d.setOptions([{text:"案例类",value:"1"},{text:"制度类",value:"2"},{text:"销售工具类",value:"3"},{text:"培训材料类",value:"4"},{text:"客户回馈",value:"5"},{text:"行业资讯",value:"6"},{text:"市场活动",value:"7"},{text:"Q&A",value:"8"},{text:"其它",value:"9"}],m)}}var c=function(e){var t=s+e;return o.push(t),t},u=e.define(s,function(n){n.navCrumbs=[{text:"资料库",href:"#/databank/list"},{text:"上传资料"}],n.titleType="上传资料",n.pageType=parseInt(r.params.type),n.fileId=parseInt(r.params.id),n.pageType||(n.titleType="修改资料",n.navCrumbs[1].text="修改资料");var s=i.getAppData("user");n.searchData={pageSize:10,pageNumber:1,id:n.fileId},n.fileName="",n.personType=[{text:"客户服务经理",value:1,isSelect:"0"},{text:"客户经理",value:2,isSelect:"0"}],n.$dataTypeOpts={selectId:c("dataTypeOpts"),options:[{text:"案例类",value:"1"},{text:"制度类",value:"2"},{text:"销售工具类",value:"3"},{text:"培训材料类",value:"4"},{text:"客户回馈",value:"5"},{text:"行业资讯",value:"6"},{text:"市场活动",value:"7"},{text:"Q&A",value:"8"},{text:"其它",value:"9"}],selectedIndex:0},n.requestData={id:"",title:"",description:"",applyCrowdType:[],dataType:"",sysAttachment:{originalFileName:"",attachmentName:"",attachmentSize:"",attachmentSuffix:""}},n.personTypeSele=function(){var e=this.value;if(this.checked)u.requestData.applyCrowdType.push(e);else for(var t=u.requestData.applyCrowdType,a=0;a<t.length;a++)t[a]==e&&t.splice(a,1);var t=u.requestData.applyCrowdType;u.isType=t.length?1:0},n.isData=1,n.isType=1,n.saveData=function(){var s,o,r,l=$(".add-edit-content")[0],d=e.getVm(c("dataUploaderId"));o=t.testing(l),u.requestData.sysAttachment.attachmentSize||(n.isData=0,o=0);var m=u.requestData.applyCrowdType;0==m.length&&(n.isType=0,o=0),u.requestData.$model.dataType=e.getVm(c("dataTypeOpts")).selectedValue,u.fileId?(s="sysDatabase/updateSysDatabase.do",u.requestData.$model.id=u.fileId):s="sysDatabase/saveSysDatabase.do",o&&(r=function(){t.c2s({url:i.BASE_PATH+s,type:"post",contentType:"application/json",data:a.stringify(u.requestData.$model),success:function(e){e.flag&&t.alert({content:"操作成功！",iconType:"success",onSubmit:function(){window.location.href=i.BASE_PATH+"#!/databank/list"}})}})},d.uploading?(t.showGlobalMask(),d.$unwatch("uploading"),d.$watch("uploading",function(e){e||(t.hideGlobalMask(),r(),d.$unwatch("uploading"))})):r())},n.$dataUploaderOpts={uploaderId:c("dataUploaderId"),uploadifyOpts:{uploader:i.BASE_PATH+"sysDatabase/uploadFiles.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.pdf;*.rar;*.zip",formData:function(){return{sessionId:s.sessionId}},width:80,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=a.parse(e),e.flag){u.isData=1;var n=e.data[0],i=n.originalFileName.lastIndexOf("."),s=n.originalFileName.substr(i+1);u.requestData.sysAttachment.originalFileName=n.originalFileName,u.requestData.sysAttachment.attachmentName=n.fileName,u.requestData.sysAttachment.attachmentSize=n.fileSize,u.requestData.sysAttachment.attachmentSuffix=s,u.fileName=n.originalFileName}else t.alert({content:responseData.message,iconType:"error"})}}});e.scan(n[0]),u.pageType||l(u.searchData.$model,"sysDatabase/querySysDatabaseById.do",d)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),s});

//From origin\page\databank\list\info\info.js
define("originpagedatabanklistinfoinfojs",["avalon","util","json","moment","originwidgetpaginationpaginationjs","originwidgetformselectjs"],function(e,t,a){var n=this,i=n.erp,s={},o=[];return _.extend(s,{$init:function(n,s,o){function r(e,n,s){var o=a.stringify(e);t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:s})}function l(e){var t;if(e.flag){t=e.data;for(var a=t.sysAttachmentUserList.rows,n=0;n<a.length;n++)a[n].insert_time=moment(a[n].insert_time).format("YYYY-MM-DD");d.responseData=t}}var d=e.define(s,function(e){e.navCrumbs=[{text:"资料库",href:"#/databank/list"},{text:"资料详情"}],e.path=i.BASE_PATH,e.pageUserId=i.getAppData("user").id,e.fileId=parseInt(o.params.id),e.userImgPath=i.appData.user.userImagePath,e.requestData={pageSize:1e3,pageNumber:1,id:e.fileId},e.responseData={},e.downFile=function(e){var t=d.responseData.databaseFilePath+"/"+d.responseData.sysAttachment.attachmentPath+"/"+d.responseData.sysAttachment.attachmentName;window.location=d.path+"sysDatabase/download.do?relPath="+t+"&userId="+d.pageUserId+"&attachmentId="+e,setTimeout(function(){r(d.requestData.$model,"sysDatabase/querySysDatabaseById.do",l)},500)}});e.scan(n[0]),r(d.requestData.$model,"sysDatabase/querySysDatabaseById.do",l)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),s});

//From origin\page\databank\list\list.js
define("originpagedatabanklistlistjs",["avalon","util","json","originwidgetpaginationpaginationjs","originwidgetformselectjs"],function(e,t,a){var n=this,i=n.erp,s={},o=[];return _.extend(s,{$init:function(n,s){function r(e,n,s){var o=a.stringify(e);t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:s})}function l(t){var a,n=e.getVm(d("paginationPage"));t.flag&&(a=t.data,c.sum=a.totalSize,c.responseDataList=a.rows,n.total=a.totalSize)}var d=function(e){var t=s+e;return o.push(t),t},c=e.define(s,function(n){n.permission={data_upload:t.hasPermission("data_upload"),data_update:t.hasPermission("data_update"),data_delete:t.hasPermission("data_delete"),data_download:t.hasPermission("data_download"),data_review:t.hasPermission("data_review")},n.pageUserId=i.getAppData("user").id,n.path=i.BASE_PATH,n.localHref=function(e){t.jumpPage(e)},n.responseData={pageSize:10,pageNumber:1,attachmentSuffix:"",applyCrowdType:"",title:"",dataType:""},n.sum=0,n.responseDataList=[],n.$personTypeOpts={selectId:d("personTypeOpts"),options:[],selectedIndex:0},n.$layoutTypeOpts={selectId:d("layoutTypeOpts"),options:[{text:"全部格式",value:""},{text:"doc",value:"doc"},{text:"docx",value:"docx"},{text:"xls",value:"xls"},{text:"xlsx",value:"xlsx"},{text:"ppt",value:"ppt"},{text:"pptx",value:"pptx"},{text:"pdf",value:"pdf"},{text:"rar",value:"rar"},{text:"zip",value:"zip"}],selectedIndex:0},n.$dataTypeOpts={selectId:d("dataTypeOpts"),options:[],selectedIndex:0},t.c2s({url:i.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000094",success:function(t){var a,n=e.getVm(d("personTypeOpts"));if(t.flag){a=t.data;var i=_.map(a,function(e){return{text:e.dictionary_value,value:e.dictionary_key}});i.unshift({text:"全部人群",value:""}),n.setOptions(i)}}}),t.c2s({url:i.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000095",success:function(t){var a,n=e.getVm(d("dataTypeOpts"));if(t.flag){a=t.data;var i=_.map(a,function(e){return{text:e.dictionary_value,value:e.dictionary_key}});i.unshift({text:"全部类型",value:""}),n.setOptions(i)}}}),n.search=function(){var t=e.getVm(d("personTypeOpts")).selectedValue,a=e.getVm(d("layoutTypeOpts")).selectedValue,n=e.getVm(d("dataTypeOpts")).selectedValue;c.responseData.attachmentSuffix=a,c.responseData.applyCrowdType=t,c.responseData.dataType=n;var i=e.getVm(d("paginationPage"));c.responseData.pageNumber=1,i.currentPage=1,r(c.responseData.$model,"sysDatabase/querySysDatabase.do",l)},n.removeFile=function(e){t.confirm({content:"你确定要删除吗？",onSubmit:function(){t.c2s({url:i.BASE_PATH+"sysDatabase/deleteSysDatabase.do",type:"post",contentType:"application/json",data:a.stringify({id:e}),success:function(e){e.flag&&(t.alert({content:"已删除",iconType:"success"}),r(c.responseData.$model,"sysDatabase/querySysDatabase.do",l))}})}})},n.toInfo=function(e){var a="#/databank/list/info/"+e;c.permission.data_review?t.jumpPage(a):t.alert({content:"您没有查看详情的权限！",iconType:"info"})},n.downFile=function(e){var t=this.$vmodel.$model.el,a=t.databaseFilePath+"/"+t.attachment_path+"/"+t.attachment_name;window.location=c.path+"sysDatabase/download.do?relPath="+a+"&userId="+c.pageUserId+"&attachmentId="+e},n.$paginationOpts={paginationId:d("paginationPage"),total:0,onJump:function(){var t=e.getVm(d("paginationPage"));c.responseData.pageNumber=t.currentPage,r(c.responseData.$model,"sysDatabase/querySysDatabase.do",l)}}});e.scan(n[0]),r(c.responseData.$model,"sysDatabase/querySysDatabase.do",l)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),s});

//From origin\page\datamonitor\allstatistics\allstatistics.js
define("originpagedatamonitorallstatisticsallstatisticsjs",["avalon","util","moment","highcharts","originwidgetformselectjs","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,s=i.erp,o={};return _.extend(o,{$init:function(i,o){var r=o+"-ub-dot-user",l=o+"-ub-dot-brand",d=o+"-ub-range-user",c=o+"-ub-range-rd",u=o+"-calendar-1",m=o+"-calendar-2",p=o+"-calendar-3",f=o+"-ub-chart-holder",g=o+"-fun-chart-holder",v=o+"-fun-cate",h=o+"-fun-hb",y=o+"fun-send",b=o+"fun-gt",T=new Date,S=$(".range-date-calendar",i),w=$(".date-range-selector .selector-panel",i),D=$(".ub-section .chart-box .chart-panel",i),I=$(".fun-section .chart-box .chart-panel",i),x={chart:{style:{fontFamily:'tahoma,arial,"Hiragino Sans GB","微软雅黑","Microsoft YaHei","WenQuanYi Micro Hei","b8bf53"',fontSize:"14px",color:"#666666"}},credits:{enabled:!1},exporting:{enabled:!1},colors:["#e0769b","#e0ad76","#dae076","#66ccb5","#76cae0","#76a9e0","#7678e0"],title:{style:{color:"#666666",fontSize:"14px"}},legend:{itemStyle:{color:"#666666",fontSize:"14px",fontWeight:"normal"}},labels:{style:{color:"#666666",fontSize:"14px"}},tooltip:{style:{color:"#666666",fontSize:"14px",fontWeight:"normal"},headerFormat:'<span style="font-weight:bold;">{point.key}</span><br/>'},plotOptions:{pie:{dataLabels:{style:{color:"#666666",fontSize:"14px"}},showInLegend:!0}},yAxis:{plotLines:[{value:0,width:1,color:"#666666"}]}},C=e.define(o,function(i){i.$skipArray=["ubChart"],i.statisticsState="dot",i.showRangeCalendar=function(){w.show()},i.$calendar1Opts={calendarId:u,disableYearMonthPanel:!0,focusDate:a().subtract("months",2)._d,focusChangeWithClick:!1,onClickDate:function(e){i.selectDateRange(e)}},i.$calendar2Opts={calendarId:m,disableYearMonthPanel:!0,focusDate:a().subtract("months",1)._d,focusChangeWithClick:!1,onClickDate:function(e){i.selectDateRange(e)}},i.$calendar3Opts={calendarId:p,disableYearMonthPanel:!0,focusDate:new Date,maxDate:T,onClickDate:function(e){i.selectDateRange(e)}},i.isCurrentDate=!0,i.startDate=null,i.endDate=null,i.startDateStr="",i.endDateStr="",i.selectedRangeDateStr="",i.selectDateRange=function(e){!i.startDate||i.endDate?(i.endDate=null,i.startDate=e):a(e).isBefore(i.startDate,"day")?t.alert({iconType:"info",content:"选择结束时间要大于开始时间"}):i.endDate=e},i.rangeDateCb=function(){var e=$(".ui-calendar-date-panel td",S);e.removeClass("is-start-date is-end-date is-range-date"),i.startDate||i.endDate?(e.each(function(){var e=$(this),t=e.data("date"),n=a(t,"YYYY-MM-DD");i.endDate&&t==a(i.endDate).format("YYYY-MM-DD")&&e.addClass("is-end-date"),i.startDate&&t==a(i.startDate).format("YYYY-MM-DD")&&e.addClass("is-start-date"),i.startDate&&i.endDate&&!n.isBefore(i.startDate,"day")&&!n.isAfter(i.endDate,"day")&&e.addClass("is-range-date")}),i.startDateStr=i.startDate?a(i.startDate).format("YYYY-MM-DD"):"",i.endDateStr=i.endDate?a(i.endDate).format("YYYY-MM-DD"):"",i.selectedRangeDateStr=i.startDate&&i.endDate?a(i.startDate).format("YYYY.MM.DD")+" - "+a(i.endDate).format("YYYY.MM.DD"):""):(i.startDateStr="",i.selectedRangeDateStr="")},i.getCurrentFirstDate=function(){var e=$(".ui-calendar-date-panel td",S);return a(e.first().data("date"),"YYYY-MM-DD")._d},i.$watch("startDate",function(){i.rangeDateCb()}),i.$watch("endDate",function(){i.rangeDateCb()}),i.formatInputDate=function(e){e=e.replace(/\s+/g,"");for(var t=e.split(""),a="",n=0,i=t.length;i>n&&!(n>9);n++)/[\d|-]/.test(t[n])&&(4==n&&"-"!=t[4]&&(a+="-"),7==n&&"-"!=t[7]&&(a+="-"),a+=t[n]);return a},i.$watch("startDateStr",function(e){var t;i.startDateStr=i.formatInputDate(e),10===i.startDateStr.length&&(t=a(i.startDateStr,"YYYY-MM-DD"),t.isValid()&&(i.startDate=t._d))}),i.$watch("endDateStr",function(t){var n,s=e.getVm(p);i.endDateStr=i.formatInputDate(t),10===i.endDateStr.length&&(n=a(i.endDateStr,"YYYY-MM-DD"),n.isValid()&&!n.isBefore(i.startDate,"day")&&(a(n._d).isBefore(i.getCurrentFirstDate())&&(s.focusDate=n._d),i.endDate=n._d))}),i.navToNextYear=function(){var t=e.getVm(p),n=a(t.focusDate);n=n.add("years",1),n.isAfter(T,"month")?(t.focusDate=T,i.isCurrentDate=!0):(t.focusDate=n._d,i.isCurrentDate=!1),i.$fire("startDate",i.startDate),i.$fire("endDate",i.endDate)},i.navToPrevYear=function(){var t=e.getVm(p),n=a(t.focusDate);n=n.subtract("years",1),t.focusDate=n._d,i.isCurrentDate=!1,i.$fire("startDate",i.startDate),i.$fire("endDate",i.endDate)},i.navToNextMonth=function(){var t=e.getVm(p),n=a(t.focusDate);n=n.add("months",1),n.isAfter(T,"month")?(t.focusDate=T,i.isCurrentDate=!0):(t.focusDate=n._d,i.isCurrentDate=!1),i.$fire("startDate",i.startDate),i.$fire("endDate",i.endDate)},i.navToPrevMonth=function(){var t=e.getVm(p),n=a(t.focusDate);n=n.subtract("months",1),t.focusDate=n._d,i.isCurrentDate=!1,i.$fire("startDate",i.startDate),i.$fire("endDate",i.endDate)},i.confirmRangeDate=function(){return i.endDate&&i.startDate?void(a(i.endDate).isBefore(i.startDate,"day")?t.alert({iconType:"error",content:"请设置开始时间小于结束时间"}):a(i.endDate).isSame(i.startDate,"day")&&a(i.endDate).isSame(T,"day")?(i.statisticsState="dot",i.startDate=null,i.endDate=null,w.hide(),i.refreshPage()):(i.statisticsState="range",w.hide(),i.refreshPage())):void t.alert({iconType:"error",content:"请选择有效的时间段"})},i.closeCalendarPanel=function(){w.hide()},i.switchToToday=function(){i.statisticsState="dot",i.startDate=null,i.endDate=null,i.refreshPage()},i.ubState="user",i.totalUserNum=0,i.addedUserNum=0,i.totalBrandNum=0,i.addedBrandNum=0,i.totalMerchantNum=0,i.addedMerchantNum=0,i.userStatisticsData=[],i.businessStatisticsData=[],i.ubChartBoxTitle="用户分布图表",i.$ubDotUserOpts={selectId:r,options:[{text:"总用户",value:!1},{text:"新增用户",value:!0}],selectedIndex:0,onSelect:function(){i.fetchUbData("chart",function(e){i.redrawUbChart(e)})}},i.$ubDotBrandOpts={selectId:l,options:[{text:"总品牌",value:!1},{text:"新增品牌",value:!0}],selectedIndex:0,onSelect:function(){i.fetchUbData("chart",function(e){i.redrawUbChart(e)})}},i.$ubRangeUserOpts={selectId:d,options:[{text:"新增用户",value:"newUser"},{text:"登录人数",value:"loginUser"},{text:"登录次数",value:"loginTimes"}],selectedIndex:0,onSelect:function(){i.fetchUbData("chart",function(e){i.redrawUbChart(e)})}},i.$ubRangeRdOpts={selectId:c,options:[{text:"角色占比",value:"role"},{text:"时间分布",value:"date"}],selectedIndex:0,onSelect:function(){i.fetchUbData("chart",function(e){i.redrawUbChart(e)})}},i.switchUbState=function(){i.ubState=e(this).data("ubState")},i.$watch("ubState",function(){i.fetchUbData("grid",function(e){i.reRenderUbGrid(e)}),i.fetchUbData("chart",function(e){i.redrawUbChart(e)})}),i.ubChart=null,i.fetchUbData=function(n,o){var u,m={};"user"==i.ubState?"grid"==n?u="new/superReport/userTableData.do":"chart"==n&&(u="new/superReport/userChartData.do","dot"==i.statisticsState&&(m.isNew=e.getVm(r).selectedValue),"range"==i.statisticsState&&(m.queryType=e.getVm(d).selectedValue,m.queryFlag=e.getVm(c).selectedValue)):"business"==i.ubState&&("grid"==n?u="new/superReport/brandTableData.do":"chart"==n&&(u="new/superReport/brandChartData.do","dot"==i.statisticsState&&(m.isNew=e.getVm(l).selectedValue))),"dot"==i.statisticsState?m.beginDate=m.endDate=a(T).unix():"range"==i.statisticsState&&(m.beginDate=a(i.startDate).unix(),m.endDate=a(i.endDate).unix()),t.c2s({url:s.BASE_PATH+u,data:m,success:function(e){e.flag&&o&&o.call(i,e.data)}})},i.reRenderUbGrid=function(e){var t=e.total,n=e.statistics;"dot"==i.statisticsState?(i.totalUserNum=t.userCount,i.addedUserNum=t.newUserCount,i.totalBrandNum=t.brandCount,i.addedBrandNum=t.newBrandCount,i.totalMerchantNum=t.faceShopCount,i.addedMerchantNum=t.newFaceShopCount,"user"==i.ubState?i.userStatisticsData=_.map(n,function(e){return"hisMax"==e.cate&&_.each(["loginNumHisMaxDate","loginTimesHisMaxDate","newNumHisMaxDate"],function(t){e[t]=a.unix(e[t]).format("YYYY-MM-DD")}),e}):"business"==i.ubState&&(i.businessStatisticsData=_.map(n,function(e){return"hisMax"==e.cate&&_.each(["newBrandHisMaxDate","activeBrandNumHisMaxDate","newMerchantHisMaxDate","activeMerchantNumHisMaxDate"],function(t){e[t]=a.unix(e[t]).format("YYYY-MM-DD")}),e}))):"range"==i.statisticsState&&(i.addedUserNum=t.newUserCount,i.addedBrandNum=t.newBrandCount,i.addedMerchantNum=t.newFaceShopCount,"user"==i.ubState?i.userStatisticsData=n:"business"==i.ubState&&(i.businessStatisticsData=n))},i.redrawUbChart=function(t){var s=i.statisticsState,o=i.ubState;i.ubChart&&i.ubChart.destroy(),D.html('<div id="'+f+'"></div>'),"dot"==s?"user"==o?i.ubChart=new n.Chart(e.mix(!0,{},x,{chart:{renderTo:f,type:"pie"},title:{text:a(T).format("YYYY-MM-DD")+e.getVm(r).selectedText+"数量"},legend:{align:"right",verticalAlign:"middle",width:200,layout:"vertical",borderWidth:1,borderColor:"#e9e9e9",backgroundColor:"#e9e9e9",padding:20,itemMarginBottom:10},plotOptions:{pie:{dataLabels:{format:"{point.userCount}<br/>占{point.percentage:.1f} %"}}},series:[{name:"占比",data:_.map(t,function(e){return{name:e.role,y:e.ratio,userCount:e.userCount}})}]})):"business"==o&&(i.ubChart=new n.Chart(e.mix(!0,{},x,{chart:{renderTo:f,type:"column"},title:{text:"近7日"+e.getVm(l).selectedText+"数量对比"},xAxis:{categories:t.categories},yAxis:{min:0,title:{text:"总数"}},tooltip:{headerFormat:"<span>{point.key}</span><table>",pointFormat:'<tr><td style="color:{series.color};padding:0">{series.name}: </td><td style="padding:0">&nbsp;<span>{point.y}</span></td></tr>',footerFormat:"</table>",shared:!0,useHTML:!0},series:t.series}))):"range"==s&&("user"==o?i.ubChart=new n.Chart("date"==e.getVm(c).selectedValue?e.mix(!0,{},x,{chart:{renderTo:f,type:"line"},title:{text:a.unix(t.categories[0]).format("YYYY-MM-DD")+" 至 "+a.unix(t.categories[t.categories.length-1]).format("YYYY-MM-DD")+" "+e.getVm(d).selectedText},xAxis:{categories:_.map(t.categories,function(e){return a.unix(e).format("YYYY-MM-DD")}),labels:{rotation:t.categories.length>10?45:0}},yAxis:{title:{text:"loginTimes"==e.getVm(d).selectedValue?"次数":"人数"}},tooltip:{valueSuffix:""},series:t.series}):e.mix(!0,{},x,{chart:{renderTo:f,type:"pie"},title:{text:a(i.startDate).format("YYYY-MM-DD")+" 至 "+a(i.endDate).format("YYYY-MM-DD")+" "+e.getVm(d).selectedText+"数量"},legend:{align:"right",verticalAlign:"middle",width:200,layout:"vertical",borderWidth:1,borderColor:"#e9e9e9",backgroundColor:"#e9e9e9",padding:20,itemMarginBottom:10},plotOptions:{pie:{dataLabels:{format:"{point.userCount}<br/>占{point.percentage:.1f} %"}}},series:[{name:"占比",data:_.map(t,function(e){return{name:e.role,y:e.ratio,userCount:e.userCount}})}]})):"business"==o&&(i.ubChart=new n.Chart(e.mix(!0,{},x,{chart:{renderTo:f,type:"line"},title:{text:a.unix(t.categories[0]).format("YYYY-MM-DD")+" 至 "+a.unix(t.categories[t.categories.length-1]).format("YYYY-MM-DD")+" 品牌分布图表"},xAxis:{categories:_.map(t.categories,function(e){return a.unix(e).format("YYYY-MM-DD")}),labels:{rotation:t.categories.length>10?45:0}},yAxis:{title:{text:"品牌"}},tooltip:{valueSuffix:""},series:t.series}))))},i.$funCateOpts={selectId:v,options:[{text:"全部功能",value:""},{text:"发送日报",value:"SEND_REPORT"},{text:"查看日报",value:"VIEW_REPORT"},{text:"查看月报",value:"VIEW_MONTHREPORT"},{text:"月报导出",value:"EXPORT_REPORT"},{text:"数据统计",value:"VIEW_STATISTICS"},{text:"发送评论",value:"SEND_COMMENT"},{text:"查看评论",value:"VIEW_COMMENT"},{text:"发送通知",value:"SEND_NOTICE"},{text:"查看通知",value:"VIEW_NOTICE"},{text:"标注",value:"VIEW_MARK"}],selectedIndex:0,onSelect:function(){i.fetchFunData("chart",function(e){i.redrawFunChart(e)})}},i.$funHbOpts={selectId:h,options:[{text:"全部图表",value:""},{text:"日环比图",value:"CHART_DAY"},{text:"月同比图",value:"CHART_MONTH"}],selectedIndex:0,onSelect:function(){i.fetchFunData("chart",function(e){i.redrawFunChart(e)})}},i.$funSendOpts={selectId:y,options:[{text:"全部数据",value:""},{text:"发送日报",value:"SEND_REPORT"},{text:"发送通知",value:"SEND_NOTICE"}],selectedIndex:0,onSelect:function(t){e.getVm(b).setOptions(t?[{text:"功能占比",value:"function"},{text:"时间分布",value:"date"}]:[{text:"时间分布",value:"date"}]),i.fetchFunData("chart",function(e){i.redrawFunChart(e)})}},i.$funGtOpts={selectId:b,options:[{text:"功能占比",value:"function"},{text:"时间分布",value:"date"}],selectedIndex:0,onSelect:function(){i.fetchFunData("chart",function(e){i.redrawFunChart(e)})}},i.funStatisticsData=[],i.funState="user",i.switchFunState=function(){i.funState=e(this).data("funState")},i.$watch("funState",function(t){e.getVm(b).setOptions("sending"!=t||e.getVm(y).selectedValue?[{text:"功能占比",value:"function"},{text:"时间分布",value:"date"}]:[{text:"时间分布",value:"date"}]),i.fetchFunData("grid",function(e){i.reRenderFunGrid(e)}),i.fetchFunData("chart",function(e){i.redrawFunChart(e)})}),i.funChart=null,i.fetchFunData=function(n,o){var r,l={};"grid"==n?r="new/superReport/functionTableData.do":"chart"==n&&(r="new/superReport/functionChartData.do","user"==i.funState||"times"==i.funState?l.path=e.getVm(v).selectedValue:"clicks"==i.funState?l.path=e.getVm(h).selectedValue:"sending"==i.funState&&(l.path=e.getVm(y).selectedValue),l.queryFlag="range"==i.statisticsState?e.getVm(b).selectedValue:"function"),l.type=i.translateFunState(i.funState),"dot"==i.statisticsState?l.beginDate=l.endDate=a(T).unix():"range"==i.statisticsState&&(l.beginDate=a(i.startDate).unix(),l.endDate=a(i.endDate).unix()),t.c2s({url:s.BASE_PATH+r,data:l,success:function(e){e.flag&&o&&o.call(i,e.data)}})},i.reRenderFunGrid=function(e){i.funStatisticsData=_.map(e,function(e){return _.each(["sendReportCountHisMaxDate","viewReportCountHisMaxDate","viewMonthReportCountHisMaxDate","exportReportCountHisMaxDate","viewStatisticsCountHisMaxDate","sendCommentCountHisMaxDate","viewCommentCountHisMaxDate","sendNoticeCountHisMaxDate","viewNoticeCountHisMaxDate","viewMarkCountHisMaxDate","chartDayCountHisMaxDate","chartMonthCountHisMaxDate"],function(t){e[t]&&(e[t]=a.unix(e[t]).format("YYYY-MM-DD"))}),e})},i.redrawFunChart=function(t){var s,o=i.statisticsState,r=i.funState;i.funChart&&i.funChart.destroy(),I.html('<div id="'+g+'"></div>'),"user"==r||"times"==r?s=v:"clicks"==i.funState?s=h:"sending"==i.funState&&(s=y),"dot"==o?i.funChart=new n.Chart(e.mix(!0,{},x,{chart:{renderTo:g,type:"pie"},title:{text:a(T).format("YYYY-MM-DD")+e.getVm(s).selectedText},legend:{align:"right",verticalAlign:"middle",width:200,layout:"vertical",borderWidth:1,borderColor:"#e9e9e9",backgroundColor:"#e9e9e9",padding:20,itemMarginBottom:10},plotOptions:{pie:{dataLabels:{format:"{point.userCount}<br/>占{point.percentage:.1f} %"}}},series:[{name:"占比",data:_.map(t,function(e){return{name:e.name,y:e.ratio,userCount:e.count}})}]})):"range"==o&&(i.funChart=new n.Chart("date"==e.getVm(b).selectedValue?e.mix(!0,{},x,{chart:{renderTo:g,type:"line"},title:{text:a.unix(t.categories[0]).format("YYYY-MM-DD")+" 至 "+a.unix(t.categories[t.categories.length-1]).format("YYYY-MM-DD")+" "+e.getVm(s).selectedText},xAxis:{categories:_.map(t.categories,function(e){return a.unix(e).format("YYYY-MM-DD")}),labels:{rotation:t.categories.length>10?45:0}},yAxis:{title:{text:"总数"}},tooltip:{valueSuffix:""},series:t.series}):e.mix(!0,{},x,{chart:{renderTo:g,type:"pie"},title:{text:a(i.startDate).format("YYYY-MM-DD")+" 至 "+a(i.endDate).format("YYYY-MM-DD")+" "+e.getVm(s).selectedText},legend:{align:"right",verticalAlign:"middle",width:200,layout:"vertical",borderWidth:1,borderColor:"#e9e9e9",backgroundColor:"#e9e9e9",padding:20,itemMarginBottom:10},plotOptions:{pie:{dataLabels:{format:"{point.userCount}<br/>占{point.percentage:.1f} %"}}},series:[{name:"占比",data:_.map(t,function(e){return{name:e.name,y:e.ratio,userCount:e.count}})}]})))},i.refreshPage=function(){i.fetchUbData("grid",function(e){i.reRenderUbGrid(e)}),i.fetchUbData("chart",function(e){i.redrawUbChart(e)}),i.fetchFunData("grid",function(e){i.reRenderFunGrid(e)}),i.fetchFunData("chart",function(e){i.redrawFunChart(e)})},i.translateFunState=function(e){var t="";switch(e){case"user":t="personCount";break;case"times":t="count";break;case"clicks":t="clickCount";break;case"sending":t="sendCount"}return t}});e.scan(i[0]),e.nextTick(function(){C.refreshPage()}),e.getVm(p).$watch("focusDate",function(t){e.getVm(m).focusDate=a(t).subtract("months",1)._d,e.getVm(u).focusDate=a(t).subtract("months",2)._d}),t.regGlobalMdExcept({element:w,handler:function(){C.closeCalendarPanel()}})},$remove:function(t,a){var n=a+"-ub-dot-user",i=a+"-ub-dot-brand",s=a+"-ub-range-user",o=a+"-calendar-1",r=a+"-calendar-2",l=a+"-calendar-3",d=a+"-fun-cate",c=a+"-fun-hb",u=a+"fun-send",m=a+"fun-gt",p=e.getVm(a);$(e.getVm(n).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(l).widgetElement).remove(),$(e.getVm(d).widgetElement).remove(),$(e.getVm(c).widgetElement).remove(),$(e.getVm(u).widgetElement).remove(),$(e.getVm(m).widgetElement).remove(),p.ubChart&&p.ubChart.destroy(),p.funChart&&p.funChart.destroy(),p.ubChart=null,p.funChart=null}}),o});

//From origin\page\demand\demandboard\demandboard.js
define("originpagedemanddemandboarddemandboardjs",["avalon","util","moment","json","originwidgetpaginationpaginationjs","originwidgetformformjs","originwidgetformselectjs","dialog","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,s=i.erp,o={};return _.extend(o,{$init:function(o,r){function l(i){var o=e.getVm(m),r=e.getVm(y),l=e.getVm(b),d={name:x.demandName,requirementPlanType:e.getVm(g).selectedValue,projectIds:e.getVm(v).selectedValue?[].concat(e.getVm(v).selectedValue):[],requirementStatus:e.getVm(h).selectedValue};l.selectedValue?(d.startPlanTime=+a(r.selectedValue+"-"+l.selectedValue,"YYYY-M"),d.endPlanTime=a(d.startPlanTime).add("months",1).subtract("seconds",1)/1):(d.startPlanTime=+a(r.selectedValue,"YYYY"),d.endPlanTime=+a(r.selectedValue,"YYYY").add("years",1).subtract("seconds",1)/1),i?(d.pageSize=o.perPages,d.pageNumber=1):(d.pageSize=o.perPages,d.pageNumber=o.currentPage),t.c2s({url:s.BASE_PATH+"reqRequirement/listReqRequirements.do",data:n.stringify(d),contentType:"application/json",success:function(e){var t;e.flag&&(t=e.data,o.total=t.totalSize,i&&(o.currentPage=1),x.gridData=_.map(t.rows,function(e){return e.projectNames=_.map(e.reqProjects,function(e){return e.name}).join(","),e.isOutDateOfPlanEndTime=e.onlineTime&&a(e.onlineTime).isAfter(a(e.planEndTime),"day")?!0:!1,e.requirementsReviewTime=e.requirementsReviewTime?a(e.requirementsReviewTime).format("YYYY-MM-DD")+"&nbsp;":"",e.productReviewTime=e.productReviewTime?a(e.productReviewTime).format("YYYY-MM-DD"):"",e.developmentTime=e.developmentTime?a(e.developmentTime).format("YYYY-MM-DD"):"",e.planEndTime=e.planEndTime?a(e.planEndTime).format("YYYY-MM-DD"):"",e.isRequirementsReviewText='<span data-tip="'+e.requirementsReviewOpinion+'" class="'+("0"==e.isRequirementsReview?"no-passed-flag state-out-date":"")+'">'+c(e.isRequirementsReview)+"</span>",e.isProductReviewText='<span data-tip="'+e.productReviewOpinion+'" class="'+("0"==e.isProductReview?"no-passed-flag state-out-date":"")+'">'+u(e.isProductReview)+"</span>",e.planTimeText=e.planTime?a(e.planTime).format("YYYY/MM"):"",e.onlineTime=e.onlineTime?a(e.onlineTime).format("YYYY-MM-DD"):"",e}),x.gridTotalSize=t.totalSize,x.gridAllChecked=!1,x.gridSelected.clear())}})}function d(a){t.c2s({url:s.BASE_PATH+"reqRequirement/getDropDownLists.do",contentType:"application/json",type:"get",success:function(t){var n,i,s,o,r=e.getVm(f);t.flag&&(n=t.data,i=n.planType,s=n.project,o=n.state,e.getVm(g).setOptions([{text:"计划类型",value:""}].concat(i)),e.getVm(T).setOptions(i),e.getVm(v).setOptions([{text:"全部项目",value:""}].concat(s)),e.getVm(h).setOptions([{text:"全部状态",value:""}].concat(o)),e.getVm(w).setOptions([{text:"全部状态",value:""}].concat(o)),r.projectList=[].concat(s),a&&a.call(this,n))}})}function c(e){var t="";switch(e){case"0":t="未通过";break;case"1":t="通过";break;case"2":t="无需评审"}return t}function u(e){var t="";switch(e){case"0":t="未通过";break;case"1":t="通过";break;case"2":t="无需评审"}return t}var m=r+"-pagination",p=r+"-dialog",f=r+"-form",g=r+"plan-type-selector",v=r+"project-selector",h=r+"status-selector",y=r+"year-selector",b=r+"month-selector",T=r+"plan-type-selector-",w=r+"status-selector-",S=r+"year-selector-",D=r+"month-selector-",I=r+"-calendar",x=e.define(r,function(o){o.permission={add:t.hasPermission("requirement_insert"),edit:t.hasPermission("requirement_update"),"delete":t.hasPermission("requirement_delete")},o.demandName="",o.$yearOpts={selectId:y,options:_.map(_.range(a().year(),a().year()-10,-1),function(e){return{text:e+"年",value:e}}),selectedIndex:0},o.$monthOpts={selectId:b,options:[{text:"全部",value:0}].concat(_.map(_.range(1,13),function(e){return{text:e+"月",value:e}})),selectedIndex:0},o.$planTypeOpts={selectId:g,options:[{text:"计划类型",value:""}],selectedIndex:0},o.$projectOpts={selectId:v,options:[{text:"",value:""}],selectedIndex:0},o.$statusOpts={selectId:h,options:[{text:"",value:""}],selectedIndex:0},o.gridTotalSize=0,o.gridData=[],o.gridAllChecked=!1,o.gridSelected=[],o.gridCheckAll=function(){this.checked?o.gridSelected=_.map(o.gridData.$model,function(e){return e.id+""}):o.gridSelected.clear()},o.scCheckAll=function(){o.gridSelected=_.map(o.gridData.$model,function(e){return e.id+""})},o.search=function(){l(!0)},o.$paginationOpts={paginationId:m,total:0,perPages:30,onJump:function(){l()}},o.$aeDialogOpts={title:"添加需求",dialogId:p,width:920,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close" ms-visible="addEditState != \'view\'">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){var t,n=e.getVm(f);("edit"==o.addEditState||"view"==o.addEditState)&&(t=_.find(o.gridData.$model,function(e){return e.id==o.gridSelected[0]}),n.demandName=t.name,n.belongProject=_.map(t.reqProjects,function(e){return e.id+""}),n.devChargePerson=t.leader,e.getVm(T).selectValue(t.requirementPlanType),e.getVm(S).selectValue(a(t.planTime).year()),e.getVm(D).selectValue(a(t.planTime).month()+1),e.getVm(w).selectValue(t.requirementStatus),n.statusText=t.requirementStatusVal,n.isRequirementsReview=t.isRequirementsReview+"",n.requirementsReviewText=c(t.isRequirementsReview),n.isProductReview=t.isProductReview+"",n.productReviewText=u(t.isProductReview),n.requirementsReviewOpinion=t.requirementsReviewOpinion,n.productReviewOpinion=t.productReviewOpinion,n.demandReviewTime=t.requirementsReviewTime,n.productReviewTime=t.productReviewTime,n.devStartTime=t.developmentTime,n.devEndTime=t.planEndTime,n.planTypeText=t.requirementPlanTypeVal,n.planDateText=a(e.getVm(S).selectedValue+"-"+e.getVm(D).selectedValue,"YYYY-M").format("YYYY年MM月"),n.remark=t.remark,n.onlineTime=t.onlineTime)},onClose:function(){var t=e.getVm(f);t.reset(),t.demandName="",t.devChargePerson="",t.demandReviewTime="",t.productReviewTime="",t.requirementsReviewOpinion="",t.productReviewOpinion="",t.devStartTime="",t.devEndTime="",e.getVm(T).select(0,!0),e.getVm(S).select(0,!0),e.getVm(D).select(0,!0),e.getVm(w).select(0,!0),t.isRequirementsReview="",t.isProductReview="",t.planTypeText="",t.planDateText="",t.belongProject=[],t.remark="",t.statusText="",t.requirementsReviewText="",t.productReviewText="",t.onlineTime=""},submit:function(){var i,r,d=s.BASE_PATH+"reqRequirement/saveReqRequirement.do",c=e.getVm(p),u=e.getVm(f),m=o.addEditState;return"view"===m?void c.close():void(u.validate()&&(i=u.getFormData(),"edit"==m&&(r=o.gridSelected[0],_.extend(i,{id:r})),_.extend(i,{endPlanTime:+a(i.startPlanTime).add("months",1)}),i.projectIds=[].concat(i.projectIds),t.c2s({url:d,type:"post",data:n.stringify(i),contentType:"application/json",success:function(e){e.flag&&("edit"==m?l():(o.resetQueryFilter(),l(!0)),c.close())}})))}},o.$aeFormOpts={formId:f,field:[{selector:".demand-name",name:"name",rule:["noempty",function(e,t){return t[0]!==!0?"需求名称不能为空":!0}]},{selector:".belong-project",name:"projectIds",rule:function(e){return e.length?!0:"所属项目不能为空"}},{selector:".dev-charge-person",name:"leader",rule:function(e){return e.length?!0:"开发负责人"}},{selector:".plan-type",name:"requirementPlanType",getValue:function(){return e.getVm(T).selectedValue},rule:function(e){return e?!0:"请选择一种计划类型"}},{selector:".plan-date",name:"startPlanTime",getValue:function(){return+a(e.getVm(S).selectedValue+"-"+e.getVm(D).selectedValue,"YYYY-M")}},{selector:".status",name:"requirementStatus",getValue:function(){return e.getVm(w).selectedValue},rule:function(e){return e?!0:"请选择一种状态"}},{selector:".demand-review-box",name:"isRequirementsReview",getValue:function(){return e.getVm(f).isRequirementsReview}},{selector:".demand-no-passed-reason",name:"requirementsReviewOpinion",rule:["maxlength",function(e,t){return t[0]!==!0?"原因不能超过200字限制":!0}]},{selector:".product-review-box",name:"isProductReview",getValue:function(){return e.getVm(f).isProductReview}},{selector:".product-no-passed-reason",name:"productReviewOpinion",rule:["maxlength",function(e,t){return t[0]!==!0?"原因不能超过200字限制":!0}]},{selector:".demand-review-time",name:"requirementsReviewTime",getValue:function(){var e=_.str.trim($(this).val());return e&&(e=+a(e,"YYYY-MM-DD")),e}},{selector:".product-review-time",name:"productReviewTime",getValue:function(){var e=_.str.trim($(this).val());return e&&(e=+a(e,"YYYY-MM-DD")),e}},{selector:".dev-start-time",name:"developmentTime",getValue:function(){var e=_.str.trim($(this).val());return e&&(e=+a(e,"YYYY-MM-DD")),e}},{selector:".dev-end-time",name:"planEndTime",getValue:function(){var e=_.str.trim($(this).val());return e&&(e=+a(e,"YYYY-MM-DD")),e}},{selector:".remark",name:"remark",rule:["maxlength",function(e,t){return t[0]!==!0?"备注不能超过200字限制":!0}]},{selector:".online-time",name:"onlineTime",getValue:function(){var e=_.str.trim($(this).val());return e&&(e=+a(e,"YYYY-MM-DD")),e}}],$planTypeOpts_:{selectId:T,options:[{text:"计划类型",value:""}],selectedIndex:0},$yearOpts_:{selectId:S,options:_.map(_.range(a().year(),a().year()-10,-1),function(e){return{text:e+"年",value:e}}),selectedIndex:0},$monthOpts_:{selectId:D,options:_.map(_.range(1,13),function(e){return{text:e+"月",value:e}}),selectedIndex:a().month()},$statusOpts_:{selectId:w,options:[{text:"",value:""}],selectedIndex:0},demandName:"",projectList:[],belongProject:[],devChargePerson:"",demandReviewTime:"",productReviewTime:"",devStartTime:"",devEndTime:"",isRequirementsReview:"",isProductReview:"",planTypeText:"",planDateText:"",requirementsReviewOpinion:"",productReviewOpinion:"",remark:"",statusText:"",requirementsReviewText:"",productReviewText:"",onlineTime:"",formState:"add"},o.$calendarOpts={calendarId:I,bindInputName:"",onClickDate:function(t){var n=e.getVm(f),i=e.getVm(I),s=i.bindInputName;n[s]=a(t).format("YYYY-MM-DD"),$(i.widgetElement).hide()}},o.addEditState="add",o.$watch("addEditState",function(t){e.getVm(f).formState=t}),o.addDemand=function(){var t=e.getVm(p);o.addEditState="add",t.title="添加需求",t.open()},o.editGridItem=function(){var t=e.getVm(p),a=this.$vmodel.$model;o.gridSelected=[a.el.id+""],o.addEditState="edit",t.title="编辑需求",t.open()},o.viewGridItem=function(){var t=e.getVm(p),a=this.$vmodel.$model;o.gridSelected=[a.el.id+""],o.addEditState="view",t.title="查看需求",t.open()},o.getCalendarVm=function(){var a,n=e.getVm(I);return n||(a=$('<div class="demand-calendar fn-hide" ms-widget="calendar,$,$calendarOpts"></div>'),a.appendTo("body"),e.scan(a[0],o),n=e.getVm(I),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),n},o.showCalendar=function(){var e=$(this),t=_.str.trim(e.val()),n=e.offset(),s=o.getCalendarVm(),r=$(s.widgetElement),l=n.top+e.height()+1;n.top+e.height()+1+r.outerHeight()>$(i).scrollTop()+$(i).height()&&(l=n.top-r.outerHeight()),s.bindInputName=e.attr("name"),s.focusDate=t?a(t,"YYYY-MM-DD")._d:new Date,r.css({left:n.left,top:l}).show()},o.showNoPassedTip=function(){var t=e(this).data("tip"),a=r+"-no-passed-tip",n=$(this),i=$("#"+a),s=n.offset();i.length||(i=$('<div id="'+a+'" class="grid-tip"></div>'),i.html('<span class="text-content"></span><span class="icon-arrow"></span>'),i.hide().appendTo("body")),$(".text-content",i).text(t),i.css({top:s.top-i.height()-20,left:s.left-i.width()/2}).show()},o.hideNoPassedTip=function(){$("#"+r+"-no-passed-tip").hide()},o.removeGridItem=function(){var e=this.$vmodel.$model;o.gridSelected=[e.el.id+""],o._removeDemand()},o.batchRemoveGridItem=function(){o._removeDemand()},o._removeDemand=function(){var e,a;0===o.gridSelected.size()?t.alert({content:"请先选中需求"}):(e=o.gridSelected.$model,a=s.BASE_PATH+"reqRequirement/deleteReqRequirement/"+e[0]+".do",t.confirm({content:"确定要删除选中的需求吗？",onSubmit:function(){t.c2s({url:a,type:"post",dataType:"json",contentType:"application/json",success:function(t){t.flag&&_.each(e,function(e){var t=-1;_.some(o.gridData.$model,function(a,n){a.id==e&&(t=n)}),-1!=t&&o.gridData.removeAt(t)})}})}}))},o.resetQueryFilter=function(){var t=a();o.demandName="",e.getVm(y).selectValue(t.year()),e.getVm(b).selectValue(0),e.getVm(g).select(0),e.getVm(v).select(0),e.getVm(h).select(0)}});e.scan(o[0]),d(function(){l(!0)}),e.getVm(f).$watch("isRequirementsReview",function(t){var a=e.getVm(f);"2"==t&&(a.demandReviewTime="")}),e.getVm(f).$watch("isProductReview",function(t){var a=e.getVm(f);"2"==t&&(a.productReviewTime="")}),o.on("mouseenter",".no-passed-flag",function(e){x.showNoPassedTip.call(this,e)}).on("mouseleave",".no-passed-flag",function(e){x.hideNoPassedTip.call(this,e)})},$remove:function(t,a){var n=a+"-pagination",i=a+"-dialog",s=a+"-form",o=a+"plan-type-selector",r=a+"project-selector",l=a+"status-selector",d=a+"year-selector",c=a+"month-selector",u=a+"plan-type-selector-",m=a+"status-selector-",p=a+"year-selector-",f=a+"month-selector-",g=a+"-calendar",v=e.getVm(g);v&&$(v.widgetElement).remove(),$(e.getVm(f).widgetElement).remove(),$(e.getVm(p).widgetElement).remove(),$(e.getVm(m).widgetElement).remove(),$(e.getVm(u).widgetElement).remove(),$(e.getVm(c).widgetElement).remove(),$(e.getVm(d).widgetElement).remove(),$(e.getVm(l).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),o});

//From origin\page\frontend\home\activesrequest\activesrequest.js
define("originpagefrontendhomeactivesrequestactivesrequestjs",["avalon","util","originwidgetautocompleteautocompletejs","originwidgetpaginationpaginationjs","originwidgetformselectjs","dialog","originwidgetformformjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function s(a){JSON.stringify(a);t.c2s({url:n.BASE_PATH+"/activity/listActivity.do",type:"post",data:a,success:function(t){var a=e.getVm(m);t.flag&&(f.pageDataStatus=t.data.statusList,f.pageData=t.data.rows,a.total=t.data.totalSize)}})}var o=i+"-create-active-dialog",r=i+"-auto-complete-active",l=i+"-create-active-form",d=i+"-schedule",c=i+"-attach-uploader",u=i+"-brandId",m=i+"-pagination",p=n.getAppData("user"),f=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"活动申请"}],a.url=n.BASE_PATH,a.pageData={},a.pageDataStatus={},a.options1=[],a.upfile="",a.createData={merchantId:0,activityTitle:"",activityType:"",attachmentId:0,description:""},a.requestData={merchantName:"",pageNumber:1,pageSize:10,status:""},a.createActive=function(){var i=e.getVm(o),s=e.getVm(l),r=e.getVm(d);a.options1.length?r.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),r.setOptions(a.options1))}}),i.title="营销活动申请",s.activityTitle="",s.description="",i.open()},a.$brandOpts={autocompleteId:u,placeholder:"请指定商户",delayTime:300,onChange:function(e,a){e.length?t.c2s({url:n.BASE_PATH+"synMerchant/getSynMerchantInfoByUserId.do",data:{merchantName:e},success:function(e){var t;e.flag&&(t=e.data,a(_.map(t,function(e){return e.text=e.merchant_name||"未知",e.value=e.merchant_id,e})))}},{mask:!1}):a([])},onSelect:function(t){var a=e.getVm(u).getOptionByValue(t);f.createData.$model.merchantId=a.merchant_id}},a.$attachUploaderOpts={uploaderId:c,uploadifyOpts:{uploader:n.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:p.sessionId}},width:80,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=JSON.parse(e),e.flag){var t=e.data;f.createData.$model.attachmentName=t.attachmentName,f.createData.$model.originalFileName=t.originalFileName,f.createData.$model.fileSize=t.fileSize,a.upfile=t.originalFileName}}},a.$createActiveDialogOpts={dialogId:o,autoFocusInput:!1,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(l);t.reset(),t.activityTitle="",t.description="",f.complaintsId=0,a.upfile=""},submit:function(){{var i,c=e.getVm(o),u=e.getVm(l),m=e.getVm(d);e.getVm(r)}if(u.validate()){if(i=u.getFormData(),0==f.createData.$model.merchantId)return t.confirm({content:"请选择商户!",onSubmit:function(){}}),!1;f.createData.$model.activityTitle=i.activityTitle,f.createData.$model.description=i.description,f.createData.$model.activityType=m.selectedValue,f.createData.$model.attachmentId=0;var p=JSON.stringify(f.createData.$model);t.c2s({url:n.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:p,success:function(e){1==e.flag&&(s(a.requestData.$model),c.close(),f.complaintsId=0)}})}}},a.$createActiveFormOpts={formId:l,field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},a.$scheduleOpts={selectId:d,options:[],selectedIndex:1},a.changeStatus=function(t){var n=e.getVm(m);t=""+t,a.requestData.status=t,a.requestData.pageNumber=1,n.currentPage=1,s(a.requestData.$model)},a.search=function(){s(a.requestData.$model)},a.$paginationOpts={paginationId:m,total:0,onJump:function(){var t=e.getVm(m);f.requestData.pageNumber=t.currentPage,s(f.requestData.$model)}}});e.scan(a[0]),s(f.requestData.$model)},$remove:function(){}}),i});

//From origin\page\frontend\home\attachmentmanage\attachmentmanage.js
define("originpagefrontendhomeattachmentmanageattachmentmanagejs",["avalon","util","originwidgetpaginationpaginationjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i,o){function r(a){var i=JSON.stringify(a);t.c2s({url:n.BASE_PATH+"mailAndAttachment/listAttachment.do",type:"post",contentType:"application/json",data:i,success:function(t){var a,n=e.getVm(l("paginationId"));t.flag&&(a=t.data,n.total=a.totalSize,d.pageData=a.rows)}})}var l=function(e){var t=i+e;return s.push(t),t},d=e.define(i,function(t){t.navCrumbs=[{text:"我的主页",href:""},{text:"附件管理"}];var a="";switch(o.route){case"/sales/home/attachmentmanage":a="#/sales/home";break;case"/frontend/home/attachmentmanage":a="#/frontend/home";break;case"/backend/attachmentmanage":a="#/backend/customerservice"}t.navCrumbs[0].href=a,t.url=n.BASE_PATH,t.pageUserId=n.getAppData("user").id,t.pageData={},t.statusTabs="",t.requestData={merchantId:"",attachmentType:"plan",merchantName:"",pageNumber:1,pageSize:10,userId:t.pageUserId},t.changeStatus=function(t){var a=e.getVm(l("paginationId"));a.currentPage=1,d.requestData.pageNumber=1,d.requestData.attachmentType=t,d.requestData.merchantName="",d.pageData={},r(d.requestData.$model)},t.search=function(){r(d.requestData.$model)},t.$paginationOpts={paginationId:l("paginationId"),total:0,onJump:function(){var t=e.getVm(l("paginationId"));d.requestData.pageNumber=t.currentPage,r(d.requestData.$model)}}});e.scan(a[0]),r(d.requestData.$model)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\frontend\home\complaintsmanage\complaintsmanage.js
define("originpagefrontendhomecomplaintsmanagecomplaintsmanagejs",["avalon","util","originwidgetautocompleteautocompletejs","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,s){function o(a){var i=JSON.stringify(a);t.c2s({url:n.BASE_PATH+"sysCustomerComplaint/querySysCustomerComplaintList.do",type:"post",contentType:"application/json",data:i,success:function(t){var a,n=e.getVm(p);if(t.flag){a=t.data,n.total=a.totalSize;for(var i=0,s=a.rows.length;s>i;i++)a.rows[i].state=0;g.pageData=a.rows}}})}var r=i+"-submit-com-dialog",l=i+"-auto-complete-active",d=i+"-submit-com-form",c=i+"-schedule",u=i+"-brandId",m=i+"-attach-uploader",p=i+"-pagination",f=n.getAppData("user"),g=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:""},{text:"投诉管理"}];var i="";switch(s.route){case"/sales/home/complaintsmanage":i="#/sales/home";break;case"/frontend/home/complaintsmanage":i="#/frontend/home";break;case"/backend/complaintsmanage":i="#/backend/customerservice"}a.navCrumbs[0].href=i,a.upfile="",a.complaintsId=0,a.merchantId=parseInt(s.params.id),a.url=n.BASE_PATH,a.pageData={},a.options1=[],a.checkBoxArr=[],a.sysAttachment={},a.statusTabs="",a.requestData={merchantId:a.merchantId,merchantName:"",pageNumber:1,pageSize:10,customerComplaintStatus:""},a.changeStatus=function(t){var n=e.getVm(p);g.requestData.customerComplaintStatus=t,a.requestData.pageNumber=1,n.currentPage=1,o(g.requestData.$model)},a.search=function(){o(g.requestData.$model)},a.modStatus=function(e){e=e.toString(),t.c2s({url:n.BASE_PATH+"activity/updateRemind.do",type:"post",data:{id:e},success:function(){o(g.requestData.$model)}})},a.$paginationOpts={paginationId:p,total:0,onJump:function(){var t=e.getVm(p);g.requestData.pageNumber=t.currentPage,o(g.requestData.$model)}},a.showCon=function(){var e=this.$vmodel.$model.el;e.state=1},a.hideCon=function(){var e=this.$vmodel.$model.el;e.state=0},a.submitCom=function(){var i=e.getVm(r),s=e.getVm(d);a.options1.length||t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000049",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}))}}),i.title="提交投诉",s.complaintTitle="",s.complaintContent="",i.open()},a.addType=function(){var e=this.$vmodel.$model.el.value;if(this.checked)a.checkBoxArr.$model.push(e);else for(var t=0,n=a.checkBoxArr.$model.length;n>t;t++)e==a.checkBoxArr.$model[t]&&a.checkBoxArr.$model.splice(t,1)},a.$submitComDialogOpts={dialogId:r,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(d);t.reset(),g.complaintsId=0,t.complaintTitle="",t.complaintContent="",g.upfile=""},submit:function(){{var i,s=e.getVm(r),c=e.getVm(d);e.getVm(l)}if(c.validate()){var u=(new Date).getTime();if(i=c.getFormData(),i.merchantId=parseInt(g.complaintsId),!i.merchantId)return t.confirm({content:"请选择商户!",onSubmit:function(){}}),!1;i.customerComplaintType=g.checkBoxArr.$model,i.sysAttachment=g.sysAttachment.$model,i.complaintTime=u;var m=JSON.stringify(i);t.c2s({url:n.BASE_PATH+"sysCustomerComplaint/saveSysCustomerComplaint.do",type:"post",contentType:"application/json",data:m,success:function(e){1==e.flag&&(o(a.requestData.$model),s.close(),g.complaintsId=0)}})}}},a.$submitComFormOpts={formId:d,field:[{selector:".complaintTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".complaintContent",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],complaintTitle:"",complaintContent:""},a.$scheduleOpts={selectId:c,options:[],selectedIndex:1},a.$attachUploaderOpts={uploaderId:m,uploadifyOpts:{uploader:n.BASE_PATH+"sysCustomerComplaint/uploadFiles.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:f.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e,t){if(e=JSON.parse(e),e.flag){var a=e.data[0];g.sysAttachment.$model.originalFileName=a.originalFileName,g.sysAttachment.$model.attachmentName=a.fileName,g.sysAttachment.$model.attachmentSize=t.size.toString(),g.sysAttachment.$model.attachmentSuffix=t.type,g.upfile=a.originalFileName}}},a.$brandOpts={autocompleteId:u,placeholder:"请指定商户",delayTime:300,onChange:function(e,a){e.length?t.c2s({url:n.BASE_PATH+"synMerchant/getSynMerchantInfoByUserId.do",data:{merchantName:e},success:function(e){var t;e.flag&&(t=e.data,a(_.map(t,function(e){return e.text=e.merchant_name||"未知",e.value=e.merchant_id,e})))}},{mask:!1}):a([])},onSelect:function(t){var a=e.getVm(u).getOptionByValue(t);g.complaintsId=a.merchant_id}}});e.scan(a[0]),o(g.requestData.$model)},$remove:function(){}}),i});

//From origin\page\frontend\home\customer\customer.js
define("originpagefrontendhomecustomercustomerjs",["avalon","util","json","moment","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs","originmodulecardrulesettingcardrulesettingjs","originwidgeteditoreditorjs","originmoduleinterviewinterviewjs","originmodulesurveysurveyjs","originmoduleaddressaddressjs"],function(e,t,a){var n=this,i=n.erp,s={},o=[];return _.extend(s,{$init:function(n,s,r){function l(e,n,s){var o=a.stringify(e);f.pageData=[],t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:s})}function d(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?f.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:f.path+"portal/origin/asset/image/merchant-default-logo.jpg",f.merchantData=a,f.navCrumbs[1].text=a.merchant_name}}function c(e){var t,a,n=m.id;if(e.flag){t=e.data,f.stepData=t,a=t[0].listUsers;var i=r.params.type;if("sale"==i)return;for(var s=0;s<a.length;s++){if(n==a[s].id)return void(f.promise=!0);f.promise=!1}}}var u=function(e){var t=s+e;return o.push(t),t},m=i.getAppData("user"),p=($(".upload-info",n),s+"-cardrulesetting"),f=e.define(s,function(n){function s(){y.length=0;for(var e=1;8>=e;e++){var t="checkoucon"+e;$("."+t).blur(function(){_.str.trim($(this).val())&&($(this).removeClass("valid-error-field"),$(this).closest("tr").find(".ff-value-tip").hide())});var a=$("."+t).prevAll("input");if(a.length){if(1==a[0].checked){var n={selector:"."+t,rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]};y.push(n)}}else{var n={selector:"."+t,rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]};y.push(n)}}return y}function o(e,t){e=$(e);for(var a=0,n=t.length;n>a;a++)$(t[a],e).attr("disabled","disabled")}n.localHref=function(e){t.jumpPage(e+n.merchantId)},n.promise=!1,n.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:""}],n.path=i.BASE_PATH,n.merchantId=parseInt(r.params.id);var c=r.params.type;"sale"==c&&(n.navCrumbs[0].href="#/sales/home"),n.stepData={},n.imgUrl="";var g=function(){n.merchantData={productList:[],filePath:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",format_name:"",attachment_name:"",attachment_path:""}};g(),n.stepEnd=function(e,s,o){var r={id:e,onlineProcessStatus:s},l=a.stringify(r);t.confirm({content:o,onSubmit:function(){t.c2s({url:i.BASE_PATH+"fesOnlineProcess/updateFesOnlineProcessStatus.do",type:"post",contentType:"application/json",data:l,success:function(e){if(e.flag){var t=e.data;n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus,n.stepData[t.stepId-1].sysOperationLogVOs.push(t),n.stepData[9].onlineProcessStatus=t.finalStatus,t.stepId-1==3&&(n.stepData[3].onlineProcessStatus=s)}}})}})},n.removeUpload=function(e,a,s){t.confirm({content:"确定要删除选中的附件吗？",onSubmit:function(){t.c2s({url:i.BASE_PATH+"fesOnlineProcess/deleteAttachment/"+e+"/"+a+".do",type:"get",success:function(e){if(e.flag){var t=e.data;9==t.stepId?n.stepData[t.stepId-1].listAttachmentAndOperateLog.splice(s,1):n.stepData[t.stepId-1].fesSysAttachments.splice(s,1),n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus}}})}})},n.$surveyOpts={surveyId:u("-surveyModule"),readonly:"",merchantId:"",callFn:function(e){function t(e){e.flag&&f.stepData.splice(0,1,e.data[0])}if(1==e.flag){var a=f.stepData[0].id;l({processId:a},"fesOnlineProcess/listFesOnlineProcesss.do",t)}}},n.addSurvey=function(t){var a=e.getVm(u("-surveyModule"));a.readonly="04"!=t&&n.promise?0:1,a.moduleType="fes",a.merchantId=f.merchantId,a.requestData=$(this).attr("data-id")?{merchantId:f.merchantId,id:$(this).attr("data-id")}:{merchantId:f.merchantId},a.open()},n.removeResearch=function(e,n){var s={id:e,moduleType:"fes",storeId:n};s=a.stringify(s),t.confirm({content:"你确定要删除调研单吗？",onSubmit:function(){t.c2s({url:i.BASE_PATH+"mktShopSurvey/deleteMktShopSurvey.do",type:"post",contentType:"application/json",data:s,success:function(e){function t(e){e.flag&&f.stepData.splice(0,1,e.data[0])}if(1==e.flag&&1==e.flag){var a=f.stepData[0].id;l({processId:a},"fesOnlineProcess/listFesOnlineProcesss.do",t)}}})}})},n.$interviewOpts={interviewId:u("-interviewModule"),sessionId:"",readonly:"",moduleType:"",merchantId:"",callFn:function(){function e(e){e.flag&&f.stepData.splice(0,1,e.data[0])}var t=f.stepData[0].id;l({processId:t},"fesOnlineProcess/listFesOnlineProcesss.do",e),l({merchantId:f.merchantId},"synMerchant/getMerchantInfoByOrder.do",d)}},n.addInterval=function(t){var a=e.getVm(u("-interviewModule"));a.requestData={merchantId:f.merchantId},a.sessionId=m.sessionId,a.readonly="04"!=t&&n.promise?0:1,a.moduleType="fes",a.merchantId=f.merchantId,a.requestData={merchantId:f.merchantId},a.open()},n.$addressOpts={addressId:u("-addressModule"),readonly:"",moduleType:"fes",merchantId:""},n.addCommunication=function(n){var s=e.getVm(u("-addressModule"));s.readonly=0,s.callFn=function(){t.c2s({url:i.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:a.stringify({merchantId:f.merchantId}),success:function(t){var a;if(t.flag){a=t.data.rows;var i=e.getVm(n),s=_.map(a,function(e){return{text:e.name,value:e.id}});s.unshift({text:"请选择",value:""}),i.setOptions(s)}}})},s.requestData=$(this).attr("data-id")?{merchantId:f.merchantId,id:$(this).attr("data-id")}:{merchantId:f.merchantId},s.open()},n.$step3AttachUploaderOpts={uploaderId:u("step3AttachUploaderId"),uploadifyOpts:{uploader:i.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:m.sessionId,processId:n.stepData[2].id}},width:140,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=a.parse(e),e.flag){var t=e.data;n.stepData[2].fesSysAttachments.push(t),n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus}}},n.$step4AttachUploaderOpts={uploaderId:u("step4AttachUploaderId"),uploadifyOpts:{uploader:i.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:m.sessionId,processId:n.stepData[3].id}},width:140,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=a.parse(e),e.flag){var t=e.data;n.stepData[3].fesSysAttachments.length?n.stepData[3].fesSysAttachments.splice(0,1,t):n.stepData[3].fesSysAttachments.push(t),n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus}}};var v=function(){n.messageRequestData={},n.messageData={},n.controlWitch=function(e){if(this.$vmodel.$model.el.isAvail)if("parent"==e){this.$vmodel.$model.el.isAvail=!1;var t=this.$vmodel.$model.el.child,a=this.$vmodel.$model.el.id;if(t)for(var n=0;n<t.length;n++)t[n].isAvail=!1;$(".input"+a+">input").attr("checked",!1)}else"child"==e&&(this.$vmodel.$model.el.isAvail=!1);else{var i=this.$vmodel.$model.el;"parent"==e?i.isAvail=!0:"child"==e&&(i.isAvail=!0)}},n.appendValue=function(e){function a(e,t,n){for(var i=0;i<e.length;i++){if(e[i].id==t)return void(e[i].templateTxt=n);e[i].child&&e[i].child instanceof Array&&a(e[i].child,t,n)}}var n=".textarea"+e,i=this.innerHTML,s=$(n).val();if(-1!=s.indexOf(i))return t.confirm({content:"不能重复添加内容",onSubmit:function(){}}),!1;t.appendTextAtCursor(n,i);var o=$(n).val();a(f.messageData.$model,e,o)},n.openMessageRules=function(s){var o=e.getVm(u("messageRulesId"));o.readonly="04"!=s&&f.promise?!1:!0,t.c2s({url:i.BASE_PATH+"trade/messageTemplate/listMessageTemplates.do",type:"post",data:{merchantId:f.merchantId},success:function(e){if(1==e.flag){for(var s=e.data,r=[],l=[],d=[],c=0;c<s.length;c++)d.push(s[c].transCode);var u=a.stringify(d);t.c2s({url:i.BASE_PATH+"trade/messageTemplate/listSmsTmpFields.do",type:"post",contentType:"application/json",data:u,success:function(e){if(1==e.flag){for(var t=e.data,a=0;a<s.length;a++)for(var i in t){var d=t.hasOwnProperty(i);d&&s[a].transCode==i&&(s[a].listType=[],s[a].listType=t[i])}for(var a=0;a<s.length;a++)s[a].parent?l.push(s[a]):r.push(s[a]);for(var a=0;a<r.length;a++)for(var c=0;c<l.length;c++)l[c].parent==r[a].id&&(r[a].child||(r[a].child=[]),r[a].child.push(l[c]));n.messageData=r,o.title="交易短信规则",o.open()}}})}}})},n.$messageRulesOpts={dialogId:u("messageRulesId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="close">确&nbsp;定</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},width:670,readonly:!1,onOpen:function(){},onClose:function(){},submit:function(){var s=[];t.c2s({url:i.BASE_PATH+"trade/smstmpfeild/listTradeSmsTmpFeilds.do",type:"post",success:function(o){if(1==o.flag){s=o.data;for(var r=[],l=f.messageData.$model,d=0;d<l.length;d++)r.push(l[d]),l[d].child&&(r=r.concat(l[d].child));for(var d=0;d<r.length;d++){delete r[d].listType,delete r[d].child;var c=r[d].templateTxt.match(/\[([^\]])*\]/g);try{for(var m=0;m<c.length;m++)c[m]=c[m].replace(/]|\[/g,"");for(var p=[],m=0;m<s.length;m++)for(var g=0;g<c.length;g++)c[g]==s[m].description&&p.push(s[m].fieldName);r[d].templateFeilds=p.join()}catch(v){}for(var m=0;m<s.length;m++){var h=r[d].templateTxt,y=s[m].description;if(-1!=h.indexOf("["+y+"]")){var b=RegExp("\\["+y+"]","g");h=h.replace(b,s[m].fieldType)}r[d].templateTxt=h}}for(var d=0;d<r.length;d++)r[d].merchantId=f.merchantId,r[d].messageTemplate=r[d].templateTxt;var T=a.stringify(r);t.c2s({url:i.BASE_PATH+"trade/messageTemplate/saveMessageTemplates.do",type:"post",contentType:"application/json",data:T,success:function(t){if(1==t.flag){var a=t.data,i=e.getVm(u("messageRulesId"));i.close(),n.stepData[4].tradeMessageTemplates.push(a),n.stepData[4].sysOperationLogVOs.push(a),n.stepData[4].onlineProcessStatus=a.onlineProcessStatus}}})}}})}},n.$messageRulesFormOpts={formId:u("messageRulesFormId"),field:[{selector:".beginTime",name:"beginTime",rule:[]}]}};v(),n.$cardrulesettingOpts={cardrulesettingId:p,merchantId:r.params.id/1,onUpdateCallback:function(e){if(e.flag){var t=e.data;n.stepData[4].tradeCardtypes.push(t),n.stepData[4].sysOperationLogVOs.push(t),n.stepData[4].onlineProcessStatus=t.onlineProcessStatus}}},n.openCardRuleDialog=function(t){"04"!=t&&f.promise||e.getVm(p).setReadonly(1),e.getVm(p).open()};var h=function(){n.carRequestData={processId:0,merchantId:n.merchantId,fesOpenCardApplicationDtls:[{cardName:"",cardAmount:"",validityTerm:1,isContainFour:"0",isContainSeven:"0"}]},n.openCard=function(t){var a=e.getVm(u("cardDialog"));a.title="开卡申请",n.carRequestData.processId=t,a.open()},n.changeRedio4=function(e){this.$vmodel.$model.el.isContainFour=e},n.changeRedio7=function(e){this.$vmodel.$model.el.isContainSeven=e},n.$addCardDialogOpts={dialogId:u("cardDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button ms-if="save" type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},save:1,width:530,onClose:function(){var t=e.getVm(u("cardForm"));t.reset(),t.cardName="",t.cardAmount="",t.validityTerm=""},submit:function(){var n,s=e.getVm(u("cardDialog")),o=e.getVm(u("cardForm"));if(o.validate()){for(var r=f.carRequestData.$model.fesOpenCardApplicationDtls,d=0;d<r.length;d++)r[d].cardAmount=Number(r[d].cardAmount),r[d].validityTerm=Number(r[d].validityTerm);n=a.stringify(f.carRequestData.$model),t.c2s({url:i.BASE_PATH+"applySetting/saveOpenCardApply.do",type:"post",contentType:"application/json",data:n,success:function(e){1==e.flag&&(s.close(),l({merchantId:f.merchantId,userId:m.id},"fesOnlineProcess/listFesOnlineProcesss.do",listWaiting))}})}}},n.$addCardFormOpts={formId:u("cardForm"),field:[{selector:".cardName",rule:["noempty",function(e,t){return t[0]!==!0?"卡类型名称不能为空":!0}]},{selector:".cardAmount",rule:["noempty",function(e,t){if(t[0]!==!0)return"开卡数量不能为空";var a=/^[0-9]\d*$/;return a.test(e)?!0:"开卡数量必须为数字"}]}],cardName:"",cardAmount:"",validityTerm:""},n.readCard=function(s){t.c2s({url:i.BASE_PATH+"fesOnlineProcess/getFesOpenCardApplicationsAndDtls.do",type:"post",contentType:"application/json",data:a.stringify({processId:s}),success:function(t){if(1==t.flag){for(var a=t.data[0],i=0;i<a.fesOpenCardApplicationDtls.length;i++)a.fesOpenCardApplicationDtls[i].validityTerm||(a.fesOpenCardApplicationDtls[i].validityTerm="");f.carRequestData=a;var s=e.getVm(u("cardDialog"));s.save=0,n.openCard()}}})},n.addCarList=function(){var e={cardName:"",cardAmount:"",validityTerm:1,isContainFour:0,isContainSeven:"0"};n.carRequestData.fesOpenCardApplicationDtls.push(e)},n.removeCarList=function(){n.carRequestData.fesOpenCardApplicationDtls.pop()}};h(),n.setp7ReqData={id:0,processId:0,accessId:1,description:"",fesMaterialRequestDtlVOs:[{materialRequestType:"1",specificationType:"1",description:""},{materialRequestType:"2",specificationType:"1",description:""},{materialRequestType:"3",specificationType:"1",description:""},{materialRequestType:"4",specificationType:"1",description:""},{materialRequestType:"5",specificationType:"1",description:""},{materialRequestType:"6",specificationType:"1",description:""},{materialRequestType:"7",specificationType:"1",description:""}]},n.changeRadioStatus=function(t,a,i){var s=e.getVm(u("step7DialogId"));s.readonly||(n.setp7ReqData.fesMaterialRequestDtlVOs[t].specificationType=a,$(this).children("input:radio")[0].checked=!0,$(this).closest("tr").find("input").removeClass("valid-error-field"),$(this).closest("tr").find(".ff-value-tip").hide(),i&&$("."+i)[0].focus())},n.$step7AttachUploaderOpts={uploaderId:u("step7AttachUploaderId"),uploadifyOpts:{uploader:i.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:m.sessionId,processId:n.stepData[6].id,typeId:15}},width:140,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=a.parse(e),e.flag){var t=e.data;n.stepData[6].fesSysAttachments.length?n.stepData[6].fesSysAttachments.splice(0,1,t):n.stepData[6].fesSysAttachments.push(t),n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus}}},n.step7Input=function(n){function s(){t.c2s({url:i.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:a.stringify({merchantId:f.merchantId}),success:function(t){if(1==t.flag){var a=t.data.rows,n=e.getVm(u("step7NameSelect")),i=_.map(a,function(e){return{text:e.name,value:e.id}});n.setOptions(i),o.title="设计需求单",(18!=f.stepData[6].onlineProcessStatus&&19!=f.stepData[6].onlineProcessStatus||!f.promise)&&(o.readonly=1,$("input",o.widgetElement).prop("disabled",!0),$("textarea",o.widgetElement).prop("disabled",!0),$("span",o.widgetElement).off("click")),o.open()}}})}{var o=e.getVm(u("step7DialogId"));e.getVm(u("step7FormId"))}n?t.c2s({url:i.BASE_PATH+"fesOnlineProcess/getFesMaterialRequestById.do",type:"post",contentType:"application/json",data:a.stringify({id:n}),success:function(e){1==e.flag&&(f.setp7ReqData=e.data,s())}}):s()},n.$step7DialogOpts={dialogId:u("step7DialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">关&nbsp;闭</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},readonly:0,onOpen:function(){},onClose:function(){f.setp7ReqData={id:0,processId:0,accessId:1,description:"",fesMaterialRequestDtlVOs:[{materialRequestType:"",specificationType:"",description:""},{materialRequestType:"",specificationType:"",description:""},{materialRequestType:"",specificationType:"",description:""},{materialRequestType:"",specificationType:"",description:""},{materialRequestType:"",specificationType:"",description:""},{materialRequestType:"",specificationType:"",description:""},{materialRequestType:"",specificationType:"",description:""}]};var a=e.getVm(u("step7DialogId"));t.testCancel($(a.widgetElement)[0])},width:600,submit:function(){var n=e.getVm(u("step7DialogId")),o=e.getVm(u("step7FormId"));if(s(),o.validate()){f.setp7ReqData.processId=f.stepData[6].id,f.setp7ReqData.accessId=e.getVm(u("step7NameSelect")).selectedValue;var r=a.stringify(f.setp7ReqData.$model);t.c2s({url:i.BASE_PATH+"fesOnlineProcess/saveFesMaterialRequestAndDtls.do",type:"post",contentType:"application/json",data:r,success:function(e){if(1==e.flag){var t=e.data;f.stepData.splice(6,1,t),n.close()}}})}}};var y=[];n.$step7FormOpts={formId:u("step7FormId"),field:y},n.$step7NameSelectOpts={selectId:u("step7NameSelect"),options:[],selectedIndex:1},n.$addEditDialogOpts={dialogId:u("addEditDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(u("addEditFormId"));t.reset(),t.beginTime="",t.endTime="",t.address="",t.trainer="",t.content=""},submit:function(){var s,o,r=e.getVm(u("addEditDialogId")),l=e.getVm(u("addEditFormId")),d=n.step9AddEditState,c=n.stepData.$model[8].id;l.validate()&&(s=l.getFormData(),o=i.BASE_PATH+"fesOnlineProcess/saveFesTrainPlan.do","edit"==d?(s.processId=c,s.id=n.stepData.$model[8].fesTrainPlans[0].id):"add"==d&&(s.processId=c),s.beginTime=moment(s.beginTime,"YYYY-MM-DD"),s.endTime=moment(s.endTime,"YYYY-MM-DD"),s=a.stringify(s),t.c2s({url:o,type:"post",contentType:"application/json",data:s,success:function(e){if(1==e.flag){var t=e.data;"edit"==d?(n.stepData[8].fesTrainPlans[0].beginTime=t.beginTime,n.stepData[8].fesTrainPlans[0].endTime=t.endTime,n.stepData[8].fesTrainPlans[0].address=t.address,n.stepData[8].fesTrainPlans[0].trainer=t.trainer,n.stepData[8].fesTrainPlans[0].content=t.content):"add"==d&&n.stepData[8].fesTrainPlans.push(t),r.close()}}}))}},n.$addEditFormOpts={formId:u("addEditFormId"),field:[{selector:".beginTime",name:"beginTime",rule:["noempty",function(e,t){return t[0]!==!0?"开始时间不能为空":!0}]},{selector:".endTime",name:"endTime",rule:["noempty",function(e,t){return t[0]!==!0?"结束时间不能为空":!0}]},{selector:".address",name:"address",rule:["noempty",function(e,t){return t[0]!==!0?"请填写培训地点":!0}]},{selector:".trainer",name:"trainer",rule:["noempty",function(e,t){return t[0]!==!0?"请填写参与人员":!0}]},{selector:".content",name:"content",rule:["noempty",function(e,t){return t[0]!==!0?"培训内容不能为空":!0}]}],beginTime:"",endTime:"",address:"",trainer:"",content:""},n.openEditStep9=function(){var t=e.getVm(u("addEditDialogId")),a=e.getVm(u("addEditFormId")),i=this.$vmodel.$model.el.fesTrainPlans[0];t.title="培训计划",a.beginTime=moment(i.beginTime).format("YYYY-MM-DD"),a.endTime=moment(i.endTime).format("YYYY-MM-DD"),a.address=i.address,a.trainer=i.trainer,a.content=i.content,n.step9AddEditState="edit",t.open()},n.openAddStep9=function(){{var t=e.getVm(u("addEditDialogId"));e.getVm(u("addEditFormId"))}t.title="培训计划",n.step9AddEditState="add",t.open()},n.$startDateOpts={calendarId:u("startDateCalendarId"),minDate:new Date,onClickDate:function(t){var a=e.getVm(u("addEditFormId"));a.beginTime=moment(t).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},n.openStartDateCalendar=function(){var a,i=e.getVm(u("addEditFormId")),s=$(this),o=e.getVm(u("startDateCalendarId")),r=s.offset();o?a=$(o.widgetElement):(a=$('<div ms-widget="calendar,$,$startDateOpts"></div>'),a.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(a[0],[n]),o=e.getVm(u("startDateCalendarId")),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),o.focusDate=i.beginTime?moment(i.beginTime,"YYYY-MM-DD")._d:new Date,i.endTime&&(o.maxDate=moment(i.endTime,"YYYY-MM-DD")._d),a.css({top:r.top+s.outerHeight()-1,left:r.left}).show()},n.$endDateOpts={calendarId:u("endDateCalendarId"),minDate:new Date,onClickDate:function(t){var a=e.getVm(u("addEditFormId"));a.endTime=moment(t).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},n.openEndDateCalendar=function(){var a,i=e.getVm(u("addEditFormId")),s=$(this),o=e.getVm(u("endDateCalendarId")),r=s.offset();o?a=$(o.widgetElement):(a=$('<div ms-widget="calendar,$,$endDateOpts"></div>'),a.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(a[0],[n]),o=e.getVm(u("endDateCalendarId")),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),o.focusDate=i.endTime?moment(i.endTime,"YYYY-MM-DD")._d:new Date,i.beginTime&&(o.minDate=moment(i.beginTime,"YYYY-MM-DD")._d),a.css({top:r.top+s.outerHeight()-1,left:r.left}).show()},n.$step9AttachUploaderOpts={uploaderId:u("attachUploaderId"),uploadifyOpts:{uploader:i.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:m.sessionId,processId:n.stepData[8].id,typeId:"5"}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=a.parse(e),e.flag){var t=e.data;n.stepData[t.stepId-1].listAttachmentAndOperateLog.push(t),n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus}}};var b=function(){n.step9AccessId=0,n.acessRequestData=[],n.step9Access=function(s,r,l){var d,c=e.getVm(u("addAccessForm")),m=e.getVm(u("addAccessDialog"));if(o(c.widgetElement,["input","textarea"]),"add"==s){n.step9AccessId=0;var p=a.stringify({documentType:"1"});d="sysQuestion/listSysQuestions.do"}else if("edit"==s){n.step9AccessId=r;var p=a.stringify({id:r});d="sysDocument/querySysDocumentById.do"}t.c2s({url:i.BASE_PATH+d,type:"post",contentType:"application/json",data:p,success:function(t){function a(e){for(var t=[],a=0;a<e.length;a++){var n={};n.optionContent=e[a].optionContent,n.isSelected=e[a].isSelected,n.isOpenTextarea=e[a].isOpenTextarea,n.tip=e[a].tip,n.isOpenTextarea=e[a].isOpenTextarea,n.comment=e[a].comment?e[a].comment:"",t.push(n)}return t}function i(e){for(var t=[],n=0;n<e.length;n++){var i={};i.questionId=e[n].id,i.questionType=e[n].question_type,i.title=e[n].title,i.tip=e[n].tip,i.comment=e[n].comment?e[n].comment:"",e[n].sysQuestionOptionList&&(i.sysDocumentDtlOptionList=a(e[n].sysQuestionOptionList)),t.push(i)}return t}function o(){var t=e.getVm(u("addAccessDialog")),a=e.getVm(u("addAccessForm"));t.readonly=!0;{var n=a.widgetElement;$("input",$(n)).attr("disabled","disabled"),$("textarea",$(n)).attr("disabled","disabled")}}if(1==t.flag)if("add"==s){var r=t.data;r=i(r),n.acessRequestData=r,m.title="回访单",m.open()}else if("edit"==s){var r=t.data.sysDocumentDtlList;n.acessRequestData=r,m.title="回访单","04"==l&&o(),m.open()}}})},n.radioBox=function(e){for(var t=e.sysDocumentDtlOptionList,a=0;a<t.length;a++)t[a].isSelected="0",t[a].comment="";this.$vmodel.$model.el.isSelected="1",$(this).closest("li").find("textarea").removeClass("valid-error-field"),$(this).closest("li").find(".ff-value-tip").hide()},n.checkBox=function(){var e=this.$vmodel.$model.el;e.isSelected="1"==e.isSelected?"0":"1"},n.$addAccessDialogOpts={dialogId:u("addAccessDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">关&nbsp;闭</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},width:600,readonly:!0,onOpen:function(){},onClose:function(){var t=e.getVm(u("addAccessDialog")),a=e.getVm(u("addAccessForm"));a.reset(),t.readonly=!1},submit:function(){var n,s=e.getVm(u("addAccessDialog")),o=e.getVm(u("addAccessForm")),r={};o.testVal()&&(f.step9AccessId?(r.id=f.step9AccessId,n="sysDocument/saveDocumentAndUpdateStatusForStep9.do"):n="sysDocument/saveDocumentAndUpdateStatusForStep9.do",r.documentType=1,r.merchantId=f.merchantId,r.sysDocumentDtlList=f.acessRequestData.$model,r=a.stringify(r),t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:r,success:function(e){1==e.flag&&(s.close(),s.readonly=!1,l({merchantId:f.merchantId,userId:m.id,resourceRemark:"end_custom_service"},"fesOnlineProcess/listFesOnlineProcesss.do",listWaiting))}}))}},n.$addAccessFormOpts={formId:u("addAccessForm"),testVal:function(){for(var t=!0,a=e.getVm(u("addAccessForm")),n=a.widgetElement,i=$(".questions",$(n)),s=0;s<i.length;s++){var o=$(i[s]);if(!_.str.trim(o.val())){o.blur(function(){var e=_.str.trim($(this).val());if(e)$(this).removeClass("valid-error-field"),$(this).next(".ff-value-tip").hide();else{$(this).addClass("valid-error-field");var t=$(this).next(".ff-value-tip");t?t.addClass("valid-error").html("内容不能为空！").show():$(this).parent().append("<div class='ff-value-tip valid-error'>内容不能为空</div>")}}),o.addClass("valid-error-field");var r=o.next(".ff-value-tip");r?r.addClass("valid-error").html("内容不能为空！").show():o.parent().append("<div class='ff-value-tip valid-error'>内容不能为空</div>"),t=!1}}return t},questions:""}};b();var T=function(){n.linkMan={data:[],flag:0},n.mailModel={data:[],flag:0},n.mailTo="",n.mailRequestData={id:"",onlineProcessStatus:"04",email:{sendAddress:m.userName,to:[],context:"",subject:""}},n.$editorOpts={editorId:u("editorId"),ueditorOptions:{UEDITOR_HOME_URL:i.WIDGET_PATH+"editor/ueditor/",serverUrl:i.BASE_PATH,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter"]]}},n.onLineMail=function(){n.mailRequestData.id=this.$vmodel.$model.el.id;var t=e.getVm(u("onLineMailDialogId"));t.title="发送《启动服务通知函》",t.open()},n.addLinkman=function(){$(document).on("click",function(e){var t=e.target;"addLinkMan"!=t.id&&(f.linkMan.flag=0),"addMailModel"!=t.id&&(f.mailModel.flag=0)}),t.c2s({url:i.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:a.stringify({merchantId:f.merchantId}),success:function(e){1==e.flag&&(f.linkMan.flag=1,f.linkMan.data=e.data.rows)}})},n.addPut=function(){var e=this.$vmodel.$model.el.mail;if(f.mailTo.length)for(var t=f.mailTo.split(";"),a=0;a<t.length;a++)t[a]!=e&&(f.mailTo+=";"+e);else f.mailTo+=e;f.linkMan.flag=0},n.addMailModel=function(){t.c2s({url:i.BASE_PATH+"fesOnlineProcess/getEmailTemplates.do",type:"post",contentType:"application/json",data:a.stringify({mailTemplateType:"001"}),success:function(e){1==e.flag&&(f.mailModel.data=e.data.rows,f.mailModel.flag=1)}})},n.addPutEmailModel=function(){var t=this.$vmodel.$model.el.content,a=e.getVm(u("editorId"));a.core.setContent(t),f.mailModel.flag=0,f.mailRequestData.email.subject=this.$vmodel.$model.el.title},n.$onLineMailDialogOpts={dialogId:u("onLineMailDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(u("addQuestionFormId"));t.reset()},width:700,submit:function(){var s=e.getVm(u("onLineMailDialogId")),o=e.getVm(u("onLineMailFormId")),r=e.getVm(u("editorId"));o.validate()&&(f.mailRequestData.email.context=r.core.getContent(),f.mailRequestData.email.to=f.mailTo.split(";"),t.c2s({url:i.BASE_PATH+"fesOnlineProcess/updateOnlineStatusAndSendEmail.do",type:"post",contentType:"application/json",data:a.stringify(f.mailRequestData.$model),success:function(e){if(1==e.flag){var t=e.data;n.stepData[t.stepId-1].onlineProcessStatus=t.onlineProcessStatus,n.stepData[t.stepId-1].sysOperationLogVOs.push(t),n.stepData[9].onlineProcessStatus=t.finalStatus,s.close()}}}))}},n.$onLineMailFormOpts={formId:u("onLineMailFormId"),field:[{selector:".mail-to",rule:["noempty",function(e,t){return t[0]!==!0?"收件人不能为空":!0}]},{selector:".mail-subject",rule:["noempty",function(e,t){return t[0]!==!0?"邮件标题不能为空":!0}]},{selector:".mail-name-fa",rule:["noempty",function(e,t){return t[0]!==!0?"发件人不能为空":!0}]}]}};T();var D=function(){n.options1=[],n.$addQuestionDialogOpts={dialogId:u("addQuestionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(u("addQuestionFormId"));t.reset(),t.title="",t.description=""},submit:function(){var n,s=e.getVm(u("addQuestionDialogId")),o=e.getVm(u("addQuestionFormId"));if(o.validate()){n=o.getFormData();var r=e.getVm(u("scheduleId")).selectedValue;n.merchantId=f.merchantId,n.problemType=r,n.problemStatus=1,n=a.stringify(n),t.c2s({url:i.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:n,success:function(e){1==e.flag&&s.close()}})}}},n.openAdd=function(){var a=e.getVm(u("scheduleId"));n.options1.length?a.setOptions(n.options1):t.c2s({url:i.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,n.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),a.setOptions(n.options1))}});var s=e.getVm(u("addQuestionDialogId")),o=e.getVm(u("addQuestionFormId"));s.title="添加问题",o.title="",o.description="",s.open()},n.$addQuestionFormOpts={formId:u("addQuestionFormId"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},n.$scheduleOpts={selectId:u("scheduleId"),options:[],selectedIndex:1}};D();var I=function(){n.createData={},n.options2=[],n.createActive=function(){var a=e.getVm(u("createActiveDialogId")),s=e.getVm(u("createActiveFormId")),o=e.getVm(u("activeId"));n.options2.length?o.setOptions(n.options2):t.c2s({url:i.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,n.options2=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}
}),o.setOptions(n.options2))}}),a.title="营销活动申请",s.activityTitle="",s.description="",a.open()},n.$activeUploaderOpts={uploaderId:u("activeUploaderId"),uploadifyOpts:{uploader:i.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:m.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=a.parse(e),e.flag){var t=e.data;f.createData.$model.attachmentName=t.attachmentName,f.createData.$model.originalFileName=t.originalFileName,f.createData.$model.fileSize=t.fileSize}}},n.$createActiveDialogOpts={dialogId:u("createActiveDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(u("createActiveFormId"));t.reset(),t.activityTitle="",t.description=""},submit:function(){var n,s=e.getVm(u("createActiveDialogId")),o=e.getVm(u("createActiveFormId")),r=e.getVm(u("activeId"));if(o.validate()){n=o.getFormData(),f.createData.$model.merchantId=f.merchantId,f.createData.$model.activityTitle=n.activityTitle,f.createData.$model.description=n.description,f.createData.$model.activityType=r.selectedValue,f.createData.$model.attachmentId=0;var l=a.stringify(f.createData.$model);t.c2s({url:i.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:l,success:function(e){1==e.flag&&s.close()}})}}},n.$createActiveFormOpts={formId:u("createActiveFormId"),field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},n.$activeOpts={selectId:u("activeId"),options:[],selectedIndex:1}};I()});e.scan(n[0]),l({merchantId:f.merchantId},"synMerchant/getMerchantInfoByOrder.do",d),l({merchantId:f.merchantId},"fesOnlineProcess/listFesOnlineProcesss.do",c)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),s});

//From origin\page\frontend\home\customerline\customerline.js
define("originpagefrontendhomecustomerlinecustomerlinejs",["avalon","util","moment","json","originwidgetformselectjs","dialog","originwidgetformformjs","originwidgetuploaderuploaderjs","originmodulescheduleschedulejs","originwidgeteditoreditorjs"],function(e,t,a,n){var i=this,s=i.erp,o={},r=[];return _.extend(o,{$init:function(i,o,l){function d(e,t){var a=[];if(e instanceof Array)for(var n=0;n<e.length;n++){var i={};for(var s in e[n]){var o=e[n].hasOwnProperty(s);if(o)for(var r=0;r<t.length;r++)s==t[r]&&(i[t[r]]=e[n][s])}a.push(i)}else{var i={};for(var s in e){var o=e[n].hasOwnProperty(s);if(o)for(var r=0;r<t.length;r++)s==t[r]&&(i[t[r]]=e[n][s])}a.push(i)}return a}function c(e){t.c2s({url:s.BASE_PATH+"user/isExistSysUserMerchant.do",type:"post",contentType:"application/json",data:n.stringify({merchantId:b.merchantId,userId:v.id}),success:function(t){t.flag&&e&&e(t.data)}},{mask:!1})}function u(e,a,i){var o=n.stringify(e);t.c2s({url:s.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:i})}function m(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.userMerchantList=t.userMerchantList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in t){var s=t.hasOwnProperty(i);s&&"object"!=typeof t[i]&&(a[i]=t[i])}for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?b.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:b.path+"portal/origin/asset/image/merchant-default-logo.jpg",b.merchantData=a;for(var o=v.id,r=0;r<a.userMerchantList.length;r++){if(o==a.userMerchantList[r].userId)return void(b.promise=!0);b.promise=!1}}}function p(e){var t;e.flag&&(t=e.data,b.healthResponseData=t)}function f(e){var t;e.flag&&(t=e.data,b.reportResponseData=t.merchantMonthSum)}function g(){var e=$("#warn>li").length,t=0;setInterval(function(){t++,t>=e&&(t=0),$("#warn").animate({top:40*-t})},5e3)}var v=s.getAppData("user"),h=new Date,y=o+"-schedule",b=e.define(o,function(i){var m=function(e){var t=o+e;return r.push(t),t};i.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"客户服务看板"}],i.belongToRouteName=l.route.split("/")[1],i.path=s.BASE_PATH,i.merchantId=parseInt(l.params.id),i.pageUserId=s.getAppData("user").id,i.modelType=parseInt(l.params.type),i.pageStatus=1,i.pageData={},i.imgUrl="",i.upfile="",i.promise=!1,i.localHref=function(e){t.jumpPage(e)},i.warn=[{insertTime:"",itemContent:""}];var g=function(){i.merchantData={productList:[],filePath:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",online_time:"",format_name:"",attachment_name:"",attachment_path:""}};g(),i.requestDataDispose={id:0,handledBy:i.pageUserId,handledTime:(new Date).getTime(),handledDescription:"",customerComplaintStatus:1},i.changePageStatus=function(e){i.pageStatus=e,2==e&&i.cardFn()};var T=function(){i.responseCardData=[{card_count:216481,card_price:0,card_type:"粉丝会员",merchant_type:"品牌",is_sold_card:!1,merchant_name:"北京新辣道餐饮管理有限公司",merchant_id:1119,cardtype_id:207,description:"暂无",card_name:"积分卡"}],i.cardFn=function(){t.c2s({url:s.BASE_PATH+"synMembershipCard/listSynMembershipCards.do",type:"post",data:{pageNumber:1,pageSize:1e4,merchantId:b.merchantId},success:function(e){if(e.flag){var t=e.data.rows,a=["card_count","card_price","card_type","merchant_type","is_sold_card","merchant_name","cardtype_id","description","card_name"];b.responseCardData=d(t,a)}}})}};T();var D=function(){function e(){var e=new Date;i.nextHealthBtn=t<=e.getFullYear()&&a<e.getMonth()+1?!0:!1,n=t+"-"+a,i.healthRequestData.date=n,u(i.healthRequestData.$model,"health/getHealthDegreeByMerchantId.do",p)}var t=h.getFullYear(),a=h.getMonth()+1,n=t+"-"+a;i.healthResponseData=[{actualValue:0,healthDegree:0,targetType:"",targetValue:0}],i.healthRequestData={merchantId:i.merchantId,date:n},i.healthMonth=a,i.nextHealthBtn=!1,i.prevHealth=function(){a--,0>=a&&(a=12,t--),i.healthMonth=a,e()},i.nextHealth=function(){a++,a>12&&(a=1,t++),i.healthMonth=a,e()}};D();var I=function(){function e(){var e=new Date;i.nextReportBtn=t<=e.getFullYear()&&a<e.getMonth()+1?!0:!1,i.reportMonth=a,1==a.toString().length&&(a=0+a.toString()),n=t+"-"+a,i.reportRequestData.date=n,u(i.reportRequestData.$model,"report/getMonthMerchantSummary.do",f)}var t=h.getFullYear(),a=h.getMonth()+1,n=t+"-"+a;if(1==a.toString().length)var s=t+"-0"+a.toString();else var s=t+"-"+a;i.reportResponseData={newMember:62,fansMember:43,integralMember:20,storeMember:30,integralMemberRate:0,realcard:12,cardIncome:246,storePay:386851.54,storeConsume:11662.25,integralConsume:1116.8,cash:133789.59,couponAmount:1611,marketingIncome:-462.6,yearMember:1172,totalConsume:146568.64,yearCardInconsume:1068,yearMarketingConsume:1229336,storeBalance:215140265.61,consumedAvg:1093.8,consumedRate:3.01,evaluateWellRate:0,evaluateRate:0},i.reportRequestData={merchantId:i.merchantId,date:s},i.reportMonth=a,i.nextReportBtn=!1,i.prevReport=function(){a--,0>=a&&(a=12,t--),e()},i.nextReport=function(){a++,a>12&&(a=1,t++),e()}};I();var S=function(){i.options1=[],i.$addQuestionDialogOpts={dialogId:m("addQuestionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(m("addQuestionFormId"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(m("addQuestionDialogId")),o=e.getVm(m("addQuestionFormId"));if(o.validate()){a=o.getFormData();var r=e.getVm(m("scheduleId")).selectedValue;a.merchantId=b.merchantId,a.problemType=r,a.problemStatus=1,a=n.stringify(a),t.c2s({url:s.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},i.openAdd=function(){var a=e.getVm(m("scheduleIds"));i.options1.length?a.setOptions(i.options1):t.c2s({url:s.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,i.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),a.setOptions(i.options1))}});var n=e.getVm(m("addQuestionDialogId")),o=e.getVm(m("addQuestionFormId"));n.title="添加问题",o.title="",o.description="",n.open()},i.$addQuestionFormOpts={formId:m("addQuestionFormId"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},i.$scheduleOptss={selectId:m("scheduleIds"),options:[],selectedIndex:1}};S();var w=function(){i.createData={},i.options2=[],i.createActive=function(){var a=e.getVm(m("createActiveDialogId")),n=e.getVm(m("createActiveFormId")),o=e.getVm(m("activeId"));i.options2.length?o.setOptions(i.options2):t.c2s({url:s.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,i.options2=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),o.setOptions(i.options2))}}),a.title="营销活动申请",n.activityTitle="",n.description="",a.open()},i.$activeUploaderOpts={uploaderId:m("activeUploaderId"),uploadifyOpts:{uploader:s.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:v.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=n.parse(e),e.flag){var t=e.data;b.createData.$model.attachmentName=t.attachmentName,b.createData.$model.originalFileName=t.originalFileName,b.createData.$model.fileSize=t.fileSize,b.upfile=t.attachmentName}}},i.$createActiveDialogOpts={dialogId:m("createActiveDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(m("createActiveFormId"));t.reset(),t.activityTitle="",t.description="",b.upfile=""},submit:function(){var a,i=e.getVm(m("createActiveDialogId")),o=e.getVm(m("createActiveFormId")),r=e.getVm(m("activeId"));if(o.validate()){a=o.getFormData(),b.createData.$model.merchantId=b.merchantId,b.createData.$model.activityTitle=a.activityTitle,b.createData.$model.description=a.description,b.createData.$model.activityType=r.selectedValue,b.createData.$model.attachmentId=0;var l=n.stringify(b.createData.$model);t.c2s({url:s.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:l,success:function(e){1==e.flag&&i.close()}})}}},i.$createActiveFormOpts={formId:m("createActiveFormId"),field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},i.$activeOpts={selectId:m("activeId"),options:[],selectedIndex:1}};w(),i.linkMan={data:[],flag:0},i.mailModel={data:[],flag:0},i.mailTo="",i.mailRequestData={sendAddress:v.userName,to:[],context:"",subject:""},i.$editorOpts={editorId:m("editorId"),ueditorOptions:{UEDITOR_HOME_URL:s.WIDGET_PATH+"editor/ueditor/",serverUrl:s.BASE_PATH,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter"]]}},i.onLineMail=function(){var t=e.getVm(m("onLineMailDialogId"));t.title="发送月报",t.open()},i.addLinkman=function(){$(document).on("click",function(e){var t=e.target;"addLinkMan"!=t.id&&(b.linkMan.flag=0),"addMailModel"!=t.id&&(b.mailModel.flag=0)}),t.c2s({url:s.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:n.stringify({merchantId:b.merchantId}),success:function(e){1==e.flag&&(b.linkMan.flag=1,b.linkMan.data=e.data.rows)}})},i.addPut=function(){var e=this.$vmodel.$model.el.mail;b.mailTo+=b.mailTo.length?";"+e:e,b.linkMan.flag=0},i.addMailModel=function(){t.c2s({url:s.BASE_PATH+"fesOnlineProcess/getEmailTemplates.do",type:"post",contentType:"application/json",data:n.stringify({mailTemplateType:"002"}),success:function(e){1==e.flag&&(b.mailModel.data=e.data.rows,b.mailModel.flag=1)}})},i.addPutEmailModel=function(){var t=this.$vmodel.$model.el.content,a=e.getVm(m("editorId"));a.core.setContent(t),b.mailModel.flag=0,b.mailRequestData.subject=this.$vmodel.$model.el.title},i.$onLineMailDialogOpts={dialogId:m("onLineMailDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(m("addQuestionFormId"));t.reset()},width:700,submit:function(){var a=e.getVm(m("onLineMailDialogId")),i=e.getVm(m("onLineMailFormId")),o=e.getVm(m("editorId"));i.validate()&&(b.mailRequestData.context=o.core.getContent(),b.mailRequestData.to=b.mailTo.split(";"),t.c2s({url:s.BASE_PATH+"fesOnlineProcess/sendEmail.do",type:"post",contentType:"application/json",data:n.stringify(b.mailRequestData.$model),success:function(e){1==e.flag&&a.close()}}))}},i.$onLineMailFormOpts={formId:m("onLineMailFormId"),field:[{selector:".mail-to",rule:["noempty",function(e,t){return t[0]!==!0?"收件人不能为空":!0}]},{selector:".mail-subject",rule:["noempty",function(e,t){return t[0]!==!0?"邮件标题不能为空":!0}]},{selector:".mail-name-fa",rule:["noempty",function(e,t){return t[0]!==!0?"发件人不能为空":!0}]},{selector:'[name="content"]',rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}]},i.$scheduleOpts={scheduleId:y,onFetchPlan:function(e,a){t.c2s({url:s.BASE_PATH+"fesPlan/queryFesPlanList.do",type:"post",contentType:"application/json",data:n.stringify(_.extend({merchantId:i.merchantId},e)),success:function(e){var t;e.flag?(t=e.data,a(t)):a([])}})},onClickDateCell:function(e){var n,s=this.$vmodel.$model,o=s.el.date,r=$(e.target),l=new Date;if(a(o).isBefore(l,"day"))r.is(".plan-item")&&("frontend"===i.belongToRouteName||"sales"===i.belongToRouteName&&n.user_id==v.id)&&t.jumpPage("#/"+i.belongToRouteName+"/home/customerline/plan/list/"+a(o)/1+"/"+r.data("planId"));else if(r.is(".plan-item")){if(n=r.data("plan"),"sales"===i.belongToRouteName)return void(n.user_id==v.id&&t.jumpPage("#/"+i.belongToRouteName+"/home/customerline/plan/list/"+a(o)/1+"/"+r.data("planId")));t.jumpPage(n.user_id==v.id&&"1"==r.data("status")?"#/"+i.belongToRouteName+"/home/customerline/plan/edit/"+a(o).hour(9)/1+"/"+r.data("planId"):"#/"+i.belongToRouteName+"/home/customerline/plan/list/"+a(o)/1+"/"+r.data("planId"))}else"frontend"===i.belongToRouteName&&c(function(e){e?t.jumpPage("#/"+i.belongToRouteName+"/home/customerline/plan/add/"+a(o).hour(9)/1):t.alert({content:"对不起，您无权限添加计划",iconType:"error"})})}}});e.scan(i[0]),u({merchantId:b.merchantId},"synMerchant/getMerchantInfoByOrder.do",m),u(b.healthRequestData.$model,"health/getHealthDegreeByMerchantId.do",p),u(b.reportRequestData.$model,"report/getMonthMerchantSummary.do",f),t.c2s({url:s.BASE_PATH+"activity/listNoneReadRemind.do",type:"post",data:{merchantId:1763},success:function(e){if(e.flag){var t=e.data;b.warn=t}g()}})},$remove:function(){_.each(r,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),r.length=0}}),o});

//From origin\page\frontend\home\emailtemplate\emailtemplate.js
define("originpagefrontendhomeemailtemplateemailtemplatejs",["avalon","util","originwidgetpaginationpaginationjs","originwidgetformselectjs","dialog","originwidgetformformjs","originwidgeteditoreditorjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i,o){function r(a){t.c2s({url:n.BASE_PATH+"mailAndAttachment/listMailTemplates.do",type:"post",data:a,success:function(t){var a,n=e.getVm(l("paginationId"));t.flag&&(a=t.data,n.total=a.totalSize,d.pageData=a.rows)}})}var l=function(e){var t=i+e;return s.push(t),t},d=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:""},{text:"邮件模板"}];var i="";switch(o.route){case"/sales/home/emailtemplate":i="#/sales/home";break;case"/frontend/home/emailtemplate":i="#/frontend/home";break;case"/backend/emailtemplate":i="#/backend/customerservice"}a.navCrumbs[0].href=i,a.options1=[],a.url=n.BASE_PATH,a.pageData={},a.requestData={name:"",pageNumber:1,pageSize:10},a.$editorOpts={editorId:l("editorId"),ueditorOptions:{UEDITOR_HOME_URL:n.WIDGET_PATH+"editor/ueditor/",serverUrl:n.BASE_PATH,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter"]]}},a.addEmailTemplate=function(){var i=e.getVm(l("addEmailDialogId")),s=e.getVm(l("addEmailFormId")),o=e.getVm(l("scheduleId"));a.options1.length?o.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"mailAndAttachment/initType.do",type:"post",data:"dictionaryType=00000060",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.text,value:e.value}}),o.setOptions(a.options1))}}),i.title="添加邮件模板",s.name="",s.title="",i.state=1,i.open()},a.$scheduleOpts={selectId:l("scheduleId"),options:[],selectedIndex:1},a.$addEmilFormOpts={formId:l("addEmailFormId"),field:[{selector:".name",rule:["noempty",function(e,t){return t[0]!==!0?"名称不能为空":!0}]},{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:'[name="content"]',rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],name:"",title:""},a.$addEmailDialogOpts={dialogId:l("addEmailDialogId"),width:800,state:0,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit" ms-if="state == 1">保&nbsp;存</button><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit" ms-if="state == 2">修&nbsp;改</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(l("addEmailFormId")),a=e.getVm(l("editorId"));t.reset(),t.title="",t.name="",a.core.setContent("")},submit:function(){var i=e.getVm(l("addEmailFormId")),s=e.getVm(l("addEmailDialogId")),o=e.getVm(l("scheduleId"));if(i.validate()){var c=i.getFormData();c.mailTemplateType=o.selectedValue,2==s.state&&(c.id=d.editId),c=JSON.stringify(c),t.c2s({url:n.BASE_PATH+"mailAndAttachment/saveMailTemplate.do",type:"post",contentType:"application/json",data:c,success:function(e){1==e.flag&&(r(a.requestData.$model),s.close())}})}}},a.search=function(){r(d.requestData.$model)},a.read=function(){var i=e.getVm(l("addEmailDialogId")),s=e.getVm(l("addEmailFormId")),o=e.getVm(l("scheduleId")),r=e.getVm(l("editorId"));a.options1.length?o.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"mailAndAttachment/initType.do",type:"post",data:"dictionaryType=00000060",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.text,value:e.value}}),o.setOptions(a.options1))}}),i.title="查看邮件模板",s.name=this.$vmodel.$model.el.name,s.title=this.$vmodel.$model.el.title,r.core.setContent(this.$vmodel.$model.el.content),i.state=0,i.open()},a.edit=function(){var i=e.getVm(l("addEmailDialogId")),s=e.getVm(l("addEmailFormId")),o=e.getVm(l("scheduleId")),r=e.getVm(l("editorId"));a.options1.length?o.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"mailAndAttachment/initType.do",type:"post",data:"dictionaryType=00000060",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.text,value:e.value}}),o.setOptions(a.options1))}}),i.title="修改邮件模板",s.name=this.$vmodel.$model.el.name,s.title=this.$vmodel.$model.el.title,r.core.setContent(this.$vmodel.$model.el.content),i.state=2,a.editId=this.$vmodel.$model.el.id,i.open()},a.remove=function(){var e={};e.id=this.$vmodel.$model.el.id,t.confirm({content:"你确定要删除选择的模板吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"mailAndAttachment/deleteMailTemplate.do",type:"post",data:e,success:function(){r(d.requestData.$model)}})}})},a.$paginationOpts={paginationId:l("paginationId"),total:0,onJump:function(){var t=e.getVm(l("paginationId"));d.requestData.pageNumber=t.currentPage,r(d.requestData.$model)}}});e.scan(a[0]),r(d.requestData.$model)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\frontend\home\home.js
define("originpagefrontendhomehomejs",["avalon","util","originwidgetpaginationpaginationjs","originwidgetformselectjs"],function(avalon,util){var win=this,erp=win.erp,pageMod={},tempWidgetIdStore=[];return _.extend(pageMod,{$init:function(pageEl,pageName){function updateList(e,t,a){var n=JSON.stringify(e);pageVm.pageData=[],util.c2s({url:erp.BASE_PATH+t,type:"post",contentType:"application/json",data:n,success:a})}function merchantCallBack(responseData){function compare(e,t){return e.stepId>t.stepId?1:-1}responseData=eval(responseData);var data,paginationVm=avalon.getVm(getTypeId("paginationId"));if(responseData.flag){data=responseData.data;for(var i=0,len=data.rows.length;len>i;i++)data.rows[i].listSteps.sort(compare);for(var i=0,len=data.rows.length;len>i;i++){for(var healthType=[{index:"1",health:0},{index:"2",health:0},{index:"3",health:0},{index:"4",health:0}],arr=data.rows[i].synHealthDegrees,j=0,lenArr=arr.length;lenArr>j;j++){var obj={};obj.index=arr[j].targetType,obj.health=arr[j].healthDegree<100?0:1;for(var m=0,lenArrs=healthType.length;lenArrs>m;m++)healthType[m].index==obj.index&&(healthType[m]=obj)}data.rows[i].healthType=healthType}paginationVm.total=data.totalSize,pageVm.pageData=data.rows}}function subordinatesCallBack(e){var t,a=avalon.getVm(getTypeId("paginationId"));e.flag&&(t=e.data,a.total=t.totalSize,pageVm.pageData=t.rows)}function backlogCallBack(e){var t,a=avalon.getVm(getTypeId("paginationId"));e.flag&&(t=e.data,a.total=t.totalSize,pageVm.pageData=t.rows)}function backlogCallBackValue(e){var t;e.flag&&(t=e.data,pageVm.dotolen=t.rows.length)}var getTypeId=function(e){var t=pageName+e;return tempWidgetIdStore.push(t),t},pageVm=avalon.define(pageName,function(e){e.permission={active:util.hasPermission("fes_act_require"),remaind:util.hasPermission("fes_remaind"),question_mag:util.hasPermission("fes_question_mag"),address:util.hasPermission("fes_address"),attach_mag:util.hasPermission("fes_attach_mag"),email_temp:util.hasPermission("fes_email_temp"),complain:util.hasPermission("fes_complain"),performance:util.hasPermission("fes_performance"),my_mechant:util.hasPermission("fes_performance"),all_mechant:util.hasPermission("fes_all_mechant"),my_subordinate:util.hasPermission("fes_my_subordinate"),homepage_todolist:util.hasPermission("fes_homepage_todolist"),assign_p_incharge:util.hasPermission("fes_assign_p_incharge")},e.localHref=function(e){util.jumpPage(e)},e.userImgPath=erp.appData.user.userImagePath||"user-upload-img/pic/userPhoto/real/",e.pageUserId=erp.getAppData("user").id,e.pageStatus=1,e.pageData={},e.options1=[],e.dotolen=0,e.distributionFd={},e.subordinates={subUserName:"",baseUserId:e.pageUserId,pageSize:10,pageNumber:1},e.backlog={userId:e.pageUserId,inputItemTypes:["01","02"],merchantName:"",pageNumber:1,pageSize:10,businessTypes:["2"]},e.requestData={merchantStatus:"",userId:e.pageUserId,pageSize:10,pageNumber:1,merchantName:"",merchantStatusType:0},e.changePageStatus=function(t,a){e.pageStatus=t;var n=avalon.getVm(getTypeId("paginationId"));n.currentPage=1,"requestData"==a?(e.requestData.$model.userId=1==t?e.pageUserId:"",pageVm.requestData.pageNumber=1,pageVm.requestData.merchantName="",updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)):"subordinatesData"==a?(pageVm.subordinates.pageNumber=1,pageVm.requestData.subUserName="",updateList(pageVm.subordinates.$model,"group/getSubordinateEmployees.do",subordinatesCallBack)):"backlog"==a&&(pageVm.backlog.pageNumber=1,pageVm.requestData.merchantName="",updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack))},e.changeStatus=function(t){e.requestData.merchantStatus=t;var a=avalon.getVm(getTypeId("paginationId"));a.currentPage=1,e.requestData.pageNumber=1,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},e.search=function(){updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},e.showProgressTip=function(){var e=this.$vmodel.$model,t=e.el.stepText,a=pageName+"-progress-tip",n=$(this),i=$("#"+a),s=n.offset();i.length||(i=$('<div id="'+a+'" class="grid-tip"></div>'),i.html('<span class="text-content"></span><span class="icon-arrow"></span>'),i.hide().appendTo("body")),$(".text-content",i).text(t),i.css({top:s.top-i.height()-20,left:s.left-i.width()/2-11}).show()},e.hideProgressTip=function(){$("#"+pageName+"-progress-tip").hide()},e.distribution=function(){var t=avalon.getVm(getTypeId("distributionDialogId")),a=avalon.getVm(getTypeId("fdId")),n={remark:"fes_my_main_page"};n=JSON.stringify(n),e.distributionFd.$model.oldUserId=this.$vmodel.$model.el.listUsers[0]?this.$vmodel.$model.el.listUsers[0].id:"",e.distributionFd.$model.merchantId=this.$vmodel.$model.el.merchantId,e.options1.length?(a.setOptions(e.options1),t.title="分配负责人",t.open()):util.c2s({url:erp.BASE_PATH+"user/getAllUsersByResourceCode.do",type:"post",contentType:"application/json",data:n,success:function(n){var i;n.flag&&(i=n.data,e.options1=_.map(i,function(e){return{text:e.userName,value:e.id}}),a.setOptions(e.options1),t.title="分配负责人",t.open())}})},e.$scheduleOpts={selectId:getTypeId("fdId"),options:[],selectedIndex:1},e.$distributionDialogOpts={dialogId:getTypeId("distributionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){},submit:function(){var e,t=avalon.getVm(getTypeId("distributionDialogId")),a=avalon.getVm(getTypeId("fdId"));pageVm.distributionFd.$model.userId=a.selectedValue,e=JSON.stringify(pageVm.distributionFd.$model),util.c2s({url:erp.BASE_PATH+"myHomePage/assignPersionForMerchant.do",type:"post",contentType:"application/json",data:e,success:function(e){1==e.flag&&(t.close(),updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack))}})}},e.subordinatesSearch=function(){updateList(pageVm.subordinates.$model,"group/getSubordinateEmployees.do",subordinatesCallBack)},e.backlogSearch=function(){updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack)},e.doToStatus=function(e){var t=avalon.getVm(getTypeId("paginationId"));t.currentPage=1,pageVm.backlog.pageNumber=1,pageVm.backlog.inputItemTypes=e,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack)},e.$paginationOpts={paginationId:getTypeId("paginationId"),total:0,onJump:function(){var e=avalon.getVm(getTypeId("paginationId"));0==pageVm.pageStatus||1==pageVm.pageStatus?(pageVm.requestData.pageNumber=e.currentPage,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)):2==pageVm.pageStatus?(pageVm.subordinates.pageNumber=e.currentPage,updateList(pageVm.subordinates.$model,"group/getSubordinateEmployees.do",subordinatesCallBack)):3==pageVm.pageStatus&&(pageVm.backlog.pageNumber=e.currentPage,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack))}}});avalon.scan(pageEl[0]),updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBackValue),updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},$remove:function(){_.each(tempWidgetIdStore,function(e){var t=avalon.getVm(e);t&&$(t.widgetElement).remove()}),tempWidgetIdStore.length=0}}),pageMod});

//From origin\page\frontend\home\marketactivitie\marketactivitie.js
define("originpagefrontendhomemarketactivitiemarketactivitiejs",["avalon","util","originwidgetformselectjs","dialog","originwidgetformformjs","originwidgetuploaderuploaderjs","originwidgeteditoreditorjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i,o){function r(e,t){var a=[];if(e instanceof Array)for(var n=0;n<e.length;n++){var i={};for(var s in e[n]){var o=e[n].hasOwnProperty(s);if(o)for(var r=0;r<t.length;r++)s==t[r]&&(i[t[r]]=e[n][s])}a.push(i)}else{var i={};for(var s in e){var o=e[n].hasOwnProperty(s);if(o)for(var r=0;r<t.length;r++)s==t[r]&&(i[t[r]]=e[n][s])}a.push(i)}return a}function l(e,a,i){var s=JSON.stringify(e);u.pageData=[],t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:s,success:i})}function d(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?u.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:u.path+"portal/origin/asset/image/merchant-default-logo.jpg",u.merchantData=a}}var c=function(e){var t=i+e;return s.push(t),t},u=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"营销活动"}],a.path=n.BASE_PATH,a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(o.params.id),a.imgUrl="",a.localHref=function(e){t.jumpPage(e)};var i=function(){a.merchantData={productList:["用户管理平台","CRM2.0","CRM4.0"],filePath:"user-upload-img/merchant/real",merchant_status:"0",merchant_name:"测试",front_user_name:"admin",sale_user_name:"18610925812",assist_user_name:null,person_avg:"",desk_avg:"",store_number:"",begin_time:1409131953594,plan_online_time:1412761451126,format_name:"",attachment_name:"test_logo",attachment_path:"881"}};i();var s=function(){a.options1=[],a.$addQuestionDialogOpts={dialogId:c("addQuestionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addQuestionFormId"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(c("addQuestionDialogId")),s=e.getVm(c("addQuestionFormId"));if(s.validate()){a=s.getFormData();var o=e.getVm(c("scheduleId")).selectedValue;a.merchantId=u.merchantId,a.problemType=o,a.problemStatus=1,a=JSON.stringify(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(c("scheduleIds"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var s=e.getVm(c("addQuestionDialogId")),o=e.getVm(c("addQuestionFormId"));s.title="添加问题",o.title="",o.description="",s.open()},a.$addQuestionFormOpts={formId:c("addQuestionFormId"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOptss={selectId:c("scheduleIds"),options:[],selectedIndex:1}};s();var l=function(){a.createData={},a.options2=[],a.createActive=function(){var i=e.getVm(c("createActiveDialogId")),s=e.getVm(c("createActiveFormId")),o=e.getVm(c("activeId"));a.options2.length?o.setOptions(a.options2):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,a.options2=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),o.setOptions(a.options2))}}),i.title="营销活动申请",s.activityTitle="",s.description="",i.open()},a.$activeUploaderOpts={uploaderId:c("activeUploaderId"),uploadifyOpts:{uploader:n.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:loginUserData.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=JSON.parse(e),e.flag){var t=e.data;u.createData.$model.attachmentName=t.attachmentName,u.createData.$model.originalFileName=t.originalFileName,u.createData.$model.fileSize=t.fileSize}}},a.$createActiveDialogOpts={dialogId:c("createActiveDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("createActiveFormId"));t.reset(),t.activityTitle="",t.description=""},submit:function(){var a,i=e.getVm(c("createActiveDialogId")),s=e.getVm(c("createActiveFormId")),o=e.getVm(c("activeId"));if(s.validate()){a=s.getFormData(),u.createData.$model.merchantId=u.merchantId,u.createData.$model.activityTitle=a.activityTitle,u.createData.$model.description=a.description,u.createData.$model.activityType=o.selectedValue,u.createData.$model.attachmentId=0;var r=JSON.stringify(u.createData.$model);t.c2s({url:n.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:r,success:function(e){1==e.flag&&i.close()}})}}},a.$createActiveFormOpts={formId:c("createActiveFormId"),field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},a.$activeOpts={selectId:c("activeId"),options:[],selectedIndex:1}};l();var d=function(){a.responseSalesData=[{active_name:"全年优惠营销---11-1",active_begin:"2014-07-01",active_end:"2015-01-01",type_name:"全年优惠营销"}],t.c2s({url:n.BASE_PATH+"activeCrm/getActiveExecutiving.do",type:"post",data:{brandId:a.merchantId},success:function(e){if(e.flag){data=e.data;var t=["active_name","active_begin","active_end","type_name"];u.responseSalesData=r(data,t)}}})};d(),a.linkMan={data:[],flag:0},a.mailModel={data:[],flag:0},a.mailTo="",a.mailRequestData={sendAddress:"",to:[],context:"",subject:""},a.$editorOpts={editorId:c("editorId"),ueditorOptions:{UEDITOR_HOME_URL:n.WIDGET_PATH+"editor/ueditor/",serverUrl:n.BASE_PATH,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter"]]}},a.onLineMail=function(){var t=e.getVm(c("onLineMailDialogId"));t.title="发送月报",t.open()},a.addLinkman=function(){$(document).on("click",function(e){var t=e.target;"addLinkMan"!=t.id&&(u.linkMan.flag=0),"addMailModel"!=t.id&&(u.mailModel.flag=0)}),t.c2s({url:n.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:JSON.stringify({merchantId:u.merchantId}),success:function(e){1==e.flag&&(u.linkMan.flag=1,u.linkMan.data=e.data.rows)}})},a.addPut=function(){var e=this.$vmodel.$model.el.mail;u.mailTo+=u.mailTo.length?";"+e:e,u.linkMan.flag=0},a.addMailModel=function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/getEmailTemplates.do",type:"post",contentType:"application/json",data:JSON.stringify({mailTemplateType:"002"}),success:function(e){1==e.flag&&(u.mailModel.data=e.data.rows,u.mailModel.flag=1)}})},a.addPutEmailModel=function(){var t=this.$vmodel.$model.el.content,a=e.getVm(c("editorId"));a.core.setContent(t),u.mailModel.flag=0},a.$onLineMailDialogOpts={dialogId:c("onLineMailDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addQuestionFormId"));t.reset()},width:700,submit:function(){var a=e.getVm(c("onLineMailDialogId")),i=e.getVm(c("onLineMailFormId")),s=e.getVm(c("editorId"));i.validate()&&(u.mailRequestData.context=s.core.getContent(),u.mailRequestData.to=u.mailTo.split(";"),t.c2s({url:n.BASE_PATH+"fesOnlineProcess/sendEmail.do",type:"post",contentType:"application/json",data:JSON.stringify(u.mailRequestData.$model),success:function(e){1==e.flag&&a.close()}}))}},a.$onLineMailFormOpts={formId:c("onLineMailFormId"),field:[{selector:".mail-to",rule:["noempty",function(e,t){return t[0]!==!0?"收件人不能为空":!0}]},{selector:".mail-subject",rule:["noempty",function(e,t){return t[0]!==!0?"邮件标题不能为空":!0}]},{selector:".mail-name-fa",rule:["noempty",function(e,t){return t[0]!==!0?"发件人不能为空":!0}]},{selector:'[name="content"]',rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}]}});e.scan(a[0]),l({merchantId:u.merchantId},"synMerchant/getMerchantInfoByOrder.do",d)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\frontend\home\mycommunication\mycommunication.js
define("originpagefrontendhomemycommunicationmycommunicationjs",["avalon","util","json","moment","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetautocompleteautocompletejs"],function(e,t){var a=this,n=a.erp,i={},o=[];return _.extend(i,{$init:function(a,i,s){function r(a){var i=JSON.stringify(a);t.c2s({url:n.BASE_PATH+"contact/listContacts.do",type:"post",contentType:"application/json",data:i,success:function(t){var a,n=e.getVm(l("pagination"));t.flag&&(a=t.data,n.total=a.totalSize,d.pageData=a.rows,d.requestData.pageNumber=1)}})}var l=function(e){var t=i+e;return o.push(t),t},d=e.define(i,function(a){a.pageUserId=n.getAppData("user").id,a.navCrumbs=[{text:"我的主页",href:""},{text:"通讯录"}];var i="";switch(s.route){case"/sales/home/mycommunication(/:mid)":i="#/sales/home";break;case"/frontend/home/mycommunication(/:mid)":i="#/frontend/home";break;case"/backend/mycommunication(/:mid)":i="#/backend/customerservice"}a.navCrumbs[0].href=i,a.url=n.BASE_PATH,a.pageData={};var o="";o||(o=parseInt(s.params.mid)),a.requestData={userId:a.pageUserId,name:"",merchantId:o,merchantName:"",pageNumber:1,pageSize:10},a.search=function(){var t=e.getVm(l("pagination"));d.requestData.pageNumber=1,t.currentPage=1,r(d.requestData.$model)},a.$paginationOpts={paginationId:l("pagination"),total:0,onJump:function(){var t=e.getVm(l("pagination"));d.requestData.pageNumber=t.currentPage,r(d.requestData.$model)}};var c=function(){a.communicationRequestData={moduleType:"fes",merchantId:"",name:"",genderType:1,birthday:"",position:"",mobilePhone:"",telephone:"",roleType:"3",mail:""};({moduleType:"fes",merchantId:a.merchantId,name:"",genderType:1,birthday:"",position:"",mobilePhone:"",telephone:"",roleType:"3",mail:""});a.$brandOpts={autocompleteId:l("brandId"),placeholder:"请指定商户",delayTime:300,onChange:function(e,a){e.length?t.c2s({url:n.BASE_PATH+"synMerchant/getSynMerchantInfo.do",data:{merchantName:e},success:function(e){var t;e.flag&&(t=e.data,a(_.map(t,function(e){return e.text=e.merchant_name||"未知",e.value=e.merchant_id,e})))}},{mask:!1}):a([])},onSelect:function(t){var a=e.getVm(l("brandId")).getOptionByValue(t);d.communicationRequestData.merchantId=a.merchant_id}},a.addCommunication=function(){var a=e.getVm(l("addCommunicationDialog")),i=e.getVm(l("addCommunicationForm")),o=e.getVm(l("addCommunicationSelect"));t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000065",success:function(e){function t(e,t){for(var a=0;a<e.length;a++)if(e[a].value==t)return a}var a,n;e.flag&&(a=e.data,n=_.map(a,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),o.setOptions(n,t(n,d.communicationRequestData.roleType)))}}),a.title="添加联系人",a.readonly=0,i.beginTime=moment(new Date).format("YYYY-MM-DD"),a.open()},a.changeSex=function(e){d.communicationRequestData.genderType=e},a.$addCommunicationOpts={dialogId:l("addCommunicationDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="close">确&nbsp;定</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},readonly:0,width:500,onOpen:function(){},onClose:function(){var t=e.getVm(l("addCommunicationForm"));t.reset(),t.beginTime=""},submit:function(){var a,i=e.getVm(l("addCommunicationDialog")),o=e.getVm(l("addCommunicationForm"));if(d.communicationRequestData.roleType=e.getVm(l("addCommunicationSelect")).selectedValue,d.communicationRequestData.birthday=moment(o.beginTime,"YYYY-MM-DD")._d/1,d.communicationRequestData.moduleType="mkt",a=JSON.stringify(d.communicationRequestData.$model),o.validate()){if(!d.communicationRequestData.merchantId)return t.confirm({content:"请选择商户!",onSubmit:function(){}}),!1;t.c2s({url:n.BASE_PATH+"contact/saveMktContact.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&(i.close(),r(d.requestData.$model))}})}}},a.$addCommunicationFormOpts={formId:l("addCommunicationForm"),field:[{selector:".name",rule:["noempty",function(e,t){return t[0]!==!0?"姓名不能为空":!0}]},{selector:".position",rule:["noempty",function(e,t){return t[0]!==!0?"职位不能为空":!0}]},{selector:".mobilePhone",rule:["noempty",function(e,t){if(t[0]!==!0)return"手机不能为空";var a=/^1[0-9]{10}$/;return a.test(e)?!0:"请输入正确的手机号！"}]},{selector:".telephone",rule:["noempty",function(e,t){if(t[0]!==!0)return!0;var a=/^(\({0,1}\d{3,4})\){0,1}(-){0,1}(\d{7,8})$/;return a.test(e)?!0:"请输入正确的座机号！"}]},{selector:".email",rule:["noempty",function(e,t){if(t[0]!==!0)return"邮箱不能为空";var a=/^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$/;return a.test(e)?!0:"请输入正确的邮箱！"}]}],beginTime:""},a.$communicationOpts={selectId:l("addCommunicationSelect"),options:[],selectedIndex:1,beginTime:moment(new Date).format("YYYY-MM-DD")},a.$startDateOpts={calendarId:l("startDateCalendarId"),onClickDate:function(t){var a=e.getVm(l("addCommunicationForm"));a.beginTime=moment(t).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},a.openStartDateCalendar=function(){var n,i=e.getVm(l("addCommunicationForm")),o=$(this),s=e.getVm(l("startDateCalendarId")),r=o.offset();s?n=$(s.widgetElement):(n=$('<div ms-widget="calendar,$,$startDateOpts"></div>'),n.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(n[0],[a]),s=e.getVm(l("startDateCalendarId")),t.regGlobalMdExcept({element:n,handler:function(){n.hide()}})),s.focusDate=i.beginTime?moment(i.beginTime,"YYYY-MM-DD")._d:new Date,n.css({top:r.top+o.outerHeight()-1,left:r.left}).show()}};c()});e.scan(a[0]),r(d.requestData.$model)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),i});

//From origin\page\frontend\home\questionmanage\questionmanage.js
define("originpagefrontendhomequestionmanagequestionmanagejs",["avalon","util","originwidgetautocompleteautocompletejs","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs"],function(e,t){var a=this,n=a.erp,i={},o=[];return _.extend(i,{$init:function(a,i,s){function r(a){var i=JSON.stringify(a);t.c2s({url:n.BASE_PATH+"sysProblem/listSysProblems.do",type:"post",contentType:"application/json",data:i,success:function(t){var a,n=e.getVm(l("paginationId"));t.flag&&(a=t.data,n.total=a.totalSize,d.pageData=a.rows)}})}var l=function(e){var t=i+e;return o.push(t),t},d=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:""},{text:"问题管理"}];var i="";switch(s.route){case"/sales/home/questionmanage":i="#/sales/home";break;case"/frontend/home/questionmanage":i="#/frontend/home";break;case"/backend/questionmanage":i="#/backend/customerservice"}a.navCrumbs[0].href=i,a.searchId=0,a.url=n.BASE_PATH,a.merchantId=parseInt(s.params.id),a.pageData={},a.options1=[],a.assignedArr=[],a.processClass=0,a.requestDataAssigned={id:0,solveredBy:0,problemStatus:"2",merchantId:"",title:""},a.requestDataDispose={id:0,problemStatus:"3",remark:"",problemType:"5",solvingType:"1"},a.crequestDataNotice={id:0,problemStatus:""},a.requestData={merchantId:a.merchantId,title:"",merchantName:"",pageNumber:1,pageSize:10,problemStatus:""},a.search=function(){r(a.requestData.$model)},a.change=function(t){var n=e.getVm(l("paginationId"));a.requestData.problemStatus=t,a.requestData.pageSize=n.perPages,a.requestData.pageNumber=1,n.currentPage=1,r(a.requestData.$model)},a.$paginationOpts={paginationId:l("paginationId"),total:0,onJump:function(){var t=e.getVm(l("paginationId"));d.requestData.pageNumber=t.currentPage,r(d.requestData.$model)}},a.$brandOpts={autocompleteId:l("brandId"),placeholder:"请指定商户",delayTime:300,onChange:function(e,a){e.length?t.c2s({url:n.BASE_PATH+"synMerchant/getSynMerchantInfo.do",data:{merchantName:e},success:function(e){var t;e.flag&&(t=e.data,a(_.map(t,function(e){return e.text=e.merchant_name||"未知",e.value=e.merchant_id,e})))}},{mask:!1}):a([])},onSelect:function(t){var a=e.getVm(l("brandId")).getOptionByValue(t);d.searchId=a.merchant_id}},a.$addQuestionDialogOpts={dialogId:l("addQuestionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(l("addQuestionFormId"));t.reset(),t.merchantId="",t.title="",t.description="",d.searchId=0},submit:function(){{var i,o=e.getVm(l("addQuestionDialogId")),s=e.getVm(l("addQuestionFormId"));e.getVm(l("searchId"))}if(s.validate()){var c=e.getVm(l("scheduleId")).selectedValue;if(i=s.getFormData(),i.merchantId=d.searchId,!i.merchantId)return t.confirm({content:"请选择商户!",onSubmit:function(){}}),!1;i.problemType=c,i.problemStatus=1,i=JSON.stringify(i),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:i,success:function(e){1==e.flag&&(r(a.requestData.$model),o.close(),d.searchId=0)}})}}},a.addQuestion=function(){var i=e.getVm(l("scheduleId"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var o=e.getVm(l("addQuestionDialogId")),s=e.getVm(l("addQuestionFormId"));o.title="添加问题",s.title="",s.description="",o.open()},a.$addQuestionFormOpts={formId:l("addQuestionFormId"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:l("scheduleId"),options:[],selectedIndex:1},a.assigned=function(i,o,s){a.requestDataAssigned.id=i,a.requestDataAssigned.merchantId=o,a.requestDataAssigned.title=s;var r={remark:"train_exam"};r=JSON.stringify(r),t.c2s({url:n.BASE_PATH+"user/getAllUsersByResourceCode.do",type:"post",contentType:"application/json",data:r,success:function(e){var t;e.flag&&(t=e.data,a.assignedArr=t)}});var d=e.getVm(l("assignedDialogId"));d.title="指派处理人",d.open()},a.assignedFn=function(e){a.processClass=e,a.requestDataAssigned.solveredBy=e},a.$assignedDialogOpts={dialogId:l("assignedDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){d.requestDataAssigned.solveredBy=0,a.processClass=0},submit:function(){var i=d.requestDataAssigned.$model.solveredBy;if(!i)return!1;dialogVm=e.getVm(l("assignedDialogId"));var o=JSON.stringify(d.requestDataAssigned.$model);t.c2s({url:n.BASE_PATH+"sysProblem/updateSysProblem.do",type:"post",contentType:"application/json",data:o,success:function(e){1==e.flag&&(dialogVm.close(),r(a.requestData.$model))}})}},a.dispose=function(t){a.requestDataDispose.id=t;var n=e.getVm(l("disposeDialogId"));n.title="问题处理",n.open()},a.changProblemStatus=function(e){a.requestDataDispose.problemStatus=e},a.$assignedDisposeOpts={dialogId:l("disposeDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){},submit:function(){var i=e.getVm(l("disposeDialogId")),o=JSON.stringify(d.requestDataDispose.$model),s=e.getVm(l("assignedform"));s.validate()&&t.c2s({url:n.BASE_PATH+"sysProblem/updateSysProblem.do",type:"post",contentType:"application/json",data:o,success:function(e){1==e.flag&&(i.close(),d.requestDataDispose.remark="",r(a.requestData.$model))}})}},a.$assignedformOpts={formId:l("assignedform"),field:[{selector:".question-remark",name:"remark",rule:["noempty",function(e,t){return e.length>250?"内容不能超过250个字！":t[0]!==!0?"内容不能为空":!0}]}]},a.confirmNotice=function(e){a.crequestDataNotice.id=e,a.crequestDataNotice.problemStatus="4";var i=JSON.stringify(d.crequestDataNotice.$model);t.confirm({content:"你确定已告知客户了吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"sysProblem/updateSysProblem.do",type:"post",contentType:"application/json",data:i,success:function(e){1==e.flag&&r(a.requestData.$model)}})}})},a.again=function(e){a.crequestDataNotice.id=e,a.crequestDataNotice.problemStatus="6";var i=JSON.stringify(d.crequestDataNotice.$model);t.confirm({content:"你确定要重新激活问题吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"sysProblem/updateSysProblem.do",type:"post",contentType:"application/json",data:i,success:function(e){1==e.flag&&r(a.requestData.$model)}})}})}});e.scan(a[0]);var c={title:"",merchantName:"",pageNumber:1,pageSize:10,problemStatus:""};r(c)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),i});

//From origin\page\frontend\home\remind\remind.js
define("originpagefrontendhomeremindremindjs",["avalon","util","json","originwidgetpaginationpaginationjs"],function(e,t,a){var n=this,i=n.erp,o={},s=[];return _.extend(o,{$init:function(n,o,r){function l(n){var o=a.stringify(n);t.c2s({url:i.BASE_PATH+"activity/listRemind.do",type:"post",contentType:"application/json",data:o,success:function(t){var a,n=e.getVm(d("pagination"));t.flag&&(a=t.data,n.total=a.totalSize,c.pageData=a.rows)}})}var d=function(e){var t=o+e;return s.push(t),t},c=e.define(o,function(a){a.pageUserId=i.getAppData("user").id,a.navCrumbs=[{text:"我的主页",href:""},{text:"提醒"}];var n="";switch(r.route){case"/sales/home/remind":n="#/sales/home";break;case"/frontend/home/remind":n="#/frontend/home";break;case"/backend/remind":n="#/backend/customerservice"}a.navCrumbs[0].href=n,a.url=i.BASE_PATH,a.pageData={},a.statusTabs="",a.requestData={userId:a.pageUserId,merchantName:"",pageNumber:1,pageSize:10,itemStatus:""},a.changeStatus=function(t){var a=e.getVm(d("pagination"));c.requestData.pageNumber=1,a.currentPage=1,c.requestData.itemStatus=t,l(c.requestData.$model)},a.search=function(){l(c.requestData.$model)},a.modStatus=function(e){e=e.toString(),t.c2s({url:i.BASE_PATH+"activity/updateRemind.do",type:"post",data:{id:e},success:function(){l(c.requestData.$model)}})},a.$paginationOpts={paginationId:d("pagination"),total:0,onJump:function(){var t=e.getVm(d("pagination"));c.requestData.pageNumber=t.currentPage,l(c.requestData.$model)}}});e.scan(n[0]),l(c.requestData.$model)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),o});

//From origin\page\frontend\home\rewardspunishments\rewardspunishments.js
define("originpagefrontendhomerewardspunishmentsrewardspunishmentsjs",["avalon","util","originwidgetpaginationpaginationjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function o(e){var a=JSON.stringify(e);t.c2s({url:n.BASE_PATH+"activity/listRemind.do",type:"post",contentType:"application/json",data:a,success:function(e){var t;e.flag&&(t=e.data,s.pageData=t.rows)}})}var s=e.define(i,function(e){e.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"我的绩效"}],e.url=n.BASE_PATH,e.pageData={},e.statusTabs="",e.requestData={merchantName:"",pageNumber:1,pageSize:10,itemStatus:""},e.changeStatus=function(e){s.requestData.itemStatus=e,o(s.requestData.$model)},e.search=function(){o(s.requestData.$model)},e.modStatus=function(e){e=e.toString(),t.c2s({url:n.BASE_PATH+"activity/updateRemind.do",type:"post",data:{id:e},success:function(){o(s.requestData.$model)}})}});e.scan(a[0]),o(s.requestData.$model)},$remove:function(){}}),i});

//From origin\page\frontend\home\subordinates\subordinates.js
define("originpagefrontendhomesubordinatessubordinatesjs",["avalon","util","moment","originwidgetpaginationpaginationjs","originmodulescheduleschedulejs"],function(avalon,util,moment){var win=this,erp=win.erp,pageMod={};return _.extend(pageMod,{$init:function(pageEl,pageName,routeData){function updateList(e,t,a){var n=JSON.stringify(e);pageVm.pageData=[],util.c2s({url:erp.BASE_PATH+t,type:"post",contentType:"application/json",data:n,success:a})}function merchantCallBack(responseData){function compare(e,t){return e.stepId>t.stepId?1:void 0}responseData=eval(responseData);var data,paginationVm=avalon.getVm(paginationId);if(responseData.flag){data=responseData.data;for(var i=0,len=data.rows.length;len>i;i++)data.rows[i].listSteps.sort(compare);for(var i=0,len=data.rows.length;len>i;i++){for(var healthType=[{index:"1",health:0},{index:"2",health:0},{index:"3",health:0},{index:"4",health:0}],arr=data.rows[i].synHealthDegrees,j=0,lenArr=arr.length;lenArr>j;j++){var obj={};obj.index=arr[j].targetType,obj.health=arr[j].healthDegree<100?0:1;for(var m=0,lenArrs=healthType.length;lenArrs>m;m++)healthType[m].index==obj.index&&(healthType[m]=obj)}data.rows[i].healthType=healthType}paginationVm.total=data.totalSize,pageVm.pageData=data.rows,pageVm.requestData.merchantName=""}}function backlogCallBack(e){var t,a=avalon.getVm(paginationId);e.flag&&(t=e.data,a.total=t.totalSize,pageVm.pageData=t.rows,pageVm.backlog.merchantName="")}var paginationId=pageName+"-pagination",scheduleId=pageName+"-schedule",pageVm=avalon.define(pageName,function(e){e.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"我的下属"}],e.subId=parseInt(routeData.params.id),e.url=erp.BASE_PATH,e.pageData={},e.statusTabs=1,e.requestData={merchantStatus:"",merchantStatusType:"0",userId:e.subId,pageSize:10,pageNumber:1,merchantName:""},e.backlog={userId:e.subId,inputItemTypes:["01","02"],merchantName:"",pageNumber:1,pageSize:10},e.changeStatus=function(e){pageVm.statusTabs=e,1==e?(updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack),pageVm.requestData.merchantName=""):2==e&&(updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack),pageVm.requestData.merchantName="")},e.changeMerchantStatus=function(t){e.requestData.merchantStatus=t,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},e.doToStatus=function(e){pageVm.backlog.inputItemTypes=e,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack)},e.$paginationOpts={paginationId:paginationId,total:0,onJump:function(){var e=avalon.getVm(paginationId);1==pageVm.statusTabs?(pageVm.requestData.pageNumber=e.currentPage,updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)):2==pageVm.pageStatus?(pageVm.backlog.pageNumber=e.currentPage,updateList(pageVm.backlog.$model,"myHomePage/getComplexSysToDoLists.do",backlogCallBack)):3==pageVm.pageStatus}},e.$scheduleOpts={scheduleId:scheduleId,onFetchPlan:function(t,a){util.c2s({url:erp.BASE_PATH+"fesPlan/queryFesPlanList.do",type:"post",contentType:"application/json",data:JSON.stringify(_.extend({userId:e.subId},t)),success:function(e){var t;e.flag?(t=e.data,a(t)):a([])}})},onClickDateCell:function(e){var t=this.$vmodel.$model,a=t.el.date,n=$(e.target),i=new Date;moment(a).isBefore(i,"day")?n.is(".plan-item")&&util.jumpPage("#/frontend/home/subordinates/plan/list/"+moment(a)/1+"/"+n.data("planId")):util.jumpPage(n.is(".plan-item")?"#/frontend/home/subordinates/plan/list/"+moment(a)/1+"/"+n.data("planId"):"#/frontend/home/subordinates/assign")}}});avalon.scan(pageEl[0]),updateList(pageVm.requestData.$model,"myHomePage/getComplexSynMerchants.do",merchantCallBack)},$remove:function(){}}),pageMod});

//From origin\page\frontend\home\waiting\waiting.js
define("originpagefrontendhomewaitingwaitingjs",["avalon","util","originwidgetformselectjs","dialog","originwidgetformformjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={},o=[];return _.extend(i,{$init:function(a,i,s){function r(e,t){var a=[];if(e instanceof Array)for(var n=0;n<e.length;n++){var i={};for(var o in e[n]){var s=e[n].hasOwnProperty(o);if(s)for(var r=0;r<t.length;r++)o==t[r]&&(i[t[r]]=e[n][o])}a.push(i)}else{var i={};for(var o in e){var s=e[n].hasOwnProperty(o);if(s)for(var r=0;r<t.length;r++)o==t[r]&&(i[t[r]]=e[n][o])}a.push(i)}return a}function l(e,a,i){var o=JSON.stringify(e);t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:i})}function d(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.userMerchantList=t.userMerchantList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in t){var o=t.hasOwnProperty(i);o&&"object"!=typeof t[i]&&(a[i]=t[i])}for(var i in n){var o=n.hasOwnProperty(i);o&&(a[i]=n[i])}a.imgUrl=a.attachment_name?p.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:p.path+"portal/origin/asset/image/merchant-default-logo.jpg",p.merchantData=a}}function c(e){var t,a;if(e.flag){t=e.data,a=t.rows;for(var n=0;n<a.length;n++)a[n].end=!1,a[n].end_time="",a[n].end_content="";p.listData=a}}var u=i+"-dispose-dialog",m=n.getAppData("user"),p=e.define(i,function(a){var l=function(e){var t=i+e;return o.push(t),t};a.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"待办事项"}],a.localHref=function(e){t.jumpPage(e)},a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(s.params.id),a.path=n.BASE_PATH,a.createData={},a.options1=[],a.options2=[],a.pageStatus=1,a.pageData={},a.listData={},a.imgUrl="";var d=function(){a.merchantData={productList:["用户管理平台","CRM2.0","CRM4.0"],filePath:"user-upload-img/merchant/real",merchant_status:"0",merchant_name:"测试",front_user_name:"admin",sale_user_name:"18610925812",assist_user_name:null,person_avg:"",desk_avg:"",store_number:"",begin_time:1409131953594,plan_online_time:1412761451126,online_time:1412761451126,format_name:"",attachment_name:"test_logo",attachment_path:"881"}};d(),a.requestDataDispose={id:0,handledBy:a.pageUserId,handledTime:(new Date).getTime(),handledDescription:"",customerComplaintStatus:1},a.changePageStatus=function(e){a.pageStatus=e,2==e&&a.cardFn()};var c=function(){a.responseCardData=[{card_count:216481,card_price:0,card_type:"粉丝会员",merchant_type:"品牌",is_sold_card:!1,merchant_name:"北京新辣道餐饮管理有限公司",merchant_id:1119,cardtype_id:207,description:"暂无",card_name:"积分卡"}],a.cardFn=function(){t.c2s({url:n.BASE_PATH+"synMembershipCard/listSynMembershipCards.do",type:"post",data:{pageNumber:1,pageSize:1e4,merchantId:p.merchantId},success:function(e){if(e.flag){var t=e.data.rows,a=["card_count","card_price","card_type","merchant_type","is_sold_card","merchant_name","cardtype_id","description","card_name"];p.responseCardData=r(t,a)}}})}};c();var g=function(){a.options1=[],a.$addQuestionDialogOpts={dialogId:l("addQuestionDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(l("addQuestionFormId"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(l("addQuestionDialogId")),o=e.getVm(l("addQuestionFormId"));if(o.validate()){a=o.getFormData();var s=e.getVm(l("scheduleId")).selectedValue;a.merchantId=p.merchantId,a.problemType=s,a.problemStatus=1,a=JSON.stringify(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(l("scheduleIds"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var o=e.getVm(l("addQuestionDialogId")),s=e.getVm(l("addQuestionFormId"));o.title="添加问题",s.title="",s.description="",o.open()},a.$addQuestionFormOpts={formId:l("addQuestionFormId"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOptss={selectId:l("scheduleIds"),options:[],selectedIndex:1}};g();var f=function(){a.createData={},a.options2=[],a.createActive=function(){var i=e.getVm(l("createActiveDialogId")),o=e.getVm(l("createActiveFormId")),s=e.getVm(l("activeId"));a.options2.length?s.setOptions(a.options2):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,a.options2=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),s.setOptions(a.options2))}}),i.title="营销活动申请",o.activityTitle="",o.description="",i.open()},a.$activeUploaderOpts={uploaderId:l("activeUploaderId"),uploadifyOpts:{uploader:n.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:m.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=JSON.parse(e),e.flag){var t=e.data;p.createData.$model.attachmentName=t.attachmentName,p.createData.$model.originalFileName=t.originalFileName,p.createData.$model.fileSize=t.fileSize}}},a.$createActiveDialogOpts={dialogId:l("createActiveDialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(l("createActiveFormId"));t.reset(),t.activityTitle="",t.description=""},submit:function(){var a,i=e.getVm(l("createActiveDialogId")),o=e.getVm(l("createActiveFormId")),s=e.getVm(l("activeId"));if(o.validate()){a=o.getFormData(),p.createData.$model.merchantId=p.merchantId,p.createData.$model.activityTitle=a.activityTitle,p.createData.$model.description=a.description,p.createData.$model.activityType=s.selectedValue,p.createData.$model.attachmentId=0;var r=JSON.stringify(p.createData.$model);t.c2s({url:n.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:r,success:function(e){1==e.flag&&i.close()}})}}},a.$createActiveFormOpts={formId:l("createActiveFormId"),field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},a.$activeOpts={selectId:l("activeId"),options:[],selectedIndex:1}};f(),a.disposeOpen=function(t,n){a.disposeIndex=n,a.requestDataDispose.id=t;var i=e.getVm(u);i.title="投诉处理",i.open()},a.changProblemStatus=function(e){a.requestDataDispose.customerComplaintStatus=String(e)},a.$assignedDisposeOpts={dialogId:u,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){p.requestDataDispose.handledDescription=""},submit:function(){var a=e.getVm(u),i=JSON.stringify(p.requestDataDispose.$model);t.c2s({url:n.BASE_PATH+"sysCustomerComplaint/updateSysCustomerComplaint.do",type:"post",contentType:"application/json",data:i,success:function(e){if(1==e.flag){var t=new Date;p.listData[p.disposeIndex].end=!0,p.listData[p.disposeIndex].end_time=t.getTime(),p.listData[p.disposeIndex].end_content="投诉处理完成",console.log(p.listData),a.close(),p.requestDataDispose.handledDescription=""}}})}}});e.scan(a[0]),l({merchantId:p.merchantId},"synMerchant/getMerchantInfoByOrder.do",d),l({merchantId:p.merchantId,pageSize:100,pageNumber:1,customerComplaintStatus:"0"},"sysCustomerComplaint/querySysCustomerComplaintList.do",c)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),i});

//From origin\page\frontend\make\customer\customer.js
define("originpagefrontendmakecustomercustomerjs",["avalon","util","moment","json","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,o){function s(e,a,i){var o=JSON.stringify(e);v.pageData=[],t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:i})}function r(e){var t;e.flag&&(t=e.data,v.merchantData=t,console.log(t))}var l=i+"-add-Question-dialog",d=i+"-add-Question-form",c=i+"-schedule",u=i+"-active-select",m=i+"-active-form",p=i+"-active-dialog",g=i+"-active-uploader",f=n.getAppData("user"),v=e.define(i,function(a){a.navCrumbs=[{text:"我的主页",href:"#/frontend/make"},{text:"大连彤德莱餐饮管理有限公司"}],a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(o.params.id),a.createData={},a.options1=[],a.options2=[],a.stepData={},a.merchantData={},a.$addQuestionDialogOpts={dialogId:l,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(d);t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(l),o=e.getVm(d);if(o.validate()){a=o.getFormData();var s=e.getVm(c).selectedValue;a.merchantId=v.merchantId,a.problemType=s,a.problemStatus=1,a=JSON.stringify(a),console.log(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(c);a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var o=e.getVm(l),s=e.getVm(d);o.title="添加问题",s.title="",s.description="",o.open()},a.$addQuestionFormOpts={formId:d,field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:c,options:[],selectedIndex:1},a.createActive=function(){var i=e.getVm(p),o=e.getVm(m),s=e.getVm(u);a.options2.length?s.setOptions(a.options2):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000056",success:function(e){var t;e.flag&&(t=e.data,a.options2=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),s.setOptions(a.options2))}}),i.title="营销活动申请",o.activityTitle="",o.description="",i.open()},a.$activeUploaderOpts={uploaderId:g,uploadifyOpts:{uploader:n.BASE_PATH+"activity/uploadFile.do",fileObjName:"myfiles",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:f.sessionId}},width:110,height:30,progressData:"speed"},onSuccessResponseData:function(e){if(e=JSON.parse(e),e.flag){var t=e.data;v.createData.$model.attachmentName=t.attachmentName,v.createData.$model.originalFileName=t.originalFileName,v.createData.$model.fileSize=t.fileSize}}},a.$createActiveDialogOpts={dialogId:p,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(m);t.reset(),t.activityTitle="",t.description=""},submit:function(){var a,i=e.getVm(p),o=e.getVm(m),s=e.getVm(u);if(o.validate()){a=o.getFormData(),v.createData.$model.merchantId=v.merchantId,v.createData.$model.activityTitle=a.activityTitle,v.createData.$model.description=a.description,v.createData.$model.activityType=s.selectedValue,v.createData.$model.attachmentId=0;var r=JSON.stringify(v.createData.$model);console.log(r),t.c2s({url:n.BASE_PATH+"activity/saveActivity.do",type:"post",contentType:"application/json",data:r,success:function(e){console.log(r),1==e.flag&&i.close()}})}}},a.$createActiveFormOpts={formId:m,field:[{selector:".activityTitle",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]}],activityTitle:"",description:""},a.$activeOpts={selectId:u,options:[],selectedIndex:1}});e.scan(a[0]),s({merchantId:v.merchantId},"synMerchant/getMerchantInfoByOrder.do",r)},$remove:function(){}}),i});

//From origin\page\frontend\make\make.js
define("originpagefrontendmakemakejs",["avalon","util","originwidgetpaginationpaginationjs"],function(e,t){var a=this,n=a.erp,i={},o=[];return _.extend(i,{$init:function(a,i){function s(e,a,i){var o=JSON.stringify(e);t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:o,success:i})}function r(t){var a,n=e.getVm(l("paginationId"));t.flag&&(a=t.data,n.total=a.totalSize,d.pageData=a.rows,d.backlogNumber=a.rows.length)}var l=function(e){var t=i+e;return o.push(t),t},d=e.define(i,function(t){t.pageUserId=n.getAppData("user").id,t.pageData={},t.backlogNumber=0,t.backlog={userId:t.pageUserId,inputItemTypes:["01"],merchantName:"",pageNumber:1,pageSize:10,businessTypes:["4","5","6"]},t.doToStatus=function(e){d.backlog.inputItemTypes=e,s(d.backlog.$model,"myHomePage/getComplexSysToDoLists.do",r)},t.$paginationOpts={paginationId:l("paginationId"),total:0,onJump:function(){var t=e.getVm(l("paginationId"));d.backlog.pageNumber=t.currentPage,s(d.backlog.$model,"myHomePage/getComplexSysToDoLists.do",r)}}});e.scan(a[0]),s(d.backlog.$model,"myHomePage/getComplexSysToDoLists.do",r)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),i});

//From origin\page\frontend\make\waiting\waiting.js
define("originpagefrontendmakewaitingwaitingjs",["avalon","util","moment","json","originmoduleautocompleteautocompletejs","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs"],function(e,t){var a=this,n=a.erp,i={},s=[];return _.extend(i,{$init:function(a,i,o){function r(e,a,i){var s=JSON.stringify(e);t.c2s({url:n.BASE_PATH+a,type:"post",contentType:"application/json",data:s,success:i})}function l(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?m.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:m.path+"portal/origin/asset/image/merchant-default-logo.jpg",m.merchantData=a,m.merchantData=a,m.navCrumbs[1].text=a.merchant_name}}function d(t){var a,n=e.getVm(c("step61Uploder")),i=e.getVm(c("step62Uploder")),s=e.getVm(c("step71Uploder"));if(t.flag){n&&$(n.widgetElement).remove(),i&&$(i.widgetElement).remove(),s&&$(s.widgetElement).remove(),a=t.data;for(var o=[],r=0;r<a.length;r++)"entity_cards"==a[r].stepNum&&o.push(a[r]),"materials_design"==a[r].stepNum&&o.push(a[r]);m.pageData=o}}var c=function(e){var t=i+e;return s.push(t),t},u=n.getAppData("user"),m=e.define(i,function(a){function i(e){for(var t=0;t<a.pageData.length;t++)if(a.pageData[t].stepNum==e)return a.pageData[t].id}function s(){h.length=0;for(var e=1;8>=e;e++){var t="checkoucon"+e;$("."+t).blur(function(){_.str.trim($(this).val())&&($(this).removeClass("valid-error-field"),$(this).closest("tr").find(".ff-value-tip").hide())});var a=$("."+t).prevAll("input");if(a.length){if(1==a[0].checked){var n={selector:"."+t,rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]};h.push(n)}}else{var n={selector:"."+t,rule:["noempty",function(e,t){return t[0]!==!0?"内容不能为空":!0}]};h.push(n)}}return h}a.navCrumbs=[{text:"制卡物料",href:"#/frontend/make"},{text:"test"}],a.path=n.BASE_PATH,a.pageUserId=n.getAppData("user").id,a.merchantId=parseInt(o.params.id),a.pageData={},a.imgUrl="";var l=function(){a.merchantData={productList:[],filePath:"",merchant_id:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",format_name:"",attachment_name:"",attachment_path:""}};l();var p=function(){a.options1=[],a.$addQuestionDialogOpts={dialogId:c("addQuestionDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("addQuestionForm"));t.reset(),t.title="",t.description=""},submit:function(){var a,i=e.getVm(c("addQuestionDialog")),s=e.getVm(c("addQuestionForm"));if(s.validate()){a=s.getFormData();var o=e.getVm(c("addQuestionSelect")).selectedValue;a.merchantId=m.merchantId,a.problemType=o,a.problemStatus=1,a=JSON.stringify(a),t.c2s({url:n.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&i.close()}})}}},a.openAdd=function(){var i=e.getVm(c("addQuestionSelect"));a.options1.length?i.setOptions(a.options1):t.c2s({url:n.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,a.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),i.setOptions(a.options1))}});var s=e.getVm(c("addQuestionDialog")),o=e.getVm(c("addQuestionForm"));s.title="添加问题",o.title="",o.description="",s.open()},a.$addQuestionFormOpts={formId:c("addQuestionForm"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},a.$scheduleOpts={selectId:c("addQuestionSelect"),options:[],selectedIndex:1}};p(),a.$step61UploaderOpts={uploaderId:c("step61Uploder"),uploadifyOpts:{uploader:n.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:u.sessionId,processId:i("entity_cards"),typeId:3}},width:120,height:30,progressData:"speed"},onSuccessResponseData:function(e){e=JSON.parse(e),e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}},a.$step62UploaderOpts={uploaderId:c("step62Uploder"),uploadifyOpts:{uploader:n.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:u.sessionId,processId:i("entity_cards"),typeId:4}},width:120,height:30,progressData:"speed"},onSuccessResponseData:function(e){e=JSON.parse(e),e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}},a.removeAttach=function(e,a){t.confirm({content:"你确定要删除文档吗？",onSubmit:function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/deleteAttachment/"+e+"/"+a+".do",type:"get",success:function(e){e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}})}})},a.stepEnd=function(e,i,s,o){var r={id:e,onlineProcessStatus:i},l=JSON.stringify(r);t.confirm({content:s,onSubmit:function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/updateFesOnlineProcessStatus.do",type:"post",contentType:"application/json",data:l,success:function(e){if(e.flag)for(var t=0;t<a.pageData.length;t++)a.pageData[t].stepNum==o&&(a.pageData[t].onlineProcessStatus=i,a.pageData[t].listAttachmentAndOperateLog.push(e.data))}})}})};var g=function(){a.carRequestData={processId:0,merchantId:a.merchantId,fesOpenCardApplicationDtls:[{cardName:"",cardAmount:"",validityTerm:"",isContainFour:"0",isContainSeven:"0"}]},a.openCard=function(t){var n=e.getVm(c("cardDialog"));n.title="开卡申请",a.carRequestData.processId=t,n.open()},a.changeRedio4=function(e){this.$vmodel.$model.el.isContainFour=e},a.changeRedio7=function(e){this.$vmodel.$model.el.isContainSeven=e},a.$addCardDialogOpts={dialogId:c("cardDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button ms-if="save" type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},save:1,width:530,onClose:function(){var t=e.getVm(c("cardForm"));m.carRequestData={processId:0,merchantId:a.merchantId,fesOpenCardApplicationDtls:[{cardName:"",cardAmount:"",validityTerm:"",isContainFour:"0",isContainSeven:"0"}]},t.reset(),t.cardName="",t.cardAmount="",t.validityTerm=""},submit:function(){var a,i=e.getVm(c("cardDialog")),s=e.getVm(c("cardForm"));if(s.validate()){for(var o=m.carRequestData.$model.fesOpenCardApplicationDtls,l=0;l<o.length;l++)o[l].cardAmount=Number(o[l].cardAmount),o[l].validityTerm=Number(o[l].validityTerm);a=JSON.stringify(m.carRequestData.$model),t.c2s({url:n.BASE_PATH+"applySetting/saveOpenCardApply.do",type:"post",contentType:"application/json",data:a,success:function(e){1==e.flag&&(i.close(),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d))}})}}},a.$addCardFormOpts={formId:c("cardForm"),field:[{selector:".card-name",name:"cardName",getValue:function(){var e=$(this),t=[];return e.each(function(){var e=$(this);t.push(_.str.trim(e.val()))}),t},rule:function(){var e=$(this),t=!0;return e.each(function(){var e=$(this);return _.str.trim(e.val()).length?void 0:(t=!1,!1)}),{handler:function(t,a){e.each(t?function(){var e=$(this),t=e.closest(".ff-value"),n=$(".ff-value-tip",t);n.removeClass(a.errorCls).empty(),e.removeClass(a.errorCls+"-field")}:function(){var e=$(this).closest(".f-field"),t=$(this),n=$(".ff-value",e),i=$(".ff-value-tip",n),s="";_.str.trim(t.val()).length?(t.removeClass(a.errorCls+"-field"),i.removeClass(a.errorCls),i.empty()):(s="卡类型名称不能为空",t.addClass(a.errorCls+"-field"),i.addClass(a.errorCls),i.text(s))})},isPassed:t}}},{selector:".card-amount",name:"cardAmount",getValue:function(){var e=$(this),t=[];return e.each(function(){var e=$(this);t.push(_.str.trim(e.val()))}),t},rule:function(){var e=$(this),t=!0;return e.each(function(){var e=$(this);if(_.str.trim(e.val()).length){var a=/^[1-9]\d*$/;a.test(e.val())||(t=!1)}else{var a=/^[1-9]\d*$/;a.test(e.val())||(t=!1)}return t?void 0:!1}),{handler:function(t,a){e.each(t?function(){var e=$(this),t=e.closest(".ff-value"),n=$(".ff-value-tip",t);n.removeClass(a.errorCls).empty(),e.removeClass(a.errorCls+"-field")}:function(){var e=$(this).closest(".f-field"),t=$(this),n=$(".ff-value",e),i=$(".ff-value-tip",n),s="",o=/^[1-9]\d*$/;o.test(t.val())?(t.removeClass(a.errorCls+"-field"),i.removeClass(a.errorCls),i.empty()):(s="开卡数量不能为空且必须为数字",t.addClass(a.errorCls+"-field"),i.addClass(a.errorCls),i.text(s))})},isPassed:t}}},{selector:".validity-term",name:"validityTerm",getValue:function(){var e=$(this),t=[];return e.each(function(){var e=$(this);t.push(_.str.trim(e.val()))}),t},rule:function(){var e=$(this),t=!0;return e.each(function(){var e=$(this);if(_.str.trim(e.val()).length){var a=/^[1-9]\d*$/;if(!a.test(e.val()))return t=!1,!1}}),{handler:function(t,a){e.each(t?function(){var e=$(this),t=e.closest(".ff-value"),n=$(".ff-value-tip",t);n.removeClass(a.errorCls).empty(),e.removeClass(a.errorCls+"-field")}:function(){var e=$(this).closest(".f-field"),t=$(this),n=$(".ff-value",e),i=$(".ff-value-tip",n),s="";if(_.str.trim(t.val()).length){var o=/^[1-9]\d*$/;o.test(t.val())||(s="开卡有效期只能是数字或空",t.addClass(a.errorCls+"-field"),i.addClass(a.errorCls),i.text(s))}else t.removeClass(a.errorCls+"-field"),i.removeClass(a.errorCls),i.empty()})},isPassed:t}}}],cardName:"",cardAmount:"",validityTerm:""},a.readCard=function(i){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/getFesOpenCardApplicationsAndDtls.do",type:"post",contentType:"application/json",data:JSON.stringify({processId:i}),success:function(t){if(1==t.flag){for(var n=t.data[0],i=0;i<n.fesOpenCardApplicationDtls.length;i++)n.fesOpenCardApplicationDtls[i].validityTerm||(n.fesOpenCardApplicationDtls[i].validityTerm="");m.carRequestData=t.data[0],m.carRequestData.read=1;var s=e.getVm(c("cardDialog"));s.save=0,a.openCard()}}})},a.addCarList=function(){var e={cardName:"",cardAmount:"",validityTerm:"",isContainFour:0,isContainSeven:"0"};a.carRequestData.fesOpenCardApplicationDtls.push(e)},a.removeCarList=function(){a.carRequestData.fesOpenCardApplicationDtls.pop()}};g(),a.$step71UploaderOpts={uploaderId:c("step71Uploder"),uploadifyOpts:{uploader:n.BASE_PATH+"fesOnlineProcess/uploadFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:function(){return{sessionId:u.sessionId,processId:i("materials_design"),typeId:6}},width:120,height:30,progressData:"speed"},onSuccessResponseData:function(e){e=JSON.parse(e),e.flag&&r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d)}};var f=function(){a.sltImg="",a.imgUrl="",a.uploadData={},a.$step72UploaderOpts={uploaderId:c("step72Uploder"),uploadifyOpts:{uploader:n.BASE_PATH+"fesOnlineProcess/uploadTempFiles.do",fileObjName:"myfile",multi:!1,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.jpg; *.png; *.gif",formData:function(){return{sessionId:u.sessionId}},width:120,height:30,progressData:"speed"},onSuccessResponseData:function(t){if(t=JSON.parse(t),t.flag){var a=t.data;a.processId=i("materials_design"),a.typeId=e.getVm(c("selectSltId")).selectedValue,m.uploadData=a,m.sltImg=n.BASE_PATH+a.fileFullPath}}},a.uploaderImgType=function(){var t=e.getVm(c("sltDialog"));t.title="上传缩略图",t.open()},a.$addsltDialogOpts={dialogId:c("sltDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){a.sltImg=""},submit:function(){var a=e.getVm(c("sltDialog")),i=JSON.stringify(m.uploadData.$model),s=e.getVm(c("step72Uploder")),o=function(){t.c2s({url:n.BASE_PATH+"fesOnlineProcess/uploadFilesForCommit.do",type:"post",contentType:"application/json",data:i,success:function(e){1==e.flag&&(a.close(),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d))}})};s.uploading?(t.showGlobalMask(),s.$unwatch("uploading"),s.$watch("uploading",function(e){e||(t.hideGlobalMask(),o(),s.$unwatch("uploading"))})):o()}},a.$selectSltOpts={selectId:c("selectSltId"),options:[{text:"X展架",value:7},{text:"台卡卡心",value:8},{text:"易拉宝",value:9},{text:"三折台卡",value:10},{text:"海报",value:11},{text:"桌贴",value:13}],onSelect:function(){},selectedIndex:0}};f();var v=function(){a.stowageCard=function(i){var s=e.getVm(c("stowageDialog")),o=e.getVm(c("selectMessId"));s.processId=i;var r=JSON.stringify({merchantId:a.merchantId});t.c2s({url:n.BASE_PATH+"contact/queryContact.do",type:"post",contentType:"application/json",data:r,success:function(e){if(e.flag){for(var t=e.data,a=[],n=0;n<t.length;n++){var i={};i.value=t[n].id,i.text=t[n].name,a.push(i)}o.setOptions(a)}}}),s.title="实体卡配送",s.open()},a.$stowageDialogOpts={dialogId:c("stowageDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(c("stowageForm"));t.reset()},submit:function(){var i,s=e.getVm(c("stowageDialog")),o=e.getVm(c("stowageForm")),r=e.getVm(c("selectMessId"));o.validate()&&(i=o.getFormData(),i.contactId=r.selectedValue,i.processId=s.processId,i.fesStowageDtls=[{category:"2"}],i=JSON.stringify(i),t.c2s({url:n.BASE_PATH+"applySetting/saveFesStowage.do",type:"post",contentType:"application/json",data:i,success:function(e){e.flag&&(s.close(),a.pageData[0].listAttachmentAndOperateLog.push(e.data),a.pageData[0].onlineProcessStatus=e.dataonlineProcessStatus)}}))}},a.$stowageFormOpts={formId:c("stowageForm"),field:[{selector:".logisticsNum",rule:["noempty",function(e,t){return t[0]!==!0?"快递单号不能为空":!0}]},{selector:".logisticsCompany",rule:["noempty",function(e,t){return t[0]!==!0?"物流公司不能为空":!0}]}],logisticsNum:"",logisticsCompany:""},a.$selectMessOpts={selectId:c("selectMessId"),options:[{text:"X展架",value:7}],selectedIndex:0}};v(),a.setp7ReqData={id:0,processId:0,accessId:1,description:"",fesMaterialRequestDtlVOs:[{materialRequestType:"1",specificationType:"1",description:""},{materialRequestType:"2",specificationType:"1",description:""},{materialRequestType:"3",specificationType:"1",description:""},{materialRequestType:"4",specificationType:"1",description:""},{materialRequestType:"5",specificationType:"1",description:""},{materialRequestType:"6",specificationType:"1",description:""},{materialRequestType:"7",specificationType:"1",description:""}]},a.changeRadioStatus=function(){},a.step7Input=function(a){function i(){t.c2s({url:n.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:JSON.stringify({merchantId:m.merchantId}),success:function(t){if(1==t.flag){var a=t.data.rows,n=e.getVm(c("step7NameSelect")),i=_.map(a,function(e){return{text:e.name,value:e.id}});n.setOptions(i),s.title="设计需求单",s.readonly=1,$("input",s.widgetElement).prop("disabled",!0),$("textarea",s.widgetElement).prop("disabled",!0),$("span",s.widgetElement).off("click"),s.open()}}})}{var s=e.getVm(c("step7DialogId"));e.getVm(c("step7FormId"))}a?t.c2s({url:n.BASE_PATH+"fesOnlineProcess/getFesMaterialRequestById.do",type:"post",contentType:"application/json",data:JSON.stringify({id:a}),success:function(e){1==e.flag&&(m.setp7ReqData=e.data,i())}}):i()},a.$step7DialogOpts={dialogId:c("step7DialogId"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns" ms-if="!readonly"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div><div class="ui-dialog-btns" ms-if="readonly"><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">关&nbsp;闭</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},readonly:0,onOpen:function(){},onClose:function(){},width:600,submit:function(){var a=e.getVm(c("step7DialogId")),i=e.getVm(c("step7FormId"));if(s(),i.validate()){m.setp7ReqData.processId=m.stepData[6].id,m.setp7ReqData.accessId=e.getVm(c("step7NameSelect")).selectedValue;var o=JSON.stringify(m.setp7ReqData.$model);t.c2s({url:n.BASE_PATH+"fesOnlineProcess/saveFesMaterialRequestAndDtls.do",type:"post",contentType:"application/json",data:o,success:function(e){if(1==e.flag){var t=e.data;m.stepData.splice(6,1,t),a.close()}}})}}};var h=[];a.$step7FormOpts={formId:c("step7FormId"),field:h},a.$step7NameSelectOpts={selectId:c("step7NameSelect"),options:[],selectedIndex:1}});e.scan(a[0]),r({merchantId:m.merchantId},"synMerchant/getMerchantInfoByOrder.do",l),r({merchantId:m.merchantId,userId:u.id,resourceRemark:"fes_card_and_materials"},"fesOnlineProcess/listFesOnlineProcesss.do",d)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),i});

//From origin\page\productoperad\list\addedit\addedit.js
define("originpageproductoperadlistaddeditaddeditjs",["avalon","util","json","moment","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetuploaderuploaderjs","originwidgetcalendarcalendarjs","originwidgeteditoreditorjs"],function(e,t,a,n){var i=this,s=i.erp,o={},r=[];return _.extend(o,{$init:function(i,o,l){function d(e,n,i){var o=a.stringify(e);t.c2s({url:s.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:i})}function c(e,t,a){for(var n=0;n<e.length;n++)for(var i=0;i<t.length;i++)e[n]==t[i].value&&(t[i].isSelect="1",$("."+a).val(t[i].value))}function u(t){var a;if(t.flag){a=t.data;try{a.content=decodeURIComponent(a.content)}catch(i){a.content=a.content}p.requestData={id:a.id,title:a.title,content:a.content,productType:a.productType,promotionPlatform:a.promotionPlatform,beginTime:n(a.beginTime).format("YYYY-MM-DD"),endTime:n(a.endTime).format("YYYY-MM-DD"),isOpen:a.isOpen};var s=e.getVm(m("editorId"));setTimeout(function(){s.core.setContent(a.content),$("#edui1").css("z-index",10)},1e3),c(a.productType,p.productType,"isProducts"),c(a.promotionPlatform,p.promotionPlatform,"isPromotionPlatform")}}var m=function(e){var t=o+e;return r.push(t),t},p=e.define(o,function(i){i.navCrumbs=[{text:"产品运营",href:"#/productoperad/list"},{text:"创建运营信息"}],i.titleType="创建运营信息",i.pageType=parseInt(l.params.type),i.fileId=parseInt(l.params.id),i.pageType||(i.titleType="修改运营信息",i.navCrumbs[1].text="修改运营信息");s.getAppData("user");i.dateType="",i.isEdit="",i.isProducts="",i.isPromotionPlatform="",i.productType=[{text:"CRM",value:1,isSelect:"0"},{text:"ERP",value:2,isSelect:"0"},{text:"软POS",value:3,isSelect:"0"},{text:"运营平台",value:4,isSelect:"0"},{text:"超级报表",value:5,isSelect:"0"},{text:"超级预定",value:6,isSelect:"0"},{text:"微信",value:7,isSelect:"0"},{text:"超级Wifi",value:8,isSelect:"0"}],i.promotionPlatform=[{text:"CRM",value:1,isSelect:"0"},{text:"ERP",value:2,isSelect:"0"},{text:"软POS",value:3,isSelect:"0"}];var o=new Date;i.requestData={id:"",title:"",content:"",productType:[],promotionPlatform:[],beginTime:n(o).format("YYYY-MM-DD"),endTime:n(o).format("YYYY-MM-DD"),isOpen:"1"},i.setChecked=function(e,t){var a=!0;if(this.checked){for(var n=0;n<t.length;n++)t[n]==e&&(a=!1);a&&t.push(e)}else for(var i=0;i<t.length;i++)t[i]==e&&t.splice(i,1)},i.setProducts=function(){var e=this.value,a=p.requestData.productType;p.setChecked.call(this,e,a),$(".isProducts").val(a.length?e:"");var n=$(".add-edit-content")[0],i=$(".isProducts",n);t.testing(n,i)},i.setPlatform=function(){var e=this.value,a=p.requestData.promotionPlatform;p.setChecked.call(this,e,a),$(".isPromotionPlatform").val(a.length?e:"");var n=$(".add-edit-content")[0],i=$(".isPromotionPlatform",n);t.testing(n,i)},i.setRadio=function(){var e=this.value;p.requestData.isOpen=e},i.$dateOpts={calendarId:m("DateCalendarId"),minDate:new Date,onClickDate:function(e){if("beginTime"==p.dateType){p.requestData.beginTime=n(e).format("YYYY-MM-DD");var t=n(p.requestData.beginTime)/1,a=n(p.requestData.endTime)/1;t>a&&(p.requestData.endTime=n(e).format("YYYY-MM-DD"))}else"endTime"==p.dateType&&(p.requestData.endTime=n(e).format("YYYY-MM-DD"));$(this.widgetElement).hide()}},i.openDateCalendar=function(){var a,s=$(this),o=e.getVm(m("DateCalendarId")),r=s.offset();p.dateType=s.attr("data-type"),o?a=$(o.widgetElement):(a=$('<div ms-widget="calendar,$,$dateOpts"></div>'),a.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(a[0],[i]),o=e.getVm(m("DateCalendarId")),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),"beginTime"==p.dateType?(o.focusDate=p.requestData.beginTime?n(p.requestData.beginTime,"YYYY-MM-DD")._d:new Date,o.minDate=n(n(new Date).format("YYYY-MM-DD"),"YYYY-MM-DD")._d):"endTime"==p.dateType&&(o.focusDate=p.requestData.endTime?n(p.requestData.endTime,"YYYY-MM-DD")._d:new Date,o.minDate=n(p.requestData.beginTime,"YYYY-MM-DD")._d,o.maxDate=""),a.css({top:r.top+s.outerHeight()-1,left:r.left}).show()},i.$editorOpts={editorId:m("editorId"),ueditorOptions:{UEDITOR_HOME_URL:s.WIDGET_PATH+"editor/ueditor/",serverUrl:s.BASE_PATH,toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","customstyle","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","simpleupload","insertimage"]]}},setTimeout(function(){$("#edui1").css("z-index",10)},1e3),i.saveData=function(){var i=e.getVm(m("editorId"));$(".isEdit").val(i.core.getContent());var o=$(".add-edit-content")[0];if(t.testing(o)){var r=p.requestData.$model;r.content=encodeURIComponent(i.core.getContent()),r.beginTime=n(p.requestData.$model.beginTime)/1,r.endTime=n(p.requestData.$model.endTime)/1,t.c2s({url:s.BASE_PATH+"sysProductOperation/saveSysProductOperation.do",type:"post",contentType:"application/json",data:a.stringify(r),success:function(e){e.flag&&t.alert({content:"操作成功！",iconType:"success",onSubmit:function(){window.location.href=s.BASE_PATH+"#!/productoperad/list"}})}})}}});e.scan(i[0]),p.pageType||d({id:p.fileId},"sysProductOperation/getSysProductOperation.do",u)},$remove:function(){_.each(r,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),r.length=0}}),o});

//From origin\page\productoperad\list\info\info.js
define("originpageproductoperadlistinfoinfojs",["avalon","util","json","moment","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetgridgridjs"],function(e,t,a,n){var i=this,s=i.erp,o={},r=[];return _.extend(o,{$init:function(i,o,l){{var d=function(e){var t=o+e;return r.push(t),t};e.define(o,function(i){i.navCrumbs=[{text:"产品运营",href:"#/productoperad/list"},{text:"资料详情"}],i.path=s.BASE_PATH,i.pageUserId=s.getAppData("user").id,i.fileId=parseInt(l.params.id),i.keyword="",i.$gridOpts={gridId:d("-grid"),disableCheckAll:!0,disableCheckbox:!0,getTemplate:function(e){var t=e.split("MS_OPTION_TBAR");return'<div class="ui-grid-tbar fn-clear"><div class="fn-left">共<span class="num">{{gridTotalSize}}</span>个需求商</div><div class="ui-grid-search fn-right"><input type="text" class="input-text" placeholder="商户名" ms-duplex="keyword"><button type="button" class="query-btn main-btn" ms-click="search">搜索</button></div></div>MS_OPTION_TBAR'+t[1]},columns:[{dataIndex:"insertTime",text:"日期",html:!0,renderer:function(e,t){return n(t.insertTime).format("YYYY-MM-DD")}},{dataIndex:"merchantName",text:"商户名"},{dataIndex:"storeName",text:"门店名称"},{dataIndex:"userName",text:"姓名"},{dataIndex:"tel",text:"手机号"},{dataIndex:"position",text:"职位"}],onLoad:function(e,n){e=_.extend(e,{merchantName:_.str.trim(i.keyword),productOperationId:i.fileId}),t.c2s({url:s.BASE_PATH+"sysUserRequirement/listSysUserRequirements.do",contentType:"application/json",data:a.stringify(e),success:function(e){var t;e.flag&&(t=e.data,n.call(this,t))}})},search:function(){console.log(i.keyword),e.getVm(d("-grid")).load()},jump:function(){var e=$(this).attr("data-id");t.jumpPage("#/productoperad/list/info/"+e)}}})}e.scan(i[0]),e.getVm(d("-grid")).load()},$remove:function(){_.each(r,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),r.length=0}}),o});

//From origin\page\productoperad\list\list.js
define("originpageproductoperadlistlistjs",["avalon","util","json","moment","originwidgetpaginationpaginationjs","originwidgetformselectjs","originwidgetgridgridjs"],function(e,t,a,n){var i=this,s=i.erp,o={},r=[];return _.extend(o,{$init:function(i,o){var l=function(e){var t=o+e;return r.push(t),t},d=e.define(o,function(i){i.permission={create_oper_info:t.hasPermission("create_oper_info"),modify_oper_info:t.hasPermission("modify_oper_info"),user_req_items:t.hasPermission("user_req_items"),delete_oper_info:t.hasPermission("delete_oper_info")},i.pageUserId=s.getAppData("user").id,i.path=s.BASE_PATH,i.localHref=function(e){t.jumpPage(e)},i.keyword="",i.$gridOpts={gridId:l("-grid"),disableCheckAll:!0,disableCheckbox:!0,getTemplate:function(e){var t=e.split("MS_OPTION_TBAR");return'<div class="ui-grid-tbar fn-clear"><div class="fn-left">共<span class="num">{{gridTotalSize}}</span>条推广信息</div><div class="ui-grid-search fn-right"><input type="text" class="input-text" placeholder="标题" ms-duplex="keyword"><button type="button" class="query-btn main-btn" ms-click="search">搜索</button></div></div>MS_OPTION_TBAR'+t[1]},columns:[{dataIndex:"insertTime",text:"创建日期",html:!0,renderer:function(e,t){return n(t.insertTime).format("YYYY-MM-DD")}},{dataIndex:"title",text:"营销标题",html:!0,renderer:function(e,t){return'<a href="javascript:;" ms-data-id ='+t.id+' ms-click="jump">'+t.title+"</a>"}},{dataIndex:"time_limit",text:"推广平台",html:!0,renderer:function(e,t){for(var a=t.dicPlatforms,n="",i=0;i<a.length;i++)n+=n?"、"+a[i].dictionaryValue:a[i].dictionaryValue;return n}},{dataIndex:"amount",text:"需求量",html:!0,renderer:function(e,t){return'<a href="javascript:;" ms-data-id ='+t.id+' ms-click="jump">'+t.amount+"</a>"}},{dataIndex:"beginTime",text:"推广开始",html:!0,renderer:function(e,t){return n(t.beginTime).format("YYYY-MM-DD")}},{dataIndex:"endTime",text:"推广截止",html:!0,renderer:function(e,t){return n(t.endTime).format("YYYY-MM-DD")}},{dataIndex:"isOpen",text:"操作",html:!0,renderer:function(e,t){var a=parseInt(t.isOpen);return a?'<div class="choose"><span ms-if="permission.modify_oper_info"  class="stop" data-id='+t.id+' data-openType="0" ms-click="setOpen"> 停用</span><a ms-if="permission.modify_oper_info" href="javascript:;" data-id='+t.id+' ms-click="openEdit">修改</a><a ms-if="permission.delete_oper_info" href="javascript:;" data-id='+t.id+' ms-click="removeOne">删除</a></div>':'<div class="choose"><span ms-if="permission.modify_oper_info"  class="start" data-id='+t.id+' data-openType="1" ms-click="setOpen"> 启用</span><a ms-if="permission.modify_oper_info" href="javascript:;" data-id='+t.id+' ms-click="openEdit">修改</a><a ms-if="permission.delete_oper_info" href="javascript:;" data-id='+t.id+' ms-click="removeOne">删除</a></div>'}}],onLoad:function(e,n){e=_.extend(e,{title:_.str.trim(i.keyword)}),t.c2s({url:s.BASE_PATH+"sysProductOperation/listSysProductOperations.do",contentType:"application/json",data:a.stringify(e),success:function(e){var t;e.flag&&(t=e.data,n.call(this,t))}})},search:function(){e.getVm(l("-grid")).load()},jump:function(){var e=$(this).attr("data-id");d.permission.user_req_items?t.jumpPage("#/productoperad/list/info/"+e):t.alert({content:"您没有查看详情的权限！",iconType:"info"})},setOpen:function(){var n=$(this).attr("data-id"),i=$(this).attr("data-openType"),o=e.getVm(l("-grid"));o.selectById(n);var r=o.getSelectedData()[0];t.c2s({url:s.BASE_PATH+"sysProductOperation/saveSysProductOperation.do",contentType:"application/json",data:a.stringify({id:n,isOpen:i}),success:function(e){e.flag&&(o.updateData({id:r.id,isOpen:"1"==r.isOpen?"0":"1"}),o.unselectById(r.id))}})},removeOne:function(){var a=$(this).attr("data-id");t.confirm({content:"你确定要删除选中的信息吗？",onSubmit:function(){t.c2s({url:s.BASE_PATH+"sysProductOperation/deleteSysProductOperation/"+a+".do",success:function(t){t.flag&&e.getVm(l("-grid")).load()}})}})},openEdit:function(){var e=$(this).attr("data-id");t.jumpPage("#/productoperad/list/addedit/0/"+e)}}});e.scan(i[0]),e.getVm(l("-grid")).load()},$remove:function(){_.each(r,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),r.length=0}}),o});

//From origin\page\sales\home\home.js
define("originpagesaleshomehomejs",["avalon","util","json","originwidgetpaginationpaginationjs","originwidgetformselectjs"],function(e,t,a){var n=this,i=n.erp,s={},o=[];return _.extend(s,{$init:function(n,s){function r(e,n,s){var o=a.stringify(e);t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:s})}function l(t){function a(e,t){return e.stepId>t.stepId?1:-1}var n,i=e.getVm(u("paginationPage"));if(t.flag){m.merchantListData=[],n=t.data;for(var s=0,o=n.rows.length;o>s;s++)n.rows[s].listSteps.sort(a);for(var s=0,o=n.rows.length;o>s;s++){for(var r=[{index:"1",health:0},{index:"2",health:0},{index:"3",health:0},{index:"4",health:0}],l=n.rows[s].synHealthDegrees,d=0,c=l.length;c>d;d++){var p={};p.index=l[d].targetType,p.health=l[d].healthDegree<100?0:1;for(var g=0,f=r.length;f>g;g++)r[g].index==p.index&&(r[g]=p)}n.rows[s].healthType=r}for(var l=n.rows,s=0;s<l.length;s++){var v={};for(var h in l[s]){var y=l[s].hasOwnProperty(h);if(y){if("merchantId"==h&&(v.merchantId=l[s][h]),"merchantName"==h&&(v.merchantName=l[s][h]),"merchantStatus"==h&&(v.merchantStatus=l[s][h]),"salesName"==h){var b=[];if(l[s][h]instanceof Array)b=l[s][h];else{var T={};T.id=0,T.tel=0,T.userName=l[s][h],b.push(T)}v.salesName=b}if("listUsers"==h){var b=[];if(l[s][h]instanceof Array)b=l[s][h];else{var T={};T.id=0,T.tel=0,T.userName=l[s][h],b.push(T)}v.listUsers=b}"merchantStatusText"==h&&(v.merchantStatusText=l[s][h]),"listSteps"==h&&(v.listSteps=l[s][h]),"healthType"==h&&(v.healthType=l[s][h])}}m.merchantListData.push(v)}i.total=n.totalSize}}function d(t){var a,n=e.getVm(u("paginationPage"));t.flag&&(m.backlogListData=[],a=t.data,m.backlogListData=a.rows,n.total=a.totalSize)}function c(e){var t;e.flag&&(t=e.data,m.dotolen=t.rows.length)}var u=function(e){var t=s+e;return o.push(t),t},m=e.define(s,function(a){a.pageUserId=i.getAppData("user").id,a.pageStatus=1,a.merchantListData=[],a.backlogListData=[],a.dotolen=0,a.backlogRequestData={userId:a.pageUserId,inputItemTypes:["03"],merchantName:"",pageNumber:1,pageSize:10,businessTypes:["1"]},a.merchantRequestData={merchantStatus:"",userId:a.pageUserId,pageSize:10,pageNumber:1,merchantName:"",merchantStatusType:1},a.localHref=function(e){t.jumpPage(e)},a.permission={sales_remaind:t.hasPermission("sales_remaind"),sales_ques_mag:t.hasPermission("sales_ques_mag"),sales_address:t.hasPermission("sales_address"),sales_my_merchant:t.hasPermission("sales_my_merchant"),sales_todolist:t.hasPermission("sales_todolist")},a.changePageStatus=function(t){a.pageStatus=t;var n=e.getVm(u("paginationPage"));n.currentPage=1,1==t?(m.merchantRequestData.merchantName="",r(m.merchantRequestData.$model,"myHomePage/getComplexSynMerchants.do",l)):2==t&&(m.backlogRequestData.merchantName="",r(m.backlogRequestData.$model,"myHomePage/getComplexSysToDoLists.do",d))},a.changeStatus=function(t){a.merchantRequestData.merchantStatus=t;var n=e.getVm(u("paginationPage"));m.merchantRequestData.pageNumber=1,n.currentPage=1,r(m.merchantRequestData.$model,"myHomePage/getComplexSynMerchants.do",l)},a.merchantSearch=function(){r(m.merchantRequestData.$model,"myHomePage/getComplexSynMerchants.do",l)},a.showProgressTip=function(){var e=this.$vmodel.$model,t=e.el.stepText,a=s+"-progress-tip",n=$(this),i=$("#"+a),o=n.offset();i.length||(i=$('<div id="'+a+'" class="grid-tip"></div>'),i.html('<span class="text-content"></span><span class="icon-arrow"></span>'),i.hide().appendTo("body")),$(".text-content",i).text(t),i.css({top:o.top-i.height()-20,left:o.left-i.width()/2-11}).show()},a.hideProgressTip=function(){$("#"+s+"-progress-tip").hide()},a.backlogSearch=function(){r(m.backlogRequestData.$model,"myHomePage/getComplexSysToDoLists.do",d)},a.doToStatus=function(t){var a=e.getVm(u("paginationPage"));a.currentPage=1,m.backlogRequestData.pageNumber=1,m.backlogRequestData.inputItemTypes=t,r(m.backlogRequestData.$model,"myHomePage/getComplexSysToDoLists.do",d)},a.$paginationOpts={paginationId:u("paginationPage"),total:0,onJump:function(){var t=e.getVm(u("paginationPage"));1==m.pageStatus?(m.merchantRequestData.pageNumber=t.currentPage,r(m.merchantRequestData.$model,"myHomePage/getComplexSynMerchants.do",l)):2==m.pageStatus&&(m.backlogRequestData.pageNumber=t.currentPage,r(m.backlogRequestData.$model,"myHomePage/getComplexSysToDoLists.do",d))}}});e.scan(n[0]),r(m.backlogRequestData.$model,"myHomePage/getComplexSysToDoLists.do",c),r(m.merchantRequestData.$model,"myHomePage/getComplexSynMerchants.do",l)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),s});

//From origin\page\sales\home\waiting\waiting.js
define("originpagesaleshomewaitingwaitingjs",["avalon","util","json","moment","dialog","originwidgetformselectjs","originwidgetformformjs","originwidgetcalendarcalendarjs","originwidgetuploaderuploaderjs","originmoduleinterviewinterviewjs","originmodulesurveysurveyjs","originmoduleaddressaddressjs"],function(e,t,a){var n=this,i=n.erp,s={},o=[];return _.extend(s,{$init:function(n,s,r){function l(e,n,s){var o=a.stringify(e);p.pageData=[],t.c2s({url:i.BASE_PATH+n,type:"post",contentType:"application/json",data:o,success:s})}function d(e){var t;if(e.flag){t=e.data;var a={};a.productList=t.productList,a.filePath=t.filePath;var n=t.merchantInfo;for(var i in n){var s=n.hasOwnProperty(i);s&&(a[i]=n[i])}a.imgUrl=a.attachment_name?p.path+a.filePath+"/"+a.attachment_path+"/"+a.attachment_name:p.path+"portal/origin/asset/image/merchant-default-logo.jpg",p.merchantData=a}}function c(e){var t;e.flag&&(t=e.data,p.pageData=t)}var u=function(e){var t=s+e;return o.push(t),t},m=i.getAppData("user"),p=e.define(s,function(n){n.navCrumbs=[{text:"我的主页",href:"#/sales/home"},{text:"待办事项"}],n.path=i.BASE_PATH,n.pageUserId=i.getAppData("user").id,n.merchantId=parseInt(r.params.id),n.imgUrl="",n.isLogo=!1,n.pageData={},n.type=r.params.type,1==n.type&&(n.navCrumbs[0].href="#/backend/customerservice"),n.localHref=function(e){t.jumpPage(e)};var s=function(){n.merchantData={productList:[],filePath:"",merchant_status:"",merchant_name:"",front_user_name:"",sale_user_name:"",assist_user_name:"",person_avg:"",desk_avg:"",store_number:"",begin_time:"",plan_online_time:"",format_name:"",attachment_name:"",attachment_path:""}};s();var o=function(){n.options1=[],n.$addQuestionDialogOpts={dialogId:u("addQuestionDialog"),getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">保&nbsp;存</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(u("addQuestionForm"));t.reset(),t.title="",t.description=""},submit:function(){var n,s=e.getVm(u("addQuestionDialog")),o=e.getVm(u("addQuestionForm"));if(o.validate()){n=o.getFormData();var r=e.getVm(u("addQuestionSelect")).selectedValue;n.merchantId=p.merchantId,n.problemType=r,n.problemStatus=1,n=a.stringify(n),t.c2s({url:i.BASE_PATH+"sysProblem/saveSysProblem.do",type:"post",contentType:"application/json",data:n,success:function(e){1==e.flag&&s.close()}})}}},n.openAdd=function(){var a=e.getVm(u("addQuestionSelect"));n.options1.length?a.setOptions(n.options1):t.c2s({url:i.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000040",success:function(e){var t;e.flag&&(t=e.data,n.options1=_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}),a.setOptions(n.options1))}});var s=e.getVm(u("addQuestionDialog")),o=e.getVm(u("addQuestionForm"));s.title="添加问题",o.title="",o.description="",s.open()},n.$addQuestionFormOpts={formId:u("addQuestionForm"),field:[{selector:".title",rule:["noempty",function(e,t){return t[0]!==!0?"问题标题不能为空":!0}]},{selector:".description",rule:["noempty",function(e,t){return t[0]!==!0?"问题类型不能为空":!0}]}],title:"",description:""},n.$scheduleOpts={selectId:u("addQuestionSelect"),options:[],selectedIndex:1}};o(),n.$surveyOpts={surveyId:u("-surveyModule"),readonly:"",merchantId:"",callFn:function(){l({merchantId:p.merchantId},"mktShopSurvey/listMktShopSurveys.do",c),l({merchantId:p.merchantId},"synMerchant/getMerchantInfoByOrder.do",d)}},n.addSurvey=function(){var t=e.getVm(u("-surveyModule"));t.readonly=3==p.pageData.isDisabled?1:0,t.moduleType="mkt",t.merchantId=p.merchantId,t.requestData=$(this).attr("data-id")?{merchantId:p.merchantId,id:$(this).attr("data-id")}:{merchantId:p.merchantId},t.open()},n.removeResearch=function(e,n){var s={id:e,moduleType:"mkt",storeId:n};s=a.stringify(s),t.confirm({content:"你确定要删除调研单吗？",onSubmit:function(){t.c2s({url:i.BASE_PATH+"mktShopSurvey/deleteMktShopSurvey.do",type:"post",contentType:"application/json",data:s,success:function(e){1==e.flag&&l({merchantId:p.merchantId},"mktShopSurvey/listMktShopSurveys.do",c)}})}})},n.$interviewOpts={interviewId:u("-interviewModule"),sessionId:"",readonly:"",moduleType:"",merchantId:"",callFn:function(){l({merchantId:p.merchantId},"mktShopSurvey/listMktShopSurveys.do",c),l({merchantId:p.merchantId},"synMerchant/getMerchantInfoByOrder.do",d)}},n.addInterval=function(){var t=e.getVm(u("-interviewModule"));t.requestData={merchantId:p.merchantId},t.sessionId=m.sessionId,t.readonly=3==p.pageData.isDisabled?1:0,t.moduleType="mkt",t.merchantId=p.merchantId,t.requestData={merchantId:p.merchantId},t.open()},n.$addressOpts={addressId:u("-addressModule"),readonly:"",moduleType:"mkt",merchantId:""},n.addCommunication=function(n){var s=e.getVm(u("-addressModule"));s.readonly=0,s.callFn=function(){n&&t.c2s({url:i.BASE_PATH+"contact/searchContacts.do",type:"post",contentType:"application/json",data:a.stringify({merchantId:p.merchantId}),success:function(t){var a;if(t.flag){a=t.data.rows;var i=e.getVm(n),s=_.map(a,function(e){return{text:e.name,value:e.id}});s.unshift({text:"请选择",value:""}),i.setOptions(s)}}}),l({merchantId:p.merchantId},"mktShopSurvey/listMktShopSurveys.do",c),l({merchantId:p.merchantId},"synMerchant/getMerchantInfoByOrder.do",d)},s.requestData=$(this).attr("data-id")?{merchantId:p.merchantId,id:$(this).attr("data-id")}:{merchantId:p.merchantId},s.readonly=$(this).attr("data-readonly")?1:0,s.open()},n.showCommunication=function(e){t.c2s({url:i.BASE_PATH+"contact/editContact.do",type:"post",data:{contactIdStr:e},success:function(e){var t;e.flag&&(t=e.data,p.communicationRequestData=t,n.addCommunication("edit"))}})},n.stepEnd=function(){t.confirm({content:"你确定完成了吗？",onSubmit:function(){t.c2s({url:i.BASE_PATH+"mktShopSurvey/salesComfirm.do",type:"get",contentType:"application/json",data:{merchantId:p.merchantId},success:function(e){e.flag&&l({merchantId:p.merchantId},"mktShopSurvey/listMktShopSurveys.do",c)}})}})}});e.scan(n[0]),l({merchantId:p.merchantId},"synMerchant/getMerchantInfoByOrder.do",d),l({merchantId:p.merchantId},"mktShopSurvey/listMktShopSurveys.do",c)},$remove:function(){_.each(o,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),o.length=0}}),s});

//From origin\page\study\casemanage\casemanage.js
define("originpagestudycasemanagecasemanagejs",["avalon","util"],function(e){var t=this,a=t.erp,n={};return _.extend(n,{$init:function(t,n){e.define(n,function(e){e.externalLink=a.BASE_PATH+"erp/project/toProjectItems.do",e.iframeHeight=1,e.onIframeLoad=function(){var t=$(this.contentWindow.document.body);$(".page-hd",t).hide(),e.iframeHeight=t.height()+60}});e.scan(t[0])},$remove:function(){}}),n});

//From origin\page\study\coursemanage\coursedetail\coursedetail.js
define("originpagestudycoursemanagecoursedetailcoursedetailjs",["avalon","util","sortable","originmodulecwselectorcwselectorjs","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,o){function s(){t.c2s({url:n.BASE_PATH+"course/getCourseDetail.do",data:{pageSize:1e4,pageNumber:1,courseId:o.params.id},success:function(e){var t;1==e.flag&&(t=e.data,d.requiredCourseware=_.map(t.requiredCourseware,function(e){return{coursewareId:e.courseware_id,coursewareName:e.courseware_name,timeLimit:e.time_limit}}),d.optionalCourseware=_.map(t.noRequiredCourseware,function(e){return{coursewareId:e.courseware_id,coursewareName:e.courseware_name,timeLimit:e.time_limit}}))}})}var r=i+"-cwselector",l=decodeURIComponent(o.params.courseName),d=e.define(i,function(a){a.requiredCourseware=[],a.optionalCourseware=[],a.courseType="",a.navCrumbs=[{text:"课程管理",href:"#/study/coursemanage"},{text:l,href:"#/study/coursemanage"},{text:"查看课程详情"}],a.$cwselectorOpts={cwselectorId:r,multi:!0,onListReady:function(e){var t=a[a.courseType+"Courseware"];_.each(t.$model,function(t){var a=-1;_.some(e.$model,function(e,n){return e.id==t.coursewareId?(a=n,!0):void 0})&&e.set(a,{isSelected:!0})});var n="optional"==a.courseType?"required":"optional",i=a[n+"Courseware"];_.each(i.$model,function(t){var a=-1;_.some(e.$model,function(e,n){return e.id==t.coursewareId?(a=n,!0):void 0})&&e.removeAt(a)})},onSubmit:function(e){e.length&&(a[a.courseType+"Courseware"].clear(),a[a.courseType+"Courseware"]=_.map(e,function(e){return{coursewareId:e.id,coursewareName:e.coursewareName,timeLimit:e.timeLimit}}))}},a.openAdd=function(){var t=e.getVm(r);a.courseType=e(this).data("courseType"),t.open()},a.removeGridItem=function(){var t=e(this).data("courseType"),n=this.$vmodel.$model;a[t+"Courseware"].removeAt(n.$index)},a.deleteAll=function(){var n=e(this).data("courseType");t.confirm({content:"确定将课件都删除?",onSubmit:function(){a[n+"Courseware"].removeAll()}})},a.saveCourseware=function(){var e=[],i={courseId:o.params.id/1};return _.each(a.requiredCourseware.$model,function(t){e.push({coursewareId:t.coursewareId,reRequired:"1"})}),_.each(a.optionalCourseware.$model,function(t){e.push({coursewareId:t.coursewareId,reRequired:"0"})}),e.length?(i.coursewareInfos=e,void t.c2s({url:n.BASE_PATH+"course/saveCourseware.do",type:"post",contentType:"application/json",data:JSON.stringify(i),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){t.jumpPage("#/study/coursemanage")}})}})):void t.alert({iconType:"error",content:"请选择至少一个课件"})}});e.scan(a[0],[d]),s(),$(".required-grid, .not-required-grid",a).sortable({containerSelector:"table",itemPath:"> tbody",itemSelector:"tr",placeholder:'<tr class="drag-sort-placeholder"><td colspan="4">&nbsp;</td></tr>',onDrop:function(t,a,n){var i=t.closest("table"),o=i.hasClass("required-grid")?"required":"optional",s=[];$("tbody tr",i).each(function(){var t=e(this).data("coursewareId");_.some(d[o+"Courseware"].$model,function(e){e.coursewareId==t&&s.push(e)})}),d[o+"Courseware"]=s,n(t)}})},$remove:function(t,a){var n=a+"-cwselector";$(e.getVm(n).widgetElement).remove()}}),i});

//From origin\page\study\coursemanage\coursemanage.js
define("originpagestudycoursemanagecoursemanagejs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetgridgridjs","originmodulepositionselectorpositionselectorjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){var o=i+"-add-edit-dialog",s=i+"-add-edit-form",r=i+"-grid",l=i+"-positionselector",d=e.define(i,function(a){a.permission={magCourse:t.hasPermission("mag_course"),viewCourse:t.hasPermission("view_course"),finalExamRule:t.hasPermission("final_exam_rule")},a.$gridOpts={gridId:r,recordUnit:"种课程",columns:[{dataIndex:"course_name",text:"课程名称"},{dataIndex:"time_limit",text:"课程限时（小时）"},{dataIndex:"count_is_required",text:"课件安排",renderer:function(e,t){return"必修课"+t.count_is_required+"节,选修课"+t.count_is_not_required+"节"}},{dataIndex:"operation",text:"课件安排",html:!0,renderer:function(e,t){return'<a href="#/study/coursemanage/coursedetail/'+t.id+"/"+t.course_name+'" class="edit-l" ms-if="permission.viewCourse" data-course-id="'+t.id+'">查看课程详情</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="ref-position-l" ms-if="permission.finalExamRule" ms-click="openPositonRef" data-course-id="'+t.id+'">关联职位</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#/study/coursemanage/examrule/'+t.id+"/"+t.course_name+'" class="edit-l" ms-if="permission.finalExamRule" data-course-id="'+t.id+'">期末考试规则</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="edit-l" ms-click="openEdit" ms-if="permission.magCourse" data-course-id="'+t.id+'" data-course-name="'+t.course_name+'" data-time-limit="'+t.time_limit+'">修改</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="remove-l" ms-if="permission.magCourse" ms-click="removeGridItem" data-course-id="'+t.id+'">删除</a></td>'}}],onLoad:function(e,a){t.c2s({url:n.BASE_PATH+"course/getCourseInfo.do",data:e,success:function(e){var t;e.flag&&(t=e.data,a.call(this,t))}})},openEdit:function(){var t=e.getVm(o),n=e.getVm(s),i=e.getVm(r),l=$(this),d=l.data("courseId")+"",c=l.data("courseName"),u=l.data("timeLimit");t.title="编辑课程",n.courseName=c,n.timeLimit=u,a.addEditState="edit",i.selectById(d,!0),t.open()},openPositonRef:function(){var t=$(this),a=e.getVm(r),n=e.getVm(l),i=t.data("courseId");a.selectById(i,!0),n.open()},removeGridItem:function(){var t=$(this),a=e.getVm(r),n=t.data("courseId");a.selectById(n,!0),a._removeCourse()},batchRemoveGridItem:function(){e.getVm(r)._removeCourse()},_removeCourse:function(){var a,i,o,s=e.getVm(r),l=s.getSelectedData();0===l.length?t.alert({content:"请先选中课程"}):(a=_.map(l,function(e){return e.id}),o=n.BASE_PATH+"course/deleteCourse.do",i=JSON.stringify({idString:a}),t.confirm({content:"确定要删除选中的课程吗？",onSubmit:function(){t.c2s({url:o,type:"post",dataType:"json",contentType:"application/json",data:i,success:function(e){1==e.flag&&s.load()}})}}))}},a.$psOpts={positionselectorId:l,multi:!0,onListRequestData:function(t){var a=e.getVm(r),n=a.getSelectedData();return _.extend(t,{courseId:n[0].id/1})},onListReady:function(e){_.each(e.$model,function(t,a){t.isChoosed&&e.set(a,{isSelected:!0})})},onSubmit:function(a){var i=e.getVm(r),o=i.getSelectedData();a.length?t.c2s({url:n.BASE_PATH+"traPositionCourse/saveTraPositionCourse.do",type:"post",dataType:"json",contentType:"application/json",data:JSON.stringify(_.map(a,function(e){return{positionId:e.id/1,courseId:o[0].id/1}})),success:function(){}}):t.alert({iconType:"error",content:"请选择对应的职位"})}},a.addEditState="",a.$addEditDialogOpts={dialogId:o,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(s);t.reset(),t.courseName="",t.timeLimit=""},submit:function(){var i,l,d,c=e.getVm(o),u=e.getVm(s),m=e.getVm(r),p=a.addEditState;u.validate()&&(i=u.getFormData(),"edit"==p?(d=m.getSelectedData()[0].id,_.extend(i,{id:d}),l=n.BASE_PATH+"course/updateCourse.do"):l=n.BASE_PATH+"course/saveCourse.do",t.c2s({url:l,type:"post",data:i,success:function(e){1==e.flag&&("edit"==p?_.some(m.gridData.$model,function(e,t){return e.id==d?(m.gridData.set(t,{course_name:i.courseName,time_limit:i.timeLimit}),!0):void 0}):m.load(),c.close())}}))}},a.$addEditFormOpts={formId:s,field:[{selector:".course-name",rule:["noempty",function(e,t){return t[0]!==!0?"课程名称不能为空":!0}]},{selector:".time-limit",name:"timeLimit",rule:["noempty",function(e,t){return t[0]!==!0?"课程时限不能为空":/^-?\d+(\.\d{1,1})?$/.test(e)?parseFloat(e,10)<=0||"00"===e.slice(0,2)?"请输入有效的课程时限":!0:"请输入有效的课程时限"}]}],courseName:"",timeLimit:""},a.openAdd=function(){var t=e.getVm(o),n=e.getVm(s),i=e.getVm(r);t.title="添加课程",n.courseName="",n.timeLimit="",a.addEditState="add",i.unselectById("all"),t.open()}});e.scan(a[0],[d]),e.getVm(r).load()},$remove:function(t,a){var n=a+"-add-edit-dialog",i=a+"-add-edit-form",o=a+"-grid",s=a+"-positionselector";$(e.getVm(o).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove(),$(e.getVm(s).widgetElement).remove()}}),i});

//From origin\page\study\coursemanage\examrule\examrule.js
define("originpagestudycoursemanageexamruleexamrulejs",["avalon","util","json","originwidgetformformjs","dialog","originwidgetuploaderuploaderjs","originwidgetformselectjs","originmoduleqselectorqselectorjs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o,s){function r(){t.c2s({url:i.BASE_PATH+"finalExamRule/getFinalExamRuleByCourseId.do",data:a.stringify({courseId:u}),contentType:"application/json",success:function(t){var a;t.flag&&(a=t.data,p.ruleId=a.id||0,p.total=a.total||"",p.timeLimit=a.time_limit||"",p.passScore=a.pass_score||"",p.interviewScores=a.interview_scores||"",e.getVm(c).select(a.final_exam_rule_type/1),p.selectedWriteList=_.map(a.finalExamQuestions,function(e){return{id:e.question_id,question:e.question,questionType:e.question_type,pptName:e.ppt_name}}))}})}var l=o+"-form",d=o+"-qselector",c=o+"-write-range",u=s.params.id/1,m=decodeURIComponent(s.params.courseName),p=e.define(o,function(n){n.state=o.split("-").pop(),n.navCrumbs=[{text:"课程管理",href:"#/study/coursemanage"},{text:m,href:"#/study/coursemanage"},{text:"期末考试规则"}],n.total="",n.timeLimit="",n.passScore="",n.ruleId=0,n.interviewScores="",n.selectedWriteList=[],n.examRange="all",n.$writeRangeOpts={selectId:c,options:[{text:"全部随机",value:"0"},{text:"部分随机",value:"1"}],onSelect:function(e){n.examRange="0"==e?"all":"part"}},n.$qselectorOpts={qselectorId:d,multi:!0,listPath:"finalExamRule/getQuestionByCourseId.do",onListRequestData:function(e){return e.courseId=u,e},onListReady:function(e){_.each(n.selectedWriteList.$model,function(t){var a=-1;_.some(e.$model,function(e,n){return e.id==t.id?(a=n,!0):void 0})&&e.set(a,{isSelected:!0})})},onSubmit:function(e){e.length?n.selectedWriteList=_.map(e,function(e){return{id:e.id,question:e.question,questionType:e.questionType}}):t.alert({iconType:"error",content:"请选择至少一个试题"})}},n.openQuestionSelector=function(){var t=e.getVm(d);t.title="选择必考题",t.open()},n.removeWriteItem=function(){var e=this.$vmodel.$model;n.selectedWriteList.removeAt(e.$index)},n.$formOpts={formId:l,field:[{selector:".time-limit",name:"timeLimit",rule:["noempty",function(e,t){return t[0]!==!0?"考试时限不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的考试时限":!0:"请输入有效的考试时限"}]},{selector:".total",name:"total",rule:["noempty",function(e,t){return t[0]!==!0?"考题数量不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的考题数量":!0:"请输入有效的考题数量"}]},{selector:".pass-score",name:"passScore",rule:["noempty",function(e,t){return t[0]!==!0?"及格分数线不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的及格分数":!0:"请输入有效的及格分数"}]},{selector:".interview-scores",name:"interviewScores",rule:["noempty",function(e,t){return t[0]!==!0?"互动及格分数线不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的互动及格分数":!0:"请输入有效的互动及格分数"}]}],action:[{selector:".f-submit",handler:function(){var n,o=e.getVm(l),s=e.getVm(c),r=[];if(o.validate()){if(n=o.getFormData(),_.extend(n,{id:p.ruleId,courseId:u,finalExamRuleType:s.selectedValue}),"part"==p.examRange){if(r=_.map(p.selectedWriteList.$model,function(e){return e.id}),!r.length)return void t.alert({iconType:"error",content:"请指定有效的考题范围"});if(r.length>n.total/1)return void t.alert({iconType:"error",content:"必考题数量不能大于增加考题数量"})}n.questionIdList=r,t.c2s({url:i.BASE_PATH+"finalExamRule/addFinalExamRule.do",type:"post",contentType:"application/json",data:a.stringify(n),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){t.jumpPage("#/study/coursemanage")}})}})}}}]}});r(),e.scan(n[0],[p])},$remove:function(t,a){var n=a+"-form",i=a+"-qselector",o=a+"-write-range";$(e.getVm(o).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),o});

//From origin\page\study\coursestudy\coursestudy.js
define("originpagestudycoursestudycoursestudyjs",["avalon","util","json","moment"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(a,i){function s(){t.c2s({url:o.BASE_PATH+"train/student/getAllCoursewares.do",success:function(e){var a,i,o,s,l;e.flag&&(a=e.data,i=a.required,o=a.optional,s=a.course,l=a.finalExamAvail,d.requiredList=r(i,s),d.requiredList.push({indexNum:i.length+1,isStudied:l?!0:!1,content:l?'<a href="#/study/coursestudy/plainexam/'+s.learningProgressId+"/"+s.id+'/0">期末考试</a>':"期末考试"}),d.optionalList=r(o,s),d.speaker=a.teachername,s&&(d.coursename=s.courseName,d.endTime=s.endTime?n(s.endTime).format("YYYY-MM-DD HH:mm"):""),i.length||o.length||t.alert({iconType:"info",content:e.message}))}})}function r(e,t){return _.map(e,function(e,a){var n="《"+e.coursewareName+"》",i=!1;return n+="&nbsp;&nbsp;&nbsp;&nbsp;",n+="课时："+e.courseHours,n+="&nbsp;&nbsp;|&nbsp;&nbsp;",n+="主讲人："+e.speaker,e.studied&&(n+='&nbsp;&nbsp;<a href="#/study/coursestudy/process/'+t.learningProgressId+"/"+t.id+"/"+e.id+'">复习课程</a>',i=!0),e.isNew&&(n+='&nbsp;&nbsp;<a href="#/study/coursestudy/process/'+t.learningProgressId+"/"+t.id+"/"+e.id+'">开始学习</a>'),e.examined&&(n+="0"==e.paperType?'&nbsp;-&nbsp;<a href="#/study/coursestudy/plainexam/'+t.learningProgressId+"/"+t.id+"/"+e.id+'">重新考试</a>':'&nbsp;-&nbsp;<a href="#/study/coursestudy/recordexam/'+t.learningProgressId+"/"+t.id+"/"+e.id+'">重新考试</a>'),e.studied&&!e.examined&&(n+="0"==e.paperType?'&nbsp;-&nbsp;<a href="#/study/coursestudy/plainexam/'+t.learningProgressId+"/"+t.id+"/"+e.id+'">马上考试</a>':'&nbsp;-&nbsp;<a href="#/study/coursestudy/recordexam/'+t.learningProgressId+"/"+t.id+"/"+e.id+'">马上考试</a>'),{indexNum:a+1,content:n,isNew:e.isNew,isStudied:i}})}var l=o.getAppData("user"),d=e.define(i,function(e){e.requiredList=[],e.optionalList=[],e.speaker="",e.coursename="",e.endTime=""});e.scan(a[0]),"1"==l.isFormal?t.jumpPage("#/study/coursestudy/oldstaffstudy"):s()},$remove:function(){}}),s});

//From origin\page\study\coursestudy\oldstaffstudy\oldstaffstudy.js
define("originpagestudycoursestudyoldstaffstudyoldstaffstudyjs",["avalon","util","json","moment"],function(e,t,a,n){var i=this,s=i.erp,o={};return _.extend(o,{$init:function(a,i){function o(){t.c2s({url:s.BASE_PATH+"train/student/getAllCoursewares.do",data:{isOldStaff:1},success:function(e){var t;e.flag&&(t=e.data,r.studyList=_.map(t.learningCoursewareList,function(e,t){return e.indexNum=_.str.lpad(t+1,2,"0"),e.coursewareEndTimeText=n(e.coursewareEndTime).format("YYYY.MM.DD HH:mm"),e}),r.historyList=_.map(t.historyCoursewareList,function(e,t){return e.indexNum=_.str.lpad(t+1,2,"0"),e.coursewareEndTimeText=n(e.coursewareEndTime).format("YYYY.MM.DD HH:mm"),e}))}})}var r=e.define(i,function(e){e.studyList=[],e.historyList=[],e.clickStartStudy=function(){var e=this.$vmodel.$model.el,a=e.id,n=e.learningProgressId;t.jumpPage("#/study/coursestudy/process/"+n+"/0/"+a)},e.clickStartExam=function(){var e=this.$vmodel.$model.el;"0"==e.paperType?t.jumpPage("#/study/coursestudy/plainexam/"+e.learningProgressId+"/0/"+e.id):"1"==e.paperType?t.jumpPage("#/study/coursestudy/recordexam/"+e.learningProgressId+"/0/"+e.id):"2"==e.paperType&&t.jumpPage("#/study/coursestudy/practiceexam/"+e.learningProgressId+"/0/"+e.id)}});e.scan(a[0]),o()},$remove:function(){}}),o});

//From origin\page\study\coursestudy\plainexam\plainexam.js
define("originpagestudycoursestudyplainexamplainexamjs",["avalon","util","json","originwidgetformformjs"],function(e,t,a){var n=this,i=n.erp,s={};return _.extend(s,{$init:function(n,s,o){function r(e){var t="";switch(e){case"0":t="单选题";break;case"1":t="多选题";break;case"2":t="判断题"}return t}function l(e){var t=0,a=0,n=0;return t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=e-60*a-3600*t,{hour:t,minute:a,second:n}}function d(e){var t,a=[],n={0:"single",1:"multi",2:"bool"},i={0:"单选题",1:"多选题",2:"判断题"};return t=_.groupBy(e,function(e){return e.questionType}),_.each(t,function(e,t){var s=_.map(e,function(e){return{questionTitle:e.content,id:e.id,isAnswered:!1,optionList:_.map(e.examOptionVOs,function(e){return{optionContent:e.optionContent,id:e.id}})}});a.push({questionTypeTitle:i[t],questionType:n[t],questionList:s})}),a}function c(){t.c2s({url:g.isFinalExam?i.BASE_PATH+"train/exam/finalExamine.do":i.BASE_PATH+"train/exam/examine.do",data:{courseId:o.params.courseId,coursewareId:o.params.id,learningProgressId:o.params.learningProgressId},success:function(e){var a;e.flag&&(a=e.data,g.isFinalExam?g.navCrumbs.removeAt(1):g.navCrumbs.set(1,{text:a.paperName,href:"#/study/coursestudy/process/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+a.coursewareId}),g.originData=a.traExamDtlVOs,g.questionTypeList=d(a.traExamDtlVOs),g.duration=parseFloat(a.timeLimit,10),g.isFinalExam||t.c2s({url:i.BASE_PATH+"train/exam/startExam.do",type:"get",data:{examPaperId:a.id},contentType:"application/json"}))}})}var u=s+"-form",m=s+"-exam-complete",p=i.getAppData("user"),g=e.define(s,function(s){s.$skipArray=["tId","originData"],s.navCrumbs=[{text:"课程学习",href:"#/study/coursestudy"},{text:"",href:"#"},{text:"课后习题"}],s.isFinalExam="0"==o.params.id?!0:!1,s.isOldStaff="1"==p.isFormal,s.duration=0,s.leftHour=0,s.leftMinute=0,s.leftSecond=0,s.tId=0,s.originData=[],s.questionTypeList=[],s.$formOpts={formId:u,field:[{selector:".question-item",name:"answers",getValue:function(){var e=[],t=$(".question-option",n);return t.each(function(){var t,a=$(this),n=a.data("questionId"),i=a.val(),s=!1,o=_.find(e,function(e){return e.id==n});o?t=o.examOptionVOs||[]:(o={},t=[],s=!0),t.push({id:i/1,isSelected:a.prop("checked")?"1":"0"}),o.id=n/1,o.examOptionVOs=t,s&&e.push(o)}),e},rule:function(){var e=$(".progress-panel",n),a=$(".timer-panel",e),i=$(".question-state-panel",e),s=!0,o=!0;return $(".num",a).each(function(){return $(this).text()/1?(s=!1,!1):void 0}),$(".question-item",i).each(function(){return $(this).hasClass("is-answered")?void 0:(o=!1,!1)}),{handler:function(){s||o||t.alert({iconType:"error",content:"请检查答题板，完成未答的题"})},isPassed:s||o}}}],action:[{selector:".f-submit",handler:function(){var n,o,r=e.getVm(u),l=e.getVm(m);if(r.validate()){if(n=r.getFormData(),o=s.isFinalExam?i.BASE_PATH+"train/exam/saveFinalExam.do":i.BASE_PATH+"train/exam/saveExam.do",_.isEmpty(n))return void t.alert({iconType:"error",content:"没有任何试题作答"});t.c2s({url:o,type:"post",data:a.stringify(n.answers),contentType:"application/json",success:function(e){var t,a,n,i,s,o,r,d;e.flag&&(t=e.data,a=t.examResult,n=a.judgement,i=a.multiple,s=a.single,o=t.nextCourse,r=t.isFinalExamAvailable,d=t.courseId,l.detailList.clear(),s&&l.detailList.push({questionTypeName:"单选题",rightList:s.correct,wrongList:s.wrong,leftList:s.unanswered,score:s.score}),i&&l.detailList.push({questionTypeName:"多选题",rightList:i.correct,wrongList:i.wrong,leftList:i.unanswered,score:i.score}),n&&l.detailList.push({questionTypeName:"判断题",rightList:n.correct,wrongList:n.wrong,leftList:n.unanswered,score:n.score}),l.isPassed=t.passed,l.tipContent=t.passed?"恭喜您，亲~您取得了"+t.score+"分的好成绩，要继续保持哦~":"很抱歉，您的成绩只有"+t.score+"分，无法通过考试。<br/>小伙伴，继续加油吧！",l.nextCourse=o,l.isFinalExamAvailable=r,l.enterNextStudyText=r?"进入期末考试":"学习下一节课程",l.courseId=d,l.open())}})}}}]},s.$examCompleteTip={dialogId:m,title:"",showClose:!1,width:580,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="ui-dialog-btn" ms-if="!isFinalExam && !!nextCourse && !isOldStaff" ms-class-1="submit-btn: isPassed" ms-class-2="cancel-btn: !isPassed" ms-click="enterNextStudy">{{enterNextStudyText}}</button><span class="separation"></span><button type="button" class="submit-btn ui-dialog-btn" ms-click="returnCourseList">返回课程列表</button><span class="separation"></span><button type="button" class="submit-btn ui-dialog-btn" ms-click="reExam" ms-if="!(isFinalExam && isPassed)">重新考试</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},tipContent:"",detailList:[],isPassed:!1,questionList:[],nextCourse:null,isFinalExamAvailable:!1,enterNextStudyText:"学习下一节课程",courseId:0,clickNumField:function(){var a,n=e.getVm(m),i=$(this),o=$(".question-list-wrapper",i),l=this.$vmodel.$model;i.hasClass("right-num")?a=l.el.rightList:i.hasClass("wrong-num")?a=l.el.wrongList:i.hasClass("left-num")&&(a=l.el.leftList),n.questionList=_.map(a,function(e){var t=_.find(s.originData,function(t){return t.id==e});return{questionContent:t.content,questionTypeName:r(t.questionType)}}),o.length?o.show():(o=$('<div class="question-list-wrapper"></div>'),o.html('<ul class="question-list"><li class="question-item" ms-repeat="questionList">{{$index + 1}}、{{el.questionContent}}({{el.questionTypeName}})</li></ul>'),o.appendTo(i),e.scan(o[0],[n]),t.regGlobalMdExcept({element:o,handler:function(){o.hide()}}))},enterNextStudy:function(){var a=e.getVm(m);a.isPassed&&(a.isFinalExamAvailable?t.jumpPage("#/study/coursestudy/plainexam/"+o.params.learningProgressId+"/"+a.courseId+"/0"):a.nextCourse&&t.jumpPage("#/study/coursestudy/process/"+o.params.learningProgressId+"/"+a.nextCourse.courseId+"/"+a.nextCourse.coursewareId),a.close())},returnCourseList:function(){var a=e.getVm(m);t.jumpPage("#/study/coursestudy"),a.close()},reExam:function(){var t=(e.getVm(u),e.getVm(m));t.close();var a=o.params.id;e.router.navigate("/study/coursestudy/plainexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+a)},onClose:function(){var t=e.getVm(m);t.tipContent="",t.detailList.clear(),t.isPassed=!1,t.questionList.clear()}},s.$watch("duration",function(e){var t=Math.floor(60*e*60);clearInterval(s.tId),s.tId=setInterval(function(){var e;e=l(t),s.leftHour=e.hour,s.leftMinute=e.minute,s.leftSecond=e.second,0>=t?(clearInterval(s.tId),$(".f-submit",n).click()):t--},1e3)})});e.scan(n[0]),c(),n.on("change",".option-item input",function(){var e=$(this),t=e.closest(".option-list"),a=e.data("questionId"),n=!1,i=-1,s=-1;$("input",t).each(function(){return $(this).prop("checked")?(n=!0,!1):void 0}),_.some(g.questionTypeList.$model,function(e,t){return _.some(e.questionList,function(e,t){return e.id==a?(s=t,!0):void 0})?(i=t,!0):void 0}),s>-1&&g.questionTypeList[i].questionList.set(s,{isAnswered:n})})},$remove:function(t,a){var n=a+"-form",i=a+"-exam-complete";$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\study\coursestudy\practiceexam\practiceexam.js
define("originpagestudycoursestudypracticeexampracticeexamjs",["avalon","util","json"],function(e,t){var a=this,n=a.erp,i=n.page,s={};return _.extend(s,{$init:function(a,s,o){function r(){t.c2s({url:n.BASE_PATH+"train/exam/examine.do",data:{courseId:o.params.courseId,coursewareId:o.params.id,learningProgressId:o.params.learningProgressId},success:function(e){var t;e.flag&&(t=e.data,d.navCrumbs.set(1,{text:t.paperName,href:"#/study/coursestudy/process/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+t.coursewareId}),d.questionList=_.map(t.traExamDtlVOs,function(e,t){return 0===t&&(d.firstExamPath=e.url),{id:e.id,content:e.content,url:e.url,isPassed:!1}}),d.duration=(60*parseFloat(t.timeLimit,10)).toFixed(0),d.leftTime=Math.ceil(60*parseFloat(t.timeLimit,10)*60),d.originLeftTime=d.leftTime,d.examPaperId=t.id)}})}function l(){d.questionList.clear(),d.duration="",d.leftTime=0}var d=e.define(s,function(e){e.$skipArray=["firstExamPath"],e.navCrumbs=[{text:"课程学习",href:"#/study/coursestudy"},{text:"",href:"#"},{text:"课后习题"}],e.duration="",e.leftTime=0,e.originLeftTime=0,e.questionList=[],e.firstExamPath="",e.learningProgressId=o.params.learningProgressId,e.courseId=o.params.courseId,e.coursewareId=o.params.id,e.examPaperId=0,e.jumpFirstExam=function(){t.jumpPage("#/study/coursestudy/practiceexam"+e.firstExamPath)}});e.scan(a[0]),r(),i.pageEvent.on("switched",function(e,t){t===s&&(l(),r())})},$remove:function(){}}),s});

//From origin\page\study\coursestudy\practiceexam\softpos\createintegralcard\createintegralcard.js
define("originpagestudycoursestudypracticeexamsoftposcreateintegralcardcreateintegralcardjs",["avalon","util","moment","json","originmodulepracticehelperpracticehelperjs"],function(e,t,a){var n,i,s=this,o=s.erp,r=(o.page,{});return _.extend(r,{$init:function(t,o){var r=o+"-exam-board",l=($(".practice-exam-softpos",t),$(".dialog-overlay",t)),d=$(".portal-section",t),c=$(".card-active-tip",t),u=$(".card-active-section",t),m=$(".main-section",t),p=$(".group-consume-box",m),g=$(".action-btn-box",m),f=$(".consume-confirm",t),v=$(".print",t),h=e.define(o,function(t){t.$examBoardOpts={practicehelperId:r,examPath:"/softpos/createintegralcard"},t.cardNo="",t.result0=null,t.step0=function(e){var a=null;("click"==e.type||"keydown"==e.type&&13==e.keyCode)&&(-1!==_.str.trim(t.cardNo).search("6201200261500028")?(a=!0,c.show(),l.show()):a=!1,t.result0=a,e.stopPropagation(),this.blur())},t.result1=null,t.step1=function(){var e=null,a=_.str.trim($(".mobile",u).val()),n=_.str.trim($(".user-name",u).val()),i=$(".sex",u).val(),s=$(".birthday-year",u).val()+"-"+$(".birthday-month",u).val()+"-"+$(".birthday-day",u).val();e="18500068578"===a&&"小雅"===n&&"2"==i&&"1990-10-1"===s?!0:!1,t.result1=e,a?($(".mobile-field-tip",u).hide(),m.show(),u.hide(),$(".total-amount",m)[0].select()):$(".mobile-field-tip",u).show()},t.result2=null,t.step2=function(){var e=null,a=_.str.trim($(".cash-amount",p).val());e="300"===a?!0:!1,t.result2=e,$(".cash-value",f).text(a),f.show(),l.show()},t.validate=function(){e.getVm(r).next(t)},t.resetCardActive=function(){$(".mobile",u).val(""),$(".user-name",u).val(""),$(".sex",u).val("1"),$(".birthday-year",u).val(""),$(".birthday-month",u).val(""),$(".birthday-day",u).val(""),$(".mobile-field-tip",u).hide()},t.enterCardActive=function(){t.resetCardActive(),u.show(),d.hide(),c.hide(),l.hide()},t.cancelCardActive=function(){c.hide(),l.hide(),$(".card-input",d)[0].focus()},t.leaveCardActive=function(){var e=$(".card-input",d);d.show(),u.hide(),e.val(""),e[0].focus()},t.enterPrint=function(){$(".cash-value",v).text(_.str.trim($(".cash-amount",p).val())),v.show(),f.hide(),l.show()},t.leaveMain=function(){var e=$(".card-input",d);d.show(),m.hide(),e.val(""),e[0].focus()},t.cancelConsumeConfirm=function(){f.hide(),l.hide()},t.reEnterPortal=function(){var e=$(".card-input",d);v.hide(),l.hide(),d.show(),m.hide(),e.val(""),e[0].focus(),t.validate()}});e.scan(t[0]),setTimeout(function(){$(".card-input",d)[0].focus()},600),e.getVm(r).startCountdown(),function(){var e=$(".birthday-wrapper",u),n=$(".birthday-year",e),i=$(".birthday-month",e),s=$(".birthday-day",e),o=(new Date).getFullYear(),r=(new Date).getMonth()+1,l="";_.each(_.range(0,100),function(e){var t=o-e;l+='<option value="'+t+'">'+t+"年</option>"}),t.on("change",".birthday-year",function(){var e="",t=n.val(),a=t==o?(new Date).getMonth()+2:13;"0"==t?i.html('<option value="0"></option>'):(_.each(_.range(1,a),function(t){e+='<option value="'+t+'">'+t+"月</option>"}),i.html('<option value="0"></option>'+e).change())}).on("change",".birthday-month",function(){var e="",t=n.val(),l=i.val(),d=t==o&&l==r?(new Date).getDate():a(t+"-"+l,"YYYY-M").endOf("month").date();"0"==t||"0"==l?s.html('<option value="0"></option>'):(_.each(_.range(1,d+1),function(t){e+='<option value="'+t+'">'+t+"日</option>"}),s.html('<option value="0"></option>'+e))}).on("keyup",".mobile",function(){var e=$(this),t=_.str.trim(e.val());""!==t?isNaN(t)?e.val(e.data("oldValue")||""):(e.val(t),e.data("oldValue",t)):(t=parseInt(_.str.trim(e.val()),10),e.val(0),e.data("oldValue",""))}),$(".birthday-year",e).html('<option value="0"></option>'+l)}(),i=function(){g.css({top:$(s).height()-180+$(s).scrollTop()-44})},t.on("keyup",".group-consume-box .total-amount, .group-consume-box .cash-amount",function(){var e=$(this),t=_.str.trim(e.val());""!==t?isNaN(t)?e.val(e.data("oldValue")||""):(e.val(t),e.data("oldValue",t)):(t=parseFloat(_.str.trim(e.val()),10),e.val(0),e.data("oldValue",""))}).on("keyup",".group-consume-box .total-amount",function(){var e=$(this),t=parseFloat(_.str.trim(e.val()),10);isNaN(t)||$(".cash-amount",p).val(t)}),n=function(e){13==e.keyCode?c.is(":visible")&&h.enterCardActive():27==e.keyCode&&c.is(":visible")&&h.cancelCardActive()},$(document).on("keydown",n),$(s).on("scroll resize",i),i()},$remove:function(t,a){var o=a+"-exam-board";$(e.getVm(o).widgetElement).remove(),$(document).off("keydown",n),n=null,$(s).off("scroll resize",i),i=null}}),r});

//From origin\page\study\coursestudy\process\process.js
define("originpagestudycoursestudyprocessprocessjs",["avalon","util","json","moment","originwidgetmediaplayerjs","dialog"],function(e,t,a,n){var i=this,s=i.erp,o={};return _.extend(o,{$init:function(a,i,o){function r(){t.c2s({url:s.BASE_PATH+"train/student/study.do",data:{isOldStaff:c.isFormal,courseId:o.params.courseId,coursewareId:o.params.id,learningProgressId:0==o.params.learningProgressId?"":o.params.learningProgressId},success:function(e){var t,a,i,s,o,r;e.flag&&(t=e.data,a=t.attachmentVO,i=t.studyStudentRecords,s=t.examStudentRecords,o=a.smvpAttachData,r=o.entries[0].renditions,u.examEnable=!("1"==c.isFormal&&"0"==t.isTest),u.navCrumbs.set(1,{text:t.coursewareName}),u.coursewareName=t.coursewareName,u.coursewareSummary="主讲人："+t.speaker+"&nbsp;&nbsp;&nbsp;&nbsp;时长："+t.courseHours,m.load([{file:r[0].urls.smf.url.slice(0,-20)+".mp4"}]),u.studyHistoryList=_.map(i,function(e){return{historyTime:n(e.beginTime).format("MM月DD日 HH:mm")}}),u.examHistoryList=_.map(s,function(e){return{historyTime:n(e.beginTime).format("MM月DD日 HH:mm"),examScore:e.score,isPassed:!0}}),u.isExist=!0,u.studied=t.studied,u.paperType=t.paperType)}})}var l=i+"-player",d=i+"-dialog",c=s.getAppData("user"),u=e.define(i,function(a){a.navCrumbs=[{text:"课程学习",href:"#/study/coursestudy"},{text:""}],a.examEnable=!0,a.isExist=!0,a.paperType="0",a.coursewareName="",a.coursewareSummary="",a.studyHistoryList=[],a.examHistoryList=[],a.studied=!1,a.$coursewareOpts={playerId:l,jwplayerOptions:{width:798,height:558,image:s.ASSET_PATH+"image/media-bg.png"}},a.$completedOpts={dialogId:d,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-if="examEnable" ms-click="enterExam">开始考试</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="replay">重新播放</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},enterExam:function(){"0"==a.paperType?t.jumpPage("#/study/coursestudy/plainexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+o.params.id):"1"==a.paperType?t.jumpPage("#/study/coursestudy/recordexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+o.params.id):"2"==a.paperType&&t.jumpPage("#/study/coursestudy/practiceexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+o.params.id),e.getVm(d).close()},replay:function(){m.play(!0),e.getVm(d).close()}},a.enterExam=function(){"0"==a.paperType?t.jumpPage("#/study/coursestudy/plainexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+o.params.id):"1"==a.paperType?t.jumpPage("#/study/coursestudy/recordexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+o.params.id):"2"==a.paperType&&t.jumpPage("#/study/coursestudy/practiceexam/"+o.params.learningProgressId+"/"+o.params.courseId+"/"+o.params.id)},a.enterStudyPage=function(){t.jumpPage("#/study/coursestudy")},a.enterHistoryPage=function(){t.jumpPage("#/study/history")}});e.scan(a[0]);var m=e.getVm(l).playerCore,p=!1,g=!0;m.onSeek(function(e){var t=e.position,a=e.offset;p||u.studied?p=!1:setTimeout(function(){a>t&&(p=!0,m.seek(t))},10)}),m.onPlay(function(e){"BUFFERING"==e.oldstate&&g&&(t.c2s({url:s.BASE_PATH+"train/student/startStudy.do",data:{isOldStaff:c.isFormal,courseId:o.params.courseId,coursewareId:o.params.id,learningProgressId:0==o.params.learningProgressId?"":o.params.learningProgressId},success:function(e){e.flag}}),g=!1)}),m.onComplete(function(){t.c2s({url:s.BASE_PATH+"train/student/completeStudy.do",data:{isOldStaff:c.isFormal,courseId:o.params.courseId,coursewareId:o.params.id,learningProgressId:0==o.params.learningProgressId?"":o.params.learningProgressId},success:function(t){if(t.flag){var a=e.getVm(d);u.studied=!0,a.open()}}}),g=!0}),r()},$remove:function(t,a){var n=a+"-player",i=a+"-dialog",s=e.getVm(n);$(e.getVm(i).widgetElement).remove(),s&&$(s.widgetElement).remove()}}),o});

//From origin\page\study\coursestudy\recordexam\recordexam.js
define("originpagestudycoursestudyrecordexamrecordexamjs",["avalon","util","json","originmodulepptplayerpptplayerjs","originwidgetformformjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,s){function o(){t.c2s({url:n.BASE_PATH+"train/exam/pptExam.do",data:{courseId:s.params.courseId,coursewareId:s.params.id,learningProgressId:s.params.learningProgressId},success:function(t){var a,i,o,u,m,p=[];t.flag&&(i=e.getVm(r),a=t.data,o=a.ppt,m=o.pptDtlVOs,u=a.exampaper,c.navCrumbs.set(1,{text:o.pptName,href:"#/study/coursestudy/process/"+s.params.learningProgressId+"/"+s.params.courseId+"/"+o.coursewareId}),i.pptList=_.map(m,function(e){return{imagePath:n.BASE_PATH+e.uri}}),i.currentPath=i.pptList[0].imagePath,l&&l.RecordOpen&&(p[0]=u.id,p[1]=o.id,p[2]=u.timeLimit/1,p[3]=d.sessionId,l.RecordOpen(p.join(","))))}})}var r=i+"-ppt",l=document.getElementById("softPos"),d=n.getAppData("user"),c=e.define(i,function(e){e.navCrumbs=[{text:"课程学习",href:"#/study/coursestudy"},{text:"",href:"#"},{text:"课后习题"}],e.$pptplayerOpts={pptplayerId:r}});e.scan(a[0]),o()},$remove:function(t,a){var n=a+"-ppt",i=document.getElementById("softPos");$(e.getVm(n).widgetElement).remove(),i&&i.RecordClose&&i.RecordClose()}}),i});

//From origin\page\study\coursewaremanage\courseware-add-edit.js
define("originpagestudycoursewaremanagecoursewareaddeditjs",["avalon","util","json","originwidgetformformjs","dialog","originwidgetuploaderuploaderjs"],function(e,t,a){var n=this,i=n.erp,s={};return _.extend(s,{$init:function(n,s,o){function r(){t.c2s({url:i.BASE_PATH+"courseware/getCoursewareInfoByCoursewareId.do",type:"post",contentType:"application/json",data:a.stringify({coursewareId:o.params.id/1}),success:function(a){var n,i=e.getVm(d);a.flag&&(n=a.data,m.coursewareName=n.courseware_name,m.speaker=n.speaker,m.attachName=n.remark,m.timeLimit=n.time_limit,m.hours=n.hours,m.belongToCourseList=_.map(n.courseInfo,function(e){return{courseName:e.course_name}}),i.uploadList.push({id:t.generateID(),name:n.attachment_name}))}})}var l=s+"-form",d=s+"-uploader",c=i.getAppData("user"),u=c.smvp,m=e.define(s,function(n){n.state=s.split("-").pop(),n.navCrumbs=[{text:"课件管理",href:"#/study/coursewaremanage"},{text:"add"===n.state?"添加课件":"修改课件"}],n.belongToCourseList=[],n.coursewareName="",n.speaker="",n.timeLimit="",n.attachName="",n.videoId="",n.hours="",n.$uploaderOpts={uploaderId:d,clickRemoveBtn:function(){var t=e.getVm(d),a=this.$vmodel.$model;t.removeFile(a.el.id)},defaultExtKeyData:{},uploadifyOpts:{swf:"http://static.smvp.cn/flash/uploadify.swf",uploader:"http://api.alpha.smvp.cn/entries/upload",formData:{token:u.token,entry:a.stringify({category:_.find(u.category,function(e){return"课件"===e.name}).id,activated:!0})},fileObjName:"myfiles",multi:!1,fileTypeDesc:"视频文件(*.mp4)",fileTypeExts:"*.mp4",fileSizeLimit:"1024MB",width:116,height:30,onSelect:function(){var t=e.getVm(d);t.uploadList.size()>1&&t.removeFile(t.uploadList[0].id)}},onSuccessResponseData:function(e){var t=a.parse(e);n.videoId=t.id,n.attachName=t.title}},n.$formOpts={formId:l,field:[{selector:".courseware-name",name:"coursewareName",rule:["noempty",function(e,t){return t[0]!==!0?"课件名称不能为空":!0}]},{selector:".speaker",name:"speaker",rule:["noempty",function(e,t){return t[0]!==!0?"主讲人不能为空":!0}]},{selector:".video-uploader",name:"videoId",getValue:function(){return n.videoId},reset:function(){var t=e.getVm(d);"add"==n.state&&t.removeAllFile()},rule:function(){var t=e.getVm(d),a=t.uploadList;return a.size()?!0:"上传视频不能为空"}},{selector:".time-limit",name:"timeLimit",rule:["noempty",function(e,t){return t[0]!==!0?"学习时限不能为空":/^-?\d+(\.\d{1,1})?$/.test(e)?parseFloat(e,10)<=0||"00"===e.slice(0,2)?"请输入有效地时间值":!0:"请输入有效的学习时限"}]},{selector:".hours",name:"hours",rule:["noempty",function(e,t){return t[0]!==!0?"规定时长不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的规定时长":!0:"请输入有效的规定时长"}]}],action:[{selector:".f-submit",handler:function(){var s,r,c,u=e.getVm(l),m=e.getVm(d);u.validate()&&(r=function(){s=u.getFormData(),"edit"==n.state?(_.extend(s,{coursewareId:o.params.id/1}),c=i.BASE_PATH+"courseware/updateCourseware.do"):c=i.BASE_PATH+"courseware/saveCourseware.do",s.originalFileName=n.attachName,t.c2s({url:c,type:"post",contentType:"application/json",data:a.stringify(s),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){window.location.href=i.BASE_PATH+"#!/study/coursewaremanage"}})}})},m.uploading?(t.showGlobalMask(),m.$unwatch("uploading"),m.$watch("uploading",function(e){e||(t.hideGlobalMask(),r(),m.$unwatch("uploading"))})):r())}}]}});e.scan(n[0]),"edit"==m.state&&r()},$remove:function(t,a){var n=a+"-form",i=a+"-uploader";$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\study\coursewaremanage\coursewaremanage.js
define("originpagestudycoursewaremanagecoursewaremanagejs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetformselectjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function s(a){var i=e.getVm(o),s={courseName:l.courseName,coursewareName:l.coursewareName};a?(s.pageSize=i.perPages,s.pageNumber=1):(s.pageSize=i.perPages,s.pageNumber=i.currentPage),t.c2s({url:n.BASE_PATH+"courseware/getCoursewareInfo.do",data:s,success:function(e){var t;e.flag&&(t=e.data,i.total=t.totalSize,a&&(i.currentPage=1),l.gridData=t.rows,l.gridTotalSize=t.totalSize,l.gridAllChecked=!1,l.gridSelected.clear())}})}var o=i+"-pagination",r=i+"-course-list-tip",l=e.define(i,function(e){e.permission={magCourseware:t.hasPermission("mag_course_ware"),paperRule:t.hasPermission("paper_rule"),magQuestion:t.hasPermission("mag_question")},e.courseName="",e.coursewareName="",e.gridTotalSize=0,e.gridData=[],e.gridAllChecked=!1,e.gridSelected=[],e.gridCheckAll=function(){this.checked?e.gridSelected=_.map(e.gridData.$model,function(e){return e.id}):e.gridSelected.clear()},e.scCheckAll=function(){e.gridSelected=_.map(e.gridData.$model,function(e){return e.id})},e.$paginationOpts={paginationId:o,total:0,onJump:function(){s()}},e.search=function(){s(!0)},e.jumpAddQuestionPage=function(){var e=$('<a href="#/study/questionmanage/add"></a>');e.appendTo("body"),e[0].click(),e.remove()},e.jumpQueryQuestionPage=function(){var e=$('<a href="#/study/questionmanage"></a>');e.appendTo("body"),e[0].click(),e.remove()},e.jumpAddPage=function(){var e=$('<a href="#/study/coursewaremanage/add"></a>');e.appendTo("body"),e[0].click(),e.remove()},e.removeGridItem=function(){var t=$(this),a=t.data("id")+"";e.gridSelected=[a],e._removeCourseware()},e.batchRemoveGridItem=function(){e._removeCourseware()},e._removeCourseware=function(){var a,i,o;0===e.gridSelected.size()?t.alert({content:"请先选中课件"}):(a=e.gridSelected.$model,o=n.BASE_PATH+"courseware/deleteCourseware.do",i={idString:a},t.confirm({content:"确定要删除选中的课件吗？",onSubmit:function(){t.c2s({url:o,type:"post",data:JSON.stringify(i),contentType:"application/json",success:function(e){1==e.flag&&s(!0)}})}}))}});l.gridSelected.$watch("length",function(e){l.gridAllChecked=e===l.gridData.size()}),e.scan(a[0],[l]),s(),a.on("mouseenter",".course-count",function(){var a=$(this),i=e(this).data("index"),s=$("#"+r),o=a.offset(),d=l.gridData[i],c=d.coursecount,u=a.data("courseList"),m=function(e){var t="";_.each(e,function(e){t+='<li class="course-item">'+e+"</li>"}),s.html(t).css({top:o.top,left:o.left+a.width()}).show()};s.length||(s=$('<ul id="'+r+'"></ul>'),s.appendTo("body")),c>0&&(u?m(u):t.c2s({url:n.BASE_PATH+"courseware/getCourseByCoursewareId.do",type:"post",data:{coursewareId:d.id},success:function(e){var t,n;1==e.flag&&(t=e.data,n=_.map(t,function(e){return e.course_name}),m(n),a.data("courseList",n))}},{mask:!1,withData:!1,ajaxType:"abort"}))}).on("mouseleave",".course-count",function(){$("#"+r).hide()})},$remove:function(t,a){var n=a+"-pagination",i=a+"-course-list-tip";$(e.getVm(n).widgetElement).remove(),$("#"+i).remove()}}),i});

//From origin\page\study\coursewaremanage\examrule\examrule.js
define("originpagestudycoursewaremanageexamruleexamrulejs",["avalon","util","json","originwidgetformformjs","dialog","originwidgetuploaderuploaderjs","originwidgetformselectjs","originmoduleqselectorqselectorjs","originmodulepptselectorpptselectorjs"],function(e,t,a){var n=this,i=n.erp,s={};return _.extend(s,{$init:function(n,s,o){function r(){t.c2s({url:i.BASE_PATH+"rule/getRuleByCoursewareId.do",data:a.stringify({coursewareId:g}),contentType:"application/json",success:function(t){var a,n=e.getVm(c);t.flag&&(a=t.data,v.paperType=l(a.paper_type),v.isTest=a.is_test,v.passingScore=a.passing_score||"",v.timeLimit=a.time_limit||"",v.ruleId=a.id||0,v.total=a.total||"","write"===v.paperType?n.listPath="rule/getQuestionByCoursewareId.do":"practice"===v.paperType&&(n.listPath="rule/getPracticeQuestionByCoursewareId.do"),"1"==a.paper_type?("1"==a.rule_type&&a.requiredQuestions.length&&(v.selectedPptId=a.requiredQuestions[0].question_id,v.selectedPptName=a.requiredQuestions[0].question+"&nbsp;"),e.getVm(m).select(a.rule_type/1)):(v.selectedWriteList=_.map(a.requiredQuestions,function(e){return{id:e.question_id,question:e.question,questionType:e.question_type,pptName:e.ppt_name}}),e.getVm(p).select((a.rule_type||0)/1)))}})}function l(e){var t;switch(e){case"0":t="write";break;case"1":t="ppt";break;case"2":t="practice";break;default:t=""}return t}var d=s+"-form",c=s+"-qselector",u=s+"-pptselector",m=s+"-ppt-range",p=s+"-write-range",g=o.params.id/1,f=decodeURIComponent(o.params.coursewareName),v=e.define(s,function(n){n.state=s.split("-").pop(),n.navCrumbs=[{text:"课件管理",href:"#/study/coursewaremanage"},{text:f,href:"#/study/coursewaremanage"},{text:"考卷规则"}],n.paperType="write",n.isTest="0",n.total="",n.timeLimit="",n.pptTimeLimit="",n.passingScore="",n.ruleId=0,n.selectedWriteList=[],n.examRange="all",n.selectedPptName="",n.selectedPptId=0,n.$writeRangeOpts={selectId:p,options:[{text:"全部随机",value:"0"},{text:"部分随机",value:"1"}],onSelect:function(e){n.examRange="0"==e?"all":"part"}},n.$pptRangeOpts={selectId:m,options:[{text:"随机PPT",value:"0"},{text:"指定PPT",value:"1"}],onSelect:function(e){n.examRange="0"==e?"all":"part"}},n.$qselectorOpts={qselectorId:c,multi:!0,onListRequestData:function(e){return e.coursewareId=g,e},onListReady:function(e){_.each(n.selectedWriteList.$model,function(t){var a=-1;_.some(e.$model,function(e,n){return e.id==t.id?(a=n,!0):void 0})&&e.set(a,{isSelected:!0})})},onSubmit:function(e){e.length?n.selectedWriteList=_.map(e,function(e){return{id:e.id,question:e.question,questionType:e.questionType}}):t.alert({iconType:"error",content:"请选择至少一个试题"})}},n.$pptselectorOpts={pptselectorId:u,onListRequestData:function(e){return e.coursewareId=g,e},onListReady:function(e){var t=-1;_.some(e.$model,function(e,a){return e.id==n.selectedPptId?(t=a,!0):void 0})&&e.set(t,{isSelected:!0})},onSubmit:function(e){e.length?(n.selectedPptName=e[0].pptName+"&nbsp;",n.selectedPptId=e[0].id):t.alert({iconType:"error",content:"请选择一个PPT"})}},n.openQuestionSelector=function(){var t=e.getVm(c);t.title="选择必考题",t.open()},n.openPptSelector=function(){var t=e.getVm(u);t.title="选择PPT",t.open()},n.switchPaperType=function(){var t=e(this),a=t.data("name"),i=e.getVm(p),s=e.getVm(m),o=e.getVm(c);n.paperType=a,n.selectedWriteList.clear(),n.selectedPptId=0,n.selectedPptName="",n.examRange="all",i&&i.select(0),s&&s.select(0),"write"===a?o.listPath="rule/getQuestionByCoursewareId.do":"practice"===a&&(o.listPath="rule/getPracticeQuestionByCoursewareId.do")},n.removeWriteItem=function(){var e=this.$vmodel.$model;n.selectedWriteList.removeAt(e.$index)},n.$formOpts={formId:d,field:[{selector:".paper-type",name:"paperType",getValue:function(){return $(this).filter(".mn-radio-state-selected").data("name")}},{selector:".for-old-staff",name:"isTest"},{selector:".time-limit",name:"timeLimit",rule:["noempty",function(e,t){return t[0]!==!0?"考试时限不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的考试时限":!0:"请输入有效的考试时限"}]},{selector:".total",name:"total",rule:["noempty",function(e,t){return t[0]!==!0?"考题数量不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的考题数量":!0:"请输入有效的考题数量"}]},{selector:".passing-score",name:"passingScore",rule:["noempty",function(e,t){return t[0]!==!0?"及格分数线不能为空":/^\d{1,6}$/.test(e)?0===parseFloat(e,10)||"00"===e.slice(0,2)?"请输入有效的及格分数":!0:"请输入有效的及格分数"}]}],action:[{selector:".f-submit",handler:function(){var n,s=e.getVm(d),o=e.getVm("write"==v.paperType||"practice"==v.paperType?p:m),r=[];if(s.validate()){if(n=s.getFormData(),_.extend(n,{id:v.ruleId,coursewareId:g,ruleType:o.selectedValue}),"part"==v.examRange)if("write"==v.paperType||"practice"==v.paperType){if(r=_.map(v.selectedWriteList.$model,function(e){return e.id}),!r.length)return void t.alert({iconType:"error",content:"请指定有效的考题范围"});if(r.length>n.total/1)return void t.alert({iconType:"error",content:"必考题数量不能大于增加考题数量"})}else if(r.push(v.selectedPptId),!v.selectedPptId)return void t.alert({iconType:"error",content:"请选择一个ppt考题"});n.questionIdList=r,t.c2s({url:i.BASE_PATH+"rule/addRule.do",type:"post",contentType:"application/json",data:a.stringify(n),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){t.jumpPage("#/study/coursewaremanage")}})}})}}}]}});r(),e.scan(n[0],[v])},$remove:function(t,a){var n=a+"-form",i=a+"-qselector",s=a+"-pptselector",o=a+"-ppt-range",r=a+"-write-range",l=e.getVm(o),d=e.getVm(s),c=e.getVm(i),u=e.getVm(r);u&&$(u.widgetElement).remove(),l&&$(l.widgetElement).remove(),d&&$(d.widgetElement).remove(),c&&$(c.widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\study\history\audition\audition.js
define("originpagestudyhistoryauditionauditionjs",["avalon","util","json","originmodulepptplayerpptplayerjs","originwidgetmediaplayerjs","originwidgetformformjs"],function(e,t,a){var n=this,i=n.erp,s={};return _.extend(s,{$init:function(s,o,r){function l(){t.c2s({url:i.BASE_PATH+"studentManagement/queryPptExamInfo.do",data:a.stringify({paperId:r.params.id/1}),contentType:"application/json",success:function(t){var a,s,o,l,c,u;t.flag&&(s=e.getVm(d),a=t.data,o=a.audioInfo,l=a.studentInfo,c=a.ppt,u=a.traExamPaper,p.navCrumbs.set(1,{text:c.ppt_name}),s.pptList=_.map(a.pptDtlList,function(e){return{imagePath:i.BASE_PATH+a.pptPhotoPath+"/"+c.ppt_path+"/"+e.ppt_dtl_name}}),s.currentPath=s.pptList[0].imagePath,g.load([{file:i.BASE_PATH+a.audioPath+"/"+o.attachment_path+"/"+o.attachment_name}]),p.studentName=l.userName,p.studentId=l.id,p.pptName=c.ppt_name,p.auditionSummary=c.ppt_name,"1"==u.examPaperType&&u.comment&&(p.teacherComment=u.comment),r.params.action&&"comment"==r.params.action&&$(n).scrollTop(1e4))}})}var d=o+"-ppt",c=o+"-audio",u=o+"-play-over-dialog",m=o+"do-score-form_",p=e.define(o,function(a){a.navCrumbs=[{text:"历史回顾",href:"#/study/history"},{text:""}],a.studentName="",a.studentId=0,a.pptName="",a.auditionSummary="",a.teacherComment="",a.$pptOpts={pptplayerId:d},a.$audioOpts={playerId:c,jwplayerOptions:{width:800,height:30}},a.$playOverDialogOpts={dialogId:u,title:"提示",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">返回历史回顾</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="replay">重新播放</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){var t=e.getVm(m);t&&t.reset()},submit:function(){var a=e.getVm(u);a.close(),t.jumpPage("#/study/history")},replay:function(){var t=e.getVm(u);t.close(),g.play(!0)}}});e.scan(s[0]),l();var g=e.getVm(c).playerCore;g.onComplete(function(){var t=e.getVm(u);t.open()})},$remove:function(t,a){var n=a+"-ppt",i=a+"-audio",s=a+"-do-score-dialog",o=a+"-play-over-dialog",r=a+"do-score-form",l=a+"do-score-form_",d=e.getVm(r),c=e.getVm(l),u=e.getVm(s),m=e.getVm(o);$(e.getVm(n).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),d&&$(d.widgetElement).remove(),c&&$(c.widgetElement).remove(),u&&$(u.widgetElement).remove(),m&&$(m.widgetElement).remove()}}),s});

//From origin\page\study\history\history.js
define("originpagestudyhistoryhistoryjs",["avalon","util","json","moment"],function(e,t,a,n){var i,s=this,o=s.erp,r={},l=o.getAppData("user");return _.extend(r,{$init:function(r,d,c){function u(){t.c2s({url:o.BASE_PATH+"studentManagement/queryTraStudentRecordByStudentId.do",contentType:"application/json",data:a.stringify({studentId:c.params.id?c.params.id/1:l.id,pageSize:p.pageSize,pageNumber:p.pageNumber}),success:function(e){e.flag&&(p.originData=p.originData.concat(e.data.rows),p.lineList=m(p.originData),p.totalSize=e.data.totalSize,p.pageNumber=p.pageNumber+1,p.totalSize<=p.pageSize&&(p.isComplete=!0),0===e.data.totalSize&&t.alert({iconType:"info",content:"您还未产生历史回顾"}))}})}function m(e){var t,a=[];return t=_.groupBy(e,function(e){return n(e.begin_time).format("YYYY-MM-DD")}),_.each(t,function(e,t){var i=n().format("YYYY-MM-DD"),s=n().subtract("days",1).format("YYYY-MM-DD"),o=!1,r=!1,l=t.split("-").slice(1).join(".");t==i&&(l="今天",o=!0),t==s&&(l="昨天",r=!0),a.push({dateIndex:l,isToday:o,isYestoday:r,detailList:_.map(e,function(e){var t="",a="";return"0"==e.operating_type?t='<a href="#/study/coursestudy/process/'+e.learning_progress_id+"/"+e.course_id+"/"+e.courseware_id+'">复习课程</a>':"1"==e.operating_type&&("1"==e.exam_paper_type?(t='<a href="#/study/history/audition/'+e.paper_id+'">试听录音</a>',a="#/study/coursestudy/recordexam/"+e.learning_progress_id+"/"+e.course_id+"/"+e.courseware_id):"0"==e.exam_paper_type?a="#/study/coursestudy/plainexam/"+e.learning_progress_id+"/"+e.course_id+"/"+e.courseware_id:"5"==e.exam_paper_type&&(a="#/study/coursestudy/plainexam/"+e.learning_progress_id+"/"+e.course_id+"/0"),"1"==e.exam_paper_type&&"3"==e.paper_status&&e.paper_comment&&(t+='&nbsp;&nbsp;&nbsp;&nbsp;<a href="#/study/history/audition/'+e.paper_id+'/comment">查看评语</a>'),("4"==e.paper_status&&"5"==e.exam_paper_type||"5"!=e.exam_paper_type)&&(t+='&nbsp;&nbsp;&nbsp;&nbsp;<a href="'+a+'">重新考试</a>')),e.learning_progress_id||(t=""),{timeIndex:n(e.begin_time).format("HH:mm"),content:e.description,action:t}})})}),a}var p=e.define(d,function(e){e.$skipArray=["originData"],e.lineList=[],e.originData=[],e.totalSize=0,e.pageSize=13,e.pageNumber=1,e.isComplete=!1});e.scan(r[0]),u(),i=function(){$("body").height()-$(s).scrollTop()-$(s).height()<=10&&((p.pageNumber-1)*p.pageSize<p.totalSize?u():(p.isComplete=!0,$(s).unbind("scroll",i)))},$(s).scroll(i)},$remove:function(){$(s).unbind("scroll",i),i=null}}),r});

//From origin\page\study\membermanage\membermanage.js
define("originpagestudymembermanagemembermanagejs",["avalon","util","json","originwidgetgridgridjs"],function(e,t,a){var n=this,i=n.erp,s={};return _.extend(s,{$init:function(n,s){var o=s+"-grid",r=i.getAppData("user"),l=e.define(s,function(n){n.keyword="",n.$gridOpts={gridId:o,recordUnit:"个人",disableCheckAll:!0,disableCheckbox:!0,columns:[{dataIndex:"user_name",text:"姓名"},{dataIndex:"tel",text:"手机号"},{dataIndex:"group_name",text:"部门"},{dataIndex:"position_name",text:"职位"},{dataIndex:"coursewareCount",text:"正在学习的课件"},{dataIndex:"operation",text:"操作",html:!0,renderer:function(e,t){return'<a ms-href="#/study/membermanage/viewstudy/{{$outer.el.id}}">查看学习情况</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="#/study/membermanage/history/'+t.id+'">查看历史</a></td>'}}],onLoad:function(e,s){_.extend(e,{subUserName:_.str.trim(n.keyword),baseUserId:+r.id}),t.c2s({type:"post",url:i.BASE_PATH+"teamMember/queryMemberList.do",data:a.stringify(e),contentType:"application/json",dataType:"json",success:function(e){var t;e.flag&&(t=e.data,s.call(this,t))}})}},n.query=function(){e.getVm(o).load()}});e.scan(n[0],[l]),e.getVm(o).load()},$remove:function(t,a){var n=a+"-grid";$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\study\membermanage\viewstudy\viewstudy.js
define("originpagestudymembermanageviewstudyviewstudyjs",["avalon","util","json","moment"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(s,r,l){function d(){t.c2s({type:"post",url:o.BASE_PATH+"teamMember/queryLearningProcessList.do",data:a.stringify({pageSize:m.pageSize,pageNumber:m.pageNumber,studentId:+u}),contentType:"application/json",dataType:"json",success:function(e){var a;e.flag&&(a=e.data.user,m.totalSize=e.data.totalSize,m.userName=a.user_name,m.tel=a.tel,m.group=a.group_name,m.position=a.position_name,m.pageNumber=m.pageNumber+1,m.rowsData=m.rowsData.concat(_.each(e.data.rows,function(e){e.begin_time=e.begin_time?n(e.begin_time).format("YYYY-MM-DD HH:mm")+" 开始学习":"还没有开始学习"})),m.totalSize<=m.pageSize&&(m.isComplete=!0),0===e.data.totalSize&&t.alert({iconType:"info",content:"您还未学习"}))}})}var c,u=l.params.id,m=e.define(r,function(e){e.userName="",e.tel="",e.group="",e.position="",e.rowsData=[],e.totalSize=0,e.pageSize=13,e.pageNumber=1,e.isComplete=!1});e.scan(s[0],[m]),c=function(){$("body").height()-$(i).scrollTop()-$(i).height()<=10&&((m.pageNumber-1)*m.pageSize<m.totalSize?d():(m.isComplete=!0,$(i).unbind("scroll",c)))},$(i).scroll(c),d()},$remove:function(){}}),s});

//From origin\page\study\questionmanage\question-add-edit.js
define("originpagestudyquestionmanagequestionaddeditjs",["avalon","util","json","sortable","originmodulecwselectorcwselectorjs","originwidgetformformjs","dialog","originwidgetuploaderuploaderjs","originwidgetformselectjs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o,s){function r(a){t.ajax({url:i.PAGE_PATH+"study/coursestudy/practiceexam/practiceexam.json",type:"get",async:!1,success:function(t){e.getVm(p).setOptions(t.rows),a&&a()}})}function l(){t.c2s({url:i.BASE_PATH+"question/getQuestionOptionByQId.do",type:"post",contentType:"application/json",data:a.stringify({questionId:s.params.id/1}),success:function(n){var o,s;1==n.flag&&(o=n.data,h.questionType=d(o.question_type),h.coursewareId=o.coursewareid,h.coursewareName=o.courseware_name,h.questionTitle=o.question,h.pptName=o.pptName,r(function(){e.getVm(p).selectValue(o.url)}),"bool"==h.questionType?h.boolSetting=_.map(o.questionOptions,function(e){return{isRight:e.is_right,optionContent:e.option_content,id:e.id}}):("single"==h.questionType||"multi"==h.questionType)&&(h.optionList=_.map(o.questionOptions,function(e){return{isRight:e.is_right,optionContent:e.option_content,id:e.id}})),3==o.question_type&&(s=e.getVm(m),s.uploadList=_.map(o.pptList,function(e){return{id:t.generateID(),uploaded:!0,filePath:i.BASE_PATH+o.relativePath+"/"+e.ppt_dtl_name,name:e.original_file_name,data:a.stringify(e)}}),s.uploaded=_.map(s.uploadList.$model,function(e){return e.id}),h.pptId=o.ppt_id))}})}function d(e){var t;switch(e){case"0":t="single";break;case"1":t="multi";break;case"2":t="bool";break;case"5":t="qa";break;case"3":t="ppt";break;case"4":t="practice";break;default:t=""}return t}var c=o+"-cwselector",u=o+"-form",m=o+"-uploader",p=o+"-url",g=s.params.id/1,f=decodeURIComponent(s.params.coursewareName),v=i.getAppData("user"),h=e.define(o,function(n){n.state=o.split("-").pop(),n.navCrumbs=[{text:"试题管理",href:"#/study/questionmanage"},{text:"add"===n.state?"添加试题":"修改试题"}],n.questionType="add"===n.state?"single":"",n.optionList=[{optionContent:"",isRight:!0},{optionContent:"",isRight:!1}],n.boolSetting=[{optionContent:"正确",isRight:!0},{optionContent:"错误",isRight:!1}],n.$urlOpts={selectId:p,options:[]},n.coursewareId=g?g:0,n.coursewareName=f?f:"",n.questionTitle="",n.referenceAnswer="",n.pptName="",n.pptId=0,n.switchQuestionType=function(){var t=e(this),a=t.data("name"),i=e.getVm(u);n.questionType=a;var o;("single"==n.questionType||"bool"==n.questionType)&&(_.each(n.optionList,function(e,t){e.isRight&&_.isUndefined(o)&&(o=t),e.isRight=!1}),n.optionList.set(o||0,{isRight:!0})),i.clearValidateTip(),$(".valid-error-field, .valid-error",i.widgetElement).removeClass("valid-error-field"),$(".ff-value-tip",i.widgetElement).empty()},n.addQuestionOption=function(){n.optionList.push({optionContent:"",isRight:!1,id:0})},n.removeOption=function(){var e=this.$vmodel.$model,t=e.$index;n.optionList.removeAt(t)},n.setOptionTrue=function(){var e=this.$vmodel.$model,t=e.$index;("single"==n.questionType||"bool"==n.questionType)&&_.each(n.optionList,function(e){e.isRight=!1}),n.optionList.set(t,{isRight:!0})},n.setOptionFalse=function(){var e=this.$vmodel.$model,t=e.$index;n.optionList.set(t,{isRight:!1})},n.setBoolSetting=function(){var e=this.$vmodel.$model,t=e.$index;n.boolSetting[0].isRight=!1,n.boolSetting[1].isRight=!1,n.boolSetting.set(t,{isRight:!0})},n.$uploaderOpts={uploaderId:m,uploadList_:[],clickRemoveBtn:function(){var t=e.getVm(m),a=this.$vmodel.$model;t.removeFile(a.el.id)},uploadifyOpts:{uploader:i.BASE_PATH+"question/uploadImage.do",fileObjName:"myfiles",multi:!0,fileTypeDesc:"图片文件(*.gif; *.jpg; *.png; *.jpeg)",fileTypeExts:"*.gif; *.jpg; *.png; *.jpeg",fileSizeLimit:"2MB",formData:{sessionId:v.sessionId},width:112},defaultExtKeyData:{filePath:"",fileName:"",data:""},onSuccessResponseData:function(e){var t=a.parse(e);return{filePath:t.data[0].relativePath,fileName:t.data[0].fileName}}},n.$formOpts={formId:u,field:[{selector:".question-type",name:"questionType",getValue:function(){return $(this).filter(".mn-radio-state-selected").data("name")},rule:function(e){return e?!0:"请选择一种题型"}},{selector:".question-title",name:"question",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":!0}]},{selector:".option-list",name:"answers",getValue:function(){return n.optionList.$model},reset:function(){$(".ff-value-tip",this).removeClass("valid-error").empty().hide(),$(".valid-error-field",this).removeClass("valid-error-field"),$("textarea",this).val("")},rule:function(e){var a=[],n=!1;return _.each(e,function(e,t){e.optionContent.length||a.push(t),e.isRight&&(n=!0)}),{handler:function(e){var i=this;$(".ff-value-tip",this).removeClass("valid-error").empty().hide(),$(".valid-error-field",this).removeClass("valid-error-field"),n||t.alert({iconType:"error",content:"请设置至少一个正确答案"}),e||_.each(a,function(e){var t=$(".option-item",i).eq(e),a=$(".ff-value-tip",t),n=$(".option-content",t);a.addClass("valid-error").text("答案不能为空").slideDown("fast"),n.addClass("valid-error-field")})},isPassed:!a.length&&n}}},{selector:".bool-answer-field",name:"answers",getValue:function(){return n.boolSetting.$model}},{selector:".reference-answer",name:"referenceAnswer",rule:["noempty",function(e,t){return t[0]!==!0?"参考答案不能为空":!0}]},{selector:".url",name:"url",excludeHidden:!0,getValue:function(){return e.getVm(p).selectedValue},rule:function(e){return e?!0:"URL不能为空"}},{selector:".pptName",name:"pptName",rule:["noempty",function(e,t){return t[0]!==!0?"PPT名称不能为空":!0}]},{selector:".upload-panel",name:"fileName",getValue:function(){var t=e.getVm(m),a=t.uploadList,n=[];return _.each(a.$model,function(e){return e.uploaded?(n.push({fileName:e.fileName,originalFileName:e.name,data:e.data}),!0):void 0}),n},rule:function(){var t=e.getVm(m),a=t.uploadList;return a.length?!0:"上传ppt不能为空"}},{selector:".courseware-selected",name:"coursewareId",getValue:function(){return n.coursewareId},rule:function(e){return e?!0:"请选择归属课件"}}],action:[{selector:".f-submit",handler:function(){var o,r,l,d=e.getVm(u),c=e.getVm(m);d.validate()&&(l=function(){o=d.getFormData(),"edit"==n.state?(_.extend(o,{questionId:s.params.id/1}),r=i.BASE_PATH+"question/updateQuestion.do","ppt"==o.questionType&&(o.pptId=n.pptId)):r=i.BASE_PATH+"question/saveQuestion.do",t.c2s({url:r,type:"post",contentType:"application/json",data:a.stringify(o),success:function(e){1==e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){t.jumpPage("#/study/questionmanage")}})}})},"ppt"==n.questionType&&c.uploading?(t.showGlobalMask(),c.$unwatch("uploading"),c.$watch("uploading",function(e){e||(t.hideGlobalMask(),l(),c.$unwatch("uploading"))})):l())}}]},n.$cwselectorOpts={cwselectorId:c,multi:!1,onListReady:function(e){_.some(e.$model,function(t,a){return t.id==n.coursewareId?(e.set(a,{isSelected:!0}),!0):void 0})},onSubmit:function(e){e.length&&(n.coursewareId=e[0].id,n.coursewareName=e[0].coursewareName)}},n.openCourseware=function(){e.getVm(c).open()},n.removeAllUploadBtn=function(){var t=e.getVm(m);t.removeAllFile()}});e.scan(n[0]),h.$watch("questionType",function(t){var a;"ppt"==t&&(a=e.getVm(m),a.uploadList.$watch("length",function(){var e,t=[];_.each(a.uploadList.$model,function(a){_.some(t,function(e){return e.name==a.name})?e=a:t.push(a)}),e&&t.length!==a.uploadList.size()&&(a.uploadList=t,e.uploaded||$("#"+a.uploaderId).uploadify("cancel",e.id))}),a.uploaded.$watch("length",function(){var e=[];e=_.filter(a.uploadList.$model,function(e){return e.uploaded}),a.uploadList_=e}),e.scan($(".ppt-field-wrapper .upload-panel",n).removeAttr("ms-skip")[0],[a]),$(".upload-list",n).sortable({onDrop:function(t,i,o){var s=$(".upload-item",n),r=[];s.each(function(){var t=e(this).data("fileId");r.push(_.find(a.uploadList.$model,function(e){return e.id==t}))}),a.uploadList.clear(),a.uploadList=r,a.uploadList_=r,o(t)}}),h.$unwatch("questionType"))}),"edit"==h.state?l():r()},$remove:function(t,a){var n=a+"-cwselector",i=a+"-form",o=a+"-url",s=a+"-uploader",r=e.getVm(s);r&&$(r.widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(n).widgetElement).remove(),$(e.getVm(i).widgetElement).remove()}}),o});

//From origin\page\study\questionmanage\questionmanage.js
define("originpagestudyquestionmanagequestionmanagejs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetformselectjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,o){function s(a){var i=e.getVm(r),o={question:c.questionTitle,coursewareName:c.coursewareName,questionType:e.getVm(l).selectedValue};a?(o.pageSize=i.perPages,o.pageNumber=1):(o.pageSize=i.perPages,o.pageNumber=i.currentPage),t.c2s({url:n.BASE_PATH+"question/getQuestionsInfo.do",data:o,success:function(e){var t;e.flag&&(t=e.data,i.total=t.totalSize,a&&(i.currentPage=1),c.gridData=t.rows,c.gridTotalSize=t.totalSize,c.gridAllChecked=!1,c.gridSelected.clear())}})}var r=i+"-pagination",l=i+"-schedule",d=decodeURIComponent(o.params.coursewareName),c=e.define(i,function(e){e.permission={magQuestion:t.hasPermission("mag_question")},e.$scheduleOpts={selectId:l,options:[{text:"所有题型",value:""},{text:"单选",value:"0"},{text:"多选",value:"1"},{text:"判断",value:"2"},{text:"PPT",value:"3"},{text:"产品实操",value:"4"},{text:"问答题",value:"5"}],selectedIndex:0},e.questionTitle="",e.coursewareName="undefined"===d?"":d,e.$positionOpts={options:[],selectedIndex:0},e.gridTotalSize=0,e.gridData=[],e.gridAllChecked=!1,e.gridSelected=[],e.gridCheckAll=function(){this.checked?e.gridSelected=_.map(e.gridData.$model,function(e){return e.id}):e.gridSelected.clear()},e.scCheckAll=function(){e.gridSelected=_.map(e.gridData.$model,function(e){return e.id})},e.$paginationOpts={paginationId:r,total:0,onJump:function(){s()}},e.search=function(){s(!0)},e.jumpAddPage=function(){var e=$('<a href="#/study/questionmanage/add"></a>');e.appendTo("body"),e[0].click(),e.remove()},e.removeGridItem=function(){var t=$(this),a=t.data("id")+"";e.gridSelected=[a],e._removeQuestion()},e.batchRemoveGridItem=function(){e._removeQuestion()},e._removeQuestion=function(){var a,i,o;0===e.gridSelected.size()?t.alert({content:"请先选中试题"}):(a=e.gridSelected.$model,o=n.BASE_PATH+"question/deleteQuestion.do",i={idString:a},t.confirm({content:"确定要删除选中的试题吗？",onSubmit:function(){t.c2s({url:o,type:"post",data:JSON.stringify(i),contentType:"application/json",success:function(e){1==e.flag&&s(!0)}})}}))}});c.gridSelected.$watch("length",function(e){c.gridAllChecked=e===c.gridData.size()}),e.scan(a[0],[c]),s()},$remove:function(t,a){var n=a+"-pagination",i=a+"-schedule";$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),i});

//From origin\page\study\seniorstudy\manage\manage.js
define("originpagestudyseniorstudymanagemanagejs",["avalon","util","json","moment","originwidgetgridgridjs","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s,r){function l(n){t.confirm({iconType:"info",content:"确定要删除该学员吗？",onSubmit:function(){t.c2s({type:"post",url:o.BASE_PATH+"oldStaffManagement/executeRemove.do",data:a.stringify({learningProgressIdList:n}),contentType:"application/json",dataType:"json",success:function(t){t.flag&&e.getVm(d).load()}})},onCancel:function(){e.getVm(d).unselectById("all")}})}var d=s+"-grid",c=s+"-calendar",u=e.define(s,function(i){i.removeTheStudentsPermission=t.hasPermission("remove_the_students"),i.removeAllTheStudentsPermission=t.hasPermission("remove_all_the_students"),i.timeDelayLearningPermission=t.hasPermission("time_delay_learning"),i.hashId=r.params.id,i.courseName=decodeURIComponent(r.params.name),i.tabIndex=1,i.courseStatus="",i.sumSize=0,i.learningSize=0,i.timeOutSize=0,i.graduationSize=0,i.learningProgressId="",i.studentName="",i.keyword="",i.$calendarOpts={calendarId:c,onClickDate:function(s){$(this.widgetElement).hide(),t.confirm({iconType:"info",content:"确定要延时"+i.studentName+"学习时间至"+n(s).format("YYYY-MM-DD")+"吗？",onSubmit:function(){t.c2s({type:"post",url:o.BASE_PATH+"oldStaffManagement/executeDelay.do",data:a.stringify({learningProgressId:+i.learningProgressId,endDate:s.getTime()}),contentType:"application/json",dataType:"json",success:function(t){t.flag&&e.getVm(d).load()}})}})}},i.openCalendar=function(){var a,o=$(this),s=e.getVm(c),r=o.offset(),l=o.data("dateName"),d=new Date;i.learningProgressId=o.data("id"),i.studentName=o.data("studentName"),s?a=$(s.widgetElement):(a=$('<div ms-widget="calendar,$,$calendarOpts"></div>'),a.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(a[0],[i]),s=e.getVm(c),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),s.focusDate=i[l+"Date"]?n(i[l+"Date"],"YYYY-MM-DD")._d:d,"start"===l&&i.endDate&&(s.maxDate=n(i.endDate,"YYYY-MM-DD").subtract("days",1)._d,s.minDate=null),"end"===l&&i.startDate&&(s.minDate=n(i.startDate,"YYYY-MM-DD").add("days",1)._d,s.maxDate=null),a.css({top:r.top+o.outerHeight()+5,left:r.left-245}).show()},i.$gridOpts={gridId:d,showRemoveAll:!1,disableCheckbox:!0,getTemplate:function(e){var t,a=e.split("MS_OPTION_TBAR");return a=a[1].split("MS_OPTION_MAIN"),t=a[0],t+'<div class="ui-grid-bbar fn-clear"><div class="grid-action fn-left"><button type="button" class="check-all-btn main-btn" ms-if="removeAllTheStudentsPermission" ms-visible="showRemoveAll" ms-click="delAll">移除全部学员</button>&nbsp;</div><div class="pagination fn-right" ms-widget="pagination,$,$paginationOpts"></div></div>'},columns:[{dataIndex:"user_name",text:"姓名"},{dataIndex:"tel",text:"手机号"},{dataIndex:"position_name",text:"职称"},{dataIndex:"group_name",text:"部门"},{dataIndex:"tip",text:"学习状态",html:!0,renderer:function(e,t){return 3==t.course_status?'<span class="font-red">'+e+"</span> ":e}},{dataIndex:"operation",text:"操作",html:!0,renderer:function(e,t){var a='<a href="javascript:;" ms-if="timeDelayLearningPermission" ms-click="openCalendar" ms-visible="$outer.el.course_status==3" ms-data-student-name="$outer.el.user_name" data-id="'+t.learning_progress_id+'" data-date-name="start">延时学习</a>';return("1"==t.course_status||"3"==t.course_status)&&(a='<a href="javascript:;" ms-click="delStudent" ms-data-id="$outer.el.id" ms-if="removeTheStudentsPermission">移除学员</a>&nbsp;&nbsp;&nbsp;&nbsp;'+a),a}}],onLoad:function(n,s){var r=e.getVm(d);_.extend(n,{coursewareId:+i.hashId,courseStatus:i.courseStatus,userName:_.str.trim(i.keyword),tel:""}),t.c2s({type:"post",url:o.BASE_PATH+"oldStaffManagement/queryOldStaffList.do",data:a.stringify(n),contentType:"application/json",dataType:"json",success:function(e){var t;e.flag&&(t=e.data,i.sumSize=t.sumSize,i.learningSize=t.learningSize,i.timeOutSize=t.timeOutSize,i.graduationSize=t.graduationSize,r.showRemoveAll=_.some(t.rows,function(e){return"1"==e.course_status||"3"==e.course_status})?!0:!1,s.call(this,t))}})},delStudent:function(){var e=[+$(this).data("id")];l(e)},delAll:function(){var t=e.getVm(d),a=[];t.scCheckAll(),a=_.map(t.getSelectedData(),function(e){return e.id/1}),l(a)}},i.query=function(){e.getVm(d).load()},i.switchTab=function(){var t=$(this).data("type");if(t!=i.tabIndex){switch(t){case 1:i.courseStatus="",i.tabIndex=1;break;case 2:i.courseStatus="1",i.tabIndex=2;break;case 3:i.tabIndex=3,i.courseStatus="3";break;case 4:i.tabIndex=4,i.courseStatus="2"}e.getVm(d).load()}}});e.scan(i[0],[u]),e.getVm(d).load()},$remove:function(t,a){var n=a+"-grid",i=a+"-calendar",o=e.getVm(i);$(e.getVm(n).widgetElement).remove(),o&&$(o.widgetElement).remove()}}),s});

//From origin\page\study\seniorstudy\seniorstudy.js
define("originpagestudyseniorstudyseniorstudyjs",["avalon","util","json","dialog","originwidgetformformjs","originwidgetgridgridjs","originwidgettreetreejs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o){function s(n){var o,s=e.getVm(l),r=e.getVm(d),u=e.getVm(c).getSelectedData();"3"==n?(o={queryType:n,pageSize:1e5,pageNumber:1},o.coursewareId=u[0].id/1):o={queryType:n},o.flag=r.excludeStudied?"1":"0",t.c2s({type:"post",url:i.BASE_PATH+"oldStaffManagement/queryInfo.do",data:a.stringify(o),contentType:"application/json",dataType:"json",success:function(e){var t=e.data.sysGroups;if(e.flag)switch(n){case"1":s.updateTree(_.map(t,function(e){return{id:e.id,name:e.groupName,pId:e.parentId}}));break;case"2":m.positionData=e.data.sysPositionList;break;case"3":m.employeeData=e.data.sysUserList.rows}}})}function r(e){var t=[];return e.each(function(){t.push($(this).data("id"))}),t}var d=o+"-create-study-dialog",l=o+"-tree",c=o+"-grid",u=i.getAppData("user"),m=e.define(o,function(n){n.initiateStudiesPermission=t.hasPermission("initiate_studies"),n.keyword="",n.$treeOpts={treeId:l,ztreeOptions:{setting:{check:{enable:!0,chkboxType:{Y:"s",N:"s"}},callback:{onClick:function(){}},data:{simpleData:{enable:!0}}}},treeData:[]},n.$gridOpts={gridId:c,recordUnit:"个课件",disableCheckAll:!0,disableCheckbox:!0,columns:[{dataIndex:"id",text:"ID"},{dataIndex:"courseware_name",text:"课件名称"},{dataIndex:"hours",text:"时长（分）"},{dataIndex:"speaker",text:"主讲人"},{dataIndex:"num",text:"学习人数"},{dataIndex:"operation",text:"操作",html:!0,renderer:function(){return'<a ms-href="#/study/seniorstudy/manage/{{$outer.el.id}}/{{$outer.el.courseware_name}}">学员管理</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" ms-click="openStudy" ms-data-id="$outer.el.id" ms-if="initiateStudiesPermission">发起学习</a></td>'}}],onLoad:function(e,o){_.extend(e,{coursewareName:_.str.trim(n.keyword)}),t.c2s({type:"post",url:i.BASE_PATH+"oldStaffManagement/queryCoursewareList.do",data:a.stringify(e),contentType:"application/json",dataType:"json",success:function(e){var t;e.flag&&(t=e.data,o.call(this,t))}})}},n.query=function(){e.getVm(c).load()},n.studyType=["按部门","按职位","按员工"],n.currentType="按部门",n.typeNum=1,n.showIs=!1,n.positionData=[],n.employeeData=[],n.keyName="",n.todoNum=0,n.loginUserId=u.id,n.showType=function(){n.showIs=!0},n.chooseType=function(t){var a=e(this).data("type");if(n.showIs=!1,t!=n.currentType){switch(n.positionData=[],n.employeeData=[],a){case 1:n.typeNum=1;break;case 2:s("2"),n.typeNum=2;break;case 3:s("3"),n.typeNum=3}n.currentType=t}},n.chooseSel=function(){$(this).hasClass("choose-bg")?$(this).removeClass("choose-bg"):$(this).addClass("choose-bg")},n.searchName=function(){if(_.str.trim(n.keyName)){var e=new RegExp(n.keyName);n.employeeData=_.filter(n.employeeData,function(t){return t.userName.match(e)?!0:!1})}else s("3")},n.openStudy=function(){var t=e.getVm(d),a=e.getVm(c);t.title="发起学习",a.selectById($(this).data("id"),!0),t.open()},n.$createStudyDialogOpts={dialogId:d,width:540,excludeStudied:!0,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){n.showIs=!1,n.currentType="按部门",n.typeNum=1,n.positionData=[],n.employeeData=[]},submit:function(){var o,s=$("input[name='flag']").prop("checked")?"1":"0",u=e.getVm(c),m={flag:s,coursewareId:+u.getSelectedData()[0].id},p=[];switch(n.typeNum){case 1:o="部门人员",p=_.map(e.getVm(l).core.getCheckedNodes(),function(e){return e.id}),_.extend(m,{idList:p,conditionType:"1"});break;case 2:o="职位人员",_.extend(m,{idList:r($(".position-list .choose-bg")),conditionType:"2"});break;case 3:o="员工",_.extend(m,{idList:r($(".employee-list .choose-bg")),conditionType:"3"})}t.confirm({iconType:"info",content:"你确定所选的"+o+"学习"+u.getSelectedData()[0].courseware_name+"吗？",onSubmit:function(){m.idList.length>0?t.c2s({type:"post",url:i.BASE_PATH+"oldStaffManagement/executeTermBegin.do",data:a.stringify(m),contentType:"application/json",dataType:"json",success:function(a){a.flag&&(t.alert({iconType:"success",content:a.message}),e.getVm(d).close(),u.load())}}):t.alert({iconType:"info",content:"请选择部门、职位或员工!"})}})}}});e.scan(n[0],[m]),e.getVm(c).load(),s("1"),t.c2s({url:i.BASE_PATH+"oldStaffManagement/queryToDoListCountByLeaderId.do",data:a.stringify({baseUserId:u.id}),contentType:"application/json",success:function(e){var t=e.data;e.flag&&(m.todoNum=t.totalSize)}})},$remove:function(t,a){var n=a+"-create-study-dialog",i=a+"-tree",o=a+"-grid";$(e.getVm(o).widgetElement).remove(),$(e.getVm(n).widgetElement).remove(),$(e.getVm(i).widgetElement).remove()}}),o});

//From origin\page\study\studentmanage\detail\audition\audition.js
define("originpagestudystudentmanagedetailauditionauditionjs",["avalon","util","json","originmodulepptplayerpptplayerjs","originwidgetmediaplayerjs","originwidgetformformjs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o,s){function r(){t.c2s({url:i.BASE_PATH+"studentManagement/queryPptExamInfo.do",data:a.stringify({paperId:s.params.id/1}),contentType:"application/json",success:function(t){var a,n,o,s,r;t.flag&&(n=e.getVm(d),a=t.data,o=a.audioInfo,s=a.studentInfo,r=a.ppt,g.navCrumbs.set(1,{text:"查看详情-"+s.userName,href:"#/study/studentmanage/detail/"+s.id}),g.navCrumbs.set(2,{text:r.ppt_name}),n.pptList=_.map(a.pptDtlList,function(e){return{imagePath:i.BASE_PATH+a.pptPhotoPath+"/"+r.ppt_path+"/"+e.ppt_dtl_name}}),n.currentPath=n.pptList[0].imagePath,f.load([{file:i.BASE_PATH+a.audioPath+"/"+o.attachment_path+"/"+o.attachment_name}]),g.studentName=s.userName,g.studentId=s.id,g.pptName=r.ppt_name,g.auditionSummary=r.ppt_name)}})}var d=o+"-ppt",l=o+"-audio",c=o+"-do-score-dialog",u=o+"-play-over-dialog",m=o+"do-score-form",p=o+"do-score-form_",g=e.define(o,function(n){n.permission={markTheRecord:t.hasPermission("mark_the_record")},n.navCrumbs=[{text:"学员管理",href:"#/study/studentmanage"},{text:"",href:""},{text:""}],n.studentName="",n.studentId=0,n.pptName="",n.auditionSummary="",n.$pptOpts={pptplayerId:d},n.$audioOpts={playerId:l,jwplayerOptions:{width:800,height:30}},n.$playOverDialogOpts={dialogId:u,title:"提示",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">'+(n.permission.markTheRecord?"保存并返回查看详情":"返回详情列表")+'</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="replay">重新试听</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){var t=e.getVm(p);t.reset()},submit:function(){var o,r,d=e.getVm(u);n.permission.markTheRecord?(r=e.getVm(p),r.validate()&&(o=r.getFormData(),_.extend(o,{paperId:s.params.id/1}),t.c2s({url:i.BASE_PATH+"studentManagement/updatePptPaper.do",type:"post",contentType:"application/json",data:a.stringify(o),success:function(e){e.flag&&(d.close(),t.alert({iconType:"success",content:e.message,onSubmit:function(){t.jumpPage("#/study/studentmanage/detail/"+n.studentId)}}))}}))):t.jumpPage("#/study/studentmanage/detail/"+n.studentId)},replay:function(){var t=e.getVm(u);t.close(),f.play(!0)}},n.$doScoreDialogOpts={dialogId:c,title:"录音评分",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){var t=e.getVm(m);t.reset()},submit:function(){var n,o=e.getVm(c),r=e.getVm(m);r.validate()&&(n=r.getFormData(),_.extend(n,{paperId:s.params.id/1}),t.c2s({url:i.BASE_PATH+"studentManagement/updatePptPaper.do",type:"post",contentType:"application/json",data:a.stringify(n),success:function(e){e.flag&&(t.alert({iconType:"success",content:e.message}),o.close())}}))}},n.$doScoreFormOpts={formId:m,field:[{selector:".score",name:"mark",rule:["noempty",function(e,t){return t[0]!==!0?"评分不能为空":!0}]},{selector:".comment",name:"comment",rule:["noempty",function(e,t){return t[0]!==!0?"评语不能为空":!0}]}]},n.$doScoreFormOpts_={formId:p,field:[{selector:".score",name:"mark",rule:["noempty",function(e,t){return t[0]!==!0?"评分不能为空":!0}]},{selector:".comment",name:"comment",rule:["noempty",function(e,t){return t[0]!==!0?"评语不能为空":!0}]}]},n.doScore=function(){var t=e.getVm(c);t.open()}});e.scan(n[0]),r();var f=e.getVm(l).playerCore;f.onComplete(function(){var t=e.getVm(u);$(e.getVm(c).widgetElement).is(":hidden")&&t.open()})},$remove:function(t,a){var n=a+"-ppt",i=a+"-audio",o=a+"-do-score-dialog",s=a+"-play-over-dialog",r=a+"do-score-form",d=a+"do-score-form_",l=e.getVm(r),c=e.getVm(d),u=e.getVm(o),m=e.getVm(s);$(e.getVm(n).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),l&&$(l.widgetElement).remove(),c&&$(c.widgetElement).remove(),u&&$(u.widgetElement).remove(),m&&$(m.widgetElement).remove()}}),o});

//From origin\page\study\studentmanage\detail\detail.js
define("originpagestudystudentmanagedetaildetailjs",["avalon","util","json","moment"],function(e,t,a,n){var i,o=this,s=o.erp,r={};return _.extend(r,{$init:function(r,d,l){function c(){t.c2s({url:s.BASE_PATH+"studentManagement/queryTraStudentRecordByStudentId.do",contentType:"application/json",data:a.stringify({studentId:l.params.id/1,pageSize:m.pageSize,pageNumber:m.pageNumber}),success:function(e){e.flag&&(m.originData=m.originData.concat(e.data.rows),m.lineList=u(m.originData),m.totalSize=e.data.totalSize,m.pageNumber=m.pageNumber+1,m.totalSize<=m.pageSize&&(m.isComplete=!0),0===e.data.totalSize&&t.alert({iconType:"info",content:"该学员还没有详情记录"}))}})}function u(e){var t,a=[];return t=_.groupBy(e,function(e){return n(e.begin_time).format("YYYY-MM-DD")}),_.each(t,function(e,t){var i=n().format("YYYY-MM-DD"),o=n().subtract("days",1).format("YYYY-MM-DD"),s=!1,r=!1,d=t.split("-").slice(1).join(".");t==i&&(d="今天",s=!0),t==o&&(d="昨天",r=!0),a.push({dateIndex:d,isToday:s,isYestoday:r,detailList:_.map(e,function(e){var t="";return"1"==e.operating_type&&m.permission.tryToLRecord&&"1"==e.exam_paper_type&&(t='<a href="#/study/studentmanage/detail/audition/'+e.paper_id+'">试听录音</a>'),{timeIndex:n(e.begin_time).format("HH:mm"),content:e.description,action:t}})})}),a}var m=e.define(d,function(e){e.permission={tryToLRecord:t.hasPermission("try_to_l_record")},e.$skipArray=["originData"],e.lineList=[],e.originData=[],e.totalSize=0,e.pageSize=13,e.pageNumber=1,e.isComplete=!1});e.scan(r[0]),c(),i=function(){$("body").height()-$(o).scrollTop()-$(o).height()<=10&&((m.pageNumber-1)*m.pageSize<m.totalSize?c():(m.isComplete=!0,$(o).unbind("scroll",i)))},$(o).scroll(i)},$remove:function(){$(o).unbind("scroll",i),i=null}}),r});

//From origin\page\study\studentmanage\studentmanage.js
define("originpagestudystudentmanagestudentmanagejs",["avalon","util","moment","originmodulebindselectorbindselectorjs","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetformselectjs","originwidgetcalendarcalendarjs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o){function s(a){var n=e.getVm(r),o={userName:g.userName,tel:g.tel,courseStatus:e.getVm(c).selectedValue,positionId:e.getVm(l).selectedValue};g.permission.teacher&&(o.hasTeacherFlag=1),g.permission.charge&&(o.hasTeacherFlag=e.getVm(d).selectedValue),g.permission.teacher&&!g.permission.charge&&(o.teacherId=p.id),a?(o.pageSize=n.perPages,o.pageNumber=1):(o.pageSize=n.perPages,o.pageNumber=n.currentPage),t.c2s({url:i.BASE_PATH+"studentManagement/queryStudentList.do",data:JSON.stringify(o),contentType:"application/json",success:function(e){var i,o;e.flag&&(i=e.data,n.total=i.totalSize,a&&(n.currentPage=1),o=_.map(i.rows,function(e){return t.keyToCamelize(e)}),_.each(o,function(e){var t=e.progress,a=t.coursewareList;e.progressList=_.map(a,function(e){var t={id:e.id,isStudied:e.is_studied,isCurrent:e.is_current,isTimeout:e.is_timeout};return t}),delete e.progress}),g.gridData=o,g.gridTotalSize=i.totalSize,g.gridAllChecked=!1,g.gridSelected.clear())}})}var r=o+"-pagination",d=o+"-allocate",l=o+"-position",c=o+"-schedule",u=o+"-bind",m=o+"-delay-course",p=i.getAppData("user"),g=e.define(o,function(n){n.permission={teacher:t.hasPermission("teacher_item"),charge:t.hasPermission("t_incharge_item"),addStudent:t.hasPermission("add_student"),viewStudentDetail:t.hasPermission("view_student_detail"),unbindTSRel:t.hasPermission("unbind_t_s_rel"),allocateT:t.hasPermission("allocate_t"),cDelay:t.hasPermission("c_delay")},n.$allocateOpts={selectId:d,options:[{text:"已分配老师",value:1},{text:"未分配老师",value:0}],selectedIndex:0,onSelect:function(t){t?n.scheduleIsVisible=!0:(e.getVm(c).select(0),n.scheduleIsVisible=!1)}},n.scheduleIsVisible=!0,n.$scheduleOpts={selectId:c,options:[{text:"所有进度",value:""}],selectedIndex:0,onSelect:function(){}},n.$positionOpts={selectId:l,options:[{text:"所有职位",value:0}],selectedIndex:0},n.loginUserId=p.id,n.userName="",n.tel="",n.gridData=[],n.todoNum=0,n.gridTotalSize=0,n.gridAllChecked=!1,n.gridSelected=[],n.gridCheckAll=function(){this.checked?n.gridSelected=_.map(n.gridData.$model,function(e){return e.studentId+""}):n.gridSelected.clear()},n.scCheckAll=function(){n.gridSelected=_.map(n.gridData.$model,function(e){return e.studentId+""})},n.search=function(){s(!0)},n.$paginationOpts={paginationId:r,total:0,onJump:function(){s()}},n.$allocationOpts={bindselectorId:u,multi:n.permission.charge?!1:!0,listPath:n.permission.charge?"studentManagement/queryTeacherList.do":"studentManagement/queryStudentListToBeAllocated.do",onListReady:function(e){var t=n.gridSelected[0],a=_.find(n.gridData.$model,function(e){return e.studentId==t});n.permission.charge&&_.some(e.$model,function(t,n){return t.teacherId==a.teacherId?(e.set(n,{isSelected:!0}),!0):void 0})},onSubmit:function(e){var a,o,r,d=this;e.length?(o=n.gridSelected[0],r=_.find(n.gridData.$model,function(e){return e.studentId==o}),a={teacherId:n.permission.charge?e[0].teacherId:p.id,studentIdList:n.permission.charge?[r.studentId]:_.map(e,function(e){return e.id})},t.c2s({url:i.BASE_PATH+"studentManagement/saveTraTeacherStudent.do",type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(e){e.flag&&(n.permission.charge?s():n.permission.teacher&&s(!0),d.close())}})):t.alert({iconType:"error",content:"请至少选择一个条目"})}},n.openBindDialog=function(){var t=e.getVm(u),a=this.$vmodel.$model;n.permission.charge?(t.title="分配老师",t.userRole="teacher",n.gridSelected.clear(),n.gridSelected.push(a.el.studentId+"")):n.permission.teacher&&(t.title="学员认领",t.userRole="student"),t.open()},n.removeGridItem=function(){var t=e(this),a=t.data("studentId")+"";n.gridSelected.clear(),n.gridSelected.push(a),n._remove()},n.batchRemoveGridItem=function(){n._remove()},n._remove=function(){var e=[];n.gridSelected.size()>0?(_.each(n.gridSelected.$model,function(t){var a=_.find(n.gridData.$model,function(e){return e.studentId==t});e.push({studentId:a.studentId,teacherId:a.teacherId})}),1===e.length&&(e=e[0]),t.confirm({content:"确定要解除师生关系吗？",onSubmit:function(){t.c2s({url:i.BASE_PATH+"studentManagement/deleteTraTeacherStudent.do",type:"post",contentType:"application/json",data:JSON.stringify(e),success:function(e){e.flag&&s()}})}})):t.alert({iconType:"error",content:"请选择至少一个学生"})},n.$delayCourseOpts={calendarId:m,onClickDate:function(e){var o=-1,s=_.find(n.gridData.$model,function(e,t){return e.studentId==n.gridSelected[0]?(o=t,!0):void 0}),r=a(e)/1;t.c2s({url:i.BASE_PATH+"studentManagement/updateCourseEndTime.do",type:"post",contentType:"application/json",data:JSON.stringify({endDate:r,learningProgressId:s.learningProgressId,studentId:s.studentId,teacherId:s.teacherId,courseId:s.courseId,coursewareId:s.coursewareId}),success:function(e){e.flag&&(t.alert({iconType:"success",content:e.message}),o>-1&&n.gridData.set(o,{courseEndTime:r,courseStatus:"1"}))}}),$(this.widgetElement).hide()}},n.delayCourse=function(){var i,o=$(this),s=this.$vmodel.$model,r=e.getVm(m),d=o.offset();r?i=$(r.widgetElement):(i=$('<div ms-widget="calendar,$,$delayCourseOpts"></div>'),i.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(i[0],[n]),r=e.getVm(m),t.regGlobalMdExcept({element:i,handler:function(){i.hide()}})),i.css({top:d.top+o.outerHeight()+10,left:d.left-i.width()+o.width()}).show(),r.focusDate=s.el.courseEndTime?a(s.el.courseEndTime)._d:new Date,n.gridSelected.clear(),n.gridSelected.push(s.el.studentId+"")},n.showProgressTip=function(){var e=this.$vmodel.$model,t=e.$outer,a=t.el.progressTip,n=o+"-progress-tip",i=$(this),s=$("#"+n),r=i.offset();s.length||(s=$('<div id="'+n+'" class="grid-tip"></div>'),s.html('<span class="text-content"></span><span class="icon-arrow"></span>'),s.hide().appendTo("body")),i.hasClass("is-current")&&($(".text-content",s).text(a),s.css({top:r.top-s.height()-20,left:r.left-s.width()/2-11}).show())},n.hideProgressTip=function(){$("#"+o+"-progress-tip").hide()}});g.gridSelected.$watch("length",function(e){g.gridAllChecked=e===g.gridData.size()}),e.scan(n[0]),s(),t.c2s({url:i.BASE_PATH+"dictionary/querySysDictionaryByType.do",data:"dictionaryType=00000005",success:function(t){var a=e.getVm(c);1==t.flag&&a.setOptions([{text:"所有进度",value:""}].concat(_.map(t.data,function(e){return{text:e.dictionary_value,value:e.dictionary_key}})))}}),t.c2s({url:i.BASE_PATH+"position/initPosition.do",success:function(t){var a=e.getVm(l);1==t.flag&&a.setOptions([{text:"所有职位",value:""}].concat(_.map(t.data,function(e){return{text:e.position_name,value:e.id}})))}}),!g.permission.charge&&g.permission.teacher&&t.c2s({url:i.BASE_PATH+"studentManagement/queryToDoListCountByTeacherId.do",data:JSON.stringify({teacherId:p.id}),contentType:"application/json",success:function(e){var t=e.data;g.todoNum=t.totalSize}})},$remove:function(t,a){var n=a+"-pagination",i=a+"-allocate",o=a+"-position",s=a+"-schedule",r=a+"-bind",d=a+"-delay-course",l=e.getVm(i),c=e.getVm(d);$(e.getVm(n).widgetElement).remove(),l&&$(l.widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),c&&$(c.widgetElement).remove(),$("#"+a+"-progress-tip").remove()}}),o});

//From origin\page\study\studentmanage\todolist\todolist.js
define("originpagestudystudentmanagetodolisttodolistjs",["avalon","util","moment","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs"],function(e,t,a){var n,i=this,o=i.erp,s={};return _.extend(s,{$init:function(s,r,d){function l(){var e,n={pageSize:m.pageSize,pageNumber:m.pageNumber};"/study/seniorstudy/todolist/:id"===d.route?(e="oldStaffManagement/queryToDoListByLeaderId.do",n.baseUserId=d.params.id/1):"/study/studentmanage/todolist/:id"===d.route&&(e="studentManagement/queryToDoListByTeacherId.do",n.teacherId=d.params.id/1),t.c2s({url:o.BASE_PATH+e,contentType:"application/json",data:JSON.stringify(n),success:function(e){var t,n;e.flag&&(t=e.data,n=t.rows,m.todoList=m.todoList.concat(_.map(n,function(e){return{beginTime:a(e.begin_time/1).format("YYYY-MM-DD HH:mm:ss"),studentName:e.student_name,description:e.description,examPaperType:e.exam_paper_type,paperId:e.paper_id}})),m.totalSize=t.totalSize,m.pageNumber=m.pageNumber+1,m.totalSize<=m.pageSize&&(m.isComplete=!0))}})}var c=r+"-do-score-dialog",u=r+"-do-score-form",m=e.define(r,function(a){a.permission={tryToLRecord:t.hasPermission("try_to_l_record"),markTheRecord:t.hasPermission("mark_the_record"),humanMark:t.hasPermission("human_mark")},a.todoList=[],a.currentPaperId=0,a.currentExamPaperType=0,a.navCrumbs=[{text:"学员管理",href:"#/study/studentmanage"},{text:"待办事项"}],a.$doScoreDialogOpts={dialogId:c,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){var t=e.getVm(c);5==a.currentExamPaperType?t.title="真人互动评分":1==a.currentExamPaperType&&(t.title="进行评分")},onClose:function(){var t=e.getVm(u);t.reset()},submit:function(){var n,i,s=e.getVm(c),r=e.getVm(u);r.validate()&&(5==a.currentExamPaperType?i="studentManagement/updateMark.do":1==a.currentExamPaperType&&(i="studentManagement/updatePptPaper.do"),n=r.getFormData(),_.extend(n,{paperId:a.currentPaperId/1}),t.c2s({url:o.BASE_PATH+i,type:"post",contentType:"application/json",data:JSON.stringify(n),success:function(e){e.flag?(t.alert({iconType:"success",content:e.message,onSubmit:function(){_.some(m.todoList.$model,function(e,t){return e.paperId==a.currentPaperId?(m.todoList.removeAt(t),!0):void 0})}}),s.close()):t.alert({iconType:"error",content:e.message})}}))}},a.$doScoreFormOpts={formId:u,field:[{selector:".score",name:"mark",rule:["noempty",function(e,t){return t[0]!==!0?"评分不能为空":/^\d{1,6}$/.test(e)?"0"===e.slice(0,1)?"请输入有效的分数":!0:"请输入有效的分数"}]},{selector:".comment",name:"comment",rule:["noempty",function(e,t){return t[0]!==!0?"评语不能为空":!0}]}]},a.openDoScore=function(t){var n=e.getVm(c),i=this.$vmodel.$model,o=i.el.examPaperType;a.currentPaperId=e(this).data("paperId"),a.currentExamPaperType=o,n.open(),t.preventDefault()},a.totalSize=0,a.pageSize=13,a.pageNumber=1,a.isComplete=!1});e.scan(s[0]),l(),n=function(){$("body").height()-$(i).scrollTop()-$(i).height()<=10&&((m.pageNumber-1)*m.pageSize<m.totalSize?l():(m.isComplete=!0,$(i).unbind("scroll",n)))},$(i).scroll(n)},$remove:function(t,a){var o=a+"-do-score-dialog",s=a+"-do-score-form";$(e.getVm(s).widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(i).unbind("scroll",n),n=null}}),s});

//From origin\page\study\videomanage\videomanage.js
define("originpagestudyvideomanagevideomanagejs",["avalon","util"],function(e){var t=this,a=(t.erp,{});return _.extend(a,{$init:function(t,a){e.define(a,function(e){e.externalLink="http://192.168.236.31:8083/yazuo_erp/erp/video/toVideoItems.do",e.iframeHeight=1200,e.onIframeLoad=function(){}});e.scan(t[0])},$remove:function(){}}),a});

//From origin\page\sysmanage\merchantinput\merchantinput.js
define("originpagesysmanagemerchantinputmerchantinputjs",["avalon","util","moment","json","originwidgetformformjs","originwidgetformselectjs","originwidgetuploaderuploaderjs","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s){function r(){t.c2s({url:o.BASE_PATH+"user/getAllUsersByResourceCode.do",contentType:"application/json",data:n.stringify({remark:"sales_service"}),success:function(t){var a;t.flag&&(a=t.data,e.getVm(m).setOptions(_.map(a,function(e){return{value:e.id,text:e.userName}})))}}),t.c2s({url:o.BASE_PATH+"user/getAllUsersByResourceCode.do",contentType:"application/json",data:n.stringify({remark:"front_end_service"}),success:function(t){var a;t.flag&&(a=t.data,e.getVm(p).setOptions(_.map(a,function(e){return{value:e.id,text:e.userName}})))}})}{var d=s+"-form",l=s+"-service-years",c=s+"-free-months",u=s+"-online-status",m=s+"-sale",p=s+"-advisor",g=s+"-calendar",f=s+"-uploader",v=o.getAppData("user");e.define(s,function(i){i.showAdvisor=!0,i.merchantLogo=o.ASSET_PATH+"image/merchant-default-logo.jpg",i.fileName="",i.originalFileName="",i.fileSize=0,i.$uploaderOpts={uploaderId:f,uploadifyOpts:{uploader:o.BASE_PATH+"synMerchant/uploadLogo.do",formData:{sessionId:v.sessionId},fileTypeDesc:"图片文件(*.gif; *.jpg; *.png; *.jpeg)",fileTypeExts:"*.gif; *.jpg; *.png; *.jpeg",fileSizeLimit:"2MB",fileObjName:"myfiles",multi:!1},onSuccessResponseData:function(e){var t=n.parse(e),a=t.data[0];i.merchantLogo=a.relativePath,i.fileName=a.fileName,i.originalFileName=a.originalFileName,i.fileSize=a.fileSize}},i.$serviceYearsOpts={selectId:l,options:_.map(_.range(0,11),function(e){return{text:e+"年",value:e}})},i.$freeMonthsOpts={selectId:c,options:_.map(_.range(0,7),function(e){return{text:e+"个月",value:e}})},i.$onlineStatusOpts={selectId:u,options:[{text:"已上线",value:1},{text:"商户创建",value:2}],onSelect:function(e){i.showAdvisor=2===e?!1:!0}},i.$saleOpts={selectId:m},i.$advisorOpts={selectId:p},i.$formOpts={formId:d,field:[{selector:".brand-id",name:"merchant_id",rule:["noempty",function(e,t){return t[0]!==!0?"品牌ID不能为空":!0}]},{selector:".merchant-logo",name:"fileName",getValue:function(){return i.fileName},rule:function(){return i.fileName.length?!0:"品牌Logo不能为空"}},{selector:".service-years",name:"service_year",getValue:function(){return e.getVm(l).selectedValue}},{selector:".free-months",name:"free_month",getValue:function(){return e.getVm(c).selectedValue}},{selector:".start-date",name:"service_start_time",rule:["noempty",function(e,t){return t[0]!==!0?"服务开始时间不能为空":!0}]},{selector:".online-status",name:"merchant_status",getValue:function(){return e.getVm(u).selectedValue+""}},{selector:".sale",name:"sales_user_id",getValue:function(){return e.getVm(m).selectedValue},rule:function(e){return e?!0:"请选择销售人员"}},{selector:".advisor",name:"front_user_id",excludeHidden:!0,getValue:function(){return e.getVm(p).selectedValue},rule:function(e){return e?!0:"请选择前端顾问"}}]},i.startDate="",i.$calendarOpts={calendarId:g,onClickDate:function(e){i.startDate=a(e).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},i.openCalendar=function(){var n,o=$(this),s=e.getVm(g),r=o.offset(),d=new Date;s?n=$(s.widgetElement):(n=$('<div ms-widget="calendar,$,$calendarOpts"></div>'),n.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(n[0],[i]),s=e.getVm(g),t.regGlobalMdExcept({element:n,handler:function(){n.hide()}})),s.focusDate=i.startDate?a(i.startDate,"YYYY-MM-DD")._d:d,n.css({top:r.top+o.outerHeight()-1,left:r.left}).show()},i.submit=function(){var s,r,l=e.getVm(d),c=e.getVm(f);l.validate()&&(r=function(){s=l.getFormData(),s.merchant_id=s.merchant_id/1,s.service_start_time=a(s.service_start_time,"YYYY-MM-DD")/1,s.originalFileName=i.originalFileName,s.fileSize=i.fileSize,t.c2s({url:o.BASE_PATH+"synMerchant/saveSynMerchantExtend.do",type:"post",contentType:"application/json",data:n.stringify(s),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){t.forceRefresh()}})}})},c.uploading?(t.showGlobalMask(),c.$unwatch("uploading"),c.$watch("uploading",function(e){e||(t.hideGlobalMask(),r(),c.$unwatch("uploading"))})):r())}})}e.scan(i[0]),r()},$remove:function(t,a){var n=a+"-form",i=a+"-uploader",o=a+"-service-years",s=a+"-free-months",r=a+"-online-status",d=a+"-sale",l=a+"-advisor",c=a+"-calendar",u=e.getVm(c);u&&$(u.widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(d).widgetElement).remove(),$(e.getVm(l).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\sysmanage\migration\migration.js
define("originpagesysmanagemigrationmigrationjs",["avalon","util","moment","json","originwidgetformformjs","originwidgetformselectjs","originwidgetuploaderuploaderjs","originwidgetautocompleteautocompletejs","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s){function r(){t.c2s({url:o.BASE_PATH+"user/getAllUsersByResourceCode.do",contentType:"application/json",data:n.stringify({remark:"sales_service"}),success:function(t){var a;t.flag&&(a=t.data,e.getVm(g).setOptions(_.map(a,function(e){return{value:e.id,text:e.userName}})))}}),t.c2s({url:o.BASE_PATH+"user/getAllUsersByResourceCode.do",contentType:"application/json",data:n.stringify({remark:"front_end_service"}),success:function(t){var a;t.flag&&(a=t.data,e.getVm(f).setOptions(_.map(a,function(e){return{value:e.id,text:e.userName}})))}})}{var d=s+"-form",l=s+"-brand",c=s+"-merchant-list",u=s+"-service-years",m=s+"-free-months",p=s+"-online-status",g=s+"-sale",f=s+"-advisor",v=s+"-calendar";o.getAppData("user"),e.define(s,function(i){i.navCrumbs=[{text:"miniERP数据迁移"}],i.showMerchantList=!1,i.showAdvisor=!0,i.merchantName="",i.crmId=0,i.$brandOpts={autocompleteId:l,placeholder:"请指定商户",delayTime:300,onChange:function(e,a){e.length?t.c2s({url:o.BASE_PATH+"brands/getBrandsInfo.do",data:{name:e},success:function(e){var t;e.flag&&(t=e.data,a(_.map(t,function(e){return e.text=e.name||"未知",e.value=e.id,e})))}},{mask:!1}):a([])},onSelect:function(t){var a=e.getVm(l).getOptionByValue(t);a.crm_id?(i.showMerchantList=!1,e.getVm(c)&&(e.getVm(c).inputText=""),i.merchantName=a.merchant_name,i.crmId=a.crm_id):(i.showMerchantList=!0,e.getVm(c)&&(e.getVm(c).inputText=a.name),i.merchantName="")}},i.$merchantListOpts={autocompleteId:c,onChange:function(e,a){e.length?t.c2s({url:o.BASE_PATH+"merchantCrm/getMerchantsInfo.do",data:{merchantName:e},success:function(e){var t;e.flag&&(t=e.data,a(_.map(t,function(e){return e.text=e.merchant_name||"未知",e.value=e.merchant_id,e})))}}):a([])},onSelect:function(e,t){i.merchantName=t,i.crmId=e}},i.$serviceYearsOpts={selectId:u,options:_.map(_.range(0,11),function(e){return{text:e+"年",value:e}})},i.$freeMonthsOpts={selectId:m,options:_.map(_.range(0,7),function(e){return{text:e+"个月",value:e}})},i.$onlineStatusOpts={selectId:p,options:[{text:"已上线",value:1},{text:"商户创建",value:2}],onSelect:function(e){i.showAdvisor=2===e?!1:!0}},i.$saleOpts={selectId:g},i.$advisorOpts={selectId:f},i.$formOpts={formId:d,field:[{selector:".brand-name",name:"mini_merchant_id",getValue:function(){return e.getVm(e.getVm(l).selectId).selectedValue},rule:function(e){return e?!0:"请选择品牌"}},{selector:".merchant-name",name:"merchant_id",getValue:function(){return i.crmId},rule:function(e){return e?!0:"请选择商户"}},{selector:".service-years",name:"service_year",getValue:function(){return e.getVm(u).selectedValue}},{selector:".free-months",name:"free_month",getValue:function(){return e.getVm(m).selectedValue}},{selector:".start-date",name:"service_start_time",rule:["noempty",function(e,t){return t[0]!==!0?"服务开始时间不能为空":!0}]},{selector:".online-status",name:"merchant_status",getValue:function(){return e.getVm(p).selectedValue+""}},{selector:".sale",name:"sales_user_id",getValue:function(){return e.getVm(g).selectedValue},rule:function(e){return e?!0:"请选择销售人员"}},{selector:".advisor",name:"front_user_id",excludeHidden:!0,getValue:function(){return e.getVm(f).selectedValue},rule:function(e){return e?!0:"请选择前端顾问"}}]},i.startDate="",i.$calendarOpts={calendarId:v,onClickDate:function(e){i.startDate=a(e).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},i.openCalendar=function(){var n,o=$(this),s=e.getVm(v),r=o.offset(),d=new Date;s?n=$(s.widgetElement):(n=$('<div ms-widget="calendar,$,$calendarOpts"></div>'),n.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(n[0],[i]),s=e.getVm(v),t.regGlobalMdExcept({element:n,handler:function(){n.hide()}})),s.focusDate=i.startDate?a(i.startDate,"YYYY-MM-DD")._d:d,n.css({top:r.top+o.outerHeight()-1,left:r.left}).show()},i.submit=function(){var i,s=e.getVm(d);s.validate()&&(i=s.getFormData(),i.service_start_time=a(i.service_start_time,"YYYY-MM-DD")/1,t.c2s({url:o.BASE_PATH+"synMerchant/saveSynMerchantForOnlineBefore.do",type:"post",contentType:"application/json",data:n.stringify(i),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){t.forceRefresh()}})}}))}})}e.scan(i[0]),r()},$remove:function(t,a){var n=a+"-form",i=a+"-brand",o=a+"-merchant-list",s=a+"-service-years",r=a+"-free-months",d=a+"-online-status",l=a+"-sale",c=a+"-advisor",u=a+"-calendar",m=e.getVm(u),p=e.getVm(o);m&&$(m.widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),p&&$(p.widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(d).widgetElement).remove(),$(e.getVm(l).widgetElement).remove(),$(e.getVm(c).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\sysmanage\orgmanage\orgmanage.js
define("originpagesysmanageorgmanageorgmanagejs",["avalon","util","originmoduleorganizationorganizationjs"],function(e){var t=this,a=(t.erp,{});return _.extend(a,{$init:function(t,a){var n=e.define(a,function(){});e.scan(t[0],[n])},$remove:function(){}}),a});

//From origin\page\sysmanage\position\position.js
define("originpagesysmanagepositionpositionjs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function o(a){var i=e.getVm(d),o={};a?(o.pageSize=i.perPages,o.pageNumber=1):(o.pageSize=i.perPages,o.pageNumber=i.currentPage),t.c2s({url:n.BASE_PATH+"position/list.do",data:o,success:function(e){var t;e.flag&&(t=e.data,i.total=t.totalSize,a&&(i.currentPage=1),l.gridData=t.rows,l.gridTotalSize=t.totalSize,l.gridAllChecked=!1,l.gridSelected.clear())}})}var s=i+"-add-edit-dialog",r=i+"-add-edit-form",d=i+"-pagination",l=e.define(i,function(a){a.gridTotalSize=0,a.gridData=[],a.gridAllChecked=!1,a.gridSelected=[],a.addEditState="",a.gridCheckAll=function(){this.checked?a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""}):a.gridSelected.clear()},a.scCheckAll=function(){a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""})},a.$paginationOpts={paginationId:d,total:0,onJump:function(){o()}},a.$addEditDialogOpts={dialogId:s,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(r);t.positionName="",t.reset()},submit:function(){var i,d,l,c=e.getVm(s),u=e.getVm(r),m=a.addEditState;u.validate()&&(i=u.getFormData(),"edit"==m&&(l=a.gridSelected[0],_.extend(i,{id:l})),d=n.BASE_PATH+"position/savePosition.do",t.c2s({url:d,type:"post",data:i,success:function(e){1==e.flag&&(t.alert({content:e.message,iconType:"success"}),"edit"==m?_.some(a.gridData.$model,function(e,t){return e.id==l?(a.gridData.set(t,{position_name:i.positionName}),!0):void 0}):o(!0),c.close())}}))}},a.$addEditFormOpts={formId:r,field:[{selector:".position-name",rule:["noempty",function(e,t){return t[0]!==!0?"职位名称不能为空":!0}]}],positionName:""},a.openAdd=function(){var t=e.getVm(s),n=e.getVm(r);t.title="添加职位",n.positionName="",a.addEditState="add",a.gridSelected.clear(),t.open()},a.openEdit=function(){var t=e.getVm(s),n=e.getVm(r),i=e(this),o=i.data("positionId")+"",d=i.data("positionName");t.title="编辑职位",n.positionName=d,a.addEditState="edit",a.gridSelected=[o],t.open()},a.removeGridItem=function(){var t=e(this),n=t.data("positionId")+"";a.gridSelected=[n],a._removePosition()},a.batchRemoveGridItem=function(){a._removePosition()},a._removePosition=function(){var e,i,s;0===a.gridSelected.size()?t.alert({content:"请先选中职位"}):(e=a.gridSelected.$model,1===e.length?(s=n.BASE_PATH+"position/delete.do",i={id:e[0]}):(s=n.BASE_PATH+"position/deleteMany.do",i={idString:e}),t.confirm({content:"确定要删除选中的职位吗？",onSubmit:function(){t.c2s({url:s,type:"post",data:i,success:function(e){1==e.flag&&o()}})}}))}});l.gridSelected.$watch("length",function(e){l.gridAllChecked=e===l.gridData.size()}),e.scan(a[0],[l]),o()},$remove:function(e){$(".add-edit-position-dialog .add-edit-form").remove(),$(".add-edit-position-dialog").remove(),$(".pagination",e).remove()}}),i});

//From origin\page\sysmanage\resource\resource.js
define("originpagesysmanageresourceresourcejs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function o(a,i){var o=e.getVm(d),s={};a?(s.pageSize=o.perPages,s.pageNumber=1):(s.pageSize=o.perPages,s.pageNumber=o.currentPage),i?(s.parentId=i,l.parentId=i):(s.parentId=0,l.parentId=0),t.c2s({url:n.BASE_PATH+"resource/list/"+s.parentId+"/"+s.pageNumber+"/"+s.pageSize+".do",type:"get",contentType:"application/json",success:function(e){var t,n;1==e.flag&&(t=e.data,n=t.pageNavigate,o.total=t.totalSize,a&&(o.currentPage=1),_.each(t.rows,function(e){"1"==e.is_visible?(e.is_visible_text="启用",e.control_is_visible="禁用"):(e.is_visible_text="禁用",e.control_is_visible="启用")}),l.gridData=t.rows,l.gridTotalSize=t.totalSize,l.gridAllChecked=!1,l.gridSelected.clear(),l.navCrumbs=_.map(n,function(e){return{id:e.id,text:e.resourceName,href:"javascript:;"}}),l.navCrumbs.unshift({id:0,text:"资源管理",href:"#/sysmanage/resource"}),l.navCrumbs.set(l.navCrumbs.size()-1,{href:!1}))}})}var s=i+"-add-edit-dialog",r=i+"-add-edit-form",d=i+"-pagination",l=e.define(i,function(a){a.navCrumbs=[],a.parentId=0,a.gridTotalSize=0,a.gridData=[],a.gridAllChecked=!1,a.gridSelected=[],a.addEditState="",a.gridCheckAll=function(){this.checked?a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""}):a.gridSelected.clear()},a.scCheckAll=function(){a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""})},a.$paginationOpts={paginationId:d,total:0,onJump:function(){o()}},a.$addEditDialogOpts={dialogId:s,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(r);t.resourceName="",t.reset()},submit:function(){var i,d,l,c=e.getVm(s),u=e.getVm(r),m=a.addEditState;u.validate()&&(i=u.getFormData(),"edit"==m?(l=a.gridSelected[0],_.extend(i,{id:l}),d=n.BASE_PATH+"resource/updateResource.do"):d=n.BASE_PATH+"resource/saveResource.do",t.c2s({url:d,contentType:"application/json",type:"post",data:JSON.stringify(i),success:function(e){1==e.flag&&("edit"==m?_.some(a.gridData.$model,function(e,t){return e.id==l?(a.gridData.set(t,{resource_name:i.resourceName}),!0):void 0}):o(),c.close())}}))}},a.$addEditFormOpts={formId:r,field:[{selector:".resource-name",rule:["noempty",function(e,t){return t[0]!==!0?"资源名称不能为空":!0}]}],resourceName:""},a.triggerOnOrOff=function(){var i=e(this),o=n.BASE_PATH+"resource/triggerOnOrOffResource/"+i.data("resourceId")+".do",s=this.$vmodel.$model.el,r=this.$vmodel.$model.$index;t.c2s({url:o,type:"get",contentType:"application/json",success:function(e){e.flag&&("0"==s.is_visible?a.gridData.set(r,{is_visible_text:"启用",control_is_visible:"禁用",is_visible:"1"}):a.gridData.set(r,{is_visible_text:"禁用",control_is_visible:"启用",is_visible:"0"}))}})},a.openEdit=function(){var t=e.getVm(s),n=e.getVm(r),i=e(this),o=i.data("resourceId")+"",d=i.data("resourceName");t.title="修改名称",n.resourceName=d,a.addEditState="edit",a.gridSelected=[o],t.open()},a.batchTriggerOnGridItem=function(){a.batchTriggerTrigger(1)},a.batchTriggerOffGridItem=function(){a.batchTriggerTrigger(0)},a.batchTriggerTrigger=function(e){var i,s,r;0===a.gridSelected.size()?t.alert({content:"请先选中资源"}):(i=a.gridSelected.$model,r=n.BASE_PATH+"resource/updateResources.do",s={idString:i,flag:e},t.c2s({url:r,type:"post",contentType:"application/json",data:JSON.stringify(s),success:function(e){1==e.flag&&o(!1,a.parentId)}}))},a.viewChildren=function(){var t=e(this),a=t.data("resourceId");o(!1,a)},a.clickPageNav=function(){var t=e(this).data("resourceId");o(!1,t)}});l.gridSelected.$watch("length",function(e){l.gridAllChecked=e===l.gridData.size()}),e.scan(a[0],[l]),o()},$remove:function(e){$(".add-edit-resource-dialog .add-edit-form").remove(),$(".add-edit-resource-dialog").remove(),$(".pagination",e).remove()}}),i});

//From origin\page\sysmanage\role\role-common.js
define("originpagesysmanagerolerolecommonjs",["avalon","util"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,o){function s(e){t.c2s({url:n.BASE_PATH+"role/initTree.do",success:function(t){function a(e){_.each(e,function(e){var t="";e.childrenList&&0!==e.childrenList.length||(t="leaf-item"),i+='<li class="permission-item '+t+'"><div class="permission-title"><i class="visible-h iconfont" ms-click="toggleVisible">&#xe601;</i>&nbsp;<span class="label-for"><input type="checkbox" class="check-h" value="'+e.id+'" ms-click="clickNode" />&nbsp;<label class="permission-name">'+e.text+"</label></span></div>",e.childrenList&&e.childrenList.length>0?(i+='<ul class="permission-list">',a(e.childrenList),i+="</ul></li>"):i+="</li>"})}var n,i="";1==t.flag&&(n=t.data,n=[].concat(n),a(n),d.html('<ul class="permission-list">'+i+"</ul>"),e&&e.call(this,n))}})}function r(){t.c2s({url:n.BASE_PATH+"role/edit.do",data:{id:o.params.id},success:function(e){var t;e.flag&&(t=e.data,_.each(t,function(e){$('.check-h[value="'+e+'"]',d).prop("checked",!0)}))}})}var d=$(".permission-box",a),l=i+"-form",c=e.define(i,function(a){a.navCrumbs=[{text:"权限组管理",href:"#/sysmanage/role"},{text:"add"===i.slice(-3)?"添加权限组":"修改权限组"}],a.formState="add"===i.slice(-3)?"add":"edit",a.roleName="add"===i.slice(-3)?"":decodeURIComponent(o.params.rolename),a.$formOpts={formId:l,field:[{selector:".role-name",name:"roleName",rule:["noempty",function(e,t){return t[0]!==!0?"权限组名称不能为空":!0}]},{selector:".permission-box .check-h",name:"permission",tipDeep:10,rule:function(e){return 0===e.length?"请至少分配一种权限":!0}}],action:[{selector:".f-submit",handler:function(){var i,s="role/saveRole.do",r=e.getVm(l);r.validate()&&(i=r.getFormData(),i.permission=[].concat(i.permission),"edit"===a.formState&&_.extend(i,{id:o.params.id}),t.c2s({url:n.BASE_PATH+s,data:i,success:function(e){e.flag&&("add"===a.formState&&r.reset(),t.alert({content:e.message,iconType:"success",onSubmit:function(){window.location.href=n.BASE_PATH+"#!/sysmanage/role"}}))}}))}}]},a.clickNode=function(){var e=$(this),t=e.closest(".permission-item"),a=e.prop("checked"),n=function(e){var t=e.closest(".permission-item"),a=t.parent().closest(".permission-item"),i=a.children(".permission-title").find(":checkbox");i.prop("checked",!0),i.closest(".permission-item").length>0&&n(i)};a?(n(e),t.children(".permission-list").find(":checkbox").prop("checked",!0)):t.children(".permission-list").find(":checkbox").prop("checked",!1)},a.toggleVisible=function(){var e=$(this),t=e.closest(".permission-item"),a=t.children(".permission-list"),n=e.data("isHidden");n?(a.slideDown("fast"),e.data("isHidden",!1),e.html("&#xe601;")):(a.slideUp("fast"),e.data("isHidden",!0),e.html("&#xe600;"))}});s(function(){"edit"===c.formState&&r(),e.scan(a[0],[c])})},$remove:function(t,a){var n=a+"-form";$(e.getVm(n).widgetElement).remove()}}),i});

//From origin\page\sysmanage\role\role.js
define("originpagesysmanagerolerolejs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function o(a){var i=e.getVm(s),o={};a?(o.pageSize=i.perPages,o.pageNumber=1):(o.pageSize=i.perPages,o.pageNumber=i.currentPage),t.c2s({url:n.BASE_PATH+"role/list.do",data:o,success:function(e){var t;e.flag&&(t=e.data,i.total=t.totalSize,a&&(i.currentPage=1),r.gridData=t.rows,r.gridTotalSize=t.totalSize,r.gridAllChecked=!1,r.gridSelected.clear())}})}var s=i+"-pagination",r=e.define(i,function(a){a.gridTotalSize=0,a.gridData=[],a.gridAllChecked=!1,a.gridSelected=[],a.addEditState="",a.gridCheckAll=function(){this.checked?a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""}):a.gridSelected.clear()},a.scCheckAll=function(){a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""})},a.$paginationOpts={paginationId:s,total:0,onJump:function(){o()}},a.removeGridItem=function(){var t=e(this),n=t.data("roleId")+"";a.gridSelected=[n],a._removeRole()},a.batchRemoveGridItem=function(){a._removeRole()},a.jumpAddPage=function(){var e=$('<a href="#/sysmanage/role/add"></a>');e.appendTo("body"),e[0].click(),e.remove()},a._removeRole=function(){var e,i,s;0===a.gridSelected.size()?t.alert({content:"请先选中权限组"}):(e=a.gridSelected.$model,s=n.BASE_PATH+"role/delete.do",i={id:e},t.confirm({content:"确定要删除选中的权限组吗？",onSubmit:function(){t.c2s({url:s,type:"post",data:i,success:function(e){1==e.flag&&o(!0)}})}}))}});r.gridSelected.$watch("length",function(e){r.gridAllChecked=e===r.gridData.size()}),e.scan(a[0],[r]),o()},$remove:function(e){$(".add-edit-position-dialog .add-edit-form").remove(),$(".add-edit-position-dialog").remove(),$(".pagination",e).remove()}}),i});

//From origin\page\sysmanage\usermanage\settingrange\settingrange.js
define("originpagesysmanageusermanagesettingrangesettingrangejs",["avalon","util","json","originwidgetformformjs","originwidgetformselectjs","originwidgetuploaderuploaderjs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o,s){var r=o+"-form",d=e.define(o,function(n){n.navCrumbs=[{text:"用户管理",href:"#/sysmanage/usermanage"},{text:"设置管辖范围"}],n.userName=decodeURIComponent(s.params.userName),n.$skipArray=["tempRangeId"],n.rangeIdSelected=[],n.exceptUserIdSelected=[],n.tempUserList=[],n.tempUserListVisible=!1,n.tempRangeId="",n.$formOpts={formId:r,field:[{selector:".control-range-wrapper",name:"group",getValue:function(){return n.rangeIdSelected.$model}}],action:[{selector:".f-submit",handler:function(){var o,d=e.getVm(r);d.validate()&&(o=d.getFormData(),o.exceptUser=n.exceptUserIdSelected.$model,_.extend(o,{id:s.params.id}),t.c2s({url:i.BASE_PATH+"user/updateManager.do",type:"post",contentType:"application/json",data:a.stringify(o),success:function(e){1==e.flag&&t.alert({content:e.message,iconType:"success",onSubmit:function(){t.jumpPage("#/sysmanage/usermanage")}})}}))}}]},n.switchNodeVisible=function(){var e=$(this),t=e.closest(".node-text"),a=t.next(".node-list"),n=e.data("visibleState")||"shown";"shown"==n?(a.slideUp("fast"),e.data("visibleState","hidden").html("&#xe600;")):(a.slideDown("fast"),e.data("visibleState","shown").html("&#xe601;"))},n.clickNodeCk=function(){var e=$(this),t=e.closest(".node-text"),a=t.next(".node-list");n.closeTempUserList(),e.prop("checked")?($(".ck-h",a).prop("checked",!0),n.tempRangeId=t.data("groupId"),n.tempUserListVisible=!0):$(".ck-h",a).prop("checked",!1),n.rangeIdSelected.clear(),$(":checked",c).each(function(){n.rangeIdSelected.push($(this).val())})},n.closeTempUserList=function(){n.tempRangeId="",n.tempUserListVisible=!1},n.clickTempUserItem=function(){var e=this.$vmodel.$model,t=e.$index,a=-1;e.el.isChecked?(n.tempUserList.set(t,{isChecked:!1}),_.some(n.exceptUserIdSelected,function(t){return t.id==e.el.id})||n.exceptUserIdSelected.push({id:e.el.id,belongToGroup:e.el.group_id})):(n.tempUserList.set(t,{isChecked:!0}),_.some(n.exceptUserIdSelected,function(t,n){t.id==e.el.id&&(a=n)})&&n.exceptUserIdSelected.removeAt(a))},n.$watch("tempUserListVisible",function(e){e&&t.c2s({url:i.BASE_PATH+"user/getUserOfGroup.do",data:{groupId:n.tempRangeId},success:function(e){var t;e.flag&&(t=e.data,n.tempUserList=_.map(t,function(e){return _.extend(e,{isChecked:!0})}))}})})});e.scan(n[0]),d.rangeIdSelected.$watch("length",function(){d.exceptUserIdSelected=_.filter(d.exceptUserIdSelected.$model,function(e){return _.some(d.rangeIdSelected,function(t){return t==e.belongToGroup})?!0:void 0})});var l=function(e){var t="",a="",n="";return e.childrenList&&0!==e.childrenList.length||(a="leaf-node-text"),e.isRoot&&(a+=" root-node-text",n="root-node-list"),t+='<div class="node-text '+a+'" data-group-id="'+e.id+'"><i class="visible-h iconfont" ms-click="switchNodeVisible">&#xe601;</i><span class="label-for"><input type="checkbox" class="ck-h" ms-click="clickNodeCk" ms-value="'+e.id+'" />&nbsp;<label class="text-content">'+e.text+"</label></span></div>",e.childrenList&&e.childrenList.length>0&&(t+='<ul class="node-list '+n+'">',_.each(e.childrenList,function(e){t+='<li class="node-item">'+l(e)+"</li>"}),t+="</ul>"),t},c=$(".control-range-wrapper",n);t.c2s({url:i.BASE_PATH+"group/initGroup.do",success:function(a){var n;a.flag&&(n=a.data,rootNodeData={id:0,text:"root",childrenList:n,isRoot:!0},c.html(l(rootNodeData)),e.scan(c[0],[d]),t.c2s({url:i.BASE_PATH+"user/edit.do",data:{id:s.params.id,editContent:"managerSetting"},success:function(e){var t;e.flag&&(t=e.data,_.each(t.group,function(e){$('[value="'+e+'"]',c).prop("checked",!0)}),d.rangeIdSelected=_.map(t.group,function(e){return e+""}),d.exceptUserIdSelected=_.map(t.exceptUser,function(e){return{id:e.user_id,belongToGroup:e.group_id}}))}}))}})},$remove:function(t,a){var n=a+"-form";$(e.getVm(n).widgetElement).remove()}}),o});

//From origin\page\sysmanage\usermanage\settingrole\settingrole.js
define("originpagesysmanageusermanagesettingrolesettingrolejs",["avalon","util","json","originwidgetformformjs","originwidgetformselectjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i,o){function s(e){t.c2s({url:n.BASE_PATH+"role/initRole.do",success:function(t){var a;t.flag&&(a=t.data,c.roleList=_.map(a,function(e){return _.extend(e,{isChecked:!1})}),e&&e())}})}function r(){t.c2s({url:n.BASE_PATH+"user/edit.do",data:{id:o.params.id,editContent:"roleSetting"},success:function(e){var t;e.flag&&(t=e.data,_.each(t,function(e){var t=-1;_.some(c.roleList.$model,function(a,n){return a.id==e?(t=n,!0):void 0}),c.roleList.set(t,{isChecked:!0})}))}})}var d=i+"-form",l=n.getAppData("user"),c=e.define(i,function(a){a.navCrumbs=[{text:"用户管理",href:"#/sysmanage/usermanage"},{text:"设置权限组"}],a.userName=decodeURIComponent(o.params.userName),a.roleList=[],a.$formOpts={formId:d,field:[{selector:".role-list-wrapper .ck-h",name:"roleIds",tipDeep:6,rule:function(e){return e.length?!0:($(".role-list-wrapper").addClass("valid-error-field"),"权限组不能为空")}}],action:[{selector:".f-submit",handler:function(){var a,i=e.getVm(d);i.validate()&&(a=i.getFormData(),a.roleIds=[].concat(a.roleIds),_.extend(a,{id:o.params.id}),t.c2s({url:n.BASE_PATH+"user/updateRole.do",type:"post",data:a,success:function(e){1==e.flag&&t.alert({content:e.message,iconType:"success",onSubmit:function(){o.params.id==l.id?location.reload():t.jumpPage("#/sysmanage/usermanage")}})}}))}}]}});e.scan(a[0]),s(function(){r()})},$remove:function(t,a){var n=a+"-form";$(e.getVm(n).widgetElement).remove()}}),i});

//From origin\page\sysmanage\usermanage\user-add-edit.js
define("originpagesysmanageusermanageuseraddeditjs",["avalon","util","json","moment","events","originwidgetformformjs","originwidgetformselectjs","originwidgetuploaderuploaderjs","originwidgetcalendarcalendarjs"],function(e,t,a,n,i){var o=this,s=o.erp,r={},d=new i;return _.extend(r,{$init:function(i,o,r){function l(){t.c2s({url:s.BASE_PATH+"role/initRole.do",success:function(e){var t;e.flag&&(t=e.data,y.roleList=t,I.role=!0,_.every(I,function(e){return e})&&d.trigger("cptInited"))}})}function c(){t.c2s({url:s.BASE_PATH+"position/initPosition.do",success:function(t){var a,n=e.getVm(p);t.flag&&(a=t.data,n.setOptions(_.map(a,function(e){return{text:e.position_name,value:e.id}}),0),I.position=!0,_.every(I,function(e){return e})&&d.trigger("cptInited"))}})}function u(){t.c2s({url:s.BASE_PATH+"user/edit.do",data:{id:r.params.id,editContent:"baseSetting"},success:function(t){var a,i,o=t.data,s=-1;t.flag&&(y.userType="0"==o.isFormal?"new":"old",y.userName=o.userName,y.birthday=n.unix(o.birthday).format("YYYY-MM-DD"),y.sex=o.genderType,y.mobile=o.tel,y.belongToGroupId=o.groupId||"",y.belongToGroupName=o.groupName||"",y.userAvatar=o.userImage||"",y.fileName=o.fileName||"","sysmanage"===y.mainRouteName&&(a=e.getVm(p),i=a.panelVmodel,y.macList=_.map(o.macs,function(e){return{value:e}}),_.some(i.options.$model,function(e,t){return e.value==o.positionId?(s=t,!0):void 0}),i.selectedIndex=s))}})}var m=o+"-uploader",p=o+"-position",g=o+"-organization",f=o+"-form",v=o+"-birthday",h=s.getAppData("user"),y=e.define(o,function(i){i.$skipArray=["tempRangeId"],i.mainRouteName=r.route.split("/")[1],i.state=o.split("-").pop(),i.navCrumbs=[{text:"用户管理",href:"#/sysmanage/usermanage"},{text:"add"===i.state?"添加用户":"修改用户"}],i.userAvatar=s.ASSET_PATH+"image/user-avatar-default.png",i.userType="new",i.birthday="",i.sex="0",i.userName="",i.mobile="",i.macList=[{value:""}],i.roleList=[],i.rangeIdSelected=[],i.exceptUserIdSelected=[],i.tempUserList=[],i.tempUserListVisible=!1,i.tempRangeId="",i.belongToGroupId="",i.belongToGroupName="",i.fileName="",i.$uploaderOpts={uploaderId:m,uploadifyOpts:{uploader:s.BASE_PATH+"user/uploadImage.do",formData:{sessionId:h.sessionId},fileTypeDesc:"图片文件(*.gif; *.jpg; *.png; *.jpeg)",fileTypeExts:"*.gif; *.jpg; *.png; *.jpeg",fileSizeLimit:"2MB",fileObjName:"myfiles",multi:!1},onSuccessResponseData:function(e){var t=a.parse(e);i.userAvatar=t.data[0].relativePath,i.fileName=t.data[0].fileName}},i.$positionOpts={selectId:p,options:[],selectIndex:0},i.$organizationOpts={dialogId:g,title:"选择部门",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},clickNode:function(){var e=$(this),t=e.closest(".node-text");i.belongToGroupId=t.data("groupId"),i.belongToGroupName=t.data("groupName")},onOpen:function(){},onClose:function(){},submit:function(){e.getVm(g).close()}},i.$formOpts={formId:f,field:[{selector:".user-type",name:"isFormal",getValue:function(){return $(this).filter(".mn-radio-state-selected").data("userType")}},{selector:".user-name",name:"userName",rule:["noempty",function(e,t){return t[0]!==!0?"姓名不能为空":!0}]},{selector:".birthday",name:"birthday",getValue:function(){var e=_.str.trim($(this).val());return e.length?n(e,"YYYY-MM-DD").unix():0},rule:function(e){return 0===e?"生日不能为空":!0}},{selector:".sex",name:"genderType"},{selector:".mac-wrapper",name:"macs",getValue:function(){var e=[];return _.each(i.macList.$model,function(t){var a=_.str.trim(t.value);a&&e.push(a)}),e},rule:function(e){return e.length?!0:"MAC地址不能为空"}},{selector:".mobile",name:"tel",rule:["noempty",function(e,t){if(t[0]!==!0)return"手机号不能为空";var a=/^(13[0-9]|15[0-9]|18[0-9])\d{8}$/;return a.test(e)?!0:"手机号错误"}]},{selector:".user-avatar",name:"userImage",getValue:function(){return"img"}},{selector:".organization",name:"groupId",getValue:function(){return i.belongToGroupId},rule:["noempty",function(e,t){return t[0]!==!0?"部门不能为空":!0}]},{selector:".position",name:"positionId",getValue:function(){return e.getVm(p).selectedValue},rule:function(e){return e?!0:"职位不能为空"}},{selector:".control-range-wrapper",name:"group",getValue:function(){return i.rangeIdSelected.$model}},{selector:".role-list-wrapper .ck-h",name:"roleIds",tipDeep:6,rule:function(e){return e.length?!0:($(".role-list-wrapper").addClass("valid-error-field"),"权限组不能为空")}},{selector:".old-pwd",name:"oldPassword"},{selector:".confirm-pwd",name:"newPassword"},{selector:".confirm-pwd",name:"password",rule:function(e,t,a){var n=_.str.trim($(".new-pwd",a).val());return(e.length||n.length)&&e!==n?"确认密码不一致":!0}}],action:[{selector:".f-submit",handler:function(){var n,o=e.getVm(p),d=e.getVm(f);d.validate()&&(n=d.getFormData(),n.exceptUser=i.exceptUserIdSelected.$model,"edit"===i.state?n.id=r.params.id:n.roleIds=[].concat(n.roleIds),n.fileName=i.fileName,t.c2s({url:s.BASE_PATH+"user/saveUser.do",type:"post",contentType:"application/json",data:a.stringify(n),success:function(e){1==e.flag&&("add"==i.state&&(d.reset(),i.userAvatar=s.ASSET_PATH+"image/user-avatar-default.png",i.userType="new",i.sex="0",i.birthday="",i.userName="",i.mobile="",i.rangeIdSelected=[],i.exceptUserIdSelected=[],i.tempUserList=[],i.tempUserListVisible=!1,i.tempRangeId="",i.belongToGroupId="",i.belongToGroupName="",i.fileName="",o.select(0,!0)),t.alert({content:e.message,iconType:"success",onSubmit:function(){t.jumpPage("#/sysmanage/usermanage")}}))}}))}}]},i.$birthdayOpts={calendarId:v,maxDate:new Date,onClickDate:function(e){i.birthday=n(e).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},i.openBirthdayPanel=function(){var a,o=$(this),s=e.getVm(v),r=o.offset();s?a=$(s.widgetElement):(a=$('<div ms-widget="calendar,$,$birthdayOpts"></div>'),a.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(a[0],[i]),s=e.getVm(v),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),s.focusDate=i.birthday?n(i.birthday,"YYYY-MM-DD")._d:new Date,a.css({top:r.top+o.outerHeight()-1,left:r.left}).show()},i.addMoreMac=function(){i.macList.push({value:""})},i.removeMacItem=function(){var e=this.$vmodel.$model,t=e.$index;i.macList.removeAt(t)},i.openOrganizationDialog=function(){var t=e.getVm(g);t.open()},i.switchNodeVisible=function(){var e=$(this),t=e.closest(".node-text"),a=t.next(".node-list"),n=e.data("visibleState")||"shown";"shown"==n?(a.slideUp("fast"),e.data("visibleState","hidden").html("&#xe600;")):(a.slideDown("fast"),e.data("visibleState","shown").html("&#xe601;"))},i.clickNodeCk=function(){var e=$(this),t=e.closest(".node-text"),a=t.next(".node-list");i.closeTempUserList(),e.prop("checked")?($(".ck-h",a).prop("checked",!0),i.tempRangeId=t.data("groupId"),i.tempUserListVisible=!0):$(".ck-h",a).prop("checked",!1),$(":checked",S).each(function(){i.rangeIdSelected.ensure($(this).val())})},i.closeTempUserList=function(){i.tempRangeId="",i.tempUserListVisible=!1},i.clickTempUserItem=function(){var e=this.$vmodel.$model,t=e.$index,a=-1;e.el.isChecked?(i.tempUserList.set(t,{isChecked:!1}),_.some(i.exceptUserIdSelected,function(t){return t.id==e.el.id})||i.exceptUserIdSelected.push({id:e.el.id,belongToGroup:e.el.group_id})):(i.tempUserList.set(t,{isChecked:!0}),_.some(i.exceptUserIdSelected,function(t,n){t.id==e.el.id&&(a=n)})&&i.exceptUserIdSelected.removeAt(a))},i.$watch("tempUserListVisible",function(e){e&&t.c2s({url:s.BASE_PATH+"user/getUserOfGroup.do",data:{groupId:i.tempRangeId},success:function(e){var t;e.flag&&(t=e.data,i.tempUserList=_.map(t,function(e){return _.extend(e,{isChecked:!0})}))}})})});e.scan(i[0]),y.rangeIdSelected.$watch("length",function(){y.exceptUserIdSelected=_.filter(y.exceptUserIdSelected.$model,function(e){return _.some(y.rangeIdSelected,function(t){return t==e.belongToGroup})?!0:void 0})});var b=function(e){var t="",a="",n="";return e.childrenList&&0!==e.childrenList.length||(a="leaf-node-text"),e.isRoot&&(a+=" root-node-text",n="root-node-list"),t+='<div class="node-text '+a+'" data-group-id="'+e.id+'" data-group-name="'+e.text+'" ms-class="state-selected: belongToGroupId == '+e.id+'"><i class="visible-h iconfont" ms-click="switchNodeVisible">&#xe601;</i><label class="text-content" ms-click="clickNode">'+e.text+"</label></div>",e.childrenList&&e.childrenList.length>0&&(t+='<ul class="node-list '+n+'">',_.each(e.childrenList,function(e){t+='<li class="node-item">'+b(e)+"</li>"}),t+="</ul>"),t},T=function(e){var t="",a="",n="";return e.childrenList&&0!==e.childrenList.length||(a="leaf-node-text"),e.isRoot&&(a+=" root-node-text",n="root-node-list"),t+='<div class="node-text '+a+'" data-group-id="'+e.id+'"><i class="visible-h iconfont" ms-click="switchNodeVisible">&#xe601;</i><span class="label-for"><input type="checkbox" class="ck-h" ms-click="clickNodeCk" ms-value="'+e.id+'" />&nbsp;<label class="text-content">'+e.text+"</label></span></div>",e.childrenList&&e.childrenList.length>0&&(t+='<ul class="node-list '+n+'">',_.each(e.childrenList,function(e){t+='<li class="node-item">'+T(e)+"</li>"}),t+="</ul>"),t},I={group:!1,position:!1};"add"===y.state&&(I.role=!1,I.range=!1),"add"===y.state?l():d.on("cptInited",function(){u()});var S=$(".control-range-wrapper",i);"sysmanage"===y.mainRouteName?(t.c2s({url:s.BASE_PATH+"group/initGroup.do",success:function(t){var a,n;t.flag&&(a=t.data,n={id:0,text:"root",childrenList:a,isRoot:!0},e.getVm(g).setContent('<div class="group-wrapper">'+b(n)+"</div>"),"add"===y.state&&(S.html(T(n)),e.scan(S[0],[y]),I.range=!0),I.group=!0,_.every(I,function(e){return e})&&d.trigger("cptInited"))}}),c()):"profile"===y.mainRouteName&&d.trigger("cptInited")},$remove:function(t,a){var n=a+"-uploader",i=a+"-position",o=a+"-organization",s=a+"-form",r=a+"-birthday",l=e.getVm(r);$(e.getVm(n).widgetElement).remove(),"sysmanage"===e.getVm(a).mainRouteName&&($(e.getVm(i).widgetElement).remove(),$(e.getVm(o).widgetElement).remove()),$(e.getVm(s).widgetElement).remove(),l&&$(l.widgetElement).remove(),d.off("cptInited")}}),r});

//From origin\page\sysmanage\usermanage\usermanage.js
define("originpagesysmanageusermanageusermanagejs",["avalon","util","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetformselectjs"],function(e,t){var a=this,n=a.erp,i={};return _.extend(i,{$init:function(a,i){function o(a){var i=e.getVm(s),o={userName:d.name,tel:d.phone,positionId:e.getVm(r).selectedValue};a?(o.pageSize=i.perPages,o.pageNumber=1):(o.pageSize=i.perPages,o.pageNumber=i.currentPage),t.c2s({url:n.BASE_PATH+"user/list.do",data:o,success:function(e){var t;e.flag&&(t=e.data,i.total=t.totalSize,a&&(i.currentPage=1),_.each(t.rows,function(e){var t=[];_.each(e.listRoles,function(e){t.push(e.roleName)}),e.patchedRoleNames=0==t.length?"":t.join(","),e.positionName=e.position?e.position.positionName:""}),d.gridData=t.rows,d.gridTotalSize=t.totalSize,d.gridAllChecked=!1,d.gridSelected.clear())}})}var s=i+"-pagination",r=i+"-position",d=e.define(i,function(a){a.name="",a.phone="",a.gridTotalSize=0,a.gridData=[],a.gridAllChecked=!1,a.gridSelected=[],a.addEditState="",a.gridCheckAll=function(){this.checked?a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""}):a.gridSelected.clear()},a.$positionOpts={selectId:r,options:[],selectedIndex:0},a.scCheckAll=function(){a.gridSelected=_.map(a.gridData.$model,function(e){return e.id+""})},a.$paginationOpts={paginationId:s,total:0,onJump:function(){o()}},a.jumpAddPage=function(){var e=$('<a href="#/sysmanage/usermanage/add"></a>');e.appendTo("body"),e[0].click(),e.remove()},a.search=function(){o(!0)},a.removeGridItem=function(){var t=e(this),n=t.data("userId")+"";a.gridSelected=[n],a._removeUser()},a.batchRemoveGridItem=function(){a._removeUser()},a._removeUser=function(){var e,i,o,s=function(){_.each(e,function(e){var t=-1;_.some(a.gridData.$model,function(a,n){return a.id==e?(t=n,!0):void 0})&&(a.gridData.removeAt(t),a.gridSelected.clear())})};0===a.gridSelected.size()?t.alert({content:"请先选中用户"}):(e=a.gridSelected.$model,o=n.BASE_PATH+"user/delete.do",i={id:e,defineDelete:0},t.confirm({content:"确定要删除选中的用户吗？",onSubmit:function(){t.c2s({url:o,type:"post",data:i,success:function(e){1==e.flag?s():2==e.flag&&(i.defineDelete=1,t.confirm({content:e.message,onSubmit:function(){t.c2s({url:o,type:"post",data:i,success:function(e){e.flag&&s()}})}}))}})}}))}});d.gridSelected.$watch("length",function(e){d.gridAllChecked=e===d.gridData.size()}),e.scan(a[0],[d]),o(),t.c2s({url:n.BASE_PATH+"position/initPosition.do",success:function(t){var a=e.getVm(r);1==t.flag&&a.setOptions([{value:"",text:"全部职位"}].concat(_.map(t.data,function(e){return{text:e.position_name,value:e.id}})),0)}})},$remove:function(t,a){var n=a+"-pagination",i=a+"-position";$(e.getVm(n).widgetElement).remove(),$(e.getVm(i).widgetElement).remove()}}),i});

//From origin\page\sysmanage\webkit\webkit.js
define("originpagesysmanagewebkitwebkitjs",["avalon","util","moment","originwidgetpaginationpaginationjs","dialog","originwidgetformformjs","originwidgetformselectjs","originwidgetgridgridjs","originwidgetuploaderuploaderjs"],function(e,t,a){var n=this,i=n.erp,o={};return _.extend(o,{$init:function(n,o){var s=o+"-grid",r=o+"-add-dialog",d=o+"-add-form",l=o+"-uploader",c=o+"-version-num-1",u=o+"-version-num-2",m=o+"-version-num-3",p=i.getAppData("user"),g=e.define(o,function(n){n.permission={},n.$gridOpts={gridId:s,recordUnit:"个版本",tableLayout:"fixed",columns:[{dataIndex:"versionNum",text:"版本号"},{dataIndex:"updateTime",text:"更新日期",renderer:function(e){return a(e).format("YYYY-MM-DD HH:mm:ss")}},{dataIndex:"description",text:"更新说明",width:420},{dataIndex:"fileSize",text:"文件大小（M）",renderer:function(e){return(e/1024/1024).toFixed(2)}},{dataIndex:"operation",text:"操作",html:!0,textAlign:"left",renderer:function(e,t){return'<a href="'+t.downloadLink+'" class="download-l">下载应用</a>&nbsp;&nbsp;&nbsp;&nbsp;<a href="javascript:;" class="remove-l" ms-click="removeGridItem" data-record-id="'+t.id+'">删除</a></td>'}}],onLoad:function(e,a){t.c2s({url:i.BASE_PATH+"webkit/list.do",data:e,success:function(e){var t;e.flag&&(t=e.data,a.call(this,t))}})},removeGridItem:function(){var t=$(this),a=e.getVm(s),n=t.data("recordId");a.selectById(n,!0),a._removeRecord()},_removeRecord:function(){var a,n,o,r=e.getVm(s),d=r.getSelectedData();0===d.length?t.alert({content:"请先选中记录"}):(a=_.map(d,function(e){return e.id}),o=i.BASE_PATH+"webkit/deleteWebkit.do",n={id:a[0]},t.confirm({content:"确定要删除选中的版本吗？",onSubmit:function(){t.c2s({url:o,type:"post",dataType:"json",data:n,success:function(e){e.flag&&r.load()}})}}))}},n.$addDialogOpts={dialogId:r,title:"上传新版应用",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onOpen:function(){},onClose:function(){var t=e.getVm(d);t.reset(),t.originalFileName="",t.attachmentName="",t.attachmentSize=0,e.getVm(c).select(0,!0),e.getVm(u).select(0,!0),e.getVm(m).select(0,!0)},submit:function(){var a,n,o,p=e.getVm(r),g=e.getVm(d),f=e.getVm(s),v=e.getVm(l);g.validate()&&(n=i.BASE_PATH+"webkit/saveWebkit.do",o=function(){a=g.getFormData(),a.versionNum="v."+e.getVm(c).selectedValue+"."+e.getVm(u).selectedValue+"."+e.getVm(m).selectedValue,t.c2s({url:n,type:"post",contentType:"application/json",data:JSON.stringify(a),success:function(e){e.flag&&t.alert({iconType:"success",content:e.message,onSubmit:function(){p.close(),f.load(1)}})}})},v.uploading?(t.showGlobalMask(),v.$unwatch("uploading"),v.$watch("uploading",function(e){e||(t.hideGlobalMask(),o(),v.$unwatch("uploading"))})):o())}},n.$addFormOpts={formId:d,field:[{selector:".version-uploader",name:"attachmentVO",getValue:function(){var t=e.getVm(d);return{attachmentName:t.attachmentName,originalFileName:t.originalFileName,attachmentSize:t.attachmentSize}},rule:function(){var t=e.getVm(d);return t.attachmentName.length?!0:"上传版本文件不能为空"}},{selector:".update-desc",name:"description",rule:["noempty",function(e,t){return t[0]!==!0?"更新说明不能为空":!0}]},{selector:'[name="page_sysmanage_webkit_add_is_forced_upgrade"]',name:"isForcedUpgrade"}],originalFileName:"",attachmentName:"",attachmentSize:0,$uploaderOpts:{uploaderId:l,uploadifyOpts:{uploader:i.BASE_PATH+"webkit/uploadImage.do",formData:{sessionId:p.sessionId},fileObjName:"myfiles",multi:!1,fileTypeDesc:"Webkit文件(*.*)",fileTypeExts:"*.*",fileSizeLimit:"100MB",width:88,height:30,onSelect:function(){var t=e.getVm(l);t.uploadList.size()&&t.removeFile(t.uploadList[0].id)}},onSuccessResponseData:function(a){var n,i=JSON.parse(a),o=e.getVm(d);i.flag?(n=i.data[0],o.originalFileName=n.originalFileName,o.attachmentName=n.fileName,o.attachmentSize=n.fileSize):t.alert({content:i.message,iconType:"error"})}},$versionNum1Opts:{selectId:c,options:_.map(_.range(1,31),function(e){return{text:e,value:e}})},$versionNum2Opts:{selectId:u,options:_.map(_.range(0,31),function(e){return{text:e,value:e}})},$versionNum3Opts:{selectId:m,options:_.map(_.range(0,31),function(e){return{text:e,value:e}})}},n.openAdd=function(){e.getVm(r).open()}});e.scan(n[0],[g]),e.getVm(s).load()},$remove:function(t,a){var n=a+"-grid",i=a+"-add-dialog",o=a+"-add-form",s=a+"-uploader",r=a+"-version-num-1",d=a+"-version-num-2",l=a+"-version-num-3";$(e.getVm(n).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(d).widgetElement).remove(),$(e.getVm(l).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(i).widgetElement).remove()}}),o});

//From origin\page\welcome\welcome.js
define("originpagewelcomewelcomejs",["avalon","util","json","moment","originmoduleaddproductaddproductjs"],function(e){var t=this,a=t.erp,n={};return _.extend(n,{$init:function(t,n){$(".page-bd-inner",t),e.define(n,function(e){e.noPermission=!a.getAppData("permission").length,e.noCourse=!a.getAppData("user").hasCourse});e.scan(t[0])},$remove:function(){}}),n});

//From origin\page\wldh\setting\setting.js
define("originpagewldhsettingsettingjs",["avalon","util","moment","json","originwidgetitemselectoritemselectorjs","dialog","originwidgetformselectjs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s){function r(){var n=e.getVm(u),i=e.getVm(m);t.c2s({url:o.BASE_PATH+"mktTeam/list.do",type:"get",data:{date:a(n.selectedValue+"-"+i.selectedValue,"YYYY-M")/1},success:function(e){var t=e.data;e.flag&&(v.teamList=_.map(t,function(e){return{id:e.id,teamName:e.teamName,teamLeader:e.leaderName,teamMember:e.teamMember,teamWord:e.teamSlogan,odds:e.teamOdds,oddsState:"r",oddsBtnText:"修改",income:e.salesDegrees,incomeState:"r",incomeBtnText:"修改",supportVisibleCtrBtnText:"查看支持者",supportVisibleState:!1,supportNum:e.supportCount,supportList:[]}}))}})}function d(e,a){t.c2s({url:o.BASE_PATH+"mktTeam/listSupport.do",type:"get",data:e,success:function(e){e.flag&&a&&a(e.data)}})}var l=s+"-add-support-dialog",c=s+"-user-selector",u=s+"-current-year",m=s+"-current-month",p=a(),g=p.year(),f=p.month(),v=e.define(s,function(a){a.activeTeamId=0,a.activeTeamAtIndex=-1,a.$addSupportOpts={dialogId:l,title:"添加支持者",width:600,getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},submit:function(){var i=e.getVm(c),s=i.getSelectedData();t.c2s({url:o.BASE_PATH+"mktTeam/saveSupporter.do",type:"post",contentType:"application/json",data:n.stringify({id:a.activeTeamId,supportList:_.map(s,function(e){return{id:e.id}})}),success:function(t){t.flag&&(d({teamId:a.activeTeamId},function(e){a.teamList.set(a.activeTeamAtIndex,{supportNum:e.length,supportList:_.map(e,function(e){return{id:e.id,supportName:e.userName,position:e.position.positionName}})})}),e.getVm(l).close())}})}},a.$userSelectorOpts={itemselectorId:c,rightTitle:"已添加的支持者（0）",showLeftTitle:!1,showRightFilter:!1,onItemFilter:function(e,t){return t.userName.slice(0,e.length)===e||t.positionName.slice(0,e.length)===e?!0:void 0}},a.$currentYearOpts={selectId:u,options:_.map(_.range(0,10),function(e){return{text:g-e+"年",value:g-e}}),onSelect:function(){r()}},a.$currentMonthOpts={selectId:m,options:_.map(_.range(1,13),function(e){return{text:e+"月",value:e}}),onSelect:function(){r()},selectedIndex:f},a.teamList=[],a.clickOddsBtn=function(){var e,i,s=this.$vmodel.$model.$index,r=this.$vmodel.$model.el,d=a.teamList[s].oddsState;if("e"===d){if(e=_.str.trim($(this).siblings(".odds-editor").val()),!e.length)return i=a.teamList[s].odds,a.teamList[s].odds="",a.teamList[s].odds=i,a.teamList[s].oddsState="r",void(a.teamList[s].oddsBtnText="修改");t.c2s({url:o.BASE_PATH+"mktTeam/saveMktTeam.do",type:"post",contentType:"application/json",data:n.stringify({id:r.id,teamOdds:e}),success:function(t){t.flag&&a.teamList.set(s,{oddsState:"r",oddsBtnText:"修改",odds:e})}})}else a.teamList.set(s,{oddsState:"e",oddsBtnText:"保存"})},a.clickIncomeBtn=function(){var e,i,s=this.$vmodel.$model.$index,r=this.$vmodel.$model.el,d=a.teamList[s].incomeState;if("e"===d){if(e=_.str.trim($(this).closest(".income-box").find(".income-editor").val()),!e.length)return i=a.teamList[s].income,a.teamList[s].income="",a.teamList[s].income=i,a.teamList[s].incomeState="r",void(a.teamList[s].incomeBtnText="修改");if(!/^-?\d+(\.\d{1,2})?$/.test(e))return void t.alert({content:"请输入正确格式的数字，最多保留2位小数",iconType:"error"});t.c2s({url:o.BASE_PATH+"mktTeam/saveMktTeam.do",type:"post",contentType:"application/json",data:n.stringify({id:r.id,salesDegrees:e}),success:function(t){t.flag&&a.teamList.set(s,{incomeState:"r",incomeBtnText:"修改",income:e})}})}else a.teamList.set(s,{incomeState:"e",incomeBtnText:"保存"})},a.clickSupportVisibleBtn=function(){var e=this.$vmodel.$model.$index,t=this.$vmodel.$model.el,n=a.teamList[e].supportVisibleState;n?a.teamList.set(e,{supportVisibleState:!1,supportVisibleCtrBtnText:"查看支持者",supportList:[]}):d({teamId:t.id},function(t){a.teamList.set(e,{supportVisibleState:!0,supportVisibleCtrBtnText:"收起",supportNum:t.length,supportList:_.map(t,function(e){return{id:e.id,supportName:e.userName,position:e.position.positionName}})})})},a.addMoreSupport=function(){{var n=e.getVm(l),i=e.getVm(c),s=this.$vmodel.$model.el,r=this.$vmodel.$model.$index;this.$vmodel.$model.el.supportList}t.c2s({url:o.BASE_PATH+"mktTeam/listNoChooseSupport.do",type:"get",data:{teamId:s.id},success:function(e){var t,o,d;e.flag&&(t=e.data,o=t.chooseSupportList,d=t.noChooseSupportList,i.store=_.map(o,function(e){return{text:'<div class="fn-clear"><div class="fn-left">'+e.userName+'</div><div class="fn-right">'+e.position.positionName+"</div></div>",visible:!0,selected:!0,preSelected:!1,userName:e.userName,positionName:e.position.positionName,id:e.id}}).concat(_.map(d,function(e){return{text:'<div class="fn-clear"><div class="fn-left">'+e.userName+'</div><div class="fn-right">'+e.position.positionName+"</div></div>",visible:!0,selected:!1,preSelected:!1,userName:e.userName,positionName:e.position.positionName,id:e.id}})),i.rightTitle="已添加的支持者（"+o.length+"）",a.activeTeamId=s.id,a.activeTeamAtIndex=r,n.open())}})},a.removeSupport=function(){var n=e(this),i=n.data("teamId"),s=n.data("userId"),r=this.$vmodel.$outer.$index;t.c2s({url:o.BASE_PATH+"mktTeam/deleteSupport.do",type:"post",data:{teamId:i,supportId:s},success:function(e){e.flag&&d({teamId:i},function(e){a.teamList.set(r,{supportNum:e.length,supportList:_.map(e,function(e){return{id:e.id,supportName:e.userName,position:e.position.positionName}})})})}})}});e.scan(i[0]),e.getVm(c).$watch("selectedchange",function(){this.rightTitle="已添加的支持者（"+_.filter(this.store.$model,function(e){return e.selected}).length+"）"}),r()},$remove:function(t,a){var n=a+"-add-support-dialog",i=a+"-user-selector",o=a+"-current-year",s=a+"-current-month";$(e.getVm(o).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove()}}),s});

//From origin\page\wldh\show\show.js
define("originpagewldhshowshowjs",["avalon","util","moment","json","originwidgetformselectjs"],function(e,t,a){var n=this,i=n.erp,o={},s=[];return _.extend(o,{$init:function(n,o){function r(e,a,n){t.c2s({url:i.BASE_PATH+a,type:"post",data:e,success:n})}function d(e){var t;if(e.flag){t=e.data,c.pageData=[];for(var a=0;a<t.length;a++){var n={},i=[];n.id=t[a].id,n.leaderImage=t[a].leaderImage,n.leaderName=t[a].leaderName,n.teamMember=t[a].teamMember,n.teamOdds=t[a].teamOdds,n.salesDegrees=t[a].salesDegrees,n.lold="hide",n.supporters=[],forArr=t[a].supportList;for(var o=0,s=0;s<forArr.length;s++)o++,i.push(forArr[s].userName),o>=18&&(o=0,n.supporters.push(i),i=[]);i.length&&n.supporters.push(i),c.pageData.push(n)}}}var l=function(e){var t=o+e;return s.push(t),t},c=(i.getAppData("user"),e.define(o,function(t){t.pageData=[{id:0,leaderImage:"",leaderName:"",teamMember:"",teamOdds:"",salesDegrees:"",supporters:[],lold:""}],t.loldStatus=function(e){var a=this.$vmodel.$model.el.lold;"hide"==a?t.pageData[e].lold="show":"show"==a&&(t.pageData[e].lold="hide")},t.$yearOpts={selectId:l("yearId"),options:[{text:"2014年",value:2014}],onSelect:function(){}};var n=new Date,i=n.getMonth();t.$monthOpts={selectId:l("monthId"),options:[{text:"1月",value:1},{text:"2月",value:2},{text:"3月",value:3},{text:"4月",value:4},{text:"5月",value:5},{text:"6月",value:6},{text:"7月",value:7},{text:"8月",value:8},{text:"9月",value:9},{text:"10月",value:10},{text:"11月",value:11},{text:"12月",value:12}],onSelect:function(){var t=e.getVm(l("yearId")),n=e.getVm(l("monthId")),i=t.selectedValue+"-"+n.selectedValue,o=a(i,"yyyy-M")/1;r({isFromAssiant:!0,date:o},"mktTeam/list.do",d)},selectedIndex:i}}));e.scan(n[0]);var u=new Date;r({isFromAssiant:!0,date:u.getTime()},"mktTeam/list.do",d)},$remove:function(){_.each(s,function(t){var a=e.getVm(t);a&&$(a.widgetElement).remove()}),s.length=0}}),o});

//From origin\page\work\assign\assign.js
define("originpageworkassignassignjs",["avalon","util","moment","json","originwidgetformformjs","originwidgetformselectjs","originwidgetuploaderuploaderjs","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s,r){function d(){var a=e.getVm(f),i=e.getVm(m),s=e.getVm(p);t.c2s({url:o.BASE_PATH+"group/getSubordinateEmployees.do",type:"post",contentType:"application/json",data:n.stringify({baseUserId:y.id}),success:function(e){var t;e.flag&&(t=e.data,a.setOptions([{text:"请选择",value:-1}].concat(_.map(t,function(e){return{text:e.userName,value:e.id}}))))}}),t.c2s({url:o.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000063",success:function(e){var t;e.flag&&(t=e.data,i.setOptions([{text:"请选择",value:0}].concat(_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}))))}}),t.c2s({url:o.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000064",success:function(e){var t;e.flag&&(t=e.data,s.setOptions([{text:"请选择",value:0}].concat(_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}))))}})}{var l=s+"-start-hour",c=s+"-start-minute",u=s+"-project",m=s+"-plan-item-type",p=s+"communication-form-type",g=s+"-attach-uploader",f=s+"-assigner",v=s+"-start-date",h=s+"-form",y=o.getAppData("user"),b=$(".upload-info",i);e.define(s,function(i){i.belongToRouteName=r.route.split("/")[1],"work"===i.belongToRouteName?i.navCrumbs=[{text:"工作计划",href:"#/work/plan"},{text:"工作指派"}]:"frontend"===i.belongToRouteName&&(i.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"工作指派"}]),i.$assignerOpts={selectId:f,options:[],onSelect:function(a){var n=e.getVm(u);n.setOptions([{text:"请选择",value:-1}]),-1!==a&&t.c2s({url:o.BASE_PATH+"synMerchant/getSynMerchantByUserId.do",type:"get",contentType:"application/json",data:{userId:a},success:function(e){var t;e.flag&&(t=e.data,n.setOptions([{text:"请选择",value:-1}].concat(_.map(t,function(e){return{text:e.merchant_name,value:e.merchant_id}})).concat({text:"其它",value:0})))}})}},i.$startHourOpts={selectId:l,options:_.map(_.range(0,24),function(e){return{text:_.str.lpad(e,2,"0"),value:e}}),selectedIndex:9},i.$startMinuteOpts={selectId:c,options:_.map(_.range(0,60),function(e){return{text:_.str.lpad(e,2,"0"),value:e}})},i.$projectOpts={selectId:u,options:[{text:"请选择",value:-1}]},i.$planItemTypeOpts={selectId:m,options:[]},i.$communicationFormTypeOpts={selectId:p,options:[]},i.$attachUploaderOpts={uploaderId:g,uploadifyOpts:{uploader:o.BASE_PATH+"fesPlan/uploadPlanFiles.do",fileObjName:"myfiles",multi:!0,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",formData:{sessionId:y.sessionId},width:116,height:30},defaultExtKeyData:{originalFileName:"",attachmentName:"",attachmentSize:"",attachmentSuffix:""},onSuccessResponseData:function(e,t){var a=n.parse(e),i={};return a.flag&&(i.originalFileName=a.data[0].originalFileName,i.attachmentName=a.data[0].fileName,i.attachmentSize=t.fileSize+"",i.attachmentSuffix=t.type.slice(1)),i},removeItem:function(){var t=this.$vmodel.$model,a=t.el.id;e.getVm(g).removeFile(a)}},i.$formOpts={formId:h,field:[{selector:".assigner",name:"userId",getValue:function(){return e.getVm(f).selectedValue},rule:function(e){return-1===e?"请选择指派人":!0}},{selector:".start-date",name:"startTime",getValue:function(){var t=_.str.trim($(this).val());return t?a(t+" "+e.getVm(l).selectedValue+":"+e.getVm(c).selectedValue,"YYYY-MM-DD H:m")/1:0},rule:function(e){return e?!0:"请设置开始时间"}},{selector:".project",name:"merchantId",getValue:function(){return e.getVm(u).selectedValue},rule:function(e){return-1===e?"请选择对应的项目":!0}},{selector:".plan-item-type",name:"planItemType",getValue:function(){return e.getVm(m).selectedValue},rule:function(e){return e?!0:"请选择对应的事项类型"}},{selector:".communication-form-type",name:"communicationFormType",getValue:function(){return e.getVm(p).selectedValue},rule:function(e){return e?!0:"请选择对应的沟通方式"}},{selector:".title",name:"title",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":e.length>20?"标题不能超过20个字符":!0}]},{selector:".desc",name:"description"},{selector:".attach-uploader",name:"attachmentList",reset:function(){var t=e.getVm(g);"add"==i.formState&&t.removeAllFile()},getValue:function(){var t=e.getVm(g),a=t.uploadList,n=[];return _.each(a.$model,function(e,t){n[t]={originalFileName:e.name,attachmentName:e.attachmentName,attachmentSize:e.attachmentSize+"",attachmentSuffix:e.attachmentSuffix,attachmentId:e.attachmentId}}),n}}]},i.startDate="",i.$startDateOpts={calendarId:v,onClickDate:function(e){i.startDate=a(e).format("YYYY-MM-DD"),$(this.widgetElement).hide()}},i.openStartDateCalendar=function(){var n,o=$(this),s=e.getVm(v),r=o.offset();s?n=$(s.widgetElement):(n=$('<div ms-widget="calendar,$,$startDateOpts"></div>'),n.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(n[0],[i]),s=e.getVm(v),t.regGlobalMdExcept({element:n,handler:function(){n.hide()}})),s.focusDate=i.startDate?a(i.startDate,"YYYY-MM-DD")._d:new Date,n.css({top:r.top+o.outerHeight()-1,left:r.left}).show()},i.submit=function(){var a,s,r=e.getVm(h),d=e.getVm(g);r.validate()&&(s=function(){a=r.getFormData(),a.endTime=0,a.sponsor=y.id,a.remark="",a.plansSource="2",a.isSendSms=!1,a.isRemind=!1,a.remindTime=0,0===a.merchantId&&(a.merchantId=null),t.c2s({url:o.BASE_PATH+"fesPlan/saveFesPlan.do",type:"post",contentType:"application/json",data:n.stringify(a),success:function(e){e.flag&&t.alert({content:e.message,iconType:"success",onSubmit:function(){"work"===i.belongToRouteName?t.jumpPage("#/work/plan"):"frontend"===i.belongToRouteName&&t.jumpPage("#/frontend/home")}})}})},d.uploading?(t.showGlobalMask(),d.$unwatch("uploading"),d.$watch("uploading",function(e){e||(t.hideGlobalMask(),s(),d.$unwatch("uploading"))})):s())}})}e.scan(i[0]),b.removeClass("fn-hide").removeAttr("ms-skip"),e.scan(b[0],[e.getVm(g)]),d()},$remove:function(t,a){var n=a+"-start-hour",i=a+"-start-minute",o=a+"-project",s=a+"-plan-item-type",r=a+"communication-form-type",d=a+"-attach-uploader",l=a+"-form",c=a+"-assigner",u=a+"-start-date",m=e.getVm(u);m&&$(m.widgetElement).remove(),$(e.getVm(d).widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove(),$(e.getVm(c).widgetElement).remove(),$(e.getVm(l).widgetElement).remove()}}),s});

//From origin\page\work\plan\list\list.js
define("originpageworkplanlistlistjs",["avalon","util","moment","json","originwidgetcalendarcalendarjs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s,r){function d(){t.c2s(r.params.id?{url:o.BASE_PATH+"fesPlan/queryFesPlanById.do",type:"post",contentType:"application/json",data:n.stringify({planId:r.params.id/1}),success:function(e){var t;e.flag&&(t=e.data,p.planList=[{statusText:l(t.status),status:t.status,dateIndex:a(t.start_time).format("YYYY-MM-DD HH:mm"),sponsor:t.sponsor_name,merchantName:t.merchant_name,title:t.title,description:t.description,explanation:t.explanation,attachmentList:_.map(t.attachmentList,function(e){return e.downloadUrl=o.BASE_PATH+"fesOnlineProcess/download.do?relPath="+t.planFilePath+"/"+e.attachment_name,e})}])}}:{url:o.BASE_PATH+"fesPlan/queryDailyFesPlanList.do",type:"post",contentType:"application/json",data:n.stringify({userId:m.id,startTime:p.currentDate/1,endTime:a(p.currentDate).add("days",1).subtract("seconds",1)/1}),success:function(e){var t;e.flag&&(t=e.data,p.planList=_.map(t,function(e){return{statusText:l(e.status),status:e.status,dateIndex:a(e.start_time).format("YYYY-MM-DD HH:mm"),sponsor:e.sponsor_name,merchantName:e.merchant_name,title:e.title,description:e.description,explanation:e.explanation,attachmentList:_.map(e.attachmentList,function(t){return t.downloadUrl=o.BASE_PATH+e.planFilePath+"/"+t.attachment_name,t})}}))}})}function l(e){var t="";switch(e){case"1":t="未完成";break;case"2":t="已延期";break;case"3":t="已放弃";break;case"4":t="已完成";break;case"5":t="已求助"}return t}var c=s+"-current-date-calendar",u=new Date,m=o.getAppData("user"),p=e.define(s,function(n){n.belongToRouteName=r.route.split("/")[1],"work"===n.belongToRouteName?n.navCrumbs=[{text:"工作计划",href:"#/work/plan"},{text:"工作列表"}]:"frontend"===n.belongToRouteName?n.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"工作列表"}]:"sales"===n.belongToRouteName&&(n.navCrumbs=[{text:"我的主页",href:"#/sales/home"},{text:"工作列表"}]),n.viewType=r.params.id?"single":"list",n.currentDate=a(r.params.date/1)._d,n.planList=[],n.$currentDateOpts={calendarId:c,onClickDate:function(e){n.currentDate=e,$(this.widgetElement).hide()}},n.openCurrentDateCalendar=function(){var a,i=$(this),o=e.getVm(c),s=i.offset();o?a=$(o.widgetElement):(a=$('<div ms-widget="calendar,$,$currentDateOpts"></div>'),a.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(a[0],[n]),o=e.getVm(c),t.regGlobalMdExcept({element:a,handler:function(){a.hide()}})),o.focusDate=n.currentDate?n.currentDate:u,a.css({top:s.top+i.outerHeight()-1,left:s.left-(a.outerWidth()-i.outerWidth())}).show()},n.navPrev=function(){n.currentDate=a(n.currentDate).subtract("days",1)._d},n.navNext=function(){n.currentDate=a(n.currentDate).add("days",1)._d},n.navToday=function(){n.currentDate=a(u).hour(0).minute(0).second(0)._d}});e.scan(i[0]),d(),p.$watch("currentDate",function(){d()})},$remove:function(t,a){var n=a+"-current-date-calendar",i=e.getVm(n);i&&$(i.widget).remove()}}),s});

//From origin\page\work\plan\plan-add-edit.js
define("originpageworkplanplanaddeditjs",["avalon","util","moment","json","events","originwidgetformformjs","originwidgetformselectjs","originwidgetuploaderuploaderjs","originwidgetcalendarcalendarjs"],function(e,t,a,n,i){var o=this,s=o.erp,r={},d=new i;return _.extend(r,{$init:function(i,o,r){function l(){var a=e.getVm(f),n=e.getVm(v);t.c2s({url:s.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000063",success:function(e){var t;e.flag&&(t=e.data,a.setOptions([{text:"请选择",value:0}].concat(_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}))),C.planItemType=!0,_.every(C,function(e){return e})&&d.trigger("cptInited"))}}),t.c2s({url:s.BASE_PATH+"dictionary/querySysDictionaryByType.do",type:"post",data:"dictionaryType=00000064",success:function(e){var t;e.flag&&(t=e.data,n.setOptions([{text:"请选择",value:0}].concat(_.map(t,function(e){return{text:e.dictionary_value,value:e.dictionary_key}}))),C.communicationFormType=!0,_.every(C,function(e){return e})&&d.trigger("cptInited"))}})}function c(a){var n=e.getVm(g);t.c2s({url:s.BASE_PATH+"synMerchant/getSynMerchantByUserId.do",type:"get",contentType:"application/json",data:{userId:V.userId},success:function(e){var t;e.flag&&(t=e.data,n.setOptions([{text:"请选择",value:-1}].concat(_.map(t,function(e){return{text:e.merchant_name,value:e.merchant_id}})).concat({text:"其它",value:0})),a&&a())}})}function u(i){t.c2s({url:s.BASE_PATH+"fesPlan/queryFesPlanById.do",type:"post",contentType:"application/json",data:n.stringify({planId:r.params.id/1}),success:function(n){var o;n.flag&&(o=n.data,V.userId=o.user_id,V.currentDate=a(o.start_time)._d,V.originCurrentDate=a(o.start_time)._d,e.getVm(m).selectValue(a(o.start_time).hour()),e.getVm(p).selectValue(a(o.start_time).minute()),e.getVm(f).selectValue(o.plan_item_type),e.getVm(v).selectValue(o.communication_form_type),V.title=o.title,V.desc=o.description,V.isRemindOpen=o.is_remind,V.isRemindOpen&&(e.getVm(T).selectValue(a(o.remind_time).hour()),e.getVm(b).remindDate=a(o.remind_time).format("YYYY-MM-DD")),e.getVm(h).uploadList=_.map(o.attachmentList,function(e){return{name:e.original_file_name,attachmentName:e.attachment_name,attachmentSize:e.attachment_size,attachmentSuffix:e.attachment_suffix,attachmentId:e.id,id:t.generateID(),uploaded:!0,downloadUrl:s.BASE_PATH+"fesOnlineProcess/download.do?relPath="+o.planFilePath+"/"+e.attachment_name}}),V.titleReadonly=o.sponsor==P.id?!1:!0,i&&i(o))}})}var m=o+"-start-hour",p=o+"-start-minute",g=o+"-project",f=o+"-plan-item-type",v=o+"communication-form-type",h=o+"-attach-uploader",y=o+"-form",b=o+"-remind-dialog",T=o+"-remind-time-selector",I=o+"-reason-dialog",S=o+"-reason-form",D=o+"-un-complete-selector",w=o+"-expect-date-calendar",O=o+"-expect-time-selector",x=o+"-remind-date-calendar",P=s.getAppData("user"),A=$(".upload-info",i),V=e.define(o,function(i){i.belongToRouteName=r.route.split("/")[1],"work"===i.belongToRouteName?i.navCrumbs=[{text:"工作计划",href:"#/work/plan"},{text:"添加计划"}]:"frontend"===i.belongToRouteName?i.navCrumbs=[{text:"我的主页",href:"#/frontend/home"},{text:"添加计划"}]:"sales"===i.belongToRouteName&&(i.navCrumbs=[{text:"我的主页",href:"#/sales/home"},{text:"添加计划"}]),i.formState=o.split("-").pop(),i.userId="add"===i.formState?P.id:0,i.isRemindOpen=!1,i.$watch("isRemindOpen",function(t){var a=e.getVm(b),n=e.getVm(T);i.remindTime=t?a.remindDate+" "+n.selectedText:""}),i.remindTime="",i.currentDate=a(r.params.date/1)._d,i.unCompleteState="view",i.$unCompleteOpts={selectId:D,options:[{text:"请选择",value:""},{text:"放弃",value:"giveup"},{text:"延时",value:"delay"}],onSelect:function(t,a){var n=e.getVm(I);t&&(n.title=a,n.state=t,n.reasonLabel="请说明"+a+"工作的原因",n.open()),i.unCompleteState="view"}},i.$startHourOpts={selectId:m,options:_.map(_.range(0,24),function(e){return{text:_.str.lpad(e,2,"0"),value:e}}),selectedIndex:9,onSelect:function(){i.adjustCurrentDate()}},i.$startMinuteOpts={selectId:p,options:_.map(_.range(0,60),function(e){return{text:_.str.lpad(e,2,"0"),value:e}}),onSelect:function(){i.adjustCurrentDate()}},i.$projectOpts={selectId:g,options:[]},i.$planItemTypeOpts={selectId:f,options:[]},i.$communicationFormTypeOpts={selectId:v,options:[]},i.$attachUploaderOpts={uploaderId:h,uploadifyOpts:{uploader:s.BASE_PATH+"fesPlan/uploadPlanFiles.do",fileObjName:"myfiles",multi:!0,fileTypeDesc:"上传附件(*.*)",fileTypeExts:"*.*",fileSizeLimit:"20MB",formData:{sessionId:P.sessionId},width:116,height:30},defaultExtKeyData:{originalFileName:"",attachmentName:"",attachmentSize:"",attachmentSuffix:""},onSuccessResponseData:function(e,t){var a=n.parse(e),i={};return a.flag&&(i.originalFileName=a.data[0].originalFileName,i.attachmentName=a.data[0].fileName,i.attachmentSize=t.fileSize+"",i.attachmentSuffix=t.type.slice(1)),i},removeItem:function(){var t=this.$vmodel.$model,a=t.el.id;e.getVm(h).removeFile(a)}},i.$formOpts={formId:y,field:[{selector:".start-time",name:"startTime",getValue:function(){return i.currentDate/1}},{selector:".project",name:"merchantId",getValue:function(){return e.getVm(g).selectedValue},rule:function(e){return-1===e?"请选择对应的项目":!0}},{selector:".plan-item-type",name:"planItemType",getValue:function(){return e.getVm(f).selectedValue},rule:function(e){return e?!0:"请选择对应的事项类型"}},{selector:".communication-form-type",name:"communicationFormType",getValue:function(){return e.getVm(v).selectedValue},rule:function(e){return e?!0:"请选择对应的沟通方式"}},{selector:".title",name:"title",rule:["noempty",function(e,t){return t[0]!==!0?"标题不能为空":e.length>20?"标题不能超过20个字符":!0}]},{selector:".desc",name:"description"},{selector:".attach-uploader",name:"attachmentList",reset:function(){var t=e.getVm(h);"add"==i.formState&&t.removeAllFile()},getValue:function(){var t=e.getVm(h),a=t.uploadList,n=[];return _.each(a.$model,function(e,t){n[t]={originalFileName:e.name,attachmentName:e.attachmentName,attachmentSize:e.attachmentSize+"",attachmentSuffix:e.attachmentSuffix,attachmentId:e.attachmentId}}),n}}]},i.$remindDialogOpts={dialogId:b,title:"提醒",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){i.isRemindOpen||(e.getVm(T).select(0),e.getVm(b).remindDate=a(i.currentDate).format("YYYY-MM-DD"))},remindDate:a(i.currentDate).format("YYYY-MM-DD"),$remindDateOpts:{calendarId:x,onClickDate:function(t){var n=e.getVm(T),i=new Date;e.getVm(b).remindDate=a(t).format("YYYY-MM-DD"),n.setOptions(a(t).isSame(i,"day")?_.map(_.range(a(i).hour()+1,24),function(e){return{text:_.str.lpad(e,2,"0")+":00",value:e}}):_.map(_.range(0,24),function(e){return{text:_.str.lpad(e,2,"0")+":00",value:e}})),$(this.widgetElement).hide()}},openRemindCalendar:function(){var n,i=$(this),o=e.getVm(x),s=i.offset(),r=e.getVm(b),d=new Date;o?n=$(o.widgetElement):(n=$('<div ms-widget="calendar,$,$remindDateOpts"></div>'),n.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(n[0],[r]),o=e.getVm(x),t.regGlobalMdExcept({element:n,handler:function(){n.hide()}})),o.focusDate=r.remindDate?a(r.remindDate,"YYYY-MM-DD")._d:d,o.minDate=d,o.maxDate=V.currentDate,n.css({top:s.top+i.outerHeight()-1,left:s.left}).show()},$remindTimeOpts:{selectId:T,options:_.map(_.range(0,24),function(e){return{text:_.str.lpad(e,2,"0")+":00",value:e}})},submit:function(){var o,d=e.getVm(b),l=e.getVm(T);"add"===i.formState?(i.isRemindOpen=!0,d.close()):"edit"===i.formState&&(o={},_.extend(o,{planId:r.params.id/1,isRemind:!i.isRemindOpen,isSendSms:!1,remindTime:i.isRemindOpen?0:a(d.remindDate+" "+l.selectedValue,"YYYY-MM-DD H")/1}),t.c2s({url:s.BASE_PATH+"fesPlan/updateRemindFesPlanById.do",type:"post",contentType:"application/json",data:n.stringify(o),success:function(e){e.flag&&(t.alert({content:e.message,iconType:"success"}),i.isRemindOpen=!0,d.close())}}))}},i.$reasonDialogOpts={dialogId:I,title:"",state:"",reasonLabel:"",getTemplate:function(e){var t=e.split("MS_OPTION_FOOTER"),a='<div class="ui-dialog-footer fn-clear"><div class="ui-dialog-btns"><button type="button" class="submit-btn ui-dialog-btn" ms-click="submit">确&nbsp;定</button><span class="separation"></span><button type="button" class="cancel-btn ui-dialog-btn" ms-click="close">取&nbsp;消</button></div></div>';return t[0]+"MS_OPTION_FOOTER"+a},onClose:function(){var t=e.getVm(S);t.reset(),t.expectDate=""},submit:function(){var o,d,l=e.getVm(I),c=e.getVm(S),u=e.getVm(O);c.validate()&&(o=c.getFormData(),"giveup"===l.state?d=s.BASE_PATH+"fesPlan/updateAbandonFesPlanById.do":"delay"===l.state?(d=s.BASE_PATH+"fesPlan/updateDelayFesPlanById.do",_.extend(o,{startTime:a(o.startTime+" "+u.selectedValue,"YYYY-MM-DD H")/1})):"complete"==l.state&&(d=s.BASE_PATH+"fesPlan/updateCompleteFesPlanById.do"),_.extend(o,{planId:r.params.id/1}),t.c2s({url:d,type:"post",contentType:"application/json",data:n.stringify(o),success:function(e){e.flag&&(t.alert({content:e.message,iconType:"success",onSubmit:function(){"work"===i.belongToRouteName?t.jumpPage("#/work/plan"):"frontend"===i.belongToRouteName?t.jumpPage("#/frontend/home"):"sales"===i.belongToRouteName&&t.jumpPage("#/sales/home")}}),l.close())}}))}},i.$reasonFormOpts={formId:S,expectDate:"",$expectDateOpts:{calendarId:w,onClickDate:function(t){e.getVm(S).expectDate=a(t).format("YYYY-MM-DD"),$(this.widgetElement).hide()},minDate:i.currentDate},$expectTimeOpts:{selectId:O,options:_.map(_.range(0,24),function(e){return{text:_.str.lpad(e,2,"0")+":00",value:e}})},openExpectCalendar:function(){var n,i=$(this),o=e.getVm(w),s=i.offset(),r=e.getVm(S);o?n=$(o.widgetElement):(n=$('<div ms-widget="calendar,$,$expectDateOpts"></div>'),n.css({position:"absolute","z-index":1e4}).hide().appendTo("body"),e.scan(n[0],[r]),o=e.getVm(w),t.regGlobalMdExcept({element:n,handler:function(){n.hide()}})),o.focusDate=r.expectDate?a(r.expectDate,"YYYY-MM-DD")._d:new Date,o.minDate=a(V.currentDate).add("days",1)._d,n.css({top:s.top+i.outerHeight()-1,left:s.left}).show()},field:[{selector:".reason",name:"explanation",rule:["noempty",function(e,t){return t[0]!==!0?"原因不能为空":!0}]},{selector:".expect-date",name:"startTime",rule:["noempty",function(e,t){return t[0]!==!0?"预期日期不能为空":!0}]}]},i.titleReadonly=!1,i.title="",i.desc="",i.adjustCurrentDate=function(){var t=e.getVm(m).selectedValue,n=e.getVm(p).selectedValue;i.currentDate=a(i.currentDate).hour(t).minute(n)._d},i.setUnComplete=function(){var t=e.getVm(D);t.select(0),i.unCompleteState="edit",t.open()},i.setComplete=function(){var t=e.getVm(I);i.unCompleteState="view",t.title="完成",t.state="complete",t.reasonLabel="请说明完成工作的情况",t.open()},i.clickRemindSetting=function(){var o;i.isRemindOpen?"edit"===i.formState?t.confirm({iconType:"info",content:"您确定要关闭工作计划提醒吗？",onSubmit:function(){o={planId:r.params.id/1,isRemind:!1,isSendSms:!1,remindTime:0},t.c2s({url:s.BASE_PATH+"fesPlan/updateRemindFesPlanById.do",type:"post",contentType:"application/json",data:n.stringify(o),success:function(n){n.flag&&(t.alert({content:n.message,iconType:"success"}),i.isRemindOpen=!1,e.getVm(b).remindDate=a(i.currentDate).format("YYYY-MM-DD"),e.getVm(T).select(0))}})}}):"add"===i.formState&&(i.isRemindOpen=!1,e.getVm(b).remindDate=a(i.currentDate).format("YYYY-MM-DD"),e.getVm(T).select(0)):e.getVm(b).open()},i.submit=function(){var o,d,l,c=e.getVm(y),u=e.getVm(T),m=e.getVm(h);c.validate()&&(l=function(){o=c.getFormData(),o.isRemind=i.isRemindOpen,o.remindTime=i.isRemindOpen?a(e.getVm(b).remindDate+" "+u.selectedValue,"YYYY-MM-DD H")/1:0,o.endTime=0,o.sponsor=P.id,o.userId=P.id,o.remark="",o.plansSource="1",o.isSendSms=!1,0===o.merchantId&&(o.merchantId=null),"add"===i.formState?d=s.BASE_PATH+"fesPlan/saveFesPlan.do":"edit"===i.formState&&(d=s.BASE_PATH+"fesPlan/updateFesPlan.do",o.planId=r.params.id/1),t.c2s({url:d,type:"post",contentType:"application/json",data:n.stringify(o),success:function(e){e.flag&&t.alert({content:e.message,iconType:"success",onSubmit:function(){"work"===i.belongToRouteName?t.jumpPage("#/work/plan"):"frontend"===i.belongToRouteName?t.jumpPage("#/frontend/home"):"sales"===i.belongToRouteName&&t.jumpPage("#/sales/home")}})}})},m.uploading?(t.showGlobalMask(),m.$unwatch("uploading"),m.$watch("uploading",function(e){e||(t.hideGlobalMask(),l(),m.$unwatch("uploading"))})):l())}});e.scan(i[0]),A.removeClass("fn-hide").removeAttr("ms-skip"),e.scan(A[0],[e.getVm(h)]);var C={planItemType:!1,communicationFormType:!1};d.on("cptInited",function(){"edit"===V.formState?u(function(t){c(function(){e.getVm(g).selectValue(t.merchant_id)})}):c()}),l()},$remove:function(t,a){var n=a+"-start-hour",i=a+"-start-minute",o=a+"-project",s=a+"-plan-item-type",r=a+"communication-form-type",l=a+"-attach-uploader",c=a+"-form",u=a+"-remind-dialog",m=a+"-remind-time-selector",p=a+"-reason-dialog",g=a+"-reason-form",f=a+"-un-complete-selector",v=a+"-expect-date-calendar",h=a+"-expect-time-selector",y=a+"-remind-date-calendar",b=e.getVm(v),T=e.getVm(h),_=e.getVm(f),I=e.getVm(y);b&&$(b.widgetElement).remove(),T&&$(T.widgetElement).remove(),_&&$(_.widgetElement).remove(),I&&$(I.widgetElement).remove(),$(e.getVm(g).widgetElement).remove(),$(e.getVm(p).widgetElement).remove(),$(e.getVm(m).widgetElement).remove(),$(e.getVm(u).widgetElement).remove(),$(e.getVm(l).widgetElement).remove(),$(e.getVm(o).widgetElement).remove(),$(e.getVm(s).widgetElement).remove(),$(e.getVm(r).widgetElement).remove(),$(e.getVm(i).widgetElement).remove(),$(e.getVm(n).widgetElement).remove(),$(e.getVm(c).widgetElement).remove(),d.off("cptInited")}}),r});

//From origin\page\work\plan\plan.js
define("originpageworkplanplanjs",["avalon","util","moment","json","originmodulescheduleschedulejs"],function(e,t,a,n){var i=this,o=i.erp,s={};return _.extend(s,{$init:function(i,s){{var r=o.getAppData("user"),d=new Date,l=s+"-schedule";e.define(s,function(e){e.$scheduleOpts={scheduleId:l,onFetchPlan:function(e,a){t.c2s({url:o.BASE_PATH+"fesPlan/queryFesPlanList.do",type:"post",contentType:"application/json",data:n.stringify(_.extend({userId:r.id},e)),success:function(e){var t;e.flag?(t=e.data,a(t)):a([])}})},onClickDateCell:function(e){var n=this.$vmodel.$model,i=n.el.date,o=$(e.target);t.jumpPage(a(i).isBefore(d,"day")?o.is(".plan-item")?"#/work/plan/list/"+a(i)/1+"/"+o.data("planId"):"#/work/plan/list/"+a(i)/1:o.is(".plan-item")?"3"==o.data("status")||"4"==o.data("status")||"2"==o.data("status")||"5"==o.data("status")?"#/work/plan/list/"+a(i)/1+"/"+o.data("planId"):"#/work/plan/edit/"+a(i).hour(9)/1+"/"+o.data("planId"):"#/work/plan/add/"+a(i).hour(9)/1)}}})}e.scan(i[0])},$remove:function(t,a){var n=a+"-schedule";$(e.getVm(n).widgetElement).remove()}}),s});

