//From origin\asset\common.js
define("common",["avalon","util"],function(e,t){var n=this,a=document,i=n.erp;!function(){function t(e,t){return t=t.split("."),_.every(t,function(t){return e.hasOwnProperty(t)&&"object"==typeof e[t]?(e=e[t],!0):void 0})?!0:!1}function o(e,t){var n;return t=t.split("."),_.each(t,function(t){n=e[t],e=n}),n}{var r=i.module,s=/[^, ]+/g,l=e.vmodels,c=function(){};n.dispatchEvent&&a.implementation.hasFeature("MutationEvents","2.0")}_.extend(e.bindingHandlers,{module:function(t,n){function a(){return o.msRetain||document.documentElement.contains(o)?void 0:(y.$remove(),o.msData={},delete l[y.$id],!1)}var i=t.value.match(s),o=t.element,u=i[0];"$"!==i[1]&&i[1]||(i[1]=u+setTimeout("1")),t.value=i.join(",");var d=r[u];if("function"==typeof d){n=o.vmodels||n;for(var p,m=i[2]||u,f=0;p=n[f++];)if(p.hasOwnProperty(m)&&"object"==typeof p[m]){var v=p;break}if(v){var h=v[m];h=h.$model||h;var g=h[u+"Id"];"string"==typeof g&&(i[1]=g)}var T=e.getWidgetData(o,i[0]);t[u+"Id"]=i[1],t[u+"Options"]=e.mix({},d.defaults,h||{},T),o.removeAttribute("ms-module");var y=d(o,t,n)||{};t.evaluator=c,o.msData||(o.msData={},o.msData["ms-module"]=u),o.msData["ms-module-id"]=y.$id||"",y.hasOwnProperty("$init")&&y.$init(),y.hasOwnProperty("$remove")&&(window.chrome?o.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(a)}):e.tick(a))}else n.length&&(o.vmodels=n)},widget:function(n,a){function i(){return u.msRetain||document.documentElement.contains(u)?void 0:(b.$remove(),u.msData={},delete l[b.$id],!1)}var r=n.value.match(s),u=n.element,d=r[0];"$"!==r[1]&&r[1]||(r[1]=d+setTimeout("1")),n.value=r.join(",");var p=e.ui[d];if("function"==typeof p){a=u.vmodels||a;for(var m,f=r[2]||d,v=0;m=a[v++];)if(t(m,f)){var h=m;break}if(h){var g=o(h,f);g=g.$model||g;var T=g[d+"Id"];"string"==typeof T&&(r[1]=T)}var y=e.getWidgetData(u,r[0]);n[d+"Id"]=r[1],n[d+"Options"]=e.mix({},p.defaults,g||{},y),u.removeAttribute("ms-widget");var b=p(u,n,a)||{};n.evaluator=c,u.msData["ms-widget-id"]=b.$id||"",b.hasOwnProperty("$init")&&b.$init(),b.hasOwnProperty("$remove")&&(window.chrome?u.addEventListener("DOMNodeRemovedFromDocument",function(){setTimeout(i)}):e.tick(i))}else a.length&&(u.vmodels=a)}}),i.module=r}();var o=function(){var e=$("html");_.each([6,7,8,9],function(n){t.isIE(n)&&e.addClass("ie-"+n)})},r=function(){var e,t=0;$("body").on("focus",".input-text,textarea",function(){$(this).addClass("input-focus")}).on("blur",".input-text,textarea",function(){$(this).removeClass("input-focus")}).on("click",".mn-radio",function(){var e=$(this),t=e.parent();e.hasClass("mn-radio-state-readonly")||($(".mn-radio-state-selected",t).removeClass("mn-radio-state-selected"),e.addClass("mn-radio-state-selected"))}).on("click",".label-for",function(){var e=$(this),n=$("input",e),a=$("label",e),i=n.attr("id");i||(i="label-for-"+t,n.attr("id",i),t++),a.attr("for")||a.attr("for",i)}).on("focus",".input-text",function(){var t=$("#input-text-close"),n=$(this),o=n.offset();t.length||(t=$('<div id="input-text-close">&#10005;</div>'),t.appendTo("body")),t.data("input",n),clearTimeout(e),t.css({top:o.top+1,left:o.left+n.outerWidth()-32}).show();var r=i.msValueStore;r=_.reject(r,function(e){return!$.contains(a.body,e.element)}),i.msValueStore=r}).on("blur",".input-text",function(){var t=$("#input-text-close");clearTimeout(e),e=setTimeout(function(){t.removeData("input").hide()},160)}).on("click","#input-text-close",function(){var t=$(this),n=t.data("input"),a=i.msValueStore;clearTimeout(e),_.some(a,function(e){var t,a;return e.element===n[0]?(t=e.text,a=e.vmodels,_.some(a,function(e){return e.hasOwnProperty(t)?(e[t]="",!0):void 0}),!0):void 0}),n.val(""),t.removeData("input").hide()})},s=function(){$("body").on("click",".force-refresh-link",function(){var t=$(this).attr("href").split("#")[1],n=e.History.getHash(window.location).slice(2);t===n&&e.router.navigate(t)})},l=function(e){o(),r(),s();var n=$("#page-wrapper"),a=$(".app-bd .app-inner");t.regRouter(n,a,function(){e&&e()})};return{setup:l}});